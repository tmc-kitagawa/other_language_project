var ck=Object.defineProperty;var hk=(t,e,r)=>e in t?ck(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Ai=(t,e,r)=>(hk(t,typeof e!="symbol"?e+"":e,r),r);function dk(t,e){for(var r=0;r<e.length;r++){const n=e[r];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(n,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();function Tl(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var V0={exports:{}},Fd={},B0={exports:{}},we={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Al=Symbol.for("react.element"),fk=Symbol.for("react.portal"),pk=Symbol.for("react.fragment"),mk=Symbol.for("react.strict_mode"),gk=Symbol.for("react.profiler"),yk=Symbol.for("react.provider"),bk=Symbol.for("react.context"),wk=Symbol.for("react.forward_ref"),vk=Symbol.for("react.suspense"),_k=Symbol.for("react.memo"),Pk=Symbol.for("react.lazy"),Uw=Symbol.iterator;function Ok(t){return t===null||typeof t!="object"?null:(t=Uw&&t[Uw]||t["@@iterator"],typeof t=="function"?t:null)}var H0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},W0=Object.assign,J0={};function go(t,e,r){this.props=t,this.context=e,this.refs=J0,this.updater=r||H0}go.prototype.isReactComponent={};go.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};go.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function G0(){}G0.prototype=go.prototype;function Jg(t,e,r){this.props=t,this.context=e,this.refs=J0,this.updater=r||H0}var Gg=Jg.prototype=new G0;Gg.constructor=Jg;W0(Gg,go.prototype);Gg.isPureReactComponent=!0;var qw=Array.isArray,Z0=Object.prototype.hasOwnProperty,Zg={current:null},Y0={key:!0,ref:!0,__self:!0,__source:!0};function Q0(t,e,r){var n,i={},s=null,a=null;if(e!=null)for(n in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)Z0.call(e,n)&&!Y0.hasOwnProperty(n)&&(i[n]=e[n]);var o=arguments.length-2;if(o===1)i.children=r;else if(1<o){for(var u=Array(o),l=0;l<o;l++)u[l]=arguments[l+2];i.children=u}if(t&&t.defaultProps)for(n in o=t.defaultProps,o)i[n]===void 0&&(i[n]=o[n]);return{$$typeof:Al,type:t,key:s,ref:a,props:i,_owner:Zg.current}}function Sk(t,e){return{$$typeof:Al,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Yg(t){return typeof t=="object"&&t!==null&&t.$$typeof===Al}function xk(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var Kw=/\/+/g;function Jf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?xk(""+t.key):e.toString(36)}function Cc(t,e,r,n,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case Al:case fk:a=!0}}if(a)return a=t,i=i(a),t=n===""?"."+Jf(a,0):n,qw(i)?(r="",t!=null&&(r=t.replace(Kw,"$&/")+"/"),Cc(i,e,r,"",function(l){return l})):i!=null&&(Yg(i)&&(i=Sk(i,r+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(Kw,"$&/")+"/")+t)),e.push(i)),1;if(a=0,n=n===""?".":n+":",qw(t))for(var o=0;o<t.length;o++){s=t[o];var u=n+Jf(s,o);a+=Cc(s,e,r,u,i)}else if(u=Ok(t),typeof u=="function")for(t=u.call(t),o=0;!(s=t.next()).done;)s=s.value,u=n+Jf(s,o++),a+=Cc(s,e,r,u,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function rc(t,e,r){if(t==null)return t;var n=[],i=0;return Cc(t,n,"","",function(s){return e.call(r,s,i++)}),n}function Ek(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var or={current:null},Rc={transition:null},Tk={ReactCurrentDispatcher:or,ReactCurrentBatchConfig:Rc,ReactCurrentOwner:Zg};function X0(){throw Error("act(...) is not supported in production builds of React.")}we.Children={map:rc,forEach:function(t,e,r){rc(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return rc(t,function(){e++}),e},toArray:function(t){return rc(t,function(e){return e})||[]},only:function(t){if(!Yg(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};we.Component=go;we.Fragment=pk;we.Profiler=gk;we.PureComponent=Jg;we.StrictMode=mk;we.Suspense=vk;we.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Tk;we.act=X0;we.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=W0({},t.props),i=t.key,s=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=Zg.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var o=t.type.defaultProps;for(u in e)Z0.call(e,u)&&!Y0.hasOwnProperty(u)&&(n[u]=e[u]===void 0&&o!==void 0?o[u]:e[u])}var u=arguments.length-2;if(u===1)n.children=r;else if(1<u){o=Array(u);for(var l=0;l<u;l++)o[l]=arguments[l+2];n.children=o}return{$$typeof:Al,type:t.type,key:i,ref:s,props:n,_owner:a}};we.createContext=function(t){return t={$$typeof:bk,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:yk,_context:t},t.Consumer=t};we.createElement=Q0;we.createFactory=function(t){var e=Q0.bind(null,t);return e.type=t,e};we.createRef=function(){return{current:null}};we.forwardRef=function(t){return{$$typeof:wk,render:t}};we.isValidElement=Yg;we.lazy=function(t){return{$$typeof:Pk,_payload:{_status:-1,_result:t},_init:Ek}};we.memo=function(t,e){return{$$typeof:_k,type:t,compare:e===void 0?null:e}};we.startTransition=function(t){var e=Rc.transition;Rc.transition={};try{t()}finally{Rc.transition=e}};we.unstable_act=X0;we.useCallback=function(t,e){return or.current.useCallback(t,e)};we.useContext=function(t){return or.current.useContext(t)};we.useDebugValue=function(){};we.useDeferredValue=function(t){return or.current.useDeferredValue(t)};we.useEffect=function(t,e){return or.current.useEffect(t,e)};we.useId=function(){return or.current.useId()};we.useImperativeHandle=function(t,e,r){return or.current.useImperativeHandle(t,e,r)};we.useInsertionEffect=function(t,e){return or.current.useInsertionEffect(t,e)};we.useLayoutEffect=function(t,e){return or.current.useLayoutEffect(t,e)};we.useMemo=function(t,e){return or.current.useMemo(t,e)};we.useReducer=function(t,e,r){return or.current.useReducer(t,e,r)};we.useRef=function(t){return or.current.useRef(t)};we.useState=function(t){return or.current.useState(t)};we.useSyncExternalStore=function(t,e,r){return or.current.useSyncExternalStore(t,e,r)};we.useTransition=function(){return or.current.useTransition()};we.version="18.3.1";B0.exports=we;var V=B0.exports;const dr=Tl(V),Ak=dk({__proto__:null,default:dr},[V]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kk=V,Ik=Symbol.for("react.element"),Ck=Symbol.for("react.fragment"),Rk=Object.prototype.hasOwnProperty,jk=kk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Nk={key:!0,ref:!0,__self:!0,__source:!0};function eP(t,e,r){var n,i={},s=null,a=null;r!==void 0&&(s=""+r),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)Rk.call(e,n)&&!Nk.hasOwnProperty(n)&&(i[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)i[n]===void 0&&(i[n]=e[n]);return{$$typeof:Ik,type:t,key:s,ref:a,props:i,_owner:jk.current}}Fd.Fragment=Ck;Fd.jsx=eP;Fd.jsxs=eP;V0.exports=Fd;var oe=V0.exports,rm={},tP={exports:{}},Fr={},rP={exports:{}},nP={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(q,ie){var te=q.length;q.push(ie);e:for(;0<te;){var _e=te-1>>>1,Ne=q[_e];if(0<i(Ne,ie))q[_e]=ie,q[te]=Ne,te=_e;else break e}}function r(q){return q.length===0?null:q[0]}function n(q){if(q.length===0)return null;var ie=q[0],te=q.pop();if(te!==ie){q[0]=te;e:for(var _e=0,Ne=q.length,qr=Ne>>>1;_e<qr;){var Mt=2*(_e+1)-1,Ct=q[Mt],_=Mt+1,w=q[_];if(0>i(Ct,te))_<Ne&&0>i(w,Ct)?(q[_e]=w,q[_]=te,_e=_):(q[_e]=Ct,q[Mt]=te,_e=Mt);else if(_<Ne&&0>i(w,te))q[_e]=w,q[_]=te,_e=_;else break e}}return ie}function i(q,ie){var te=q.sortIndex-ie.sortIndex;return te!==0?te:q.id-ie.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();t.unstable_now=function(){return a.now()-o}}var u=[],l=[],c=1,h=null,d=3,f=!1,p=!1,y=!1,v=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(q){for(var ie=r(l);ie!==null;){if(ie.callback===null)n(l);else if(ie.startTime<=q)n(l),ie.sortIndex=ie.expirationTime,e(u,ie);else break;ie=r(l)}}function S(q){if(y=!1,b(q),!p)if(r(u)!==null)p=!0,ce(E);else{var ie=r(l);ie!==null&&rt(S,ie.startTime-q)}}function E(q,ie){p=!1,y&&(y=!1,g(P),P=-1),f=!0;var te=d;try{for(b(ie),h=r(u);h!==null&&(!(h.expirationTime>ie)||q&&!le());){var _e=h.callback;if(typeof _e=="function"){h.callback=null,d=h.priorityLevel;var Ne=_e(h.expirationTime<=ie);ie=t.unstable_now(),typeof Ne=="function"?h.callback=Ne:h===r(u)&&n(u),b(ie)}else n(u);h=r(u)}if(h!==null)var qr=!0;else{var Mt=r(l);Mt!==null&&rt(S,Mt.startTime-ie),qr=!1}return qr}finally{h=null,d=te,f=!1}}var I=!1,j=null,P=-1,G=5,U=-1;function le(){return!(t.unstable_now()-U<G)}function ae(){if(j!==null){var q=t.unstable_now();U=q;var ie=!0;try{ie=j(!0,q)}finally{ie?de():(I=!1,j=null)}}else I=!1}var de;if(typeof m=="function")de=function(){m(ae)};else if(typeof MessageChannel<"u"){var Ee=new MessageChannel,ze=Ee.port2;Ee.port1.onmessage=ae,de=function(){ze.postMessage(null)}}else de=function(){v(ae,0)};function ce(q){j=q,I||(I=!0,de())}function rt(q,ie){P=v(function(){q(t.unstable_now())},ie)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(q){q.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,ce(E))},t.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<q?Math.floor(1e3/q):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return r(u)},t.unstable_next=function(q){switch(d){case 1:case 2:case 3:var ie=3;break;default:ie=d}var te=d;d=ie;try{return q()}finally{d=te}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(q,ie){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var te=d;d=q;try{return ie()}finally{d=te}},t.unstable_scheduleCallback=function(q,ie,te){var _e=t.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?_e+te:_e):te=_e,q){case 1:var Ne=-1;break;case 2:Ne=250;break;case 5:Ne=1073741823;break;case 4:Ne=1e4;break;default:Ne=5e3}return Ne=te+Ne,q={id:c++,callback:ie,priorityLevel:q,startTime:te,expirationTime:Ne,sortIndex:-1},te>_e?(q.sortIndex=te,e(l,q),r(u)===null&&q===r(l)&&(y?(g(P),P=-1):y=!0,rt(S,te-_e))):(q.sortIndex=Ne,e(u,q),p||f||(p=!0,ce(E))),q},t.unstable_shouldYield=le,t.unstable_wrapCallback=function(q){var ie=d;return function(){var te=d;d=ie;try{return q.apply(this,arguments)}finally{d=te}}}})(nP);rP.exports=nP;var $k=rP.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lk=V,Lr=$k;function M(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var iP=new Set,Iu={};function Qs(t,e){Xa(t,e),Xa(t+"Capture",e)}function Xa(t,e){for(Iu[t]=e,t=0;t<e.length;t++)iP.add(e[t])}var mi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),nm=Object.prototype.hasOwnProperty,Dk=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Vw={},Bw={};function Mk(t){return nm.call(Bw,t)?!0:nm.call(Vw,t)?!1:Dk.test(t)?Bw[t]=!0:(Vw[t]=!0,!1)}function Fk(t,e,r,n){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function zk(t,e,r,n){if(e===null||typeof e>"u"||Fk(t,e,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ur(t,e,r,n,i,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var Dt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Dt[t]=new ur(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Dt[e]=new ur(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Dt[t]=new ur(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Dt[t]=new ur(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Dt[t]=new ur(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Dt[t]=new ur(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Dt[t]=new ur(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Dt[t]=new ur(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Dt[t]=new ur(t,5,!1,t.toLowerCase(),null,!1,!1)});var Qg=/[\-:]([a-z])/g;function Xg(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Qg,Xg);Dt[e]=new ur(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Qg,Xg);Dt[e]=new ur(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Qg,Xg);Dt[e]=new ur(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Dt[t]=new ur(t,1,!1,t.toLowerCase(),null,!1,!1)});Dt.xlinkHref=new ur("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Dt[t]=new ur(t,1,!1,t.toLowerCase(),null,!0,!0)});function ey(t,e,r,n){var i=Dt.hasOwnProperty(e)?Dt[e]:null;(i!==null?i.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(zk(e,r,i,n)&&(r=null),n||i===null?Mk(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):i.mustUseProperty?t[i.propertyName]=r===null?i.type===3?!1:"":r:(e=i.attributeName,n=i.attributeNamespace,r===null?t.removeAttribute(e):(i=i.type,r=i===3||i===4&&r===!0?"":""+r,n?t.setAttributeNS(n,e,r):t.setAttribute(e,r))))}var Pi=Lk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,nc=Symbol.for("react.element"),Pa=Symbol.for("react.portal"),Oa=Symbol.for("react.fragment"),ty=Symbol.for("react.strict_mode"),im=Symbol.for("react.profiler"),sP=Symbol.for("react.provider"),aP=Symbol.for("react.context"),ry=Symbol.for("react.forward_ref"),sm=Symbol.for("react.suspense"),am=Symbol.for("react.suspense_list"),ny=Symbol.for("react.memo"),$i=Symbol.for("react.lazy"),oP=Symbol.for("react.offscreen"),Hw=Symbol.iterator;function Mo(t){return t===null||typeof t!="object"?null:(t=Hw&&t[Hw]||t["@@iterator"],typeof t=="function"?t:null)}var tt=Object.assign,Gf;function Zo(t){if(Gf===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);Gf=e&&e[1]||""}return`
`+Gf+t}var Zf=!1;function Yf(t,e){if(!t||Zf)return"";Zf=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var n=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){n=l}t.call(e.prototype)}else{try{throw Error()}catch(l){n=l}t()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),s=n.stack.split(`
`),a=i.length-1,o=s.length-1;1<=a&&0<=o&&i[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(i[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||i[a]!==s[o]){var u=`
`+i[a].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=a&&0<=o);break}}}finally{Zf=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?Zo(t):""}function Uk(t){switch(t.tag){case 5:return Zo(t.type);case 16:return Zo("Lazy");case 13:return Zo("Suspense");case 19:return Zo("SuspenseList");case 0:case 2:case 15:return t=Yf(t.type,!1),t;case 11:return t=Yf(t.type.render,!1),t;case 1:return t=Yf(t.type,!0),t;default:return""}}function om(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Oa:return"Fragment";case Pa:return"Portal";case im:return"Profiler";case ty:return"StrictMode";case sm:return"Suspense";case am:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case aP:return(t.displayName||"Context")+".Consumer";case sP:return(t._context.displayName||"Context")+".Provider";case ry:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case ny:return e=t.displayName||null,e!==null?e:om(t.type)||"Memo";case $i:e=t._payload,t=t._init;try{return om(t(e))}catch{}}return null}function qk(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return om(e);case 8:return e===ty?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ns(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function uP(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Kk(t){var e=uP(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var i=r.get,s=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){n=""+a,s.call(this,a)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(a){n=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function ic(t){t._valueTracker||(t._valueTracker=Kk(t))}function lP(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),n="";return t&&(n=uP(t)?t.checked?"true":"false":t.value),t=n,t!==r?(e.setValue(t),!0):!1}function uh(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function um(t,e){var r=e.checked;return tt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function Ww(t,e){var r=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;r=ns(e.value!=null?e.value:r),t._wrapperState={initialChecked:n,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function cP(t,e){e=e.checked,e!=null&&ey(t,"checked",e,!1)}function lm(t,e){cP(t,e);var r=ns(e.value),n=e.type;if(r!=null)n==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?cm(t,e.type,r):e.hasOwnProperty("defaultValue")&&cm(t,e.type,ns(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Jw(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function cm(t,e,r){(e!=="number"||uh(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var Yo=Array.isArray;function za(t,e,r,n){if(t=t.options,e){e={};for(var i=0;i<r.length;i++)e["$"+r[i]]=!0;for(r=0;r<t.length;r++)i=e.hasOwnProperty("$"+t[r].value),t[r].selected!==i&&(t[r].selected=i),i&&n&&(t[r].defaultSelected=!0)}else{for(r=""+ns(r),e=null,i=0;i<t.length;i++){if(t[i].value===r){t[i].selected=!0,n&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function hm(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(M(91));return tt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Gw(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(M(92));if(Yo(r)){if(1<r.length)throw Error(M(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:ns(r)}}function hP(t,e){var r=ns(e.value),n=ns(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),n!=null&&(t.defaultValue=""+n)}function Zw(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function dP(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function dm(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?dP(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var sc,fP=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,n,i){MSApp.execUnsafeLocalFunction(function(){return t(e,r,n,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(sc=sc||document.createElement("div"),sc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=sc.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Cu(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var pu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Vk=["Webkit","ms","Moz","O"];Object.keys(pu).forEach(function(t){Vk.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),pu[e]=pu[t]})});function pP(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||pu.hasOwnProperty(t)&&pu[t]?(""+e).trim():e+"px"}function mP(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var n=r.indexOf("--")===0,i=pP(r,e[r],n);r==="float"&&(r="cssFloat"),n?t.setProperty(r,i):t[r]=i}}var Bk=tt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fm(t,e){if(e){if(Bk[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(M(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(M(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(M(61))}if(e.style!=null&&typeof e.style!="object")throw Error(M(62))}}function pm(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mm=null;function iy(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var gm=null,Ua=null,qa=null;function Yw(t){if(t=Cl(t)){if(typeof gm!="function")throw Error(M(280));var e=t.stateNode;e&&(e=Vd(e),gm(t.stateNode,t.type,e))}}function gP(t){Ua?qa?qa.push(t):qa=[t]:Ua=t}function yP(){if(Ua){var t=Ua,e=qa;if(qa=Ua=null,Yw(t),e)for(t=0;t<e.length;t++)Yw(e[t])}}function bP(t,e){return t(e)}function wP(){}var Qf=!1;function vP(t,e,r){if(Qf)return t(e,r);Qf=!0;try{return bP(t,e,r)}finally{Qf=!1,(Ua!==null||qa!==null)&&(wP(),yP())}}function Ru(t,e){var r=t.stateNode;if(r===null)return null;var n=Vd(r);if(n===null)return null;r=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(M(231,e,typeof r));return r}var ym=!1;if(mi)try{var Fo={};Object.defineProperty(Fo,"passive",{get:function(){ym=!0}}),window.addEventListener("test",Fo,Fo),window.removeEventListener("test",Fo,Fo)}catch{ym=!1}function Hk(t,e,r,n,i,s,a,o,u){var l=Array.prototype.slice.call(arguments,3);try{e.apply(r,l)}catch(c){this.onError(c)}}var mu=!1,lh=null,ch=!1,bm=null,Wk={onError:function(t){mu=!0,lh=t}};function Jk(t,e,r,n,i,s,a,o,u){mu=!1,lh=null,Hk.apply(Wk,arguments)}function Gk(t,e,r,n,i,s,a,o,u){if(Jk.apply(this,arguments),mu){if(mu){var l=lh;mu=!1,lh=null}else throw Error(M(198));ch||(ch=!0,bm=l)}}function Xs(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function _P(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Qw(t){if(Xs(t)!==t)throw Error(M(188))}function Zk(t){var e=t.alternate;if(!e){if(e=Xs(t),e===null)throw Error(M(188));return e!==t?null:t}for(var r=t,n=e;;){var i=r.return;if(i===null)break;var s=i.alternate;if(s===null){if(n=i.return,n!==null){r=n;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===r)return Qw(i),t;if(s===n)return Qw(i),e;s=s.sibling}throw Error(M(188))}if(r.return!==n.return)r=i,n=s;else{for(var a=!1,o=i.child;o;){if(o===r){a=!0,r=i,n=s;break}if(o===n){a=!0,n=i,r=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===r){a=!0,r=s,n=i;break}if(o===n){a=!0,n=s,r=i;break}o=o.sibling}if(!a)throw Error(M(189))}}if(r.alternate!==n)throw Error(M(190))}if(r.tag!==3)throw Error(M(188));return r.stateNode.current===r?t:e}function PP(t){return t=Zk(t),t!==null?OP(t):null}function OP(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=OP(t);if(e!==null)return e;t=t.sibling}return null}var SP=Lr.unstable_scheduleCallback,Xw=Lr.unstable_cancelCallback,Yk=Lr.unstable_shouldYield,Qk=Lr.unstable_requestPaint,at=Lr.unstable_now,Xk=Lr.unstable_getCurrentPriorityLevel,sy=Lr.unstable_ImmediatePriority,xP=Lr.unstable_UserBlockingPriority,hh=Lr.unstable_NormalPriority,eI=Lr.unstable_LowPriority,EP=Lr.unstable_IdlePriority,zd=null,Jn=null;function tI(t){if(Jn&&typeof Jn.onCommitFiberRoot=="function")try{Jn.onCommitFiberRoot(zd,t,void 0,(t.current.flags&128)===128)}catch{}}var xn=Math.clz32?Math.clz32:iI,rI=Math.log,nI=Math.LN2;function iI(t){return t>>>=0,t===0?32:31-(rI(t)/nI|0)|0}var ac=64,oc=4194304;function Qo(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function dh(t,e){var r=t.pendingLanes;if(r===0)return 0;var n=0,i=t.suspendedLanes,s=t.pingedLanes,a=r&268435455;if(a!==0){var o=a&~i;o!==0?n=Qo(o):(s&=a,s!==0&&(n=Qo(s)))}else a=r&~i,a!==0?n=Qo(a):s!==0&&(n=Qo(s));if(n===0)return 0;if(e!==0&&e!==n&&!(e&i)&&(i=n&-n,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(n&4&&(n|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)r=31-xn(e),i=1<<r,n|=t[r],e&=~i;return n}function sI(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function aI(t,e){for(var r=t.suspendedLanes,n=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var a=31-xn(s),o=1<<a,u=i[a];u===-1?(!(o&r)||o&n)&&(i[a]=sI(o,e)):u<=e&&(t.expiredLanes|=o),s&=~o}}function wm(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function TP(){var t=ac;return ac<<=1,!(ac&4194240)&&(ac=64),t}function Xf(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function kl(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-xn(e),t[e]=r}function oI(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<r;){var i=31-xn(r),s=1<<i;e[i]=0,n[i]=-1,t[i]=-1,r&=~s}}function ay(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var n=31-xn(r),i=1<<n;i&e|t[n]&e&&(t[n]|=e),r&=~i}}var Re=0;function AP(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var kP,oy,IP,CP,RP,vm=!1,uc=[],Wi=null,Ji=null,Gi=null,ju=new Map,Nu=new Map,Di=[],uI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ev(t,e){switch(t){case"focusin":case"focusout":Wi=null;break;case"dragenter":case"dragleave":Ji=null;break;case"mouseover":case"mouseout":Gi=null;break;case"pointerover":case"pointerout":ju.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nu.delete(e.pointerId)}}function zo(t,e,r,n,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:r,eventSystemFlags:n,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Cl(e),e!==null&&oy(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function lI(t,e,r,n,i){switch(e){case"focusin":return Wi=zo(Wi,t,e,r,n,i),!0;case"dragenter":return Ji=zo(Ji,t,e,r,n,i),!0;case"mouseover":return Gi=zo(Gi,t,e,r,n,i),!0;case"pointerover":var s=i.pointerId;return ju.set(s,zo(ju.get(s)||null,t,e,r,n,i)),!0;case"gotpointercapture":return s=i.pointerId,Nu.set(s,zo(Nu.get(s)||null,t,e,r,n,i)),!0}return!1}function jP(t){var e=Os(t.target);if(e!==null){var r=Xs(e);if(r!==null){if(e=r.tag,e===13){if(e=_P(r),e!==null){t.blockedOn=e,RP(t.priority,function(){IP(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function jc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=_m(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var n=new r.constructor(r.type,r);mm=n,r.target.dispatchEvent(n),mm=null}else return e=Cl(r),e!==null&&oy(e),t.blockedOn=r,!1;e.shift()}return!0}function tv(t,e,r){jc(t)&&r.delete(e)}function cI(){vm=!1,Wi!==null&&jc(Wi)&&(Wi=null),Ji!==null&&jc(Ji)&&(Ji=null),Gi!==null&&jc(Gi)&&(Gi=null),ju.forEach(tv),Nu.forEach(tv)}function Uo(t,e){t.blockedOn===e&&(t.blockedOn=null,vm||(vm=!0,Lr.unstable_scheduleCallback(Lr.unstable_NormalPriority,cI)))}function $u(t){function e(i){return Uo(i,t)}if(0<uc.length){Uo(uc[0],t);for(var r=1;r<uc.length;r++){var n=uc[r];n.blockedOn===t&&(n.blockedOn=null)}}for(Wi!==null&&Uo(Wi,t),Ji!==null&&Uo(Ji,t),Gi!==null&&Uo(Gi,t),ju.forEach(e),Nu.forEach(e),r=0;r<Di.length;r++)n=Di[r],n.blockedOn===t&&(n.blockedOn=null);for(;0<Di.length&&(r=Di[0],r.blockedOn===null);)jP(r),r.blockedOn===null&&Di.shift()}var Ka=Pi.ReactCurrentBatchConfig,fh=!0;function hI(t,e,r,n){var i=Re,s=Ka.transition;Ka.transition=null;try{Re=1,uy(t,e,r,n)}finally{Re=i,Ka.transition=s}}function dI(t,e,r,n){var i=Re,s=Ka.transition;Ka.transition=null;try{Re=4,uy(t,e,r,n)}finally{Re=i,Ka.transition=s}}function uy(t,e,r,n){if(fh){var i=_m(t,e,r,n);if(i===null)lp(t,e,n,ph,r),ev(t,n);else if(lI(i,t,e,r,n))n.stopPropagation();else if(ev(t,n),e&4&&-1<uI.indexOf(t)){for(;i!==null;){var s=Cl(i);if(s!==null&&kP(s),s=_m(t,e,r,n),s===null&&lp(t,e,n,ph,r),s===i)break;i=s}i!==null&&n.stopPropagation()}else lp(t,e,n,null,r)}}var ph=null;function _m(t,e,r,n){if(ph=null,t=iy(n),t=Os(t),t!==null)if(e=Xs(t),e===null)t=null;else if(r=e.tag,r===13){if(t=_P(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return ph=t,null}function NP(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xk()){case sy:return 1;case xP:return 4;case hh:case eI:return 16;case EP:return 536870912;default:return 16}default:return 16}}var qi=null,ly=null,Nc=null;function $P(){if(Nc)return Nc;var t,e=ly,r=e.length,n,i="value"in qi?qi.value:qi.textContent,s=i.length;for(t=0;t<r&&e[t]===i[t];t++);var a=r-t;for(n=1;n<=a&&e[r-n]===i[s-n];n++);return Nc=i.slice(t,1<n?1-n:void 0)}function $c(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function lc(){return!0}function rv(){return!1}function zr(t){function e(r,n,i,s,a){this._reactName=r,this._targetInst=i,this.type=n,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(r=t[o],this[o]=r?r(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?lc:rv,this.isPropagationStopped=rv,this}return tt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=lc)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=lc)},persist:function(){},isPersistent:lc}),e}var yo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cy=zr(yo),Il=tt({},yo,{view:0,detail:0}),fI=zr(Il),ep,tp,qo,Ud=tt({},Il,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:hy,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==qo&&(qo&&t.type==="mousemove"?(ep=t.screenX-qo.screenX,tp=t.screenY-qo.screenY):tp=ep=0,qo=t),ep)},movementY:function(t){return"movementY"in t?t.movementY:tp}}),nv=zr(Ud),pI=tt({},Ud,{dataTransfer:0}),mI=zr(pI),gI=tt({},Il,{relatedTarget:0}),rp=zr(gI),yI=tt({},yo,{animationName:0,elapsedTime:0,pseudoElement:0}),bI=zr(yI),wI=tt({},yo,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),vI=zr(wI),_I=tt({},yo,{data:0}),iv=zr(_I),PI={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},OI={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},SI={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xI(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=SI[t])?!!e[t]:!1}function hy(){return xI}var EI=tt({},Il,{key:function(t){if(t.key){var e=PI[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=$c(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?OI[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:hy,charCode:function(t){return t.type==="keypress"?$c(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?$c(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),TI=zr(EI),AI=tt({},Ud,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sv=zr(AI),kI=tt({},Il,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:hy}),II=zr(kI),CI=tt({},yo,{propertyName:0,elapsedTime:0,pseudoElement:0}),RI=zr(CI),jI=tt({},Ud,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),NI=zr(jI),$I=[9,13,27,32],dy=mi&&"CompositionEvent"in window,gu=null;mi&&"documentMode"in document&&(gu=document.documentMode);var LI=mi&&"TextEvent"in window&&!gu,LP=mi&&(!dy||gu&&8<gu&&11>=gu),av=" ",ov=!1;function DP(t,e){switch(t){case"keyup":return $I.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function MP(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Sa=!1;function DI(t,e){switch(t){case"compositionend":return MP(e);case"keypress":return e.which!==32?null:(ov=!0,av);case"textInput":return t=e.data,t===av&&ov?null:t;default:return null}}function MI(t,e){if(Sa)return t==="compositionend"||!dy&&DP(t,e)?(t=$P(),Nc=ly=qi=null,Sa=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return LP&&e.locale!=="ko"?null:e.data;default:return null}}var FI={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function uv(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!FI[t.type]:e==="textarea"}function FP(t,e,r,n){gP(n),e=mh(e,"onChange"),0<e.length&&(r=new cy("onChange","change",null,r,n),t.push({event:r,listeners:e}))}var yu=null,Lu=null;function zI(t){ZP(t,0)}function qd(t){var e=Ta(t);if(lP(e))return t}function UI(t,e){if(t==="change")return e}var zP=!1;if(mi){var np;if(mi){var ip="oninput"in document;if(!ip){var lv=document.createElement("div");lv.setAttribute("oninput","return;"),ip=typeof lv.oninput=="function"}np=ip}else np=!1;zP=np&&(!document.documentMode||9<document.documentMode)}function cv(){yu&&(yu.detachEvent("onpropertychange",UP),Lu=yu=null)}function UP(t){if(t.propertyName==="value"&&qd(Lu)){var e=[];FP(e,Lu,t,iy(t)),vP(zI,e)}}function qI(t,e,r){t==="focusin"?(cv(),yu=e,Lu=r,yu.attachEvent("onpropertychange",UP)):t==="focusout"&&cv()}function KI(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return qd(Lu)}function VI(t,e){if(t==="click")return qd(e)}function BI(t,e){if(t==="input"||t==="change")return qd(e)}function HI(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var kn=typeof Object.is=="function"?Object.is:HI;function Du(t,e){if(kn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var i=r[n];if(!nm.call(e,i)||!kn(t[i],e[i]))return!1}return!0}function hv(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function dv(t,e){var r=hv(t);t=0;for(var n;r;){if(r.nodeType===3){if(n=t+r.textContent.length,t<=e&&n>=e)return{node:r,offset:e-t};t=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=hv(r)}}function qP(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?qP(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function KP(){for(var t=window,e=uh();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=uh(t.document)}return e}function fy(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function WI(t){var e=KP(),r=t.focusedElem,n=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&qP(r.ownerDocument.documentElement,r)){if(n!==null&&fy(r)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=r.textContent.length,s=Math.min(n.start,i);n=n.end===void 0?s:Math.min(n.end,i),!t.extend&&s>n&&(i=n,n=s,s=i),i=dv(r,s);var a=dv(r,n);i&&a&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>n?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var JI=mi&&"documentMode"in document&&11>=document.documentMode,xa=null,Pm=null,bu=null,Om=!1;function fv(t,e,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;Om||xa==null||xa!==uh(n)||(n=xa,"selectionStart"in n&&fy(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),bu&&Du(bu,n)||(bu=n,n=mh(Pm,"onSelect"),0<n.length&&(e=new cy("onSelect","select",null,e,r),t.push({event:e,listeners:n}),e.target=xa)))}function cc(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var Ea={animationend:cc("Animation","AnimationEnd"),animationiteration:cc("Animation","AnimationIteration"),animationstart:cc("Animation","AnimationStart"),transitionend:cc("Transition","TransitionEnd")},sp={},VP={};mi&&(VP=document.createElement("div").style,"AnimationEvent"in window||(delete Ea.animationend.animation,delete Ea.animationiteration.animation,delete Ea.animationstart.animation),"TransitionEvent"in window||delete Ea.transitionend.transition);function Kd(t){if(sp[t])return sp[t];if(!Ea[t])return t;var e=Ea[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in VP)return sp[t]=e[r];return t}var BP=Kd("animationend"),HP=Kd("animationiteration"),WP=Kd("animationstart"),JP=Kd("transitionend"),GP=new Map,pv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function cs(t,e){GP.set(t,e),Qs(e,[t])}for(var ap=0;ap<pv.length;ap++){var op=pv[ap],GI=op.toLowerCase(),ZI=op[0].toUpperCase()+op.slice(1);cs(GI,"on"+ZI)}cs(BP,"onAnimationEnd");cs(HP,"onAnimationIteration");cs(WP,"onAnimationStart");cs("dblclick","onDoubleClick");cs("focusin","onFocus");cs("focusout","onBlur");cs(JP,"onTransitionEnd");Xa("onMouseEnter",["mouseout","mouseover"]);Xa("onMouseLeave",["mouseout","mouseover"]);Xa("onPointerEnter",["pointerout","pointerover"]);Xa("onPointerLeave",["pointerout","pointerover"]);Qs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Qs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Qs("onBeforeInput",["compositionend","keypress","textInput","paste"]);Qs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Qs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Qs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),YI=new Set("cancel close invalid load scroll toggle".split(" ").concat(Xo));function mv(t,e,r){var n=t.type||"unknown-event";t.currentTarget=r,Gk(n,e,void 0,t),t.currentTarget=null}function ZP(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var n=t[r],i=n.event;n=n.listeners;e:{var s=void 0;if(e)for(var a=n.length-1;0<=a;a--){var o=n[a],u=o.instance,l=o.currentTarget;if(o=o.listener,u!==s&&i.isPropagationStopped())break e;mv(i,o,l),s=u}else for(a=0;a<n.length;a++){if(o=n[a],u=o.instance,l=o.currentTarget,o=o.listener,u!==s&&i.isPropagationStopped())break e;mv(i,o,l),s=u}}}if(ch)throw t=bm,ch=!1,bm=null,t}function Ue(t,e){var r=e[Am];r===void 0&&(r=e[Am]=new Set);var n=t+"__bubble";r.has(n)||(YP(e,t,2,!1),r.add(n))}function up(t,e,r){var n=0;e&&(n|=4),YP(r,t,n,e)}var hc="_reactListening"+Math.random().toString(36).slice(2);function Mu(t){if(!t[hc]){t[hc]=!0,iP.forEach(function(r){r!=="selectionchange"&&(YI.has(r)||up(r,!1,t),up(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[hc]||(e[hc]=!0,up("selectionchange",!1,e))}}function YP(t,e,r,n){switch(NP(e)){case 1:var i=hI;break;case 4:i=dI;break;default:i=uy}r=i.bind(null,e,r,t),i=void 0,!ym||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),n?i!==void 0?t.addEventListener(e,r,{capture:!0,passive:i}):t.addEventListener(e,r,!0):i!==void 0?t.addEventListener(e,r,{passive:i}):t.addEventListener(e,r,!1)}function lp(t,e,r,n,i){var s=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var a=n.tag;if(a===3||a===4){var o=n.stateNode.containerInfo;if(o===i||o.nodeType===8&&o.parentNode===i)break;if(a===4)for(a=n.return;a!==null;){var u=a.tag;if((u===3||u===4)&&(u=a.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;a=a.return}for(;o!==null;){if(a=Os(o),a===null)return;if(u=a.tag,u===5||u===6){n=s=a;continue e}o=o.parentNode}}n=n.return}vP(function(){var l=s,c=iy(r),h=[];e:{var d=GP.get(t);if(d!==void 0){var f=cy,p=t;switch(t){case"keypress":if($c(r)===0)break e;case"keydown":case"keyup":f=TI;break;case"focusin":p="focus",f=rp;break;case"focusout":p="blur",f=rp;break;case"beforeblur":case"afterblur":f=rp;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=nv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=mI;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=II;break;case BP:case HP:case WP:f=bI;break;case JP:f=RI;break;case"scroll":f=fI;break;case"wheel":f=NI;break;case"copy":case"cut":case"paste":f=vI;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=sv}var y=(e&4)!==0,v=!y&&t==="scroll",g=y?d!==null?d+"Capture":null:d;y=[];for(var m=l,b;m!==null;){b=m;var S=b.stateNode;if(b.tag===5&&S!==null&&(b=S,g!==null&&(S=Ru(m,g),S!=null&&y.push(Fu(m,S,b)))),v)break;m=m.return}0<y.length&&(d=new f(d,p,null,r,c),h.push({event:d,listeners:y}))}}if(!(e&7)){e:{if(d=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",d&&r!==mm&&(p=r.relatedTarget||r.fromElement)&&(Os(p)||p[gi]))break e;if((f||d)&&(d=c.window===c?c:(d=c.ownerDocument)?d.defaultView||d.parentWindow:window,f?(p=r.relatedTarget||r.toElement,f=l,p=p?Os(p):null,p!==null&&(v=Xs(p),p!==v||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=l),f!==p)){if(y=nv,S="onMouseLeave",g="onMouseEnter",m="mouse",(t==="pointerout"||t==="pointerover")&&(y=sv,S="onPointerLeave",g="onPointerEnter",m="pointer"),v=f==null?d:Ta(f),b=p==null?d:Ta(p),d=new y(S,m+"leave",f,r,c),d.target=v,d.relatedTarget=b,S=null,Os(c)===l&&(y=new y(g,m+"enter",p,r,c),y.target=b,y.relatedTarget=v,S=y),v=S,f&&p)t:{for(y=f,g=p,m=0,b=y;b;b=fa(b))m++;for(b=0,S=g;S;S=fa(S))b++;for(;0<m-b;)y=fa(y),m--;for(;0<b-m;)g=fa(g),b--;for(;m--;){if(y===g||g!==null&&y===g.alternate)break t;y=fa(y),g=fa(g)}y=null}else y=null;f!==null&&gv(h,d,f,y,!1),p!==null&&v!==null&&gv(h,v,p,y,!0)}}e:{if(d=l?Ta(l):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var E=UI;else if(uv(d))if(zP)E=BI;else{E=KI;var I=qI}else(f=d.nodeName)&&f.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(E=VI);if(E&&(E=E(t,l))){FP(h,E,r,c);break e}I&&I(t,d,l),t==="focusout"&&(I=d._wrapperState)&&I.controlled&&d.type==="number"&&cm(d,"number",d.value)}switch(I=l?Ta(l):window,t){case"focusin":(uv(I)||I.contentEditable==="true")&&(xa=I,Pm=l,bu=null);break;case"focusout":bu=Pm=xa=null;break;case"mousedown":Om=!0;break;case"contextmenu":case"mouseup":case"dragend":Om=!1,fv(h,r,c);break;case"selectionchange":if(JI)break;case"keydown":case"keyup":fv(h,r,c)}var j;if(dy)e:{switch(t){case"compositionstart":var P="onCompositionStart";break e;case"compositionend":P="onCompositionEnd";break e;case"compositionupdate":P="onCompositionUpdate";break e}P=void 0}else Sa?DP(t,r)&&(P="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(P="onCompositionStart");P&&(LP&&r.locale!=="ko"&&(Sa||P!=="onCompositionStart"?P==="onCompositionEnd"&&Sa&&(j=$P()):(qi=c,ly="value"in qi?qi.value:qi.textContent,Sa=!0)),I=mh(l,P),0<I.length&&(P=new iv(P,t,null,r,c),h.push({event:P,listeners:I}),j?P.data=j:(j=MP(r),j!==null&&(P.data=j)))),(j=LI?DI(t,r):MI(t,r))&&(l=mh(l,"onBeforeInput"),0<l.length&&(c=new iv("onBeforeInput","beforeinput",null,r,c),h.push({event:c,listeners:l}),c.data=j))}ZP(h,e)})}function Fu(t,e,r){return{instance:t,listener:e,currentTarget:r}}function mh(t,e){for(var r=e+"Capture",n=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Ru(t,r),s!=null&&n.unshift(Fu(t,s,i)),s=Ru(t,e),s!=null&&n.push(Fu(t,s,i))),t=t.return}return n}function fa(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function gv(t,e,r,n,i){for(var s=e._reactName,a=[];r!==null&&r!==n;){var o=r,u=o.alternate,l=o.stateNode;if(u!==null&&u===n)break;o.tag===5&&l!==null&&(o=l,i?(u=Ru(r,s),u!=null&&a.unshift(Fu(r,u,o))):i||(u=Ru(r,s),u!=null&&a.push(Fu(r,u,o)))),r=r.return}a.length!==0&&t.push({event:e,listeners:a})}var QI=/\r\n?/g,XI=/\u0000|\uFFFD/g;function yv(t){return(typeof t=="string"?t:""+t).replace(QI,`
`).replace(XI,"")}function dc(t,e,r){if(e=yv(e),yv(t)!==e&&r)throw Error(M(425))}function gh(){}var Sm=null,xm=null;function Em(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Tm=typeof setTimeout=="function"?setTimeout:void 0,eC=typeof clearTimeout=="function"?clearTimeout:void 0,bv=typeof Promise=="function"?Promise:void 0,tC=typeof queueMicrotask=="function"?queueMicrotask:typeof bv<"u"?function(t){return bv.resolve(null).then(t).catch(rC)}:Tm;function rC(t){setTimeout(function(){throw t})}function cp(t,e){var r=e,n=0;do{var i=r.nextSibling;if(t.removeChild(r),i&&i.nodeType===8)if(r=i.data,r==="/$"){if(n===0){t.removeChild(i),$u(e);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=i}while(r);$u(e)}function Zi(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function wv(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var bo=Math.random().toString(36).slice(2),qn="__reactFiber$"+bo,zu="__reactProps$"+bo,gi="__reactContainer$"+bo,Am="__reactEvents$"+bo,nC="__reactListeners$"+bo,iC="__reactHandles$"+bo;function Os(t){var e=t[qn];if(e)return e;for(var r=t.parentNode;r;){if(e=r[gi]||r[qn]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=wv(t);t!==null;){if(r=t[qn])return r;t=wv(t)}return e}t=r,r=t.parentNode}return null}function Cl(t){return t=t[qn]||t[gi],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ta(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(M(33))}function Vd(t){return t[zu]||null}var km=[],Aa=-1;function hs(t){return{current:t}}function Ve(t){0>Aa||(t.current=km[Aa],km[Aa]=null,Aa--)}function Me(t,e){Aa++,km[Aa]=t.current,t.current=e}var is={},Wt=hs(is),br=hs(!1),Fs=is;function eo(t,e){var r=t.type.contextTypes;if(!r)return is;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in r)i[s]=e[s];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function wr(t){return t=t.childContextTypes,t!=null}function yh(){Ve(br),Ve(Wt)}function vv(t,e,r){if(Wt.current!==is)throw Error(M(168));Me(Wt,e),Me(br,r)}function QP(t,e,r){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var i in n)if(!(i in e))throw Error(M(108,qk(t)||"Unknown",i));return tt({},r,n)}function bh(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||is,Fs=Wt.current,Me(Wt,t),Me(br,br.current),!0}function _v(t,e,r){var n=t.stateNode;if(!n)throw Error(M(169));r?(t=QP(t,e,Fs),n.__reactInternalMemoizedMergedChildContext=t,Ve(br),Ve(Wt),Me(Wt,t)):Ve(br),Me(br,r)}var oi=null,Bd=!1,hp=!1;function XP(t){oi===null?oi=[t]:oi.push(t)}function sC(t){Bd=!0,XP(t)}function ds(){if(!hp&&oi!==null){hp=!0;var t=0,e=Re;try{var r=oi;for(Re=1;t<r.length;t++){var n=r[t];do n=n(!0);while(n!==null)}oi=null,Bd=!1}catch(i){throw oi!==null&&(oi=oi.slice(t+1)),SP(sy,ds),i}finally{Re=e,hp=!1}}return null}var ka=[],Ia=0,wh=null,vh=0,Wr=[],Jr=0,zs=null,li=1,ci="";function vs(t,e){ka[Ia++]=vh,ka[Ia++]=wh,wh=t,vh=e}function eO(t,e,r){Wr[Jr++]=li,Wr[Jr++]=ci,Wr[Jr++]=zs,zs=t;var n=li;t=ci;var i=32-xn(n)-1;n&=~(1<<i),r+=1;var s=32-xn(e)+i;if(30<s){var a=i-i%5;s=(n&(1<<a)-1).toString(32),n>>=a,i-=a,li=1<<32-xn(e)+i|r<<i|n,ci=s+t}else li=1<<s|r<<i|n,ci=t}function py(t){t.return!==null&&(vs(t,1),eO(t,1,0))}function my(t){for(;t===wh;)wh=ka[--Ia],ka[Ia]=null,vh=ka[--Ia],ka[Ia]=null;for(;t===zs;)zs=Wr[--Jr],Wr[Jr]=null,ci=Wr[--Jr],Wr[Jr]=null,li=Wr[--Jr],Wr[Jr]=null}var jr=null,Rr=null,Be=!1,wn=null;function tO(t,e){var r=Zr(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function Pv(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,jr=t,Rr=Zi(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,jr=t,Rr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=zs!==null?{id:li,overflow:ci}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=Zr(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,jr=t,Rr=null,!0):!1;default:return!1}}function Im(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Cm(t){if(Be){var e=Rr;if(e){var r=e;if(!Pv(t,e)){if(Im(t))throw Error(M(418));e=Zi(r.nextSibling);var n=jr;e&&Pv(t,e)?tO(n,r):(t.flags=t.flags&-4097|2,Be=!1,jr=t)}}else{if(Im(t))throw Error(M(418));t.flags=t.flags&-4097|2,Be=!1,jr=t}}}function Ov(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;jr=t}function fc(t){if(t!==jr)return!1;if(!Be)return Ov(t),Be=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Em(t.type,t.memoizedProps)),e&&(e=Rr)){if(Im(t))throw rO(),Error(M(418));for(;e;)tO(t,e),e=Zi(e.nextSibling)}if(Ov(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(M(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){Rr=Zi(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}Rr=null}}else Rr=jr?Zi(t.stateNode.nextSibling):null;return!0}function rO(){for(var t=Rr;t;)t=Zi(t.nextSibling)}function to(){Rr=jr=null,Be=!1}function gy(t){wn===null?wn=[t]:wn.push(t)}var aC=Pi.ReactCurrentBatchConfig;function Ko(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(M(309));var n=r.stateNode}if(!n)throw Error(M(147,t));var i=n,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(a){var o=i.refs;a===null?delete o[s]:o[s]=a},e._stringRef=s,e)}if(typeof t!="string")throw Error(M(284));if(!r._owner)throw Error(M(290,t))}return t}function pc(t,e){throw t=Object.prototype.toString.call(e),Error(M(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Sv(t){var e=t._init;return e(t._payload)}function nO(t){function e(g,m){if(t){var b=g.deletions;b===null?(g.deletions=[m],g.flags|=16):b.push(m)}}function r(g,m){if(!t)return null;for(;m!==null;)e(g,m),m=m.sibling;return null}function n(g,m){for(g=new Map;m!==null;)m.key!==null?g.set(m.key,m):g.set(m.index,m),m=m.sibling;return g}function i(g,m){return g=es(g,m),g.index=0,g.sibling=null,g}function s(g,m,b){return g.index=b,t?(b=g.alternate,b!==null?(b=b.index,b<m?(g.flags|=2,m):b):(g.flags|=2,m)):(g.flags|=1048576,m)}function a(g){return t&&g.alternate===null&&(g.flags|=2),g}function o(g,m,b,S){return m===null||m.tag!==6?(m=bp(b,g.mode,S),m.return=g,m):(m=i(m,b),m.return=g,m)}function u(g,m,b,S){var E=b.type;return E===Oa?c(g,m,b.props.children,S,b.key):m!==null&&(m.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===$i&&Sv(E)===m.type)?(S=i(m,b.props),S.ref=Ko(g,m,b),S.return=g,S):(S=qc(b.type,b.key,b.props,null,g.mode,S),S.ref=Ko(g,m,b),S.return=g,S)}function l(g,m,b,S){return m===null||m.tag!==4||m.stateNode.containerInfo!==b.containerInfo||m.stateNode.implementation!==b.implementation?(m=wp(b,g.mode,S),m.return=g,m):(m=i(m,b.children||[]),m.return=g,m)}function c(g,m,b,S,E){return m===null||m.tag!==7?(m=Cs(b,g.mode,S,E),m.return=g,m):(m=i(m,b),m.return=g,m)}function h(g,m,b){if(typeof m=="string"&&m!==""||typeof m=="number")return m=bp(""+m,g.mode,b),m.return=g,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case nc:return b=qc(m.type,m.key,m.props,null,g.mode,b),b.ref=Ko(g,null,m),b.return=g,b;case Pa:return m=wp(m,g.mode,b),m.return=g,m;case $i:var S=m._init;return h(g,S(m._payload),b)}if(Yo(m)||Mo(m))return m=Cs(m,g.mode,b,null),m.return=g,m;pc(g,m)}return null}function d(g,m,b,S){var E=m!==null?m.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return E!==null?null:o(g,m,""+b,S);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case nc:return b.key===E?u(g,m,b,S):null;case Pa:return b.key===E?l(g,m,b,S):null;case $i:return E=b._init,d(g,m,E(b._payload),S)}if(Yo(b)||Mo(b))return E!==null?null:c(g,m,b,S,null);pc(g,b)}return null}function f(g,m,b,S,E){if(typeof S=="string"&&S!==""||typeof S=="number")return g=g.get(b)||null,o(m,g,""+S,E);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case nc:return g=g.get(S.key===null?b:S.key)||null,u(m,g,S,E);case Pa:return g=g.get(S.key===null?b:S.key)||null,l(m,g,S,E);case $i:var I=S._init;return f(g,m,b,I(S._payload),E)}if(Yo(S)||Mo(S))return g=g.get(b)||null,c(m,g,S,E,null);pc(m,S)}return null}function p(g,m,b,S){for(var E=null,I=null,j=m,P=m=0,G=null;j!==null&&P<b.length;P++){j.index>P?(G=j,j=null):G=j.sibling;var U=d(g,j,b[P],S);if(U===null){j===null&&(j=G);break}t&&j&&U.alternate===null&&e(g,j),m=s(U,m,P),I===null?E=U:I.sibling=U,I=U,j=G}if(P===b.length)return r(g,j),Be&&vs(g,P),E;if(j===null){for(;P<b.length;P++)j=h(g,b[P],S),j!==null&&(m=s(j,m,P),I===null?E=j:I.sibling=j,I=j);return Be&&vs(g,P),E}for(j=n(g,j);P<b.length;P++)G=f(j,g,P,b[P],S),G!==null&&(t&&G.alternate!==null&&j.delete(G.key===null?P:G.key),m=s(G,m,P),I===null?E=G:I.sibling=G,I=G);return t&&j.forEach(function(le){return e(g,le)}),Be&&vs(g,P),E}function y(g,m,b,S){var E=Mo(b);if(typeof E!="function")throw Error(M(150));if(b=E.call(b),b==null)throw Error(M(151));for(var I=E=null,j=m,P=m=0,G=null,U=b.next();j!==null&&!U.done;P++,U=b.next()){j.index>P?(G=j,j=null):G=j.sibling;var le=d(g,j,U.value,S);if(le===null){j===null&&(j=G);break}t&&j&&le.alternate===null&&e(g,j),m=s(le,m,P),I===null?E=le:I.sibling=le,I=le,j=G}if(U.done)return r(g,j),Be&&vs(g,P),E;if(j===null){for(;!U.done;P++,U=b.next())U=h(g,U.value,S),U!==null&&(m=s(U,m,P),I===null?E=U:I.sibling=U,I=U);return Be&&vs(g,P),E}for(j=n(g,j);!U.done;P++,U=b.next())U=f(j,g,P,U.value,S),U!==null&&(t&&U.alternate!==null&&j.delete(U.key===null?P:U.key),m=s(U,m,P),I===null?E=U:I.sibling=U,I=U);return t&&j.forEach(function(ae){return e(g,ae)}),Be&&vs(g,P),E}function v(g,m,b,S){if(typeof b=="object"&&b!==null&&b.type===Oa&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case nc:e:{for(var E=b.key,I=m;I!==null;){if(I.key===E){if(E=b.type,E===Oa){if(I.tag===7){r(g,I.sibling),m=i(I,b.props.children),m.return=g,g=m;break e}}else if(I.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===$i&&Sv(E)===I.type){r(g,I.sibling),m=i(I,b.props),m.ref=Ko(g,I,b),m.return=g,g=m;break e}r(g,I);break}else e(g,I);I=I.sibling}b.type===Oa?(m=Cs(b.props.children,g.mode,S,b.key),m.return=g,g=m):(S=qc(b.type,b.key,b.props,null,g.mode,S),S.ref=Ko(g,m,b),S.return=g,g=S)}return a(g);case Pa:e:{for(I=b.key;m!==null;){if(m.key===I)if(m.tag===4&&m.stateNode.containerInfo===b.containerInfo&&m.stateNode.implementation===b.implementation){r(g,m.sibling),m=i(m,b.children||[]),m.return=g,g=m;break e}else{r(g,m);break}else e(g,m);m=m.sibling}m=wp(b,g.mode,S),m.return=g,g=m}return a(g);case $i:return I=b._init,v(g,m,I(b._payload),S)}if(Yo(b))return p(g,m,b,S);if(Mo(b))return y(g,m,b,S);pc(g,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,m!==null&&m.tag===6?(r(g,m.sibling),m=i(m,b),m.return=g,g=m):(r(g,m),m=bp(b,g.mode,S),m.return=g,g=m),a(g)):r(g,m)}return v}var ro=nO(!0),iO=nO(!1),_h=hs(null),Ph=null,Ca=null,yy=null;function by(){yy=Ca=Ph=null}function wy(t){var e=_h.current;Ve(_h),t._currentValue=e}function Rm(t,e,r){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===r)break;t=t.return}}function Va(t,e){Ph=t,yy=Ca=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(mr=!0),t.firstContext=null)}function en(t){var e=t._currentValue;if(yy!==t)if(t={context:t,memoizedValue:e,next:null},Ca===null){if(Ph===null)throw Error(M(308));Ca=t,Ph.dependencies={lanes:0,firstContext:t}}else Ca=Ca.next=t;return e}var Ss=null;function vy(t){Ss===null?Ss=[t]:Ss.push(t)}function sO(t,e,r,n){var i=e.interleaved;return i===null?(r.next=r,vy(e)):(r.next=i.next,i.next=r),e.interleaved=r,yi(t,n)}function yi(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var Li=!1;function _y(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function aO(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function di(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Yi(t,e,r){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,Se&2){var i=n.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),n.pending=e,yi(t,r)}return i=n.interleaved,i===null?(e.next=e,vy(n)):(e.next=i.next,i.next=e),n.interleaved=e,yi(t,r)}function Lc(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,ay(t,r)}}function xv(t,e){var r=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var i=null,s=null;if(r=r.firstBaseUpdate,r!==null){do{var a={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};s===null?i=s=a:s=s.next=a,r=r.next}while(r!==null);s===null?i=s=e:s=s.next=e}else i=s=e;r={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:n.shared,effects:n.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function Oh(t,e,r,n){var i=t.updateQueue;Li=!1;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(o!==null){i.shared.pending=null;var u=o,l=u.next;u.next=null,a===null?s=l:a.next=l,a=u;var c=t.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==a&&(o===null?c.firstBaseUpdate=l:o.next=l,c.lastBaseUpdate=u))}if(s!==null){var h=i.baseState;a=0,c=l=u=null,o=s;do{var d=o.lane,f=o.eventTime;if((n&d)===d){c!==null&&(c=c.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=t,y=o;switch(d=e,f=r,y.tag){case 1:if(p=y.payload,typeof p=="function"){h=p.call(f,h,d);break e}h=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=y.payload,d=typeof p=="function"?p.call(f,h,d):p,d==null)break e;h=tt({},h,d);break e;case 2:Li=!0}}o.callback!==null&&o.lane!==0&&(t.flags|=64,d=i.effects,d===null?i.effects=[o]:d.push(o))}else f={eventTime:f,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(l=c=f,u=h):c=c.next=f,a|=d;if(o=o.next,o===null){if(o=i.shared.pending,o===null)break;d=o,o=d.next,d.next=null,i.lastBaseUpdate=d,i.shared.pending=null}}while(!0);if(c===null&&(u=h),i.baseState=u,i.firstBaseUpdate=l,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do a|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);qs|=a,t.lanes=a,t.memoizedState=h}}function Ev(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],i=n.callback;if(i!==null){if(n.callback=null,n=r,typeof i!="function")throw Error(M(191,i));i.call(n)}}}var Rl={},Gn=hs(Rl),Uu=hs(Rl),qu=hs(Rl);function xs(t){if(t===Rl)throw Error(M(174));return t}function Py(t,e){switch(Me(qu,e),Me(Uu,t),Me(Gn,Rl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:dm(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=dm(e,t)}Ve(Gn),Me(Gn,e)}function no(){Ve(Gn),Ve(Uu),Ve(qu)}function oO(t){xs(qu.current);var e=xs(Gn.current),r=dm(e,t.type);e!==r&&(Me(Uu,t),Me(Gn,r))}function Oy(t){Uu.current===t&&(Ve(Gn),Ve(Uu))}var Qe=hs(0);function Sh(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var dp=[];function Sy(){for(var t=0;t<dp.length;t++)dp[t]._workInProgressVersionPrimary=null;dp.length=0}var Dc=Pi.ReactCurrentDispatcher,fp=Pi.ReactCurrentBatchConfig,Us=0,Xe=null,bt=null,Et=null,xh=!1,wu=!1,Ku=0,oC=0;function zt(){throw Error(M(321))}function xy(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!kn(t[r],e[r]))return!1;return!0}function Ey(t,e,r,n,i,s){if(Us=s,Xe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Dc.current=t===null||t.memoizedState===null?hC:dC,t=r(n,i),wu){s=0;do{if(wu=!1,Ku=0,25<=s)throw Error(M(301));s+=1,Et=bt=null,e.updateQueue=null,Dc.current=fC,t=r(n,i)}while(wu)}if(Dc.current=Eh,e=bt!==null&&bt.next!==null,Us=0,Et=bt=Xe=null,xh=!1,e)throw Error(M(300));return t}function Ty(){var t=Ku!==0;return Ku=0,t}function Dn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Et===null?Xe.memoizedState=Et=t:Et=Et.next=t,Et}function tn(){if(bt===null){var t=Xe.alternate;t=t!==null?t.memoizedState:null}else t=bt.next;var e=Et===null?Xe.memoizedState:Et.next;if(e!==null)Et=e,bt=t;else{if(t===null)throw Error(M(310));bt=t,t={memoizedState:bt.memoizedState,baseState:bt.baseState,baseQueue:bt.baseQueue,queue:bt.queue,next:null},Et===null?Xe.memoizedState=Et=t:Et=Et.next=t}return Et}function Vu(t,e){return typeof e=="function"?e(t):e}function pp(t){var e=tn(),r=e.queue;if(r===null)throw Error(M(311));r.lastRenderedReducer=t;var n=bt,i=n.baseQueue,s=r.pending;if(s!==null){if(i!==null){var a=i.next;i.next=s.next,s.next=a}n.baseQueue=i=s,r.pending=null}if(i!==null){s=i.next,n=n.baseState;var o=a=null,u=null,l=s;do{var c=l.lane;if((Us&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:t(n,l.action);else{var h={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(o=u=h,a=n):u=u.next=h,Xe.lanes|=c,qs|=c}l=l.next}while(l!==null&&l!==s);u===null?a=n:u.next=o,kn(n,e.memoizedState)||(mr=!0),e.memoizedState=n,e.baseState=a,e.baseQueue=u,r.lastRenderedState=n}if(t=r.interleaved,t!==null){i=t;do s=i.lane,Xe.lanes|=s,qs|=s,i=i.next;while(i!==t)}else i===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function mp(t){var e=tn(),r=e.queue;if(r===null)throw Error(M(311));r.lastRenderedReducer=t;var n=r.dispatch,i=r.pending,s=e.memoizedState;if(i!==null){r.pending=null;var a=i=i.next;do s=t(s,a.action),a=a.next;while(a!==i);kn(s,e.memoizedState)||(mr=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),r.lastRenderedState=s}return[s,n]}function uO(){}function lO(t,e){var r=Xe,n=tn(),i=e(),s=!kn(n.memoizedState,i);if(s&&(n.memoizedState=i,mr=!0),n=n.queue,Ay(dO.bind(null,r,n,t),[t]),n.getSnapshot!==e||s||Et!==null&&Et.memoizedState.tag&1){if(r.flags|=2048,Bu(9,hO.bind(null,r,n,i,e),void 0,null),At===null)throw Error(M(349));Us&30||cO(r,e,i)}return i}function cO(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=Xe.updateQueue,e===null?(e={lastEffect:null,stores:null},Xe.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function hO(t,e,r,n){e.value=r,e.getSnapshot=n,fO(e)&&pO(t)}function dO(t,e,r){return r(function(){fO(e)&&pO(t)})}function fO(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!kn(t,r)}catch{return!0}}function pO(t){var e=yi(t,1);e!==null&&En(e,t,1,-1)}function Tv(t){var e=Dn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vu,lastRenderedState:t},e.queue=t,t=t.dispatch=cC.bind(null,Xe,t),[e.memoizedState,t]}function Bu(t,e,r,n){return t={tag:t,create:e,destroy:r,deps:n,next:null},e=Xe.updateQueue,e===null?(e={lastEffect:null,stores:null},Xe.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(n=r.next,r.next=t,t.next=n,e.lastEffect=t)),t}function mO(){return tn().memoizedState}function Mc(t,e,r,n){var i=Dn();Xe.flags|=t,i.memoizedState=Bu(1|e,r,void 0,n===void 0?null:n)}function Hd(t,e,r,n){var i=tn();n=n===void 0?null:n;var s=void 0;if(bt!==null){var a=bt.memoizedState;if(s=a.destroy,n!==null&&xy(n,a.deps)){i.memoizedState=Bu(e,r,s,n);return}}Xe.flags|=t,i.memoizedState=Bu(1|e,r,s,n)}function Av(t,e){return Mc(8390656,8,t,e)}function Ay(t,e){return Hd(2048,8,t,e)}function gO(t,e){return Hd(4,2,t,e)}function yO(t,e){return Hd(4,4,t,e)}function bO(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function wO(t,e,r){return r=r!=null?r.concat([t]):null,Hd(4,4,bO.bind(null,e,t),r)}function ky(){}function vO(t,e){var r=tn();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&xy(e,n[1])?n[0]:(r.memoizedState=[t,e],t)}function _O(t,e){var r=tn();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&xy(e,n[1])?n[0]:(t=t(),r.memoizedState=[t,e],t)}function PO(t,e,r){return Us&21?(kn(r,e)||(r=TP(),Xe.lanes|=r,qs|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,mr=!0),t.memoizedState=r)}function uC(t,e){var r=Re;Re=r!==0&&4>r?r:4,t(!0);var n=fp.transition;fp.transition={};try{t(!1),e()}finally{Re=r,fp.transition=n}}function OO(){return tn().memoizedState}function lC(t,e,r){var n=Xi(t);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},SO(t))xO(e,r);else if(r=sO(t,e,r,n),r!==null){var i=rr();En(r,t,n,i),EO(r,e,n)}}function cC(t,e,r){var n=Xi(t),i={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(SO(t))xO(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,o=s(a,r);if(i.hasEagerState=!0,i.eagerState=o,kn(o,a)){var u=e.interleaved;u===null?(i.next=i,vy(e)):(i.next=u.next,u.next=i),e.interleaved=i;return}}catch{}finally{}r=sO(t,e,i,n),r!==null&&(i=rr(),En(r,t,n,i),EO(r,e,n))}}function SO(t){var e=t.alternate;return t===Xe||e!==null&&e===Xe}function xO(t,e){wu=xh=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function EO(t,e,r){if(r&4194240){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,ay(t,r)}}var Eh={readContext:en,useCallback:zt,useContext:zt,useEffect:zt,useImperativeHandle:zt,useInsertionEffect:zt,useLayoutEffect:zt,useMemo:zt,useReducer:zt,useRef:zt,useState:zt,useDebugValue:zt,useDeferredValue:zt,useTransition:zt,useMutableSource:zt,useSyncExternalStore:zt,useId:zt,unstable_isNewReconciler:!1},hC={readContext:en,useCallback:function(t,e){return Dn().memoizedState=[t,e===void 0?null:e],t},useContext:en,useEffect:Av,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,Mc(4194308,4,bO.bind(null,e,t),r)},useLayoutEffect:function(t,e){return Mc(4194308,4,t,e)},useInsertionEffect:function(t,e){return Mc(4,2,t,e)},useMemo:function(t,e){var r=Dn();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var n=Dn();return e=r!==void 0?r(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=lC.bind(null,Xe,t),[n.memoizedState,t]},useRef:function(t){var e=Dn();return t={current:t},e.memoizedState=t},useState:Tv,useDebugValue:ky,useDeferredValue:function(t){return Dn().memoizedState=t},useTransition:function(){var t=Tv(!1),e=t[0];return t=uC.bind(null,t[1]),Dn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var n=Xe,i=Dn();if(Be){if(r===void 0)throw Error(M(407));r=r()}else{if(r=e(),At===null)throw Error(M(349));Us&30||cO(n,e,r)}i.memoizedState=r;var s={value:r,getSnapshot:e};return i.queue=s,Av(dO.bind(null,n,s,t),[t]),n.flags|=2048,Bu(9,hO.bind(null,n,s,r,e),void 0,null),r},useId:function(){var t=Dn(),e=At.identifierPrefix;if(Be){var r=ci,n=li;r=(n&~(1<<32-xn(n)-1)).toString(32)+r,e=":"+e+"R"+r,r=Ku++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=oC++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},dC={readContext:en,useCallback:vO,useContext:en,useEffect:Ay,useImperativeHandle:wO,useInsertionEffect:gO,useLayoutEffect:yO,useMemo:_O,useReducer:pp,useRef:mO,useState:function(){return pp(Vu)},useDebugValue:ky,useDeferredValue:function(t){var e=tn();return PO(e,bt.memoizedState,t)},useTransition:function(){var t=pp(Vu)[0],e=tn().memoizedState;return[t,e]},useMutableSource:uO,useSyncExternalStore:lO,useId:OO,unstable_isNewReconciler:!1},fC={readContext:en,useCallback:vO,useContext:en,useEffect:Ay,useImperativeHandle:wO,useInsertionEffect:gO,useLayoutEffect:yO,useMemo:_O,useReducer:mp,useRef:mO,useState:function(){return mp(Vu)},useDebugValue:ky,useDeferredValue:function(t){var e=tn();return bt===null?e.memoizedState=t:PO(e,bt.memoizedState,t)},useTransition:function(){var t=mp(Vu)[0],e=tn().memoizedState;return[t,e]},useMutableSource:uO,useSyncExternalStore:lO,useId:OO,unstable_isNewReconciler:!1};function gn(t,e){if(t&&t.defaultProps){e=tt({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}function jm(t,e,r,n){e=t.memoizedState,r=r(n,e),r=r==null?e:tt({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var Wd={isMounted:function(t){return(t=t._reactInternals)?Xs(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var n=rr(),i=Xi(t),s=di(n,i);s.payload=e,r!=null&&(s.callback=r),e=Yi(t,s,i),e!==null&&(En(e,t,i,n),Lc(e,t,i))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var n=rr(),i=Xi(t),s=di(n,i);s.tag=1,s.payload=e,r!=null&&(s.callback=r),e=Yi(t,s,i),e!==null&&(En(e,t,i,n),Lc(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=rr(),n=Xi(t),i=di(r,n);i.tag=2,e!=null&&(i.callback=e),e=Yi(t,i,n),e!==null&&(En(e,t,n,r),Lc(e,t,n))}};function kv(t,e,r,n,i,s,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,s,a):e.prototype&&e.prototype.isPureReactComponent?!Du(r,n)||!Du(i,s):!0}function TO(t,e,r){var n=!1,i=is,s=e.contextType;return typeof s=="object"&&s!==null?s=en(s):(i=wr(e)?Fs:Wt.current,n=e.contextTypes,s=(n=n!=null)?eo(t,i):is),e=new e(r,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Wd,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function Iv(t,e,r,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,n),e.state!==t&&Wd.enqueueReplaceState(e,e.state,null)}function Nm(t,e,r,n){var i=t.stateNode;i.props=r,i.state=t.memoizedState,i.refs={},_y(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=en(s):(s=wr(e)?Fs:Wt.current,i.context=eo(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(jm(t,e,s,r),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Wd.enqueueReplaceState(i,i.state,null),Oh(t,r,i,n),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function io(t,e){try{var r="",n=e;do r+=Uk(n),n=n.return;while(n);var i=r}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function gp(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function $m(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var pC=typeof WeakMap=="function"?WeakMap:Map;function AO(t,e,r){r=di(-1,r),r.tag=3,r.payload={element:null};var n=e.value;return r.callback=function(){Ah||(Ah=!0,Bm=n),$m(t,e)},r}function kO(t,e,r){r=di(-1,r),r.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var i=e.value;r.payload=function(){return n(i)},r.callback=function(){$m(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(r.callback=function(){$m(t,e),typeof n!="function"&&(Qi===null?Qi=new Set([this]):Qi.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),r}function Cv(t,e,r){var n=t.pingCache;if(n===null){n=t.pingCache=new pC;var i=new Set;n.set(e,i)}else i=n.get(e),i===void 0&&(i=new Set,n.set(e,i));i.has(r)||(i.add(r),t=AC.bind(null,t,e,r),e.then(t,t))}function Rv(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function jv(t,e,r,n,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=di(-1,1),e.tag=2,Yi(r,e,1))),r.lanes|=1),t)}var mC=Pi.ReactCurrentOwner,mr=!1;function Xt(t,e,r,n){e.child=t===null?iO(e,null,r,n):ro(e,t.child,r,n)}function Nv(t,e,r,n,i){r=r.render;var s=e.ref;return Va(e,i),n=Ey(t,e,r,n,s,i),r=Ty(),t!==null&&!mr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,bi(t,e,i)):(Be&&r&&py(e),e.flags|=1,Xt(t,e,n,i),e.child)}function $v(t,e,r,n,i){if(t===null){var s=r.type;return typeof s=="function"&&!Dy(s)&&s.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=s,IO(t,e,s,n,i)):(t=qc(r.type,null,n,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var a=s.memoizedProps;if(r=r.compare,r=r!==null?r:Du,r(a,n)&&t.ref===e.ref)return bi(t,e,i)}return e.flags|=1,t=es(s,n),t.ref=e.ref,t.return=e,e.child=t}function IO(t,e,r,n,i){if(t!==null){var s=t.memoizedProps;if(Du(s,n)&&t.ref===e.ref)if(mr=!1,e.pendingProps=n=s,(t.lanes&i)!==0)t.flags&131072&&(mr=!0);else return e.lanes=t.lanes,bi(t,e,i)}return Lm(t,e,r,n,i)}function CO(t,e,r){var n=e.pendingProps,i=n.children,s=t!==null?t.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Me(ja,Ir),Ir|=r;else{if(!(r&1073741824))return t=s!==null?s.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Me(ja,Ir),Ir|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:r,Me(ja,Ir),Ir|=n}else s!==null?(n=s.baseLanes|r,e.memoizedState=null):n=r,Me(ja,Ir),Ir|=n;return Xt(t,e,i,r),e.child}function RO(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function Lm(t,e,r,n,i){var s=wr(r)?Fs:Wt.current;return s=eo(e,s),Va(e,i),r=Ey(t,e,r,n,s,i),n=Ty(),t!==null&&!mr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,bi(t,e,i)):(Be&&n&&py(e),e.flags|=1,Xt(t,e,r,i),e.child)}function Lv(t,e,r,n,i){if(wr(r)){var s=!0;bh(e)}else s=!1;if(Va(e,i),e.stateNode===null)Fc(t,e),TO(e,r,n),Nm(e,r,n,i),n=!0;else if(t===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var u=a.context,l=r.contextType;typeof l=="object"&&l!==null?l=en(l):(l=wr(r)?Fs:Wt.current,l=eo(e,l));var c=r.getDerivedStateFromProps,h=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==n||u!==l)&&Iv(e,a,n,l),Li=!1;var d=e.memoizedState;a.state=d,Oh(e,n,a,i),u=e.memoizedState,o!==n||d!==u||br.current||Li?(typeof c=="function"&&(jm(e,r,c,n),u=e.memoizedState),(o=Li||kv(e,r,o,n,d,u,l))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=u),a.props=n,a.state=u,a.context=l,n=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{a=e.stateNode,aO(t,e),o=e.memoizedProps,l=e.type===e.elementType?o:gn(e.type,o),a.props=l,h=e.pendingProps,d=a.context,u=r.contextType,typeof u=="object"&&u!==null?u=en(u):(u=wr(r)?Fs:Wt.current,u=eo(e,u));var f=r.getDerivedStateFromProps;(c=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==h||d!==u)&&Iv(e,a,n,u),Li=!1,d=e.memoizedState,a.state=d,Oh(e,n,a,i);var p=e.memoizedState;o!==h||d!==p||br.current||Li?(typeof f=="function"&&(jm(e,r,f,n),p=e.memoizedState),(l=Li||kv(e,r,l,n,d,p,u)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(n,p,u),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(n,p,u)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=p),a.props=n,a.state=p,a.context=u,n=l):(typeof a.componentDidUpdate!="function"||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),n=!1)}return Dm(t,e,r,n,s,i)}function Dm(t,e,r,n,i,s){RO(t,e);var a=(e.flags&128)!==0;if(!n&&!a)return i&&_v(e,r,!1),bi(t,e,s);n=e.stateNode,mC.current=e;var o=a&&typeof r.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&a?(e.child=ro(e,t.child,null,s),e.child=ro(e,null,o,s)):Xt(t,e,o,s),e.memoizedState=n.state,i&&_v(e,r,!0),e.child}function jO(t){var e=t.stateNode;e.pendingContext?vv(t,e.pendingContext,e.pendingContext!==e.context):e.context&&vv(t,e.context,!1),Py(t,e.containerInfo)}function Dv(t,e,r,n,i){return to(),gy(i),e.flags|=256,Xt(t,e,r,n),e.child}var Mm={dehydrated:null,treeContext:null,retryLane:0};function Fm(t){return{baseLanes:t,cachePool:null,transitions:null}}function NO(t,e,r){var n=e.pendingProps,i=Qe.current,s=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=t!==null&&t.memoizedState===null?!1:(i&2)!==0),o?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),Me(Qe,i&1),t===null)return Cm(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=n.children,t=n.fallback,s?(n=e.mode,s=e.child,a={mode:"hidden",children:a},!(n&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=Zd(a,n,0,null),t=Cs(t,n,r,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Fm(r),e.memoizedState=Mm,t):Iy(e,a));if(i=t.memoizedState,i!==null&&(o=i.dehydrated,o!==null))return gC(t,e,a,n,o,i,r);if(s){s=n.fallback,a=e.mode,i=t.child,o=i.sibling;var u={mode:"hidden",children:n.children};return!(a&1)&&e.child!==i?(n=e.child,n.childLanes=0,n.pendingProps=u,e.deletions=null):(n=es(i,u),n.subtreeFlags=i.subtreeFlags&14680064),o!==null?s=es(o,s):(s=Cs(s,a,r,null),s.flags|=2),s.return=e,n.return=e,n.sibling=s,e.child=n,n=s,s=e.child,a=t.child.memoizedState,a=a===null?Fm(r):{baseLanes:a.baseLanes|r,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=t.childLanes&~r,e.memoizedState=Mm,n}return s=t.child,t=s.sibling,n=es(s,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=r),n.return=e,n.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=n,e.memoizedState=null,n}function Iy(t,e){return e=Zd({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function mc(t,e,r,n){return n!==null&&gy(n),ro(e,t.child,null,r),t=Iy(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function gC(t,e,r,n,i,s,a){if(r)return e.flags&256?(e.flags&=-257,n=gp(Error(M(422))),mc(t,e,a,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=n.fallback,i=e.mode,n=Zd({mode:"visible",children:n.children},i,0,null),s=Cs(s,i,a,null),s.flags|=2,n.return=e,s.return=e,n.sibling=s,e.child=n,e.mode&1&&ro(e,t.child,null,a),e.child.memoizedState=Fm(a),e.memoizedState=Mm,s);if(!(e.mode&1))return mc(t,e,a,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var o=n.dgst;return n=o,s=Error(M(419)),n=gp(s,n,void 0),mc(t,e,a,n)}if(o=(a&t.childLanes)!==0,mr||o){if(n=At,n!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|a)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,yi(t,i),En(n,t,i,-1))}return Ly(),n=gp(Error(M(421))),mc(t,e,a,n)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=kC.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,Rr=Zi(i.nextSibling),jr=e,Be=!0,wn=null,t!==null&&(Wr[Jr++]=li,Wr[Jr++]=ci,Wr[Jr++]=zs,li=t.id,ci=t.overflow,zs=e),e=Iy(e,n.children),e.flags|=4096,e)}function Mv(t,e,r){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),Rm(t.return,e,r)}function yp(t,e,r,n,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=r,s.tailMode=i)}function $O(t,e,r){var n=e.pendingProps,i=n.revealOrder,s=n.tail;if(Xt(t,e,n.children,r),n=Qe.current,n&2)n=n&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Mv(t,r,e);else if(t.tag===19)Mv(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(Me(Qe,n),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(r=e.child,i=null;r!==null;)t=r.alternate,t!==null&&Sh(t)===null&&(i=r),r=r.sibling;r=i,r===null?(i=e.child,e.child=null):(i=r.sibling,r.sibling=null),yp(e,!1,i,r,s);break;case"backwards":for(r=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&Sh(t)===null){e.child=i;break}t=i.sibling,i.sibling=r,r=i,i=t}yp(e,!0,r,null,s);break;case"together":yp(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Fc(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function bi(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),qs|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(M(153));if(e.child!==null){for(t=e.child,r=es(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=es(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function yC(t,e,r){switch(e.tag){case 3:jO(e),to();break;case 5:oO(e);break;case 1:wr(e.type)&&bh(e);break;case 4:Py(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,i=e.memoizedProps.value;Me(_h,n._currentValue),n._currentValue=i;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(Me(Qe,Qe.current&1),e.flags|=128,null):r&e.child.childLanes?NO(t,e,r):(Me(Qe,Qe.current&1),t=bi(t,e,r),t!==null?t.sibling:null);Me(Qe,Qe.current&1);break;case 19:if(n=(r&e.childLanes)!==0,t.flags&128){if(n)return $O(t,e,r);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Me(Qe,Qe.current),n)break;return null;case 22:case 23:return e.lanes=0,CO(t,e,r)}return bi(t,e,r)}var LO,zm,DO,MO;LO=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};zm=function(){};DO=function(t,e,r,n){var i=t.memoizedProps;if(i!==n){t=e.stateNode,xs(Gn.current);var s=null;switch(r){case"input":i=um(t,i),n=um(t,n),s=[];break;case"select":i=tt({},i,{value:void 0}),n=tt({},n,{value:void 0}),s=[];break;case"textarea":i=hm(t,i),n=hm(t,n),s=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=gh)}fm(r,n);var a;r=null;for(l in i)if(!n.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var o=i[l];for(a in o)o.hasOwnProperty(a)&&(r||(r={}),r[a]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Iu.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in n){var u=n[l];if(o=i!=null?i[l]:void 0,n.hasOwnProperty(l)&&u!==o&&(u!=null||o!=null))if(l==="style")if(o){for(a in o)!o.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(r||(r={}),r[a]="");for(a in u)u.hasOwnProperty(a)&&o[a]!==u[a]&&(r||(r={}),r[a]=u[a])}else r||(s||(s=[]),s.push(l,r)),r=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,o=o?o.__html:void 0,u!=null&&o!==u&&(s=s||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(s=s||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Iu.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&Ue("scroll",t),s||o===u||(s=[])):(s=s||[]).push(l,u))}r&&(s=s||[]).push("style",r);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};MO=function(t,e,r,n){r!==n&&(e.flags|=4)};function Vo(t,e){if(!Be)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function Ut(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,n=0;if(e)for(var i=t.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=n,t.childLanes=r,e}function bC(t,e,r){var n=e.pendingProps;switch(my(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ut(e),null;case 1:return wr(e.type)&&yh(),Ut(e),null;case 3:return n=e.stateNode,no(),Ve(br),Ve(Wt),Sy(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(fc(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,wn!==null&&(Jm(wn),wn=null))),zm(t,e),Ut(e),null;case 5:Oy(e);var i=xs(qu.current);if(r=e.type,t!==null&&e.stateNode!=null)DO(t,e,r,n,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(M(166));return Ut(e),null}if(t=xs(Gn.current),fc(e)){n=e.stateNode,r=e.type;var s=e.memoizedProps;switch(n[qn]=e,n[zu]=s,t=(e.mode&1)!==0,r){case"dialog":Ue("cancel",n),Ue("close",n);break;case"iframe":case"object":case"embed":Ue("load",n);break;case"video":case"audio":for(i=0;i<Xo.length;i++)Ue(Xo[i],n);break;case"source":Ue("error",n);break;case"img":case"image":case"link":Ue("error",n),Ue("load",n);break;case"details":Ue("toggle",n);break;case"input":Ww(n,s),Ue("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},Ue("invalid",n);break;case"textarea":Gw(n,s),Ue("invalid",n)}fm(r,s),i=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?n.textContent!==o&&(s.suppressHydrationWarning!==!0&&dc(n.textContent,o,t),i=["children",o]):typeof o=="number"&&n.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&dc(n.textContent,o,t),i=["children",""+o]):Iu.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&Ue("scroll",n)}switch(r){case"input":ic(n),Jw(n,s,!0);break;case"textarea":ic(n),Zw(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=gh)}n=i,e.updateQueue=n,n!==null&&(e.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=dP(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=a.createElement(r,{is:n.is}):(t=a.createElement(r),r==="select"&&(a=t,n.multiple?a.multiple=!0:n.size&&(a.size=n.size))):t=a.createElementNS(t,r),t[qn]=e,t[zu]=n,LO(t,e,!1,!1),e.stateNode=t;e:{switch(a=pm(r,n),r){case"dialog":Ue("cancel",t),Ue("close",t),i=n;break;case"iframe":case"object":case"embed":Ue("load",t),i=n;break;case"video":case"audio":for(i=0;i<Xo.length;i++)Ue(Xo[i],t);i=n;break;case"source":Ue("error",t),i=n;break;case"img":case"image":case"link":Ue("error",t),Ue("load",t),i=n;break;case"details":Ue("toggle",t),i=n;break;case"input":Ww(t,n),i=um(t,n),Ue("invalid",t);break;case"option":i=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},i=tt({},n,{value:void 0}),Ue("invalid",t);break;case"textarea":Gw(t,n),i=hm(t,n),Ue("invalid",t);break;default:i=n}fm(r,i),o=i;for(s in o)if(o.hasOwnProperty(s)){var u=o[s];s==="style"?mP(t,u):s==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&fP(t,u)):s==="children"?typeof u=="string"?(r!=="textarea"||u!=="")&&Cu(t,u):typeof u=="number"&&Cu(t,""+u):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Iu.hasOwnProperty(s)?u!=null&&s==="onScroll"&&Ue("scroll",t):u!=null&&ey(t,s,u,a))}switch(r){case"input":ic(t),Jw(t,n,!1);break;case"textarea":ic(t),Zw(t);break;case"option":n.value!=null&&t.setAttribute("value",""+ns(n.value));break;case"select":t.multiple=!!n.multiple,s=n.value,s!=null?za(t,!!n.multiple,s,!1):n.defaultValue!=null&&za(t,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=gh)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ut(e),null;case 6:if(t&&e.stateNode!=null)MO(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(M(166));if(r=xs(qu.current),xs(Gn.current),fc(e)){if(n=e.stateNode,r=e.memoizedProps,n[qn]=e,(s=n.nodeValue!==r)&&(t=jr,t!==null))switch(t.tag){case 3:dc(n.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&dc(n.nodeValue,r,(t.mode&1)!==0)}s&&(e.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[qn]=e,e.stateNode=n}return Ut(e),null;case 13:if(Ve(Qe),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Be&&Rr!==null&&e.mode&1&&!(e.flags&128))rO(),to(),e.flags|=98560,s=!1;else if(s=fc(e),n!==null&&n.dehydrated!==null){if(t===null){if(!s)throw Error(M(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(M(317));s[qn]=e}else to(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ut(e),s=!1}else wn!==null&&(Jm(wn),wn=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(t===null||Qe.current&1?_t===0&&(_t=3):Ly())),e.updateQueue!==null&&(e.flags|=4),Ut(e),null);case 4:return no(),zm(t,e),t===null&&Mu(e.stateNode.containerInfo),Ut(e),null;case 10:return wy(e.type._context),Ut(e),null;case 17:return wr(e.type)&&yh(),Ut(e),null;case 19:if(Ve(Qe),s=e.memoizedState,s===null)return Ut(e),null;if(n=(e.flags&128)!==0,a=s.rendering,a===null)if(n)Vo(s,!1);else{if(_t!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=Sh(t),a!==null){for(e.flags|=128,Vo(s,!1),n=a.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=r,r=e.child;r!==null;)s=r,t=n,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,t=a.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return Me(Qe,Qe.current&1|2),e.child}t=t.sibling}s.tail!==null&&at()>so&&(e.flags|=128,n=!0,Vo(s,!1),e.lanes=4194304)}else{if(!n)if(t=Sh(a),t!==null){if(e.flags|=128,n=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),Vo(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!Be)return Ut(e),null}else 2*at()-s.renderingStartTime>so&&r!==1073741824&&(e.flags|=128,n=!0,Vo(s,!1),e.lanes=4194304);s.isBackwards?(a.sibling=e.child,e.child=a):(r=s.last,r!==null?r.sibling=a:e.child=a,s.last=a)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=at(),e.sibling=null,r=Qe.current,Me(Qe,n?r&1|2:r&1),e):(Ut(e),null);case 22:case 23:return $y(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Ir&1073741824&&(Ut(e),e.subtreeFlags&6&&(e.flags|=8192)):Ut(e),null;case 24:return null;case 25:return null}throw Error(M(156,e.tag))}function wC(t,e){switch(my(e),e.tag){case 1:return wr(e.type)&&yh(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return no(),Ve(br),Ve(Wt),Sy(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Oy(e),null;case 13:if(Ve(Qe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(M(340));to()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ve(Qe),null;case 4:return no(),null;case 10:return wy(e.type._context),null;case 22:case 23:return $y(),null;case 24:return null;default:return null}}var gc=!1,Kt=!1,vC=typeof WeakSet=="function"?WeakSet:Set,J=null;function Ra(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){nt(t,e,n)}else r.current=null}function Um(t,e,r){try{r()}catch(n){nt(t,e,n)}}var Fv=!1;function _C(t,e){if(Sm=fh,t=KP(),fy(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var i=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{r.nodeType,s.nodeType}catch{r=null;break e}var a=0,o=-1,u=-1,l=0,c=0,h=t,d=null;t:for(;;){for(var f;h!==r||i!==0&&h.nodeType!==3||(o=a+i),h!==s||n!==0&&h.nodeType!==3||(u=a+n),h.nodeType===3&&(a+=h.nodeValue.length),(f=h.firstChild)!==null;)d=h,h=f;for(;;){if(h===t)break t;if(d===r&&++l===i&&(o=a),d===s&&++c===n&&(u=a),(f=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=f}r=o===-1||u===-1?null:{start:o,end:u}}else r=null}r=r||{start:0,end:0}}else r=null;for(xm={focusedElem:t,selectionRange:r},fh=!1,J=e;J!==null;)if(e=J,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,J=t;else for(;J!==null;){e=J;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var y=p.memoizedProps,v=p.memoizedState,g=e.stateNode,m=g.getSnapshotBeforeUpdate(e.elementType===e.type?y:gn(e.type,y),v);g.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(M(163))}}catch(S){nt(e,e.return,S)}if(t=e.sibling,t!==null){t.return=e.return,J=t;break}J=e.return}return p=Fv,Fv=!1,p}function vu(t,e,r){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&Um(e,r,s)}i=i.next}while(i!==n)}}function Jd(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var n=r.create;r.destroy=n()}r=r.next}while(r!==e)}}function qm(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function FO(t){var e=t.alternate;e!==null&&(t.alternate=null,FO(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[qn],delete e[zu],delete e[Am],delete e[nC],delete e[iC])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function zO(t){return t.tag===5||t.tag===3||t.tag===4}function zv(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||zO(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Km(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=gh));else if(n!==4&&(t=t.child,t!==null))for(Km(t,e,r),t=t.sibling;t!==null;)Km(t,e,r),t=t.sibling}function Vm(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(Vm(t,e,r),t=t.sibling;t!==null;)Vm(t,e,r),t=t.sibling}var jt=null,bn=!1;function ki(t,e,r){for(r=r.child;r!==null;)UO(t,e,r),r=r.sibling}function UO(t,e,r){if(Jn&&typeof Jn.onCommitFiberUnmount=="function")try{Jn.onCommitFiberUnmount(zd,r)}catch{}switch(r.tag){case 5:Kt||Ra(r,e);case 6:var n=jt,i=bn;jt=null,ki(t,e,r),jt=n,bn=i,jt!==null&&(bn?(t=jt,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):jt.removeChild(r.stateNode));break;case 18:jt!==null&&(bn?(t=jt,r=r.stateNode,t.nodeType===8?cp(t.parentNode,r):t.nodeType===1&&cp(t,r),$u(t)):cp(jt,r.stateNode));break;case 4:n=jt,i=bn,jt=r.stateNode.containerInfo,bn=!0,ki(t,e,r),jt=n,bn=i;break;case 0:case 11:case 14:case 15:if(!Kt&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var s=i,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&Um(r,e,a),i=i.next}while(i!==n)}ki(t,e,r);break;case 1:if(!Kt&&(Ra(r,e),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(o){nt(r,e,o)}ki(t,e,r);break;case 21:ki(t,e,r);break;case 22:r.mode&1?(Kt=(n=Kt)||r.memoizedState!==null,ki(t,e,r),Kt=n):ki(t,e,r);break;default:ki(t,e,r)}}function Uv(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new vC),e.forEach(function(n){var i=IC.bind(null,t,n);r.has(n)||(r.add(n),n.then(i,i))})}}function on(t,e){var r=e.deletions;if(r!==null)for(var n=0;n<r.length;n++){var i=r[n];try{var s=t,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:jt=o.stateNode,bn=!1;break e;case 3:jt=o.stateNode.containerInfo,bn=!0;break e;case 4:jt=o.stateNode.containerInfo,bn=!0;break e}o=o.return}if(jt===null)throw Error(M(160));UO(s,a,i),jt=null,bn=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(l){nt(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)qO(e,t),e=e.sibling}function qO(t,e){var r=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(on(e,t),$n(t),n&4){try{vu(3,t,t.return),Jd(3,t)}catch(y){nt(t,t.return,y)}try{vu(5,t,t.return)}catch(y){nt(t,t.return,y)}}break;case 1:on(e,t),$n(t),n&512&&r!==null&&Ra(r,r.return);break;case 5:if(on(e,t),$n(t),n&512&&r!==null&&Ra(r,r.return),t.flags&32){var i=t.stateNode;try{Cu(i,"")}catch(y){nt(t,t.return,y)}}if(n&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,a=r!==null?r.memoizedProps:s,o=t.type,u=t.updateQueue;if(t.updateQueue=null,u!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&cP(i,s),pm(o,a);var l=pm(o,s);for(a=0;a<u.length;a+=2){var c=u[a],h=u[a+1];c==="style"?mP(i,h):c==="dangerouslySetInnerHTML"?fP(i,h):c==="children"?Cu(i,h):ey(i,c,h,l)}switch(o){case"input":lm(i,s);break;case"textarea":hP(i,s);break;case"select":var d=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?za(i,!!s.multiple,f,!1):d!==!!s.multiple&&(s.defaultValue!=null?za(i,!!s.multiple,s.defaultValue,!0):za(i,!!s.multiple,s.multiple?[]:"",!1))}i[zu]=s}catch(y){nt(t,t.return,y)}}break;case 6:if(on(e,t),$n(t),n&4){if(t.stateNode===null)throw Error(M(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(y){nt(t,t.return,y)}}break;case 3:if(on(e,t),$n(t),n&4&&r!==null&&r.memoizedState.isDehydrated)try{$u(e.containerInfo)}catch(y){nt(t,t.return,y)}break;case 4:on(e,t),$n(t);break;case 13:on(e,t),$n(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(jy=at())),n&4&&Uv(t);break;case 22:if(c=r!==null&&r.memoizedState!==null,t.mode&1?(Kt=(l=Kt)||c,on(e,t),Kt=l):on(e,t),$n(t),n&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!c&&t.mode&1)for(J=t,c=t.child;c!==null;){for(h=J=c;J!==null;){switch(d=J,f=d.child,d.tag){case 0:case 11:case 14:case 15:vu(4,d,d.return);break;case 1:Ra(d,d.return);var p=d.stateNode;if(typeof p.componentWillUnmount=="function"){n=d,r=d.return;try{e=n,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(y){nt(n,r,y)}}break;case 5:Ra(d,d.return);break;case 22:if(d.memoizedState!==null){Kv(h);continue}}f!==null?(f.return=d,J=f):Kv(h)}c=c.sibling}e:for(c=null,h=t;;){if(h.tag===5){if(c===null){c=h;try{i=h.stateNode,l?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=h.stateNode,u=h.memoizedProps.style,a=u!=null&&u.hasOwnProperty("display")?u.display:null,o.style.display=pP("display",a))}catch(y){nt(t,t.return,y)}}}else if(h.tag===6){if(c===null)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(y){nt(t,t.return,y)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;c===h&&(c=null),h=h.return}c===h&&(c=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:on(e,t),$n(t),n&4&&Uv(t);break;case 21:break;default:on(e,t),$n(t)}}function $n(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(zO(r)){var n=r;break e}r=r.return}throw Error(M(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(Cu(i,""),n.flags&=-33);var s=zv(t);Vm(t,s,i);break;case 3:case 4:var a=n.stateNode.containerInfo,o=zv(t);Km(t,o,a);break;default:throw Error(M(161))}}catch(u){nt(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function PC(t,e,r){J=t,KO(t)}function KO(t,e,r){for(var n=(t.mode&1)!==0;J!==null;){var i=J,s=i.child;if(i.tag===22&&n){var a=i.memoizedState!==null||gc;if(!a){var o=i.alternate,u=o!==null&&o.memoizedState!==null||Kt;o=gc;var l=Kt;if(gc=a,(Kt=u)&&!l)for(J=i;J!==null;)a=J,u=a.child,a.tag===22&&a.memoizedState!==null?Vv(i):u!==null?(u.return=a,J=u):Vv(i);for(;s!==null;)J=s,KO(s),s=s.sibling;J=i,gc=o,Kt=l}qv(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,J=s):qv(t)}}function qv(t){for(;J!==null;){var e=J;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Kt||Jd(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Kt)if(r===null)n.componentDidMount();else{var i=e.elementType===e.type?r.memoizedProps:gn(e.type,r.memoizedProps);n.componentDidUpdate(i,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Ev(e,s,n);break;case 3:var a=e.updateQueue;if(a!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}Ev(e,a,r)}break;case 5:var o=e.stateNode;if(r===null&&e.flags&4){r=o;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&r.focus();break;case"img":u.src&&(r.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var h=c.dehydrated;h!==null&&$u(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(M(163))}Kt||e.flags&512&&qm(e)}catch(d){nt(e,e.return,d)}}if(e===t){J=null;break}if(r=e.sibling,r!==null){r.return=e.return,J=r;break}J=e.return}}function Kv(t){for(;J!==null;){var e=J;if(e===t){J=null;break}var r=e.sibling;if(r!==null){r.return=e.return,J=r;break}J=e.return}}function Vv(t){for(;J!==null;){var e=J;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{Jd(4,e)}catch(u){nt(e,r,u)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var i=e.return;try{n.componentDidMount()}catch(u){nt(e,i,u)}}var s=e.return;try{qm(e)}catch(u){nt(e,s,u)}break;case 5:var a=e.return;try{qm(e)}catch(u){nt(e,a,u)}}}catch(u){nt(e,e.return,u)}if(e===t){J=null;break}var o=e.sibling;if(o!==null){o.return=e.return,J=o;break}J=e.return}}var OC=Math.ceil,Th=Pi.ReactCurrentDispatcher,Cy=Pi.ReactCurrentOwner,Yr=Pi.ReactCurrentBatchConfig,Se=0,At=null,pt=null,$t=0,Ir=0,ja=hs(0),_t=0,Hu=null,qs=0,Gd=0,Ry=0,_u=null,fr=null,jy=0,so=1/0,ai=null,Ah=!1,Bm=null,Qi=null,yc=!1,Ki=null,kh=0,Pu=0,Hm=null,zc=-1,Uc=0;function rr(){return Se&6?at():zc!==-1?zc:zc=at()}function Xi(t){return t.mode&1?Se&2&&$t!==0?$t&-$t:aC.transition!==null?(Uc===0&&(Uc=TP()),Uc):(t=Re,t!==0||(t=window.event,t=t===void 0?16:NP(t.type)),t):1}function En(t,e,r,n){if(50<Pu)throw Pu=0,Hm=null,Error(M(185));kl(t,r,n),(!(Se&2)||t!==At)&&(t===At&&(!(Se&2)&&(Gd|=r),_t===4&&Mi(t,$t)),vr(t,n),r===1&&Se===0&&!(e.mode&1)&&(so=at()+500,Bd&&ds()))}function vr(t,e){var r=t.callbackNode;aI(t,e);var n=dh(t,t===At?$t:0);if(n===0)r!==null&&Xw(r),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(r!=null&&Xw(r),e===1)t.tag===0?sC(Bv.bind(null,t)):XP(Bv.bind(null,t)),tC(function(){!(Se&6)&&ds()}),r=null;else{switch(AP(n)){case 1:r=sy;break;case 4:r=xP;break;case 16:r=hh;break;case 536870912:r=EP;break;default:r=hh}r=YO(r,VO.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function VO(t,e){if(zc=-1,Uc=0,Se&6)throw Error(M(327));var r=t.callbackNode;if(Ba()&&t.callbackNode!==r)return null;var n=dh(t,t===At?$t:0);if(n===0)return null;if(n&30||n&t.expiredLanes||e)e=Ih(t,n);else{e=n;var i=Se;Se|=2;var s=HO();(At!==t||$t!==e)&&(ai=null,so=at()+500,Is(t,e));do try{EC();break}catch(o){BO(t,o)}while(!0);by(),Th.current=s,Se=i,pt!==null?e=0:(At=null,$t=0,e=_t)}if(e!==0){if(e===2&&(i=wm(t),i!==0&&(n=i,e=Wm(t,i))),e===1)throw r=Hu,Is(t,0),Mi(t,n),vr(t,at()),r;if(e===6)Mi(t,n);else{if(i=t.current.alternate,!(n&30)&&!SC(i)&&(e=Ih(t,n),e===2&&(s=wm(t),s!==0&&(n=s,e=Wm(t,s))),e===1))throw r=Hu,Is(t,0),Mi(t,n),vr(t,at()),r;switch(t.finishedWork=i,t.finishedLanes=n,e){case 0:case 1:throw Error(M(345));case 2:_s(t,fr,ai);break;case 3:if(Mi(t,n),(n&130023424)===n&&(e=jy+500-at(),10<e)){if(dh(t,0)!==0)break;if(i=t.suspendedLanes,(i&n)!==n){rr(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Tm(_s.bind(null,t,fr,ai),e);break}_s(t,fr,ai);break;case 4:if(Mi(t,n),(n&4194240)===n)break;for(e=t.eventTimes,i=-1;0<n;){var a=31-xn(n);s=1<<a,a=e[a],a>i&&(i=a),n&=~s}if(n=i,n=at()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*OC(n/1960))-n,10<n){t.timeoutHandle=Tm(_s.bind(null,t,fr,ai),n);break}_s(t,fr,ai);break;case 5:_s(t,fr,ai);break;default:throw Error(M(329))}}}return vr(t,at()),t.callbackNode===r?VO.bind(null,t):null}function Wm(t,e){var r=_u;return t.current.memoizedState.isDehydrated&&(Is(t,e).flags|=256),t=Ih(t,e),t!==2&&(e=fr,fr=r,e!==null&&Jm(e)),t}function Jm(t){fr===null?fr=t:fr.push.apply(fr,t)}function SC(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var i=r[n],s=i.getSnapshot;i=i.value;try{if(!kn(s(),i))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Mi(t,e){for(e&=~Ry,e&=~Gd,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-xn(e),n=1<<r;t[r]=-1,e&=~n}}function Bv(t){if(Se&6)throw Error(M(327));Ba();var e=dh(t,0);if(!(e&1))return vr(t,at()),null;var r=Ih(t,e);if(t.tag!==0&&r===2){var n=wm(t);n!==0&&(e=n,r=Wm(t,n))}if(r===1)throw r=Hu,Is(t,0),Mi(t,e),vr(t,at()),r;if(r===6)throw Error(M(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,_s(t,fr,ai),vr(t,at()),null}function Ny(t,e){var r=Se;Se|=1;try{return t(e)}finally{Se=r,Se===0&&(so=at()+500,Bd&&ds())}}function Ks(t){Ki!==null&&Ki.tag===0&&!(Se&6)&&Ba();var e=Se;Se|=1;var r=Yr.transition,n=Re;try{if(Yr.transition=null,Re=1,t)return t()}finally{Re=n,Yr.transition=r,Se=e,!(Se&6)&&ds()}}function $y(){Ir=ja.current,Ve(ja)}function Is(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,eC(r)),pt!==null)for(r=pt.return;r!==null;){var n=r;switch(my(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&yh();break;case 3:no(),Ve(br),Ve(Wt),Sy();break;case 5:Oy(n);break;case 4:no();break;case 13:Ve(Qe);break;case 19:Ve(Qe);break;case 10:wy(n.type._context);break;case 22:case 23:$y()}r=r.return}if(At=t,pt=t=es(t.current,null),$t=Ir=e,_t=0,Hu=null,Ry=Gd=qs=0,fr=_u=null,Ss!==null){for(e=0;e<Ss.length;e++)if(r=Ss[e],n=r.interleaved,n!==null){r.interleaved=null;var i=n.next,s=r.pending;if(s!==null){var a=s.next;s.next=i,n.next=a}r.pending=n}Ss=null}return t}function BO(t,e){do{var r=pt;try{if(by(),Dc.current=Eh,xh){for(var n=Xe.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}xh=!1}if(Us=0,Et=bt=Xe=null,wu=!1,Ku=0,Cy.current=null,r===null||r.return===null){_t=1,Hu=e,pt=null;break}e:{var s=t,a=r.return,o=r,u=e;if(e=$t,o.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=o,h=c.tag;if(!(c.mode&1)&&(h===0||h===11||h===15)){var d=c.alternate;d?(c.updateQueue=d.updateQueue,c.memoizedState=d.memoizedState,c.lanes=d.lanes):(c.updateQueue=null,c.memoizedState=null)}var f=Rv(a);if(f!==null){f.flags&=-257,jv(f,a,o,s,e),f.mode&1&&Cv(s,l,e),e=f,u=l;var p=e.updateQueue;if(p===null){var y=new Set;y.add(u),e.updateQueue=y}else p.add(u);break e}else{if(!(e&1)){Cv(s,l,e),Ly();break e}u=Error(M(426))}}else if(Be&&o.mode&1){var v=Rv(a);if(v!==null){!(v.flags&65536)&&(v.flags|=256),jv(v,a,o,s,e),gy(io(u,o));break e}}s=u=io(u,o),_t!==4&&(_t=2),_u===null?_u=[s]:_u.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var g=AO(s,u,e);xv(s,g);break e;case 1:o=u;var m=s.type,b=s.stateNode;if(!(s.flags&128)&&(typeof m.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Qi===null||!Qi.has(b)))){s.flags|=65536,e&=-e,s.lanes|=e;var S=kO(s,o,e);xv(s,S);break e}}s=s.return}while(s!==null)}JO(r)}catch(E){e=E,pt===r&&r!==null&&(pt=r=r.return);continue}break}while(!0)}function HO(){var t=Th.current;return Th.current=Eh,t===null?Eh:t}function Ly(){(_t===0||_t===3||_t===2)&&(_t=4),At===null||!(qs&268435455)&&!(Gd&268435455)||Mi(At,$t)}function Ih(t,e){var r=Se;Se|=2;var n=HO();(At!==t||$t!==e)&&(ai=null,Is(t,e));do try{xC();break}catch(i){BO(t,i)}while(!0);if(by(),Se=r,Th.current=n,pt!==null)throw Error(M(261));return At=null,$t=0,_t}function xC(){for(;pt!==null;)WO(pt)}function EC(){for(;pt!==null&&!Yk();)WO(pt)}function WO(t){var e=ZO(t.alternate,t,Ir);t.memoizedProps=t.pendingProps,e===null?JO(t):pt=e,Cy.current=null}function JO(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=wC(r,e),r!==null){r.flags&=32767,pt=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{_t=6,pt=null;return}}else if(r=bC(r,e,Ir),r!==null){pt=r;return}if(e=e.sibling,e!==null){pt=e;return}pt=e=t}while(e!==null);_t===0&&(_t=5)}function _s(t,e,r){var n=Re,i=Yr.transition;try{Yr.transition=null,Re=1,TC(t,e,r,n)}finally{Yr.transition=i,Re=n}return null}function TC(t,e,r,n){do Ba();while(Ki!==null);if(Se&6)throw Error(M(327));r=t.finishedWork;var i=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(M(177));t.callbackNode=null,t.callbackPriority=0;var s=r.lanes|r.childLanes;if(oI(t,s),t===At&&(pt=At=null,$t=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||yc||(yc=!0,YO(hh,function(){return Ba(),null})),s=(r.flags&15990)!==0,r.subtreeFlags&15990||s){s=Yr.transition,Yr.transition=null;var a=Re;Re=1;var o=Se;Se|=4,Cy.current=null,_C(t,r),qO(r,t),WI(xm),fh=!!Sm,xm=Sm=null,t.current=r,PC(r),Qk(),Se=o,Re=a,Yr.transition=s}else t.current=r;if(yc&&(yc=!1,Ki=t,kh=i),s=t.pendingLanes,s===0&&(Qi=null),tI(r.stateNode),vr(t,at()),e!==null)for(n=t.onRecoverableError,r=0;r<e.length;r++)i=e[r],n(i.value,{componentStack:i.stack,digest:i.digest});if(Ah)throw Ah=!1,t=Bm,Bm=null,t;return kh&1&&t.tag!==0&&Ba(),s=t.pendingLanes,s&1?t===Hm?Pu++:(Pu=0,Hm=t):Pu=0,ds(),null}function Ba(){if(Ki!==null){var t=AP(kh),e=Yr.transition,r=Re;try{if(Yr.transition=null,Re=16>t?16:t,Ki===null)var n=!1;else{if(t=Ki,Ki=null,kh=0,Se&6)throw Error(M(331));var i=Se;for(Se|=4,J=t.current;J!==null;){var s=J,a=s.child;if(J.flags&16){var o=s.deletions;if(o!==null){for(var u=0;u<o.length;u++){var l=o[u];for(J=l;J!==null;){var c=J;switch(c.tag){case 0:case 11:case 15:vu(8,c,s)}var h=c.child;if(h!==null)h.return=c,J=h;else for(;J!==null;){c=J;var d=c.sibling,f=c.return;if(FO(c),c===l){J=null;break}if(d!==null){d.return=f,J=d;break}J=f}}}var p=s.alternate;if(p!==null){var y=p.child;if(y!==null){p.child=null;do{var v=y.sibling;y.sibling=null,y=v}while(y!==null)}}J=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,J=a;else e:for(;J!==null;){if(s=J,s.flags&2048)switch(s.tag){case 0:case 11:case 15:vu(9,s,s.return)}var g=s.sibling;if(g!==null){g.return=s.return,J=g;break e}J=s.return}}var m=t.current;for(J=m;J!==null;){a=J;var b=a.child;if(a.subtreeFlags&2064&&b!==null)b.return=a,J=b;else e:for(a=m;J!==null;){if(o=J,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:Jd(9,o)}}catch(E){nt(o,o.return,E)}if(o===a){J=null;break e}var S=o.sibling;if(S!==null){S.return=o.return,J=S;break e}J=o.return}}if(Se=i,ds(),Jn&&typeof Jn.onPostCommitFiberRoot=="function")try{Jn.onPostCommitFiberRoot(zd,t)}catch{}n=!0}return n}finally{Re=r,Yr.transition=e}}return!1}function Hv(t,e,r){e=io(r,e),e=AO(t,e,1),t=Yi(t,e,1),e=rr(),t!==null&&(kl(t,1,e),vr(t,e))}function nt(t,e,r){if(t.tag===3)Hv(t,t,r);else for(;e!==null;){if(e.tag===3){Hv(e,t,r);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Qi===null||!Qi.has(n))){t=io(r,t),t=kO(e,t,1),e=Yi(e,t,1),t=rr(),e!==null&&(kl(e,1,t),vr(e,t));break}}e=e.return}}function AC(t,e,r){var n=t.pingCache;n!==null&&n.delete(e),e=rr(),t.pingedLanes|=t.suspendedLanes&r,At===t&&($t&r)===r&&(_t===4||_t===3&&($t&130023424)===$t&&500>at()-jy?Is(t,0):Ry|=r),vr(t,e)}function GO(t,e){e===0&&(t.mode&1?(e=oc,oc<<=1,!(oc&130023424)&&(oc=4194304)):e=1);var r=rr();t=yi(t,e),t!==null&&(kl(t,e,r),vr(t,r))}function kC(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),GO(t,r)}function IC(t,e){var r=0;switch(t.tag){case 13:var n=t.stateNode,i=t.memoizedState;i!==null&&(r=i.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(M(314))}n!==null&&n.delete(e),GO(t,r)}var ZO;ZO=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||br.current)mr=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return mr=!1,yC(t,e,r);mr=!!(t.flags&131072)}else mr=!1,Be&&e.flags&1048576&&eO(e,vh,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Fc(t,e),t=e.pendingProps;var i=eo(e,Wt.current);Va(e,r),i=Ey(null,e,n,t,i,r);var s=Ty();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,wr(n)?(s=!0,bh(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,_y(e),i.updater=Wd,e.stateNode=i,i._reactInternals=e,Nm(e,n,t,r),e=Dm(null,e,n,!0,s,r)):(e.tag=0,Be&&s&&py(e),Xt(null,e,i,r),e=e.child),e;case 16:n=e.elementType;e:{switch(Fc(t,e),t=e.pendingProps,i=n._init,n=i(n._payload),e.type=n,i=e.tag=RC(n),t=gn(n,t),i){case 0:e=Lm(null,e,n,t,r);break e;case 1:e=Lv(null,e,n,t,r);break e;case 11:e=Nv(null,e,n,t,r);break e;case 14:e=$v(null,e,n,gn(n.type,t),r);break e}throw Error(M(306,n,""))}return e;case 0:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:gn(n,i),Lm(t,e,n,i,r);case 1:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:gn(n,i),Lv(t,e,n,i,r);case 3:e:{if(jO(e),t===null)throw Error(M(387));n=e.pendingProps,s=e.memoizedState,i=s.element,aO(t,e),Oh(e,n,null,r);var a=e.memoizedState;if(n=a.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=io(Error(M(423)),e),e=Dv(t,e,n,r,i);break e}else if(n!==i){i=io(Error(M(424)),e),e=Dv(t,e,n,r,i);break e}else for(Rr=Zi(e.stateNode.containerInfo.firstChild),jr=e,Be=!0,wn=null,r=iO(e,null,n,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(to(),n===i){e=bi(t,e,r);break e}Xt(t,e,n,r)}e=e.child}return e;case 5:return oO(e),t===null&&Cm(e),n=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,a=i.children,Em(n,i)?a=null:s!==null&&Em(n,s)&&(e.flags|=32),RO(t,e),Xt(t,e,a,r),e.child;case 6:return t===null&&Cm(e),null;case 13:return NO(t,e,r);case 4:return Py(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=ro(e,null,n,r):Xt(t,e,n,r),e.child;case 11:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:gn(n,i),Nv(t,e,n,i,r);case 7:return Xt(t,e,e.pendingProps,r),e.child;case 8:return Xt(t,e,e.pendingProps.children,r),e.child;case 12:return Xt(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(n=e.type._context,i=e.pendingProps,s=e.memoizedProps,a=i.value,Me(_h,n._currentValue),n._currentValue=a,s!==null)if(kn(s.value,a)){if(s.children===i.children&&!br.current){e=bi(t,e,r);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var u=o.firstContext;u!==null;){if(u.context===n){if(s.tag===1){u=di(-1,r&-r),u.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}s.lanes|=r,u=s.alternate,u!==null&&(u.lanes|=r),Rm(s.return,r,e),o.lanes|=r;break}u=u.next}}else if(s.tag===10)a=s.type===e.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(M(341));a.lanes|=r,o=a.alternate,o!==null&&(o.lanes|=r),Rm(a,r,e),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===e){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}Xt(t,e,i.children,r),e=e.child}return e;case 9:return i=e.type,n=e.pendingProps.children,Va(e,r),i=en(i),n=n(i),e.flags|=1,Xt(t,e,n,r),e.child;case 14:return n=e.type,i=gn(n,e.pendingProps),i=gn(n.type,i),$v(t,e,n,i,r);case 15:return IO(t,e,e.type,e.pendingProps,r);case 17:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:gn(n,i),Fc(t,e),e.tag=1,wr(n)?(t=!0,bh(e)):t=!1,Va(e,r),TO(e,n,i),Nm(e,n,i,r),Dm(null,e,n,!0,t,r);case 19:return $O(t,e,r);case 22:return CO(t,e,r)}throw Error(M(156,e.tag))};function YO(t,e){return SP(t,e)}function CC(t,e,r,n){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Zr(t,e,r,n){return new CC(t,e,r,n)}function Dy(t){return t=t.prototype,!(!t||!t.isReactComponent)}function RC(t){if(typeof t=="function")return Dy(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ry)return 11;if(t===ny)return 14}return 2}function es(t,e){var r=t.alternate;return r===null?(r=Zr(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function qc(t,e,r,n,i,s){var a=2;if(n=t,typeof t=="function")Dy(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case Oa:return Cs(r.children,i,s,e);case ty:a=8,i|=8;break;case im:return t=Zr(12,r,e,i|2),t.elementType=im,t.lanes=s,t;case sm:return t=Zr(13,r,e,i),t.elementType=sm,t.lanes=s,t;case am:return t=Zr(19,r,e,i),t.elementType=am,t.lanes=s,t;case oP:return Zd(r,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case sP:a=10;break e;case aP:a=9;break e;case ry:a=11;break e;case ny:a=14;break e;case $i:a=16,n=null;break e}throw Error(M(130,t==null?t:typeof t,""))}return e=Zr(a,r,e,i),e.elementType=t,e.type=n,e.lanes=s,e}function Cs(t,e,r,n){return t=Zr(7,t,n,e),t.lanes=r,t}function Zd(t,e,r,n){return t=Zr(22,t,n,e),t.elementType=oP,t.lanes=r,t.stateNode={isHidden:!1},t}function bp(t,e,r){return t=Zr(6,t,null,e),t.lanes=r,t}function wp(t,e,r){return e=Zr(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function jC(t,e,r,n,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Xf(0),this.expirationTimes=Xf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xf(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function My(t,e,r,n,i,s,a,o,u){return t=new jC(t,e,r,o,u),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Zr(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},_y(s),t}function NC(t,e,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Pa,key:n==null?null:""+n,children:t,containerInfo:e,implementation:r}}function QO(t){if(!t)return is;t=t._reactInternals;e:{if(Xs(t)!==t||t.tag!==1)throw Error(M(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(wr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(M(171))}if(t.tag===1){var r=t.type;if(wr(r))return QP(t,r,e)}return e}function XO(t,e,r,n,i,s,a,o,u){return t=My(r,n,!0,t,i,s,a,o,u),t.context=QO(null),r=t.current,n=rr(),i=Xi(r),s=di(n,i),s.callback=e??null,Yi(r,s,i),t.current.lanes=i,kl(t,i,n),vr(t,n),t}function Yd(t,e,r,n){var i=e.current,s=rr(),a=Xi(i);return r=QO(r),e.context===null?e.context=r:e.pendingContext=r,e=di(s,a),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=Yi(i,e,a),t!==null&&(En(t,i,a,s),Lc(t,i,a)),a}function Ch(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Wv(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function Fy(t,e){Wv(t,e),(t=t.alternate)&&Wv(t,e)}function $C(){return null}var eS=typeof reportError=="function"?reportError:function(t){console.error(t)};function zy(t){this._internalRoot=t}Qd.prototype.render=zy.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(M(409));Yd(t,e,null,null)};Qd.prototype.unmount=zy.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ks(function(){Yd(null,t,null,null)}),e[gi]=null}};function Qd(t){this._internalRoot=t}Qd.prototype.unstable_scheduleHydration=function(t){if(t){var e=CP();t={blockedOn:null,target:t,priority:e};for(var r=0;r<Di.length&&e!==0&&e<Di[r].priority;r++);Di.splice(r,0,t),r===0&&jP(t)}};function Uy(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Xd(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Jv(){}function LC(t,e,r,n,i){if(i){if(typeof n=="function"){var s=n;n=function(){var l=Ch(a);s.call(l)}}var a=XO(e,n,t,0,null,!1,!1,"",Jv);return t._reactRootContainer=a,t[gi]=a.current,Mu(t.nodeType===8?t.parentNode:t),Ks(),a}for(;i=t.lastChild;)t.removeChild(i);if(typeof n=="function"){var o=n;n=function(){var l=Ch(u);o.call(l)}}var u=My(t,0,!1,null,null,!1,!1,"",Jv);return t._reactRootContainer=u,t[gi]=u.current,Mu(t.nodeType===8?t.parentNode:t),Ks(function(){Yd(e,u,r,n)}),u}function ef(t,e,r,n,i){var s=r._reactRootContainer;if(s){var a=s;if(typeof i=="function"){var o=i;i=function(){var u=Ch(a);o.call(u)}}Yd(e,a,t,i)}else a=LC(r,e,t,i,n);return Ch(a)}kP=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=Qo(e.pendingLanes);r!==0&&(ay(e,r|1),vr(e,at()),!(Se&6)&&(so=at()+500,ds()))}break;case 13:Ks(function(){var n=yi(t,1);if(n!==null){var i=rr();En(n,t,1,i)}}),Fy(t,1)}};oy=function(t){if(t.tag===13){var e=yi(t,134217728);if(e!==null){var r=rr();En(e,t,134217728,r)}Fy(t,134217728)}};IP=function(t){if(t.tag===13){var e=Xi(t),r=yi(t,e);if(r!==null){var n=rr();En(r,t,e,n)}Fy(t,e)}};CP=function(){return Re};RP=function(t,e){var r=Re;try{return Re=t,e()}finally{Re=r}};gm=function(t,e,r){switch(e){case"input":if(lm(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var n=r[e];if(n!==t&&n.form===t.form){var i=Vd(n);if(!i)throw Error(M(90));lP(n),lm(n,i)}}}break;case"textarea":hP(t,r);break;case"select":e=r.value,e!=null&&za(t,!!r.multiple,e,!1)}};bP=Ny;wP=Ks;var DC={usingClientEntryPoint:!1,Events:[Cl,Ta,Vd,gP,yP,Ny]},Bo={findFiberByHostInstance:Os,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},MC={bundleType:Bo.bundleType,version:Bo.version,rendererPackageName:Bo.rendererPackageName,rendererConfig:Bo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Pi.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=PP(t),t===null?null:t.stateNode},findFiberByHostInstance:Bo.findFiberByHostInstance||$C,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bc.isDisabled&&bc.supportsFiber)try{zd=bc.inject(MC),Jn=bc}catch{}}Fr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=DC;Fr.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Uy(e))throw Error(M(200));return NC(t,e,null,r)};Fr.createRoot=function(t,e){if(!Uy(t))throw Error(M(299));var r=!1,n="",i=eS;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=My(t,1,!1,null,null,r,!1,n,i),t[gi]=e.current,Mu(t.nodeType===8?t.parentNode:t),new zy(e)};Fr.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(M(188)):(t=Object.keys(t).join(","),Error(M(268,t)));return t=PP(e),t=t===null?null:t.stateNode,t};Fr.flushSync=function(t){return Ks(t)};Fr.hydrate=function(t,e,r){if(!Xd(e))throw Error(M(200));return ef(null,t,e,!0,r)};Fr.hydrateRoot=function(t,e,r){if(!Uy(t))throw Error(M(405));var n=r!=null&&r.hydratedSources||null,i=!1,s="",a=eS;if(r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(s=r.identifierPrefix),r.onRecoverableError!==void 0&&(a=r.onRecoverableError)),e=XO(e,null,t,1,r??null,i,!1,s,a),t[gi]=e.current,Mu(t),n)for(t=0;t<n.length;t++)r=n[t],i=r._getVersion,i=i(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,i]:e.mutableSourceEagerHydrationData.push(r,i);return new Qd(e)};Fr.render=function(t,e,r){if(!Xd(e))throw Error(M(200));return ef(null,t,e,!1,r)};Fr.unmountComponentAtNode=function(t){if(!Xd(t))throw Error(M(40));return t._reactRootContainer?(Ks(function(){ef(null,null,t,!1,function(){t._reactRootContainer=null,t[gi]=null})}),!0):!1};Fr.unstable_batchedUpdates=Ny;Fr.unstable_renderSubtreeIntoContainer=function(t,e,r,n){if(!Xd(r))throw Error(M(200));if(t==null||t._reactInternals===void 0)throw Error(M(38));return ef(t,e,r,!1,n)};Fr.version="18.3.1-next-f1338f8080-20240426";function tS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(tS)}catch(t){console.error(t)}}tS(),tP.exports=Fr;var FC=tP.exports,Gv=FC;rm.createRoot=Gv.createRoot,rm.hydrateRoot=Gv.hydrateRoot;function rS(t,e){return function(){return t.apply(e,arguments)}}const{toString:zC}=Object.prototype,{getPrototypeOf:qy}=Object,tf=(t=>e=>{const r=zC.call(e);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Rn=t=>(t=t.toLowerCase(),e=>tf(e)===t),rf=t=>e=>typeof e===t,{isArray:wo}=Array,Wu=rf("undefined");function UC(t){return t!==null&&!Wu(t)&&t.constructor!==null&&!Wu(t.constructor)&&Qr(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const nS=Rn("ArrayBuffer");function qC(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&nS(t.buffer),e}const KC=rf("string"),Qr=rf("function"),iS=rf("number"),nf=t=>t!==null&&typeof t=="object",VC=t=>t===!0||t===!1,Kc=t=>{if(tf(t)!=="object")return!1;const e=qy(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},BC=Rn("Date"),HC=Rn("File"),WC=Rn("Blob"),JC=Rn("FileList"),GC=t=>nf(t)&&Qr(t.pipe),ZC=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Qr(t.append)&&((e=tf(t))==="formdata"||e==="object"&&Qr(t.toString)&&t.toString()==="[object FormData]"))},YC=Rn("URLSearchParams"),[QC,XC,e1,t1]=["ReadableStream","Request","Response","Headers"].map(Rn),r1=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function jl(t,e,{allOwnKeys:r=!1}={}){if(t===null||typeof t>"u")return;let n,i;if(typeof t!="object"&&(t=[t]),wo(t))for(n=0,i=t.length;n<i;n++)e.call(null,t[n],n,t);else{const s=r?Object.getOwnPropertyNames(t):Object.keys(t),a=s.length;let o;for(n=0;n<a;n++)o=s[n],e.call(null,t[o],o,t)}}function sS(t,e){e=e.toLowerCase();const r=Object.keys(t);let n=r.length,i;for(;n-- >0;)if(i=r[n],e===i.toLowerCase())return i;return null}const aS=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,oS=t=>!Wu(t)&&t!==aS;function Gm(){const{caseless:t}=oS(this)&&this||{},e={},r=(n,i)=>{const s=t&&sS(e,i)||i;Kc(e[s])&&Kc(n)?e[s]=Gm(e[s],n):Kc(n)?e[s]=Gm({},n):wo(n)?e[s]=n.slice():e[s]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&jl(arguments[n],r);return e}const n1=(t,e,r,{allOwnKeys:n}={})=>(jl(e,(i,s)=>{r&&Qr(i)?t[s]=rS(i,r):t[s]=i},{allOwnKeys:n}),t),i1=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),s1=(t,e,r,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),r&&Object.assign(t.prototype,r)},a1=(t,e,r,n)=>{let i,s,a;const o={};if(e=e||{},t==null)return e;do{for(i=Object.getOwnPropertyNames(t),s=i.length;s-- >0;)a=i[s],(!n||n(a,t,e))&&!o[a]&&(e[a]=t[a],o[a]=!0);t=r!==!1&&qy(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype);return e},o1=(t,e,r)=>{t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=e.length;const n=t.indexOf(e,r);return n!==-1&&n===r},u1=t=>{if(!t)return null;if(wo(t))return t;let e=t.length;if(!iS(e))return null;const r=new Array(e);for(;e-- >0;)r[e]=t[e];return r},l1=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&qy(Uint8Array)),c1=(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let i;for(;(i=n.next())&&!i.done;){const s=i.value;e.call(t,s[0],s[1])}},h1=(t,e)=>{let r;const n=[];for(;(r=t.exec(e))!==null;)n.push(r);return n},d1=Rn("HTMLFormElement"),f1=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,i){return n.toUpperCase()+i}),Zv=(({hasOwnProperty:t})=>(e,r)=>t.call(e,r))(Object.prototype),p1=Rn("RegExp"),uS=(t,e)=>{const r=Object.getOwnPropertyDescriptors(t),n={};jl(r,(i,s)=>{let a;(a=e(i,s,t))!==!1&&(n[s]=a||i)}),Object.defineProperties(t,n)},m1=t=>{uS(t,(e,r)=>{if(Qr(t)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=t[r];if(Qr(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},g1=(t,e)=>{const r={},n=i=>{i.forEach(s=>{r[s]=!0})};return wo(t)?n(t):n(String(t).split(e)),r},y1=()=>{},b1=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,vp="abcdefghijklmnopqrstuvwxyz",Yv="0123456789",lS={DIGIT:Yv,ALPHA:vp,ALPHA_DIGIT:vp+vp.toUpperCase()+Yv},w1=(t=16,e=lS.ALPHA_DIGIT)=>{let r="";const{length:n}=e;for(;t--;)r+=e[Math.random()*n|0];return r};function v1(t){return!!(t&&Qr(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const _1=t=>{const e=new Array(10),r=(n,i)=>{if(nf(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[i]=n;const s=wo(n)?[]:{};return jl(n,(a,o)=>{const u=r(a,i+1);!Wu(u)&&(s[o]=u)}),e[i]=void 0,s}}return n};return r(t,0)},P1=Rn("AsyncFunction"),O1=t=>t&&(nf(t)||Qr(t))&&Qr(t.then)&&Qr(t.catch),C={isArray:wo,isArrayBuffer:nS,isBuffer:UC,isFormData:ZC,isArrayBufferView:qC,isString:KC,isNumber:iS,isBoolean:VC,isObject:nf,isPlainObject:Kc,isReadableStream:QC,isRequest:XC,isResponse:e1,isHeaders:t1,isUndefined:Wu,isDate:BC,isFile:HC,isBlob:WC,isRegExp:p1,isFunction:Qr,isStream:GC,isURLSearchParams:YC,isTypedArray:l1,isFileList:JC,forEach:jl,merge:Gm,extend:n1,trim:r1,stripBOM:i1,inherits:s1,toFlatObject:a1,kindOf:tf,kindOfTest:Rn,endsWith:o1,toArray:u1,forEachEntry:c1,matchAll:h1,isHTMLForm:d1,hasOwnProperty:Zv,hasOwnProp:Zv,reduceDescriptors:uS,freezeMethods:m1,toObjectSet:g1,toCamelCase:f1,noop:y1,toFiniteNumber:b1,findKey:sS,global:aS,isContextDefined:oS,ALPHABET:lS,generateString:w1,isSpecCompliantForm:v1,toJSONObject:_1,isAsyncFn:P1,isThenable:O1};function fe(t,e,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i)}C.inherits(fe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:C.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const cS=fe.prototype,hS={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{hS[t]={value:t}});Object.defineProperties(fe,hS);Object.defineProperty(cS,"isAxiosError",{value:!0});fe.from=(t,e,r,n,i,s)=>{const a=Object.create(cS);return C.toFlatObject(t,a,function(u){return u!==Error.prototype},o=>o!=="isAxiosError"),fe.call(a,t.message,e,r,n,i),a.cause=t,a.name=t.name,s&&Object.assign(a,s),a};const S1=null;function Zm(t){return C.isPlainObject(t)||C.isArray(t)}function dS(t){return C.endsWith(t,"[]")?t.slice(0,-2):t}function Qv(t,e,r){return t?t.concat(e).map(function(i,s){return i=dS(i),!r&&s?"["+i+"]":i}).join(r?".":""):e}function x1(t){return C.isArray(t)&&!t.some(Zm)}const E1=C.toFlatObject(C,{},null,function(e){return/^is[A-Z]/.test(e)});function sf(t,e,r){if(!C.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,r=C.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,v){return!C.isUndefined(v[y])});const n=r.metaTokens,i=r.visitor||c,s=r.dots,a=r.indexes,u=(r.Blob||typeof Blob<"u"&&Blob)&&C.isSpecCompliantForm(e);if(!C.isFunction(i))throw new TypeError("visitor must be a function");function l(p){if(p===null)return"";if(C.isDate(p))return p.toISOString();if(!u&&C.isBlob(p))throw new fe("Blob is not supported. Use a Buffer instead.");return C.isArrayBuffer(p)||C.isTypedArray(p)?u&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function c(p,y,v){let g=p;if(p&&!v&&typeof p=="object"){if(C.endsWith(y,"{}"))y=n?y:y.slice(0,-2),p=JSON.stringify(p);else if(C.isArray(p)&&x1(p)||(C.isFileList(p)||C.endsWith(y,"[]"))&&(g=C.toArray(p)))return y=dS(y),g.forEach(function(b,S){!(C.isUndefined(b)||b===null)&&e.append(a===!0?Qv([y],S,s):a===null?y:y+"[]",l(b))}),!1}return Zm(p)?!0:(e.append(Qv(v,y,s),l(p)),!1)}const h=[],d=Object.assign(E1,{defaultVisitor:c,convertValue:l,isVisitable:Zm});function f(p,y){if(!C.isUndefined(p)){if(h.indexOf(p)!==-1)throw Error("Circular reference detected in "+y.join("."));h.push(p),C.forEach(p,function(g,m){(!(C.isUndefined(g)||g===null)&&i.call(e,g,C.isString(m)?m.trim():m,y,d))===!0&&f(g,y?y.concat(m):[m])}),h.pop()}}if(!C.isObject(t))throw new TypeError("data must be an object");return f(t),e}function Xv(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function Ky(t,e){this._pairs=[],t&&sf(t,this,e)}const fS=Ky.prototype;fS.append=function(e,r){this._pairs.push([e,r])};fS.toString=function(e){const r=e?function(n){return e.call(this,n,Xv)}:Xv;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};function T1(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function pS(t,e,r){if(!e)return t;const n=r&&r.encode||T1,i=r&&r.serialize;let s;if(i?s=i(e,r):s=C.isURLSearchParams(e)?e.toString():new Ky(e,r).toString(n),s){const a=t.indexOf("#");a!==-1&&(t=t.slice(0,a)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}class e_{constructor(){this.handlers=[]}use(e,r,n){return this.handlers.push({fulfilled:e,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){C.forEach(this.handlers,function(n){n!==null&&e(n)})}}const mS={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},A1=typeof URLSearchParams<"u"?URLSearchParams:Ky,k1=typeof FormData<"u"?FormData:null,I1=typeof Blob<"u"?Blob:null,C1={isBrowser:!0,classes:{URLSearchParams:A1,FormData:k1,Blob:I1},protocols:["http","https","file","blob","url","data"]},Vy=typeof window<"u"&&typeof document<"u",R1=(t=>Vy&&["ReactNative","NativeScript","NS"].indexOf(t)<0)(typeof navigator<"u"&&navigator.product),j1=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",N1=Vy&&window.location.href||"http://localhost",$1=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Vy,hasStandardBrowserEnv:R1,hasStandardBrowserWebWorkerEnv:j1,origin:N1},Symbol.toStringTag,{value:"Module"})),Tn={...$1,...C1};function L1(t,e){return sf(t,new Tn.classes.URLSearchParams,Object.assign({visitor:function(r,n,i,s){return Tn.isNode&&C.isBuffer(r)?(this.append(n,r.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function D1(t){return C.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function M1(t){const e={},r=Object.keys(t);let n;const i=r.length;let s;for(n=0;n<i;n++)s=r[n],e[s]=t[s];return e}function gS(t){function e(r,n,i,s){let a=r[s++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),u=s>=r.length;return a=!a&&C.isArray(i)?i.length:a,u?(C.hasOwnProp(i,a)?i[a]=[i[a],n]:i[a]=n,!o):((!i[a]||!C.isObject(i[a]))&&(i[a]=[]),e(r,n,i[a],s)&&C.isArray(i[a])&&(i[a]=M1(i[a])),!o)}if(C.isFormData(t)&&C.isFunction(t.entries)){const r={};return C.forEachEntry(t,(n,i)=>{e(D1(n),i,r,0)}),r}return null}function F1(t,e,r){if(C.isString(t))try{return(e||JSON.parse)(t),C.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(t)}const Nl={transitional:mS,adapter:["xhr","http","fetch"],transformRequest:[function(e,r){const n=r.getContentType()||"",i=n.indexOf("application/json")>-1,s=C.isObject(e);if(s&&C.isHTMLForm(e)&&(e=new FormData(e)),C.isFormData(e))return i?JSON.stringify(gS(e)):e;if(C.isArrayBuffer(e)||C.isBuffer(e)||C.isStream(e)||C.isFile(e)||C.isBlob(e)||C.isReadableStream(e))return e;if(C.isArrayBufferView(e))return e.buffer;if(C.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return L1(e,this.formSerializer).toString();if((o=C.isFileList(e))||n.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return sf(o?{"files[]":e}:e,u&&new u,this.formSerializer)}}return s||i?(r.setContentType("application/json",!1),F1(e)):e}],transformResponse:[function(e){const r=this.transitional||Nl.transitional,n=r&&r.forcedJSONParsing,i=this.responseType==="json";if(C.isResponse(e)||C.isReadableStream(e))return e;if(e&&C.isString(e)&&(n&&!this.responseType||i)){const a=!(r&&r.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?fe.from(o,fe.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Tn.classes.FormData,Blob:Tn.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};C.forEach(["delete","get","head","post","put","patch"],t=>{Nl.headers[t]={}});const z1=C.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),U1=t=>{const e={};let r,n,i;return t&&t.split(`
`).forEach(function(a){i=a.indexOf(":"),r=a.substring(0,i).trim().toLowerCase(),n=a.substring(i+1).trim(),!(!r||e[r]&&z1[r])&&(r==="set-cookie"?e[r]?e[r].push(n):e[r]=[n]:e[r]=e[r]?e[r]+", "+n:n)}),e},t_=Symbol("internals");function Ho(t){return t&&String(t).trim().toLowerCase()}function Vc(t){return t===!1||t==null?t:C.isArray(t)?t.map(Vc):String(t)}function q1(t){const e=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(t);)e[n[1]]=n[2];return e}const K1=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function _p(t,e,r,n,i){if(C.isFunction(n))return n.call(this,e,r);if(i&&(e=r),!!C.isString(e)){if(C.isString(n))return e.indexOf(n)!==-1;if(C.isRegExp(n))return n.test(e)}}function V1(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,r,n)=>r.toUpperCase()+n)}function B1(t,e){const r=C.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(t,n+r,{value:function(i,s,a){return this[n].call(this,e,i,s,a)},configurable:!0})})}class _r{constructor(e){e&&this.set(e)}set(e,r,n){const i=this;function s(o,u,l){const c=Ho(u);if(!c)throw new Error("header name must be a non-empty string");const h=C.findKey(i,c);(!h||i[h]===void 0||l===!0||l===void 0&&i[h]!==!1)&&(i[h||u]=Vc(o))}const a=(o,u)=>C.forEach(o,(l,c)=>s(l,c,u));if(C.isPlainObject(e)||e instanceof this.constructor)a(e,r);else if(C.isString(e)&&(e=e.trim())&&!K1(e))a(U1(e),r);else if(C.isHeaders(e))for(const[o,u]of e.entries())s(u,o,n);else e!=null&&s(r,e,n);return this}get(e,r){if(e=Ho(e),e){const n=C.findKey(this,e);if(n){const i=this[n];if(!r)return i;if(r===!0)return q1(i);if(C.isFunction(r))return r.call(this,i,n);if(C.isRegExp(r))return r.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,r){if(e=Ho(e),e){const n=C.findKey(this,e);return!!(n&&this[n]!==void 0&&(!r||_p(this,this[n],n,r)))}return!1}delete(e,r){const n=this;let i=!1;function s(a){if(a=Ho(a),a){const o=C.findKey(n,a);o&&(!r||_p(n,n[o],o,r))&&(delete n[o],i=!0)}}return C.isArray(e)?e.forEach(s):s(e),i}clear(e){const r=Object.keys(this);let n=r.length,i=!1;for(;n--;){const s=r[n];(!e||_p(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const r=this,n={};return C.forEach(this,(i,s)=>{const a=C.findKey(n,s);if(a){r[a]=Vc(i),delete r[s];return}const o=e?V1(s):String(s).trim();o!==s&&delete r[s],r[o]=Vc(i),n[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const r=Object.create(null);return C.forEach(this,(n,i)=>{n!=null&&n!==!1&&(r[i]=e&&C.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,r])=>e+": "+r).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...r){const n=new this(e);return r.forEach(i=>n.set(i)),n}static accessor(e){const n=(this[t_]=this[t_]={accessors:{}}).accessors,i=this.prototype;function s(a){const o=Ho(a);n[o]||(B1(i,a),n[o]=!0)}return C.isArray(e)?e.forEach(s):s(e),this}}_r.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);C.reduceDescriptors(_r.prototype,({value:t},e)=>{let r=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(n){this[r]=n}}});C.freezeMethods(_r);function Pp(t,e){const r=this||Nl,n=e||r,i=_r.from(n.headers);let s=n.data;return C.forEach(t,function(o){s=o.call(r,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function yS(t){return!!(t&&t.__CANCEL__)}function vo(t,e,r){fe.call(this,t??"canceled",fe.ERR_CANCELED,e,r),this.name="CanceledError"}C.inherits(vo,fe,{__CANCEL__:!0});function bS(t,e,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?t(r):e(new fe("Request failed with status code "+r.status,[fe.ERR_BAD_REQUEST,fe.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function H1(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function W1(t,e){t=t||10;const r=new Array(t),n=new Array(t);let i=0,s=0,a;return e=e!==void 0?e:1e3,function(u){const l=Date.now(),c=n[s];a||(a=l),r[i]=u,n[i]=l;let h=s,d=0;for(;h!==i;)d+=r[h++],h=h%t;if(i=(i+1)%t,i===s&&(s=(s+1)%t),l-a<e)return;const f=c&&l-c;return f?Math.round(d*1e3/f):void 0}}function J1(t,e){let r=0;const n=1e3/e;let i=null;return function(){const a=this===!0,o=Date.now();if(a||o-r>n)return i&&(clearTimeout(i),i=null),r=o,t.apply(null,arguments);i||(i=setTimeout(()=>(i=null,r=Date.now(),t.apply(null,arguments)),n-(o-r)))}}const Rh=(t,e,r=3)=>{let n=0;const i=W1(50,250);return J1(s=>{const a=s.loaded,o=s.lengthComputable?s.total:void 0,u=a-n,l=i(u),c=a<=o;n=a;const h={loaded:a,total:o,progress:o?a/o:void 0,bytes:u,rate:l||void 0,estimated:l&&o&&c?(o-a)/l:void 0,event:s,lengthComputable:o!=null};h[e?"download":"upload"]=!0,t(h)},r)},G1=Tn.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");let n;function i(s){let a=s;return e&&(r.setAttribute("href",a),a=r.href),r.setAttribute("href",a),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return n=i(window.location.href),function(a){const o=C.isString(a)?i(a):a;return o.protocol===n.protocol&&o.host===n.host}}():function(){return function(){return!0}}(),Z1=Tn.hasStandardBrowserEnv?{write(t,e,r,n,i,s){const a=[t+"="+encodeURIComponent(e)];C.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),C.isString(n)&&a.push("path="+n),C.isString(i)&&a.push("domain="+i),s===!0&&a.push("secure"),document.cookie=a.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Y1(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Q1(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function wS(t,e){return t&&!Y1(e)?Q1(t,e):e}const r_=t=>t instanceof _r?{...t}:t;function Vs(t,e){e=e||{};const r={};function n(l,c,h){return C.isPlainObject(l)&&C.isPlainObject(c)?C.merge.call({caseless:h},l,c):C.isPlainObject(c)?C.merge({},c):C.isArray(c)?c.slice():c}function i(l,c,h){if(C.isUndefined(c)){if(!C.isUndefined(l))return n(void 0,l,h)}else return n(l,c,h)}function s(l,c){if(!C.isUndefined(c))return n(void 0,c)}function a(l,c){if(C.isUndefined(c)){if(!C.isUndefined(l))return n(void 0,l)}else return n(void 0,c)}function o(l,c,h){if(h in e)return n(l,c);if(h in t)return n(void 0,l)}const u={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(l,c)=>i(r_(l),r_(c),!0)};return C.forEach(Object.keys(Object.assign({},t,e)),function(c){const h=u[c]||i,d=h(t[c],e[c],c);C.isUndefined(d)&&h!==o||(r[c]=d)}),r}const vS=t=>{const e=Vs({},t);let{data:r,withXSRFToken:n,xsrfHeaderName:i,xsrfCookieName:s,headers:a,auth:o}=e;e.headers=a=_r.from(a),e.url=pS(wS(e.baseURL,e.url),t.params,t.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let u;if(C.isFormData(r)){if(Tn.hasStandardBrowserEnv||Tn.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((u=a.getContentType())!==!1){const[l,...c]=u?u.split(";").map(h=>h.trim()).filter(Boolean):[];a.setContentType([l||"multipart/form-data",...c].join("; "))}}if(Tn.hasStandardBrowserEnv&&(n&&C.isFunction(n)&&(n=n(e)),n||n!==!1&&G1(e.url))){const l=i&&s&&Z1.read(s);l&&a.set(i,l)}return e},X1=typeof XMLHttpRequest<"u",eR=X1&&function(t){return new Promise(function(r,n){const i=vS(t);let s=i.data;const a=_r.from(i.headers).normalize();let{responseType:o}=i,u;function l(){i.cancelToken&&i.cancelToken.unsubscribe(u),i.signal&&i.signal.removeEventListener("abort",u)}let c=new XMLHttpRequest;c.open(i.method.toUpperCase(),i.url,!0),c.timeout=i.timeout;function h(){if(!c)return;const f=_r.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders()),y={data:!o||o==="text"||o==="json"?c.responseText:c.response,status:c.status,statusText:c.statusText,headers:f,config:t,request:c};bS(function(g){r(g),l()},function(g){n(g),l()},y),c=null}"onloadend"in c?c.onloadend=h:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(h)},c.onabort=function(){c&&(n(new fe("Request aborted",fe.ECONNABORTED,i,c)),c=null)},c.onerror=function(){n(new fe("Network Error",fe.ERR_NETWORK,i,c)),c=null},c.ontimeout=function(){let p=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const y=i.transitional||mS;i.timeoutErrorMessage&&(p=i.timeoutErrorMessage),n(new fe(p,y.clarifyTimeoutError?fe.ETIMEDOUT:fe.ECONNABORTED,i,c)),c=null},s===void 0&&a.setContentType(null),"setRequestHeader"in c&&C.forEach(a.toJSON(),function(p,y){c.setRequestHeader(y,p)}),C.isUndefined(i.withCredentials)||(c.withCredentials=!!i.withCredentials),o&&o!=="json"&&(c.responseType=i.responseType),typeof i.onDownloadProgress=="function"&&c.addEventListener("progress",Rh(i.onDownloadProgress,!0)),typeof i.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",Rh(i.onUploadProgress)),(i.cancelToken||i.signal)&&(u=f=>{c&&(n(!f||f.type?new vo(null,t,c):f),c.abort(),c=null)},i.cancelToken&&i.cancelToken.subscribe(u),i.signal&&(i.signal.aborted?u():i.signal.addEventListener("abort",u)));const d=H1(i.url);if(d&&Tn.protocols.indexOf(d)===-1){n(new fe("Unsupported protocol "+d+":",fe.ERR_BAD_REQUEST,t));return}c.send(s||null)})},tR=(t,e)=>{let r=new AbortController,n;const i=function(u){if(!n){n=!0,a();const l=u instanceof Error?u:this.reason;r.abort(l instanceof fe?l:new vo(l instanceof Error?l.message:l))}};let s=e&&setTimeout(()=>{i(new fe(`timeout ${e} of ms exceeded`,fe.ETIMEDOUT))},e);const a=()=>{t&&(s&&clearTimeout(s),s=null,t.forEach(u=>{u&&(u.removeEventListener?u.removeEventListener("abort",i):u.unsubscribe(i))}),t=null)};t.forEach(u=>u&&u.addEventListener&&u.addEventListener("abort",i));const{signal:o}=r;return o.unsubscribe=a,[o,()=>{s&&clearTimeout(s),s=null}]},rR=function*(t,e){let r=t.byteLength;if(!e||r<e){yield t;return}let n=0,i;for(;n<r;)i=n+e,yield t.slice(n,i),n=i},nR=async function*(t,e,r){for await(const n of t)yield*rR(ArrayBuffer.isView(n)?n:await r(String(n)),e)},n_=(t,e,r,n,i)=>{const s=nR(t,e,i);let a=0;return new ReadableStream({type:"bytes",async pull(o){const{done:u,value:l}=await s.next();if(u){o.close(),n();return}let c=l.byteLength;r&&r(a+=c),o.enqueue(new Uint8Array(l))},cancel(o){return n(o),s.return()}},{highWaterMark:2})},i_=(t,e)=>{const r=t!=null;return n=>setTimeout(()=>e({lengthComputable:r,total:t,loaded:n}))},af=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",_S=af&&typeof ReadableStream=="function",Ym=af&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),iR=_S&&(()=>{let t=!1;const e=new Request(Tn.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e})(),s_=64*1024,Qm=_S&&!!(()=>{try{return C.isReadableStream(new Response("").body)}catch{}})(),jh={stream:Qm&&(t=>t.body)};af&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!jh[e]&&(jh[e]=C.isFunction(t[e])?r=>r[e]():(r,n)=>{throw new fe(`Response type '${e}' is not supported`,fe.ERR_NOT_SUPPORT,n)})})})(new Response);const sR=async t=>{if(t==null)return 0;if(C.isBlob(t))return t.size;if(C.isSpecCompliantForm(t))return(await new Request(t).arrayBuffer()).byteLength;if(C.isArrayBufferView(t))return t.byteLength;if(C.isURLSearchParams(t)&&(t=t+""),C.isString(t))return(await Ym(t)).byteLength},aR=async(t,e)=>{const r=C.toFiniteNumber(t.getContentLength());return r??sR(e)},oR=af&&(async t=>{let{url:e,method:r,data:n,signal:i,cancelToken:s,timeout:a,onDownloadProgress:o,onUploadProgress:u,responseType:l,headers:c,withCredentials:h="same-origin",fetchOptions:d}=vS(t);l=l?(l+"").toLowerCase():"text";let[f,p]=i||s||a?tR([i,s],a):[],y,v;const g=()=>{!y&&setTimeout(()=>{f&&f.unsubscribe()}),y=!0};let m;try{if(u&&iR&&r!=="get"&&r!=="head"&&(m=await aR(c,n))!==0){let I=new Request(e,{method:"POST",body:n,duplex:"half"}),j;C.isFormData(n)&&(j=I.headers.get("content-type"))&&c.setContentType(j),I.body&&(n=n_(I.body,s_,i_(m,Rh(u)),null,Ym))}C.isString(h)||(h=h?"cors":"omit"),v=new Request(e,{...d,signal:f,method:r.toUpperCase(),headers:c.normalize().toJSON(),body:n,duplex:"half",withCredentials:h});let b=await fetch(v);const S=Qm&&(l==="stream"||l==="response");if(Qm&&(o||S)){const I={};["status","statusText","headers"].forEach(P=>{I[P]=b[P]});const j=C.toFiniteNumber(b.headers.get("content-length"));b=new Response(n_(b.body,s_,o&&i_(j,Rh(o,!0)),S&&g,Ym),I)}l=l||"text";let E=await jh[C.findKey(jh,l)||"text"](b,t);return!S&&g(),p&&p(),await new Promise((I,j)=>{bS(I,j,{data:E,headers:_r.from(b.headers),status:b.status,statusText:b.statusText,config:t,request:v})})}catch(b){throw g(),b&&b.name==="TypeError"&&/fetch/i.test(b.message)?Object.assign(new fe("Network Error",fe.ERR_NETWORK,t,v),{cause:b.cause||b}):fe.from(b,b&&b.code,t,v)}}),Xm={http:S1,xhr:eR,fetch:oR};C.forEach(Xm,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const a_=t=>`- ${t}`,uR=t=>C.isFunction(t)||t===null||t===!1,PS={getAdapter:t=>{t=C.isArray(t)?t:[t];const{length:e}=t;let r,n;const i={};for(let s=0;s<e;s++){r=t[s];let a;if(n=r,!uR(r)&&(n=Xm[(a=String(r)).toLowerCase()],n===void 0))throw new fe(`Unknown adapter '${a}'`);if(n)break;i[a||"#"+s]=n}if(!n){const s=Object.entries(i).map(([o,u])=>`adapter ${o} `+(u===!1?"is not supported by the environment":"is not available in the build"));let a=e?s.length>1?`since :
`+s.map(a_).join(`
`):" "+a_(s[0]):"as no adapter specified";throw new fe("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return n},adapters:Xm};function Op(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new vo(null,t)}function o_(t){return Op(t),t.headers=_r.from(t.headers),t.data=Pp.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),PS.getAdapter(t.adapter||Nl.adapter)(t).then(function(n){return Op(t),n.data=Pp.call(t,t.transformResponse,n),n.headers=_r.from(n.headers),n},function(n){return yS(n)||(Op(t),n&&n.response&&(n.response.data=Pp.call(t,t.transformResponse,n.response),n.response.headers=_r.from(n.response.headers))),Promise.reject(n)})}const OS="1.7.2",By={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{By[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const u_={};By.transitional=function(e,r,n){function i(s,a){return"[Axios v"+OS+"] Transitional option '"+s+"'"+a+(n?". "+n:"")}return(s,a,o)=>{if(e===!1)throw new fe(i(a," has been removed"+(r?" in "+r:"")),fe.ERR_DEPRECATED);return r&&!u_[a]&&(u_[a]=!0,console.warn(i(a," has been deprecated since v"+r+" and will be removed in the near future"))),e?e(s,a,o):!0}};function lR(t,e,r){if(typeof t!="object")throw new fe("options must be an object",fe.ERR_BAD_OPTION_VALUE);const n=Object.keys(t);let i=n.length;for(;i-- >0;){const s=n[i],a=e[s];if(a){const o=t[s],u=o===void 0||a(o,s,t);if(u!==!0)throw new fe("option "+s+" must be "+u,fe.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new fe("Unknown option "+s,fe.ERR_BAD_OPTION)}}const eg={assertOptions:lR,validators:By},Ii=eg.validators;class Rs{constructor(e){this.defaults=e,this.interceptors={request:new e_,response:new e_}}async request(e,r){try{return await this._request(e,r)}catch(n){if(n instanceof Error){let i;Error.captureStackTrace?Error.captureStackTrace(i={}):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}catch{}}throw n}}_request(e,r){typeof e=="string"?(r=r||{},r.url=e):r=e||{},r=Vs(this.defaults,r);const{transitional:n,paramsSerializer:i,headers:s}=r;n!==void 0&&eg.assertOptions(n,{silentJSONParsing:Ii.transitional(Ii.boolean),forcedJSONParsing:Ii.transitional(Ii.boolean),clarifyTimeoutError:Ii.transitional(Ii.boolean)},!1),i!=null&&(C.isFunction(i)?r.paramsSerializer={serialize:i}:eg.assertOptions(i,{encode:Ii.function,serialize:Ii.function},!0)),r.method=(r.method||this.defaults.method||"get").toLowerCase();let a=s&&C.merge(s.common,s[r.method]);s&&C.forEach(["delete","get","head","post","put","patch","common"],p=>{delete s[p]}),r.headers=_r.concat(a,s);const o=[];let u=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(r)===!1||(u=u&&y.synchronous,o.unshift(y.fulfilled,y.rejected))});const l=[];this.interceptors.response.forEach(function(y){l.push(y.fulfilled,y.rejected)});let c,h=0,d;if(!u){const p=[o_.bind(this),void 0];for(p.unshift.apply(p,o),p.push.apply(p,l),d=p.length,c=Promise.resolve(r);h<d;)c=c.then(p[h++],p[h++]);return c}d=o.length;let f=r;for(h=0;h<d;){const p=o[h++],y=o[h++];try{f=p(f)}catch(v){y.call(this,v);break}}try{c=o_.call(this,f)}catch(p){return Promise.reject(p)}for(h=0,d=l.length;h<d;)c=c.then(l[h++],l[h++]);return c}getUri(e){e=Vs(this.defaults,e);const r=wS(e.baseURL,e.url);return pS(r,e.params,e.paramsSerializer)}}C.forEach(["delete","get","head","options"],function(e){Rs.prototype[e]=function(r,n){return this.request(Vs(n||{},{method:e,url:r,data:(n||{}).data}))}});C.forEach(["post","put","patch"],function(e){function r(n){return function(s,a,o){return this.request(Vs(o||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:a}))}}Rs.prototype[e]=r(),Rs.prototype[e+"Form"]=r(!0)});class Hy{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(s){r=s});const n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s;const a=new Promise(o=>{n.subscribe(o),s=o}).then(i);return a.cancel=function(){n.unsubscribe(s)},a},e(function(s,a,o){n.reason||(n.reason=new vo(s,a,o),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const r=this._listeners.indexOf(e);r!==-1&&this._listeners.splice(r,1)}static source(){let e;return{token:new Hy(function(i){e=i}),cancel:e}}}function cR(t){return function(r){return t.apply(null,r)}}function hR(t){return C.isObject(t)&&t.isAxiosError===!0}const tg={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(tg).forEach(([t,e])=>{tg[e]=t});function SS(t){const e=new Rs(t),r=rS(Rs.prototype.request,e);return C.extend(r,Rs.prototype,e,{allOwnKeys:!0}),C.extend(r,e,null,{allOwnKeys:!0}),r.create=function(i){return SS(Vs(t,i))},r}const ot=SS(Nl);ot.Axios=Rs;ot.CanceledError=vo;ot.CancelToken=Hy;ot.isCancel=yS;ot.VERSION=OS;ot.toFormData=sf;ot.AxiosError=fe;ot.Cancel=ot.CanceledError;ot.all=function(e){return Promise.all(e)};ot.spread=cR;ot.isAxiosError=hR;ot.mergeConfig=Vs;ot.AxiosHeaders=_r;ot.formToJSON=t=>gS(C.isHTMLForm(t)?new FormData(t):t);ot.getAdapter=PS.getAdapter;ot.HttpStatusCode=tg;ot.default=ot;/**
 * @remix-run/router v1.16.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ju(){return Ju=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Ju.apply(this,arguments)}var Vi;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Vi||(Vi={}));const l_="popstate";function dR(t){t===void 0&&(t={});function e(n,i){let{pathname:s,search:a,hash:o}=n.location;return rg("",{pathname:s,search:a,hash:o},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(n,i){return typeof i=="string"?i:Nh(i)}return pR(e,r,null,t)}function gt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function xS(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function fR(){return Math.random().toString(36).substr(2,8)}function c_(t,e){return{usr:t.state,key:t.key,idx:e}}function rg(t,e,r,n){return r===void 0&&(r=null),Ju({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?_o(e):e,{state:r,key:e&&e.key||n||fR()})}function Nh(t){let{pathname:e="/",search:r="",hash:n=""}=t;return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function _o(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substr(n),t=t.substr(0,n)),t&&(e.pathname=t)}return e}function pR(t,e,r,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:s=!1}=n,a=i.history,o=Vi.Pop,u=null,l=c();l==null&&(l=0,a.replaceState(Ju({},a.state,{idx:l}),""));function c(){return(a.state||{idx:null}).idx}function h(){o=Vi.Pop;let v=c(),g=v==null?null:v-l;l=v,u&&u({action:o,location:y.location,delta:g})}function d(v,g){o=Vi.Push;let m=rg(y.location,v,g);l=c()+1;let b=c_(m,l),S=y.createHref(m);try{a.pushState(b,"",S)}catch(E){if(E instanceof DOMException&&E.name==="DataCloneError")throw E;i.location.assign(S)}s&&u&&u({action:o,location:y.location,delta:1})}function f(v,g){o=Vi.Replace;let m=rg(y.location,v,g);l=c();let b=c_(m,l),S=y.createHref(m);a.replaceState(b,"",S),s&&u&&u({action:o,location:y.location,delta:0})}function p(v){let g=i.location.origin!=="null"?i.location.origin:i.location.href,m=typeof v=="string"?v:Nh(v);return m=m.replace(/ $/,"%20"),gt(g,"No window.location.(origin|href) available to create URL for href: "+m),new URL(m,g)}let y={get action(){return o},get location(){return t(i,a)},listen(v){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(l_,h),u=v,()=>{i.removeEventListener(l_,h),u=null}},createHref(v){return e(i,v)},createURL:p,encodeLocation(v){let g=p(v);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:d,replace:f,go(v){return a.go(v)}};return y}var h_;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(h_||(h_={}));function mR(t,e,r){r===void 0&&(r="/");let n=typeof e=="string"?_o(e):e,i=Wy(n.pathname||"/",r);if(i==null)return null;let s=ES(t);gR(s);let a=null;for(let o=0;a==null&&o<s.length;++o){let u=AR(i);a=xR(s[o],u)}return a}function ES(t,e,r,n){e===void 0&&(e=[]),r===void 0&&(r=[]),n===void 0&&(n="");let i=(s,a,o)=>{let u={relativePath:o===void 0?s.path||"":o,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};u.relativePath.startsWith("/")&&(gt(u.relativePath.startsWith(n),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(n.length));let l=ts([n,u.relativePath]),c=r.concat(u);s.children&&s.children.length>0&&(gt(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),ES(s.children,e,c,l)),!(s.path==null&&!s.index)&&e.push({path:l,score:OR(l,s.index),routesMeta:c})};return t.forEach((s,a)=>{var o;if(s.path===""||!((o=s.path)!=null&&o.includes("?")))i(s,a);else for(let u of TS(s.path))i(s,a,u)}),e}function TS(t){let e=t.split("/");if(e.length===0)return[];let[r,...n]=e,i=r.endsWith("?"),s=r.replace(/\?$/,"");if(n.length===0)return i?[s,""]:[s];let a=TS(n.join("/")),o=[];return o.push(...a.map(u=>u===""?s:[s,u].join("/"))),i&&o.push(...a),o.map(u=>t.startsWith("/")&&u===""?"/":u)}function gR(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:SR(e.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const yR=/^:[\w-]+$/,bR=3,wR=2,vR=1,_R=10,PR=-2,d_=t=>t==="*";function OR(t,e){let r=t.split("/"),n=r.length;return r.some(d_)&&(n+=PR),e&&(n+=wR),r.filter(i=>!d_(i)).reduce((i,s)=>i+(yR.test(s)?bR:s===""?vR:_R),n)}function SR(t,e){return t.length===e.length&&t.slice(0,-1).every((n,i)=>n===e[i])?t[t.length-1]-e[e.length-1]:0}function xR(t,e){let{routesMeta:r}=t,n={},i="/",s=[];for(let a=0;a<r.length;++a){let o=r[a],u=a===r.length-1,l=i==="/"?e:e.slice(i.length)||"/",c=ER({path:o.relativePath,caseSensitive:o.caseSensitive,end:u},l);if(!c)return null;Object.assign(n,c.params);let h=o.route;s.push({params:n,pathname:ts([i,c.pathname]),pathnameBase:RR(ts([i,c.pathnameBase])),route:h}),c.pathnameBase!=="/"&&(i=ts([i,c.pathnameBase]))}return s}function ER(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=TR(t.path,t.caseSensitive,t.end),i=e.match(r);if(!i)return null;let s=i[0],a=s.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:n.reduce((l,c,h)=>{let{paramName:d,isOptional:f}=c;if(d==="*"){let y=o[h]||"";a=s.slice(0,s.length-y.length).replace(/(.)\/+$/,"$1")}const p=o[h];return f&&!p?l[d]=void 0:l[d]=(p||"").replace(/%2F/g,"/"),l},{}),pathname:s,pathnameBase:a,pattern:t}}function TR(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!0),xS(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let n=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,u)=>(n.push({paramName:o,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function AR(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return xS(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function Wy(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,n=t.charAt(r);return n&&n!=="/"?null:t.slice(r)||"/"}function kR(t,e){e===void 0&&(e="/");let{pathname:r,search:n="",hash:i=""}=typeof t=="string"?_o(t):t;return{pathname:r?r.startsWith("/")?r:IR(r,e):e,search:jR(n),hash:NR(i)}}function IR(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function Sp(t,e,r,n){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function CR(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function AS(t,e){let r=CR(t);return e?r.map((n,i)=>i===t.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function kS(t,e,r,n){n===void 0&&(n=!1);let i;typeof t=="string"?i=_o(t):(i=Ju({},t),gt(!i.pathname||!i.pathname.includes("?"),Sp("?","pathname","search",i)),gt(!i.pathname||!i.pathname.includes("#"),Sp("#","pathname","hash",i)),gt(!i.search||!i.search.includes("#"),Sp("#","search","hash",i)));let s=t===""||i.pathname==="",a=s?"/":i.pathname,o;if(a==null)o=r;else{let h=e.length-1;if(!n&&a.startsWith("..")){let d=a.split("/");for(;d[0]==="..";)d.shift(),h-=1;i.pathname=d.join("/")}o=h>=0?e[h]:"/"}let u=kR(i,o),l=a&&a!=="/"&&a.endsWith("/"),c=(s||a===".")&&r.endsWith("/");return!u.pathname.endsWith("/")&&(l||c)&&(u.pathname+="/"),u}const ts=t=>t.join("/").replace(/\/\/+/g,"/"),RR=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),jR=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,NR=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function $R(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const IS=["post","put","patch","delete"];new Set(IS);const LR=["get",...IS];new Set(LR);/**
 * React Router v6.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Gu(){return Gu=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Gu.apply(this,arguments)}const Jy=V.createContext(null),DR=V.createContext(null),ea=V.createContext(null),of=V.createContext(null),ta=V.createContext({outlet:null,matches:[],isDataRoute:!1}),CS=V.createContext(null);function MR(t,e){let{relative:r}=e===void 0?{}:e;$l()||gt(!1);let{basename:n,navigator:i}=V.useContext(ea),{hash:s,pathname:a,search:o}=NS(t,{relative:r}),u=a;return n!=="/"&&(u=a==="/"?n:ts([n,a])),i.createHref({pathname:u,search:o,hash:s})}function $l(){return V.useContext(of)!=null}function Ll(){return $l()||gt(!1),V.useContext(of).location}function RS(t){V.useContext(ea).static||V.useLayoutEffect(t)}function jS(){let{isDataRoute:t}=V.useContext(ta);return t?YR():FR()}function FR(){$l()||gt(!1);let t=V.useContext(Jy),{basename:e,future:r,navigator:n}=V.useContext(ea),{matches:i}=V.useContext(ta),{pathname:s}=Ll(),a=JSON.stringify(AS(i,r.v7_relativeSplatPath)),o=V.useRef(!1);return RS(()=>{o.current=!0}),V.useCallback(function(l,c){if(c===void 0&&(c={}),!o.current)return;if(typeof l=="number"){n.go(l);return}let h=kS(l,JSON.parse(a),s,c.relative==="path");t==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:ts([e,h.pathname])),(c.replace?n.replace:n.push)(h,c.state,c)},[e,n,a,s,t])}function NS(t,e){let{relative:r}=e===void 0?{}:e,{future:n}=V.useContext(ea),{matches:i}=V.useContext(ta),{pathname:s}=Ll(),a=JSON.stringify(AS(i,n.v7_relativeSplatPath));return V.useMemo(()=>kS(t,JSON.parse(a),s,r==="path"),[t,a,s,r])}function zR(t,e){return UR(t,e)}function UR(t,e,r,n){$l()||gt(!1);let{navigator:i}=V.useContext(ea),{matches:s}=V.useContext(ta),a=s[s.length-1],o=a?a.params:{};a&&a.pathname;let u=a?a.pathnameBase:"/";a&&a.route;let l=Ll(),c;if(e){var h;let v=typeof e=="string"?_o(e):e;u==="/"||(h=v.pathname)!=null&&h.startsWith(u)||gt(!1),c=v}else c=l;let d=c.pathname||"/",f=d;if(u!=="/"){let v=u.replace(/^\//,"").split("/");f="/"+d.replace(/^\//,"").split("/").slice(v.length).join("/")}let p=mR(t,{pathname:f}),y=HR(p&&p.map(v=>Object.assign({},v,{params:Object.assign({},o,v.params),pathname:ts([u,i.encodeLocation?i.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?u:ts([u,i.encodeLocation?i.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),s,r,n);return e&&y?V.createElement(of.Provider,{value:{location:Gu({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:Vi.Pop}},y):y}function qR(){let t=ZR(),e=$R(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return V.createElement(V.Fragment,null,V.createElement("h2",null,"Unexpected Application Error!"),V.createElement("h3",{style:{fontStyle:"italic"}},e),r?V.createElement("pre",{style:i},r):null,null)}const KR=V.createElement(qR,null);class VR extends V.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,r){return r.location!==e.location||r.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:r.error,location:r.location,revalidation:e.revalidation||r.revalidation}}componentDidCatch(e,r){console.error("React Router caught the following error during render",e,r)}render(){return this.state.error!==void 0?V.createElement(ta.Provider,{value:this.props.routeContext},V.createElement(CS.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function BR(t){let{routeContext:e,match:r,children:n}=t,i=V.useContext(Jy);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),V.createElement(ta.Provider,{value:e},n)}function HR(t,e,r,n){var i;if(e===void 0&&(e=[]),r===void 0&&(r=null),n===void 0&&(n=null),t==null){var s;if((s=r)!=null&&s.errors)t=r.matches;else return null}let a=t,o=(i=r)==null?void 0:i.errors;if(o!=null){let c=a.findIndex(h=>h.route.id&&(o==null?void 0:o[h.route.id])!==void 0);c>=0||gt(!1),a=a.slice(0,Math.min(a.length,c+1))}let u=!1,l=-1;if(r&&n&&n.v7_partialHydration)for(let c=0;c<a.length;c++){let h=a[c];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(l=c),h.route.id){let{loaderData:d,errors:f}=r,p=h.route.loader&&d[h.route.id]===void 0&&(!f||f[h.route.id]===void 0);if(h.route.lazy||p){u=!0,l>=0?a=a.slice(0,l+1):a=[a[0]];break}}}return a.reduceRight((c,h,d)=>{let f,p=!1,y=null,v=null;r&&(f=o&&h.route.id?o[h.route.id]:void 0,y=h.route.errorElement||KR,u&&(l<0&&d===0?(p=!0,v=null):l===d&&(p=!0,v=h.route.hydrateFallbackElement||null)));let g=e.concat(a.slice(0,d+1)),m=()=>{let b;return f?b=y:p?b=v:h.route.Component?b=V.createElement(h.route.Component,null):h.route.element?b=h.route.element:b=c,V.createElement(BR,{match:h,routeContext:{outlet:c,matches:g,isDataRoute:r!=null},children:b})};return r&&(h.route.ErrorBoundary||h.route.errorElement||d===0)?V.createElement(VR,{location:r.location,revalidation:r.revalidation,component:y,error:f,children:m(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):m()},null)}var $S=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}($S||{}),$h=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}($h||{});function WR(t){let e=V.useContext(Jy);return e||gt(!1),e}function JR(t){let e=V.useContext(DR);return e||gt(!1),e}function GR(t){let e=V.useContext(ta);return e||gt(!1),e}function LS(t){let e=GR(),r=e.matches[e.matches.length-1];return r.route.id||gt(!1),r.route.id}function ZR(){var t;let e=V.useContext(CS),r=JR($h.UseRouteError),n=LS($h.UseRouteError);return e!==void 0?e:(t=r.errors)==null?void 0:t[n]}function YR(){let{router:t}=WR($S.UseNavigateStable),e=LS($h.UseNavigateStable),r=V.useRef(!1);return RS(()=>{r.current=!0}),V.useCallback(function(i,s){s===void 0&&(s={}),r.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,Gu({fromRouteId:e},s)))},[t,e])}function Bc(t){gt(!1)}function QR(t){let{basename:e="/",children:r=null,location:n,navigationType:i=Vi.Pop,navigator:s,static:a=!1,future:o}=t;$l()&&gt(!1);let u=e.replace(/^\/*/,"/"),l=V.useMemo(()=>({basename:u,navigator:s,static:a,future:Gu({v7_relativeSplatPath:!1},o)}),[u,o,s,a]);typeof n=="string"&&(n=_o(n));let{pathname:c="/",search:h="",hash:d="",state:f=null,key:p="default"}=n,y=V.useMemo(()=>{let v=Wy(c,u);return v==null?null:{location:{pathname:v,search:h,hash:d,state:f,key:p},navigationType:i}},[u,c,h,d,f,p,i]);return y==null?null:V.createElement(ea.Provider,{value:l},V.createElement(of.Provider,{children:r,value:y}))}function XR(t){let{children:e,location:r}=t;return zR(ng(e),r)}new Promise(()=>{});function ng(t,e){e===void 0&&(e=[]);let r=[];return V.Children.forEach(t,(n,i)=>{if(!V.isValidElement(n))return;let s=[...e,i];if(n.type===V.Fragment){r.push.apply(r,ng(n.props.children,s));return}n.type!==Bc&&gt(!1),!n.props.index||!n.props.children||gt(!1);let a={id:n.props.id||s.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(a.children=ng(n.props.children,s)),r.push(a)}),r}/**
 * React Router DOM v6.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ig(){return ig=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},ig.apply(this,arguments)}function ej(t,e){if(t==null)return{};var r={},n=Object.keys(t),i,s;for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&(r[i]=t[i]);return r}function tj(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function rj(t,e){return t.button===0&&(!e||e==="_self")&&!tj(t)}const nj=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],ij="6";try{window.__reactRouterVersion=ij}catch{}const sj="startTransition",f_=Ak[sj];function aj(t){let{basename:e,children:r,future:n,window:i}=t,s=V.useRef();s.current==null&&(s.current=dR({window:i,v5Compat:!0}));let a=s.current,[o,u]=V.useState({action:a.action,location:a.location}),{v7_startTransition:l}=n||{},c=V.useCallback(h=>{l&&f_?f_(()=>u(h)):u(h)},[u,l]);return V.useLayoutEffect(()=>a.listen(c),[a,c]),V.createElement(QR,{basename:e,children:r,location:o.location,navigationType:o.action,navigator:a,future:n})}const oj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",uj=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,lj=V.forwardRef(function(e,r){let{onClick:n,relative:i,reloadDocument:s,replace:a,state:o,target:u,to:l,preventScrollReset:c,unstable_viewTransition:h}=e,d=ej(e,nj),{basename:f}=V.useContext(ea),p,y=!1;if(typeof l=="string"&&uj.test(l)&&(p=l,oj))try{let b=new URL(window.location.href),S=l.startsWith("//")?new URL(b.protocol+l):new URL(l),E=Wy(S.pathname,f);S.origin===b.origin&&E!=null?l=E+S.search+S.hash:y=!0}catch{}let v=MR(l,{relative:i}),g=cj(l,{replace:a,state:o,target:u,preventScrollReset:c,relative:i,unstable_viewTransition:h});function m(b){n&&n(b),b.defaultPrevented||g(b)}return V.createElement("a",ig({},d,{href:p||v,onClick:y||s?n:m,ref:r,target:u}))});var p_;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(p_||(p_={}));var m_;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(m_||(m_={}));function cj(t,e){let{target:r,replace:n,state:i,preventScrollReset:s,relative:a,unstable_viewTransition:o}=e===void 0?{}:e,u=jS(),l=Ll(),c=NS(t,{relative:a});return V.useCallback(h=>{if(rj(h,r)){h.preventDefault();let d=n!==void 0?n:Nh(l)===Nh(c);u(t,{replace:d,state:i,preventScrollReset:s,relative:a,unstable_viewTransition:o})}},[l,u,c,n,i,r,t,s,a,o])}const hj=()=>{const[t,e]=V.useState(null);return V.useEffect(()=>{(async()=>{const r=await ot("/api/users").then(n=>n.data);e(r)})()},[]),oe.jsxs(oe.Fragment,{children:[oe.jsxs("div",{children:[oe.jsx("p",{children:""}),t==null?void 0:t.map((r,n)=>oe.jsx("p",{children:r.username},n))]}),oe.jsx(lj,{to:"/",children:"Home"})]})};var Dl=t=>t.type==="checkbox",Na=t=>t instanceof Date,er=t=>t==null;const DS=t=>typeof t=="object";var Ot=t=>!er(t)&&!Array.isArray(t)&&DS(t)&&!Na(t),dj=t=>Ot(t)&&t.target?Dl(t.target)?t.target.checked:t.target.value:t,fj=t=>t.substring(0,t.search(/\.\d+(\.|$)/))||t,pj=(t,e)=>t.has(fj(e)),mj=t=>{const e=t.constructor&&t.constructor.prototype;return Ot(e)&&e.hasOwnProperty("isPrototypeOf")},Gy=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Vr(t){let e;const r=Array.isArray(t);if(t instanceof Date)e=new Date(t);else if(t instanceof Set)e=new Set(t);else if(!(Gy&&(t instanceof Blob||t instanceof FileList))&&(r||Ot(t)))if(e=r?[]:{},!r&&!mj(t))e=t;else for(const n in t)t.hasOwnProperty(n)&&(e[n]=Vr(t[n]));else return t;return e}var Ml=t=>Array.isArray(t)?t.filter(Boolean):[],st=t=>t===void 0,Z=(t,e,r)=>{if(!e||!Ot(t))return r;const n=Ml(e.split(/[,[\].]+?/)).reduce((i,s)=>er(i)?i:i[s],t);return st(n)||n===t?st(t[e])?r:t[e]:n},Fi=t=>typeof t=="boolean",Zy=t=>/^\w*$/.test(t),MS=t=>Ml(t.replace(/["|']|\]/g,"").split(/\.|\[/)),qe=(t,e,r)=>{let n=-1;const i=Zy(e)?[e]:MS(e),s=i.length,a=s-1;for(;++n<s;){const o=i[n];let u=r;if(n!==a){const l=t[o];u=Ot(l)||Array.isArray(l)?l:isNaN(+i[n+1])?{}:[]}if(o==="__proto__")return;t[o]=u,t=t[o]}return t};const g_={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},_n={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},ti={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};dr.createContext(null);var gj=(t,e,r,n=!0)=>{const i={defaultValues:e._defaultValues};for(const s in t)Object.defineProperty(i,s,{get:()=>{const a=s;return e._proxyFormState[a]!==_n.all&&(e._proxyFormState[a]=!n||_n.all),t[a]}});return i},kr=t=>Ot(t)&&!Object.keys(t).length,yj=(t,e,r,n)=>{r(t);const{name:i,...s}=t;return kr(s)||Object.keys(s).length>=Object.keys(e).length||Object.keys(s).find(a=>e[a]===_n.all)},xp=t=>Array.isArray(t)?t:[t];function bj(t){const e=dr.useRef(t);e.current=t,dr.useEffect(()=>{const r=!t.disabled&&e.current.subject&&e.current.subject.subscribe({next:e.current.next});return()=>{r&&r.unsubscribe()}},[t.disabled])}var Bn=t=>typeof t=="string",wj=(t,e,r,n,i)=>Bn(t)?(n&&e.watch.add(t),Z(r,t,i)):Array.isArray(t)?t.map(s=>(n&&e.watch.add(s),Z(r,s))):(n&&(e.watchAll=!0),r),vj=(t,e,r,n,i)=>e?{...r[t],types:{...r[t]&&r[t].types?r[t].types:{},[n]:i||!0}}:{},y_=t=>({isOnSubmit:!t||t===_n.onSubmit,isOnBlur:t===_n.onBlur,isOnChange:t===_n.onChange,isOnAll:t===_n.all,isOnTouch:t===_n.onTouched}),b_=(t,e,r)=>!r&&(e.watchAll||e.watch.has(t)||[...e.watch].some(n=>t.startsWith(n)&&/^\.\w+/.test(t.slice(n.length))));const Ou=(t,e,r,n)=>{for(const i of r||Object.keys(t)){const s=Z(t,i);if(s){const{_f:a,...o}=s;if(a){if(a.refs&&a.refs[0]&&e(a.refs[0],i)&&!n)break;if(a.ref&&e(a.ref,a.name)&&!n)break;Ou(o,e)}else Ot(o)&&Ou(o,e)}}};var _j=(t,e,r)=>{const n=Ml(Z(t,r));return qe(n,"root",e[r]),qe(t,r,n),t},Yy=t=>t.type==="file",Bi=t=>typeof t=="function",Lh=t=>{if(!Gy)return!1;const e=t?t.ownerDocument:0;return t instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},Hc=t=>Bn(t),Qy=t=>t.type==="radio",Dh=t=>t instanceof RegExp;const w_={value:!1,isValid:!1},v_={value:!0,isValid:!0};var FS=t=>{if(Array.isArray(t)){if(t.length>1){const e=t.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:e,isValid:!!e.length}}return t[0].checked&&!t[0].disabled?t[0].attributes&&!st(t[0].attributes.value)?st(t[0].value)||t[0].value===""?v_:{value:t[0].value,isValid:!0}:v_:w_}return w_};const __={isValid:!1,value:null};var zS=t=>Array.isArray(t)?t.reduce((e,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:e,__):__;function P_(t,e,r="validate"){if(Hc(t)||Array.isArray(t)&&t.every(Hc)||Fi(t)&&!t)return{type:r,message:Hc(t)?t:"",ref:e}}var pa=t=>Ot(t)&&!Dh(t)?t:{value:t,message:""},O_=async(t,e,r,n,i)=>{const{ref:s,refs:a,required:o,maxLength:u,minLength:l,min:c,max:h,pattern:d,validate:f,name:p,valueAsNumber:y,mount:v,disabled:g}=t._f,m=Z(e,p);if(!v||g)return{};const b=a?a[0]:s,S=ae=>{n&&b.reportValidity&&(b.setCustomValidity(Fi(ae)?"":ae||""),b.reportValidity())},E={},I=Qy(s),j=Dl(s),P=I||j,G=(y||Yy(s))&&st(s.value)&&st(m)||Lh(s)&&s.value===""||m===""||Array.isArray(m)&&!m.length,U=vj.bind(null,p,r,E),le=(ae,de,Ee,ze=ti.maxLength,ce=ti.minLength)=>{const rt=ae?de:Ee;E[p]={type:ae?ze:ce,message:rt,ref:s,...U(ae?ze:ce,rt)}};if(i?!Array.isArray(m)||!m.length:o&&(!P&&(G||er(m))||Fi(m)&&!m||j&&!FS(a).isValid||I&&!zS(a).isValid)){const{value:ae,message:de}=Hc(o)?{value:!!o,message:o}:pa(o);if(ae&&(E[p]={type:ti.required,message:de,ref:b,...U(ti.required,de)},!r))return S(de),E}if(!G&&(!er(c)||!er(h))){let ae,de;const Ee=pa(h),ze=pa(c);if(!er(m)&&!isNaN(m)){const ce=s.valueAsNumber||m&&+m;er(Ee.value)||(ae=ce>Ee.value),er(ze.value)||(de=ce<ze.value)}else{const ce=s.valueAsDate||new Date(m),rt=te=>new Date(new Date().toDateString()+" "+te),q=s.type=="time",ie=s.type=="week";Bn(Ee.value)&&m&&(ae=q?rt(m)>rt(Ee.value):ie?m>Ee.value:ce>new Date(Ee.value)),Bn(ze.value)&&m&&(de=q?rt(m)<rt(ze.value):ie?m<ze.value:ce<new Date(ze.value))}if((ae||de)&&(le(!!ae,Ee.message,ze.message,ti.max,ti.min),!r))return S(E[p].message),E}if((u||l)&&!G&&(Bn(m)||i&&Array.isArray(m))){const ae=pa(u),de=pa(l),Ee=!er(ae.value)&&m.length>+ae.value,ze=!er(de.value)&&m.length<+de.value;if((Ee||ze)&&(le(Ee,ae.message,de.message),!r))return S(E[p].message),E}if(d&&!G&&Bn(m)){const{value:ae,message:de}=pa(d);if(Dh(ae)&&!m.match(ae)&&(E[p]={type:ti.pattern,message:de,ref:s,...U(ti.pattern,de)},!r))return S(de),E}if(f){if(Bi(f)){const ae=await f(m,e),de=P_(ae,b);if(de&&(E[p]={...de,...U(ti.validate,de.message)},!r))return S(de.message),E}else if(Ot(f)){let ae={};for(const de in f){if(!kr(ae)&&!r)break;const Ee=P_(await f[de](m,e),b,de);Ee&&(ae={...Ee,...U(de,Ee.message)},S(Ee.message),r&&(E[p]=ae))}if(!kr(ae)&&(E[p]={ref:b,...ae},!r))return E}}return S(!0),E};function Pj(t,e){const r=e.slice(0,-1).length;let n=0;for(;n<r;)t=st(t)?n++:t[e[n++]];return t}function Oj(t){for(const e in t)if(t.hasOwnProperty(e)&&!st(t[e]))return!1;return!0}function yt(t,e){const r=Array.isArray(e)?e:Zy(e)?[e]:MS(e),n=r.length===1?t:Pj(t,r),i=r.length-1,s=r[i];return n&&delete n[s],i!==0&&(Ot(n)&&kr(n)||Array.isArray(n)&&Oj(n))&&yt(t,r.slice(0,-1)),t}var Ep=()=>{let t=[];return{get observers(){return t},next:i=>{for(const s of t)s.next&&s.next(i)},subscribe:i=>(t.push(i),{unsubscribe:()=>{t=t.filter(s=>s!==i)}}),unsubscribe:()=>{t=[]}}},Mh=t=>er(t)||!DS(t);function Es(t,e){if(Mh(t)||Mh(e))return t===e;if(Na(t)&&Na(e))return t.getTime()===e.getTime();const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(const i of r){const s=t[i];if(!n.includes(i))return!1;if(i!=="ref"){const a=e[i];if(Na(s)&&Na(a)||Ot(s)&&Ot(a)||Array.isArray(s)&&Array.isArray(a)?!Es(s,a):s!==a)return!1}}return!0}var US=t=>t.type==="select-multiple",Sj=t=>Qy(t)||Dl(t),Tp=t=>Lh(t)&&t.isConnected,qS=t=>{for(const e in t)if(Bi(t[e]))return!0;return!1};function Fh(t,e={}){const r=Array.isArray(t);if(Ot(t)||r)for(const n in t)Array.isArray(t[n])||Ot(t[n])&&!qS(t[n])?(e[n]=Array.isArray(t[n])?[]:{},Fh(t[n],e[n])):er(t[n])||(e[n]=!0);return e}function KS(t,e,r){const n=Array.isArray(t);if(Ot(t)||n)for(const i in t)Array.isArray(t[i])||Ot(t[i])&&!qS(t[i])?st(e)||Mh(r[i])?r[i]=Array.isArray(t[i])?Fh(t[i],[]):{...Fh(t[i])}:KS(t[i],er(e)?{}:e[i],r[i]):r[i]=!Es(t[i],e[i]);return r}var wc=(t,e)=>KS(t,e,Fh(e)),VS=(t,{valueAsNumber:e,valueAsDate:r,setValueAs:n})=>st(t)?t:e?t===""?NaN:t&&+t:r&&Bn(t)?new Date(t):n?n(t):t;function Ap(t){const e=t.ref;if(!(t.refs?t.refs.every(r=>r.disabled):e.disabled))return Yy(e)?e.files:Qy(e)?zS(t.refs).value:US(e)?[...e.selectedOptions].map(({value:r})=>r):Dl(e)?FS(t.refs).value:VS(st(e.value)?t.ref.value:e.value,t)}var xj=(t,e,r,n)=>{const i={};for(const s of t){const a=Z(e,s);a&&qe(i,s,a._f)}return{criteriaMode:r,names:[...t],fields:i,shouldUseNativeValidation:n}},Wo=t=>st(t)?t:Dh(t)?t.source:Ot(t)?Dh(t.value)?t.value.source:t.value:t,Ej=t=>t.mount&&(t.required||t.min||t.max||t.maxLength||t.minLength||t.pattern||t.validate);function S_(t,e,r){const n=Z(t,r);if(n||Zy(r))return{error:n,name:r};const i=r.split(".");for(;i.length;){const s=i.join("."),a=Z(e,s),o=Z(t,s);if(a&&!Array.isArray(a)&&r!==s)return{name:r};if(o&&o.type)return{name:s,error:o};i.pop()}return{name:r}}var Tj=(t,e,r,n,i)=>i.isOnAll?!1:!r&&i.isOnTouch?!(e||t):(r?n.isOnBlur:i.isOnBlur)?!t:(r?n.isOnChange:i.isOnChange)?t:!0,Aj=(t,e)=>!Ml(Z(t,e)).length&&yt(t,e);const kj={mode:_n.onSubmit,reValidateMode:_n.onChange,shouldFocusError:!0};function Ij(t={}){let e={...kj,...t},r={submitCount:0,isDirty:!1,isLoading:Bi(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},n={},i=Ot(e.defaultValues)||Ot(e.values)?Vr(e.defaultValues||e.values)||{}:{},s=e.shouldUnregister?{}:Vr(i),a={action:!1,mount:!1,watch:!1},o={mount:new Set,unMount:new Set,array:new Set,watch:new Set},u,l=0;const c={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},h={values:Ep(),array:Ep(),state:Ep()},d=y_(e.mode),f=y_(e.reValidateMode),p=e.criteriaMode===_n.all,y=O=>A=>{clearTimeout(l),l=setTimeout(O,A)},v=async O=>{if(c.isValid||O){const A=e.resolver?kr((await P()).errors):await U(n,!0);A!==r.isValid&&h.state.next({isValid:A})}},g=(O,A)=>{(c.isValidating||c.validatingFields)&&((O||Array.from(o.mount)).forEach(x=>{x&&(A?qe(r.validatingFields,x,A):yt(r.validatingFields,x))}),h.state.next({validatingFields:r.validatingFields,isValidating:!kr(r.validatingFields)}))},m=(O,A=[],x,K,R=!0,k=!0)=>{if(K&&x){if(a.action=!0,k&&Array.isArray(Z(n,O))){const $=x(Z(n,O),K.argA,K.argB);R&&qe(n,O,$)}if(k&&Array.isArray(Z(r.errors,O))){const $=x(Z(r.errors,O),K.argA,K.argB);R&&qe(r.errors,O,$),Aj(r.errors,O)}if(c.touchedFields&&k&&Array.isArray(Z(r.touchedFields,O))){const $=x(Z(r.touchedFields,O),K.argA,K.argB);R&&qe(r.touchedFields,O,$)}c.dirtyFields&&(r.dirtyFields=wc(i,s)),h.state.next({name:O,isDirty:ae(O,A),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else qe(s,O,A)},b=(O,A)=>{qe(r.errors,O,A),h.state.next({errors:r.errors})},S=O=>{r.errors=O,h.state.next({errors:r.errors,isValid:!1})},E=(O,A,x,K)=>{const R=Z(n,O);if(R){const k=Z(s,O,st(x)?Z(i,O):x);st(k)||K&&K.defaultChecked||A?qe(s,O,A?k:Ap(R._f)):ze(O,k),a.mount&&v()}},I=(O,A,x,K,R)=>{let k=!1,$=!1;const L={name:O},D=!!(Z(n,O)&&Z(n,O)._f.disabled);if(!x||K){c.isDirty&&($=r.isDirty,r.isDirty=L.isDirty=ae(),k=$!==L.isDirty);const Y=D||Es(Z(i,O),A);$=!!(!D&&Z(r.dirtyFields,O)),Y||D?yt(r.dirtyFields,O):qe(r.dirtyFields,O,!0),L.dirtyFields=r.dirtyFields,k=k||c.dirtyFields&&$!==!Y}if(x){const Y=Z(r.touchedFields,O);Y||(qe(r.touchedFields,O,x),L.touchedFields=r.touchedFields,k=k||c.touchedFields&&Y!==x)}return k&&R&&h.state.next(L),k?L:{}},j=(O,A,x,K)=>{const R=Z(r.errors,O),k=c.isValid&&Fi(A)&&r.isValid!==A;if(t.delayError&&x?(u=y(()=>b(O,x)),u(t.delayError)):(clearTimeout(l),u=null,x?qe(r.errors,O,x):yt(r.errors,O)),(x?!Es(R,x):R)||!kr(K)||k){const $={...K,...k&&Fi(A)?{isValid:A}:{},errors:r.errors,name:O};r={...r,...$},h.state.next($)}},P=async O=>{g(O,!0);const A=await e.resolver(s,e.context,xj(O||o.mount,n,e.criteriaMode,e.shouldUseNativeValidation));return g(O),A},G=async O=>{const{errors:A}=await P(O);if(O)for(const x of O){const K=Z(A,x);K?qe(r.errors,x,K):yt(r.errors,x)}else r.errors=A;return A},U=async(O,A,x={valid:!0})=>{for(const K in O){const R=O[K];if(R){const{_f:k,...$}=R;if(k){const L=o.array.has(k.name);g([K],!0);const D=await O_(R,s,p,e.shouldUseNativeValidation&&!A,L);if(g([K]),D[k.name]&&(x.valid=!1,A))break;!A&&(Z(D,k.name)?L?_j(r.errors,D,k.name):qe(r.errors,k.name,D[k.name]):yt(r.errors,k.name))}$&&await U($,A,x)}}return x.valid},le=()=>{for(const O of o.unMount){const A=Z(n,O);A&&(A._f.refs?A._f.refs.every(x=>!Tp(x)):!Tp(A._f.ref))&&_(O)}o.unMount=new Set},ae=(O,A)=>(O&&A&&qe(s,O,A),!Es(_e(),i)),de=(O,A,x)=>wj(O,o,{...a.mount?s:st(A)?i:Bn(O)?{[O]:A}:A},x,A),Ee=O=>Ml(Z(a.mount?s:i,O,t.shouldUnregister?Z(i,O,[]):[])),ze=(O,A,x={})=>{const K=Z(n,O);let R=A;if(K){const k=K._f;k&&(!k.disabled&&qe(s,O,VS(A,k)),R=Lh(k.ref)&&er(A)?"":A,US(k.ref)?[...k.ref.options].forEach($=>$.selected=R.includes($.value)):k.refs?Dl(k.ref)?k.refs.length>1?k.refs.forEach($=>(!$.defaultChecked||!$.disabled)&&($.checked=Array.isArray(R)?!!R.find(L=>L===$.value):R===$.value)):k.refs[0]&&(k.refs[0].checked=!!R):k.refs.forEach($=>$.checked=$.value===R):Yy(k.ref)?k.ref.value="":(k.ref.value=R,k.ref.type||h.values.next({name:O,values:{...s}})))}(x.shouldDirty||x.shouldTouch)&&I(O,R,x.shouldTouch,x.shouldDirty,!0),x.shouldValidate&&te(O)},ce=(O,A,x)=>{for(const K in A){const R=A[K],k=`${O}.${K}`,$=Z(n,k);(o.array.has(O)||!Mh(R)||$&&!$._f)&&!Na(R)?ce(k,R,x):ze(k,R,x)}},rt=(O,A,x={})=>{const K=Z(n,O),R=o.array.has(O),k=Vr(A);qe(s,O,k),R?(h.array.next({name:O,values:{...s}}),(c.isDirty||c.dirtyFields)&&x.shouldDirty&&h.state.next({name:O,dirtyFields:wc(i,s),isDirty:ae(O,k)})):K&&!K._f&&!er(k)?ce(O,k,x):ze(O,k,x),b_(O,o)&&h.state.next({...r}),h.values.next({name:a.mount?O:void 0,values:{...s}})},q=async O=>{a.mount=!0;const A=O.target;let x=A.name,K=!0;const R=Z(n,x),k=()=>A.type?Ap(R._f):dj(O),$=L=>{K=Number.isNaN(L)||L===Z(s,x,L)};if(R){let L,D;const Y=k(),se=O.type===g_.BLUR||O.type===g_.FOCUS_OUT,Ft=!Ej(R._f)&&!e.resolver&&!Z(r.errors,x)&&!R._f.deps||Tj(se,Z(r.touchedFields,x),r.isSubmitted,f,d),ha=b_(x,o,se);qe(s,x,Y),se?(R._f.onBlur&&R._f.onBlur(O),u&&u(0)):R._f.onChange&&R._f.onChange(O);const da=I(x,Y,se,!1),uk=!kr(da)||ha;if(!se&&h.values.next({name:x,type:O.type,values:{...s}}),Ft)return c.isValid&&v(),uk&&h.state.next({name:x,...ha?{}:da});if(!se&&ha&&h.state.next({...r}),e.resolver){const{errors:Fw}=await P([x]);if($(Y),K){const lk=S_(r.errors,n,x),zw=S_(Fw,n,lk.name||x);L=zw.error,x=zw.name,D=kr(Fw)}}else g([x],!0),L=(await O_(R,s,p,e.shouldUseNativeValidation))[x],g([x]),$(Y),K&&(L?D=!1:c.isValid&&(D=await U(n,!0)));K&&(R._f.deps&&te(R._f.deps),j(x,D,L,da))}},ie=(O,A)=>{if(Z(r.errors,A)&&O.focus)return O.focus(),1},te=async(O,A={})=>{let x,K;const R=xp(O);if(e.resolver){const k=await G(st(O)?O:R);x=kr(k),K=O?!R.some($=>Z(k,$)):x}else O?(K=(await Promise.all(R.map(async k=>{const $=Z(n,k);return await U($&&$._f?{[k]:$}:$)}))).every(Boolean),!(!K&&!r.isValid)&&v()):K=x=await U(n);return h.state.next({...!Bn(O)||c.isValid&&x!==r.isValid?{}:{name:O},...e.resolver||!O?{isValid:x}:{},errors:r.errors}),A.shouldFocus&&!K&&Ou(n,ie,O?R:o.mount),K},_e=O=>{const A={...a.mount?s:i};return st(O)?A:Bn(O)?Z(A,O):O.map(x=>Z(A,x))},Ne=(O,A)=>({invalid:!!Z((A||r).errors,O),isDirty:!!Z((A||r).dirtyFields,O),isTouched:!!Z((A||r).touchedFields,O),isValidating:!!Z((A||r).validatingFields,O),error:Z((A||r).errors,O)}),qr=O=>{O&&xp(O).forEach(A=>yt(r.errors,A)),h.state.next({errors:O?r.errors:{}})},Mt=(O,A,x)=>{const K=(Z(n,O,{_f:{}})._f||{}).ref,R=Z(r.errors,O)||{},{ref:k,message:$,type:L,...D}=R;qe(r.errors,O,{...D,...A,ref:K}),h.state.next({name:O,errors:r.errors,isValid:!1}),x&&x.shouldFocus&&K&&K.focus&&K.focus()},Ct=(O,A)=>Bi(O)?h.values.subscribe({next:x=>O(de(void 0,A),x)}):de(O,A,!0),_=(O,A={})=>{for(const x of O?xp(O):o.mount)o.mount.delete(x),o.array.delete(x),A.keepValue||(yt(n,x),yt(s,x)),!A.keepError&&yt(r.errors,x),!A.keepDirty&&yt(r.dirtyFields,x),!A.keepTouched&&yt(r.touchedFields,x),!A.keepIsValidating&&yt(r.validatingFields,x),!e.shouldUnregister&&!A.keepDefaultValue&&yt(i,x);h.values.next({values:{...s}}),h.state.next({...r,...A.keepDirty?{isDirty:ae()}:{}}),!A.keepIsValid&&v()},w=({disabled:O,name:A,field:x,fields:K,value:R})=>{if(Fi(O)&&a.mount||O){const k=O?void 0:st(R)?Ap(x?x._f:Z(K,A)._f):R;qe(s,A,k),I(A,k,!1,!1,!0)}},N=(O,A={})=>{let x=Z(n,O);const K=Fi(A.disabled);return qe(n,O,{...x||{},_f:{...x&&x._f?x._f:{ref:{name:O}},name:O,mount:!0,...A}}),o.mount.add(O),x?w({field:x,disabled:A.disabled,name:O,value:A.value}):E(O,!0,A.value),{...K?{disabled:A.disabled}:{},...e.progressive?{required:!!A.required,min:Wo(A.min),max:Wo(A.max),minLength:Wo(A.minLength),maxLength:Wo(A.maxLength),pattern:Wo(A.pattern)}:{},name:O,onChange:q,onBlur:q,ref:R=>{if(R){N(O,A),x=Z(n,O);const k=st(R.value)&&R.querySelectorAll&&R.querySelectorAll("input,select,textarea")[0]||R,$=Sj(k),L=x._f.refs||[];if($?L.find(D=>D===k):k===x._f.ref)return;qe(n,O,{_f:{...x._f,...$?{refs:[...L.filter(Tp),k,...Array.isArray(Z(i,O))?[{}]:[]],ref:{type:k.type,name:O}}:{ref:k}}}),E(O,!1,void 0,k)}else x=Z(n,O,{}),x._f&&(x._f.mount=!1),(e.shouldUnregister||A.shouldUnregister)&&!(pj(o.array,O)&&a.action)&&o.unMount.add(O)}}},T=()=>e.shouldFocusError&&Ou(n,ie,o.mount),ye=O=>{Fi(O)&&(h.state.next({disabled:O}),Ou(n,(A,x)=>{const K=Z(n,x);K&&(A.disabled=K._f.disabled||O,Array.isArray(K._f.refs)&&K._f.refs.forEach(R=>{R.disabled=K._f.disabled||O}))},0,!1))},ke=(O,A)=>async x=>{let K;x&&(x.preventDefault&&x.preventDefault(),x.persist&&x.persist());let R=Vr(s);if(h.state.next({isSubmitting:!0}),e.resolver){const{errors:k,values:$}=await P();r.errors=k,R=$}else await U(n);if(yt(r.errors,"root"),kr(r.errors)){h.state.next({errors:{}});try{await O(R,x)}catch(k){K=k}}else A&&await A({...r.errors},x),T(),setTimeout(T);if(h.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:kr(r.errors)&&!K,submitCount:r.submitCount+1,errors:r.errors}),K)throw K},$e=(O,A={})=>{Z(n,O)&&(st(A.defaultValue)?rt(O,Vr(Z(i,O))):(rt(O,A.defaultValue),qe(i,O,Vr(A.defaultValue))),A.keepTouched||yt(r.touchedFields,O),A.keepDirty||(yt(r.dirtyFields,O),r.isDirty=A.defaultValue?ae(O,Vr(Z(i,O))):ae()),A.keepError||(yt(r.errors,O),c.isValid&&v()),h.state.next({...r}))},He=(O,A={})=>{const x=O?Vr(O):i,K=Vr(x),R=kr(O),k=R?i:K;if(A.keepDefaultValues||(i=x),!A.keepValues){if(A.keepDirtyValues)for(const $ of o.mount)Z(r.dirtyFields,$)?qe(k,$,Z(s,$)):rt($,Z(k,$));else{if(Gy&&st(O))for(const $ of o.mount){const L=Z(n,$);if(L&&L._f){const D=Array.isArray(L._f.refs)?L._f.refs[0]:L._f.ref;if(Lh(D)){const Y=D.closest("form");if(Y){Y.reset();break}}}}n={}}s=t.shouldUnregister?A.keepDefaultValues?Vr(i):{}:Vr(k),h.array.next({values:{...k}}),h.values.next({values:{...k}})}o={mount:A.keepDirtyValues?o.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},a.mount=!c.isValid||!!A.keepIsValid||!!A.keepDirtyValues,a.watch=!!t.shouldUnregister,h.state.next({submitCount:A.keepSubmitCount?r.submitCount:0,isDirty:R?!1:A.keepDirty?r.isDirty:!!(A.keepDefaultValues&&!Es(O,i)),isSubmitted:A.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:R?[]:A.keepDirtyValues?A.keepDefaultValues&&s?wc(i,s):r.dirtyFields:A.keepDefaultValues&&O?wc(i,O):{},touchedFields:A.keepTouched?r.touchedFields:{},errors:A.keepErrors?r.errors:{},isSubmitSuccessful:A.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1})},ct=(O,A)=>He(Bi(O)?O(s):O,A);return{control:{register:N,unregister:_,getFieldState:Ne,handleSubmit:ke,setError:Mt,_executeSchema:P,_getWatch:de,_getDirty:ae,_updateValid:v,_removeUnmounted:le,_updateFieldArray:m,_updateDisabledField:w,_getFieldArray:Ee,_reset:He,_resetDefaultValues:()=>Bi(e.defaultValues)&&e.defaultValues().then(O=>{ct(O,e.resetOptions),h.state.next({isLoading:!1})}),_updateFormState:O=>{r={...r,...O}},_disableForm:ye,_subjects:h,_proxyFormState:c,_setErrors:S,get _fields(){return n},get _formValues(){return s},get _state(){return a},set _state(O){a=O},get _defaultValues(){return i},get _names(){return o},set _names(O){o=O},get _formState(){return r},set _formState(O){r=O},get _options(){return e},set _options(O){e={...e,...O}}},trigger:te,register:N,handleSubmit:ke,watch:Ct,setValue:rt,getValues:_e,reset:ct,resetField:$e,clearErrors:qr,unregister:_,setError:Mt,setFocus:(O,A={})=>{const x=Z(n,O),K=x&&x._f;if(K){const R=K.refs?K.refs[0]:K.ref;R.focus&&(R.focus(),A.shouldSelect&&R.select())}},getFieldState:Ne}}function BS(t={}){const e=dr.useRef(),r=dr.useRef(),[n,i]=dr.useState({isDirty:!1,isValidating:!1,isLoading:Bi(t.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1,defaultValues:Bi(t.defaultValues)?void 0:t.defaultValues});e.current||(e.current={...Ij(t),formState:n});const s=e.current.control;return s._options=t,bj({subject:s._subjects.state,next:a=>{yj(a,s._proxyFormState,s._updateFormState)&&i({...s._formState})}}),dr.useEffect(()=>s._disableForm(t.disabled),[s,t.disabled]),dr.useEffect(()=>{if(s._proxyFormState.isDirty){const a=s._getDirty();a!==n.isDirty&&s._subjects.state.next({isDirty:a})}},[s,n.isDirty]),dr.useEffect(()=>{t.values&&!Es(t.values,r.current)?(s._reset(t.values,s._options.resetOptions),r.current=t.values,i(a=>({...a}))):s._resetDefaultValues()},[t.values,s]),dr.useEffect(()=>{t.errors&&s._setErrors(t.errors)},[t.errors,s]),dr.useEffect(()=>{s._state.mount||(s._updateValid(),s._state.mount=!0),s._state.watch&&(s._state.watch=!1,s._subjects.state.next({...s._formState})),s._removeUnmounted()}),dr.useEffect(()=>{t.shouldUnregister&&s._subjects.values.next({values:s._getWatch()})},[t.shouldUnregister,s]),e.current.formState=gj(n,s),e.current}function sg(){return sg=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},sg.apply(null,arguments)}function Cj(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}var Rj=V.useLayoutEffect,jj=function(e){var r=V.useRef(e);return Rj(function(){r.current=e}),r},x_=function(e,r){if(typeof e=="function"){e(r);return}e.current=r},Nj=function(e,r){var n=V.useRef();return V.useCallback(function(i){e.current=i,n.current&&x_(n.current,null),n.current=r,r&&x_(r,i)},[r])},E_={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},$j=function(e){Object.keys(E_).forEach(function(r){e.style.setProperty(r,E_[r],"important")})},T_=$j,Yt=null,A_=function(e,r){var n=e.scrollHeight;return r.sizingStyle.boxSizing==="border-box"?n+r.borderSize:n-r.paddingSize};function Lj(t,e,r,n){r===void 0&&(r=1),n===void 0&&(n=1/0),Yt||(Yt=document.createElement("textarea"),Yt.setAttribute("tabindex","-1"),Yt.setAttribute("aria-hidden","true"),T_(Yt)),Yt.parentNode===null&&document.body.appendChild(Yt);var i=t.paddingSize,s=t.borderSize,a=t.sizingStyle,o=a.boxSizing;Object.keys(a).forEach(function(d){var f=d;Yt.style[f]=a[f]}),T_(Yt),Yt.value=e;var u=A_(Yt,t);Yt.value=e,u=A_(Yt,t),Yt.value="x";var l=Yt.scrollHeight-i,c=l*r;o==="border-box"&&(c=c+i+s),u=Math.max(c,u);var h=l*n;return o==="border-box"&&(h=h+i+s),u=Math.min(h,u),[u,l]}var k_=function(){},Dj=function(e,r){return e.reduce(function(n,i){return n[i]=r[i],n},{})},Mj=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak"],Fj=!!document.documentElement.currentStyle,zj=function(e){var r=window.getComputedStyle(e);if(r===null)return null;var n=Dj(Mj,r),i=n.boxSizing;if(i==="")return null;Fj&&i==="border-box"&&(n.width=parseFloat(n.width)+parseFloat(n.borderRightWidth)+parseFloat(n.borderLeftWidth)+parseFloat(n.paddingRight)+parseFloat(n.paddingLeft)+"px");var s=parseFloat(n.paddingBottom)+parseFloat(n.paddingTop),a=parseFloat(n.borderBottomWidth)+parseFloat(n.borderTopWidth);return{sizingStyle:n,paddingSize:s,borderSize:a}},Uj=zj;function HS(t,e,r){var n=jj(r);V.useLayoutEffect(function(){var i=function(a){return n.current(a)};if(t)return t.addEventListener(e,i),function(){return t.removeEventListener(e,i)}},[])}var qj=function(e){HS(window,"resize",e)},Kj=function(e){HS(document.fonts,"loadingdone",e)},Vj=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],Bj=function(e,r){var n=e.cacheMeasurements,i=e.maxRows,s=e.minRows,a=e.onChange,o=a===void 0?k_:a,u=e.onHeightChange,l=u===void 0?k_:u,c=Cj(e,Vj),h=c.value!==void 0,d=V.useRef(null),f=Nj(d,r),p=V.useRef(0),y=V.useRef(),v=function(){var b=d.current,S=n&&y.current?y.current:Uj(b);if(S){y.current=S;var E=Lj(S,b.value||b.placeholder||"x",s,i),I=E[0],j=E[1];p.current!==I&&(p.current=I,b.style.setProperty("height",I+"px","important"),l(I,{rowHeight:j}))}},g=function(b){h||v(),o(b)};return V.useLayoutEffect(v),qj(v),Kj(v),V.createElement("textarea",sg({},c,{onChange:g,ref:f}))},WS=V.forwardRef(Bj);const Hj=()=>{const t=jS(),{register:e,handleSubmit:r}=BS(),n=i=>{t("/search",{state:{query:i.query}})};return oe.jsx(oe.Fragment,{children:oe.jsxs("div",{className:"home-container",children:[oe.jsx("h1",{children:""}),oe.jsxs("form",{onSubmit:r(n),children:[oe.jsx("div",{className:"textarea-wrapper",children:oe.jsx(WS,{style:{width:"100%",borderRadius:"5px"},minRows:5,placeholder:"",...e("query")})}),oe.jsx("button",{children:""})]})]})})};var Oe;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{const s={};for(const a of i)s[a]=a;return s},t.getValidEnumValues=i=>{const s=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),a={};for(const o of s)a[o]=i[o];return t.objectValues(a)},t.objectValues=i=>t.objectKeys(i).map(function(s){return i[s]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const s=[];for(const a in i)Object.prototype.hasOwnProperty.call(i,a)&&s.push(a);return s},t.find=(i,s)=>{for(const a of i)if(s(a))return a},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,s=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(Oe||(Oe={}));var ag;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(ag||(ag={}));const H=Oe.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),zi=t=>{switch(typeof t){case"undefined":return H.undefined;case"string":return H.string;case"number":return isNaN(t)?H.nan:H.number;case"boolean":return H.boolean;case"function":return H.function;case"bigint":return H.bigint;case"symbol":return H.symbol;case"object":return Array.isArray(t)?H.array:t===null?H.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?H.promise:typeof Map<"u"&&t instanceof Map?H.map:typeof Set<"u"&&t instanceof Set?H.set:typeof Date<"u"&&t instanceof Date?H.date:H.object;default:return H.unknown}},F=Oe.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Wj=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class Nr extends Error{constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const r=e||function(s){return s.message},n={_errors:[]},i=s=>{for(const a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)n._errors.push(r(a));else{let o=n,u=0;for(;u<a.path.length;){const l=a.path[u];u===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(r(a))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return i(this),n}static assert(e){if(!(e instanceof Nr))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Oe.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){const r={},n=[];for(const i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}Nr.create=t=>new Nr(t);const ao=(t,e)=>{let r;switch(t.code){case F.invalid_type:t.received===H.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case F.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Oe.jsonStringifyReplacer)}`;break;case F.unrecognized_keys:r=`Unrecognized key(s) in object: ${Oe.joinValues(t.keys,", ")}`;break;case F.invalid_union:r="Invalid input";break;case F.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Oe.joinValues(t.options)}`;break;case F.invalid_enum_value:r=`Invalid enum value. Expected ${Oe.joinValues(t.options)}, received '${t.received}'`;break;case F.invalid_arguments:r="Invalid function arguments";break;case F.invalid_return_type:r="Invalid function return type";break;case F.invalid_date:r="Invalid date";break;case F.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Oe.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case F.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case F.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case F.custom:r="Invalid input";break;case F.invalid_intersection_types:r="Intersection results could not be merged";break;case F.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case F.not_finite:r="Number must be finite";break;default:r=e.defaultError,Oe.assertNever(t)}return{message:r}};let JS=ao;function Jj(t){JS=t}function zh(){return JS}const Uh=t=>{const{data:e,path:r,errorMaps:n,issueData:i}=t,s=[...r,...i.path||[]],a={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let o="";const u=n.filter(l=>!!l).slice().reverse();for(const l of u)o=l(a,{data:e,defaultError:o}).message;return{...i,path:s,message:o}},Gj=[];function B(t,e){const r=zh(),n=Uh({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===ao?void 0:ao].filter(i=>!!i)});t.common.issues.push(n)}class Jt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){const n=[];for(const i of r){if(i.status==="aborted")return ue;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){const n=[];for(const i of r){const s=await i.key,a=await i.value;n.push({key:s,value:a})}return Jt.mergeObjectSync(e,n)}static mergeObjectSync(e,r){const n={};for(const i of r){const{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return ue;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(n[s.value]=a.value)}return{status:e.value,value:n}}}const ue=Object.freeze({status:"aborted"}),$a=t=>({status:"dirty",value:t}),ir=t=>({status:"valid",value:t}),og=t=>t.status==="aborted",ug=t=>t.status==="dirty",Zu=t=>t.status==="valid",Yu=t=>typeof Promise<"u"&&t instanceof Promise;function qh(t,e,r,n){if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(t)}function GS(t,e,r,n,i){if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,r),r}var ee;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(ee||(ee={}));var eu,tu;class Qn{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const I_=(t,e)=>{if(Zu(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new Nr(t.common.issues);return this._error=r,this._error}}};function pe(t){if(!t)return{};const{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>{var u,l;const{message:c}=t;return a.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(u=c??n)!==null&&u!==void 0?u:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=c??r)!==null&&l!==void 0?l:o.defaultError}},description:i}}class ge{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return zi(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:zi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Jt,ctx:{common:e.parent.common,data:e.data,parsedType:zi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const r=this._parse(e);if(Yu(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){const r=this._parse(e);return Promise.resolve(r)}parse(e,r){const n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;const i={common:{issues:[],async:(n=r==null?void 0:r.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:zi(e)},s=this._parseSync({data:e,path:i.path,parent:i});return I_(i,s)}async parseAsync(e,r){const n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:zi(e)},i=this._parse({data:e,path:n.path,parent:n}),s=await(Yu(i)?i:Promise.resolve(i));return I_(n,s)}refine(e,r){const n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,s)=>{const a=e(i),o=()=>s.addIssue({code:F.custom,...n(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new In({schema:this,typeName:z.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Zn.create(this,this._def)}nullable(){return us.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return An.create(this,this._def)}promise(){return uo.create(this,this._def)}or(e){return tl.create([this,e],this._def)}and(e){return rl.create(this,e,this._def)}transform(e){return new In({...pe(this._def),schema:this,typeName:z.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const r=typeof e=="function"?e:()=>e;return new ol({...pe(this._def),innerType:this,defaultValue:r,typeName:z.ZodDefault})}brand(){return new Xy({typeName:z.ZodBranded,type:this,...pe(this._def)})}catch(e){const r=typeof e=="function"?e:()=>e;return new ul({...pe(this._def),innerType:this,catchValue:r,typeName:z.ZodCatch})}describe(e){const r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Fl.create(this,e)}readonly(){return ll.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Zj=/^c[^\s-]{8,}$/i,Yj=/^[0-9a-z]+$/,Qj=/^[0-9A-HJKMNP-TV-Z]{26}$/,Xj=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,eN=/^[a-z0-9_-]{21}$/i,tN=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,rN=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,nN="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let kp;const iN=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,sN=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,aN=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,ZS="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",oN=new RegExp(`^${ZS}$`);function YS(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function uN(t){return new RegExp(`^${YS(t)}$`)}function QS(t){let e=`${ZS}T${YS(t)}`;const r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function lN(t,e){return!!((e==="v4"||!e)&&iN.test(t)||(e==="v6"||!e)&&sN.test(t))}class Pn extends ge{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==H.string){const s=this._getOrReturnCtx(e);return B(s,{code:F.invalid_type,expected:H.string,received:s.parsedType}),ue}const n=new Jt;let i;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),B(i,{code:F.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),B(i,{code:F.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){const a=e.data.length>s.value,o=e.data.length<s.value;(a||o)&&(i=this._getOrReturnCtx(e,i),a?B(i,{code:F.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&B(i,{code:F.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")rN.test(e.data)||(i=this._getOrReturnCtx(e,i),B(i,{validation:"email",code:F.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")kp||(kp=new RegExp(nN,"u")),kp.test(e.data)||(i=this._getOrReturnCtx(e,i),B(i,{validation:"emoji",code:F.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")Xj.test(e.data)||(i=this._getOrReturnCtx(e,i),B(i,{validation:"uuid",code:F.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")eN.test(e.data)||(i=this._getOrReturnCtx(e,i),B(i,{validation:"nanoid",code:F.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")Zj.test(e.data)||(i=this._getOrReturnCtx(e,i),B(i,{validation:"cuid",code:F.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")Yj.test(e.data)||(i=this._getOrReturnCtx(e,i),B(i,{validation:"cuid2",code:F.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")Qj.test(e.data)||(i=this._getOrReturnCtx(e,i),B(i,{validation:"ulid",code:F.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),B(i,{validation:"url",code:F.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),B(i,{validation:"regex",code:F.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),B(i,{code:F.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),B(i,{code:F.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),B(i,{code:F.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?QS(s).test(e.data)||(i=this._getOrReturnCtx(e,i),B(i,{code:F.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?oN.test(e.data)||(i=this._getOrReturnCtx(e,i),B(i,{code:F.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?uN(s).test(e.data)||(i=this._getOrReturnCtx(e,i),B(i,{code:F.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?tN.test(e.data)||(i=this._getOrReturnCtx(e,i),B(i,{validation:"duration",code:F.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?lN(e.data,s.version)||(i=this._getOrReturnCtx(e,i),B(i,{validation:"ip",code:F.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?aN.test(e.data)||(i=this._getOrReturnCtx(e,i),B(i,{validation:"base64",code:F.invalid_string,message:s.message}),n.dirty()):Oe.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:F.invalid_string,...ee.errToObj(n)})}_addCheck(e){return new Pn({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...ee.errToObj(e)})}url(e){return this._addCheck({kind:"url",...ee.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...ee.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...ee.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...ee.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...ee.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...ee.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...ee.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...ee.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...ee.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(r=e==null?void 0:e.offset)!==null&&r!==void 0?r:!1,local:(n=e==null?void 0:e.local)!==null&&n!==void 0?n:!1,...ee.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...ee.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...ee.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...ee.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r==null?void 0:r.position,...ee.errToObj(r==null?void 0:r.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...ee.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...ee.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...ee.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...ee.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...ee.errToObj(r)})}nonempty(e){return this.min(1,ee.errToObj(e))}trim(){return new Pn({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Pn({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Pn({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}Pn.create=t=>{var e;return new Pn({checks:[],typeName:z.ZodString,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...pe(t)})};function cN(t,e){const r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,s=parseInt(t.toFixed(i).replace(".","")),a=parseInt(e.toFixed(i).replace(".",""));return s%a/Math.pow(10,i)}class ss extends ge{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==H.number){const s=this._getOrReturnCtx(e);return B(s,{code:F.invalid_type,expected:H.number,received:s.parsedType}),ue}let n;const i=new Jt;for(const s of this._def.checks)s.kind==="int"?Oe.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{code:F.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),B(n,{code:F.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),B(n,{code:F.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?cN(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),B(n,{code:F.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{code:F.not_finite,message:s.message}),i.dirty()):Oe.assertNever(s);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,ee.toString(r))}gt(e,r){return this.setLimit("min",e,!1,ee.toString(r))}lte(e,r){return this.setLimit("max",e,!0,ee.toString(r))}lt(e,r){return this.setLimit("max",e,!1,ee.toString(r))}setLimit(e,r,n,i){return new ss({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:ee.toString(i)}]})}_addCheck(e){return new ss({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:ee.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ee.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ee.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ee.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ee.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:ee.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:ee.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ee.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ee.toString(e)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Oe.isInteger(e.value))}get isFinite(){let e=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}}ss.create=t=>new ss({checks:[],typeName:z.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...pe(t)});class as extends ge{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==H.bigint){const s=this._getOrReturnCtx(e);return B(s,{code:F.invalid_type,expected:H.bigint,received:s.parsedType}),ue}let n;const i=new Jt;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),B(n,{code:F.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),B(n,{code:F.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),B(n,{code:F.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):Oe.assertNever(s);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,ee.toString(r))}gt(e,r){return this.setLimit("min",e,!1,ee.toString(r))}lte(e,r){return this.setLimit("max",e,!0,ee.toString(r))}lt(e,r){return this.setLimit("max",e,!1,ee.toString(r))}setLimit(e,r,n,i){return new as({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:ee.toString(i)}]})}_addCheck(e){return new as({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ee.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ee.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ee.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ee.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:ee.toString(r)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}as.create=t=>{var e;return new as({checks:[],typeName:z.ZodBigInt,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...pe(t)})};class Qu extends ge{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==H.boolean){const n=this._getOrReturnCtx(e);return B(n,{code:F.invalid_type,expected:H.boolean,received:n.parsedType}),ue}return ir(e.data)}}Qu.create=t=>new Qu({typeName:z.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...pe(t)});class Bs extends ge{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==H.date){const s=this._getOrReturnCtx(e);return B(s,{code:F.invalid_type,expected:H.date,received:s.parsedType}),ue}if(isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return B(s,{code:F.invalid_date}),ue}const n=new Jt;let i;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),B(i,{code:F.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),B(i,{code:F.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):Oe.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Bs({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:ee.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:ee.toString(r)})}get minDate(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}}Bs.create=t=>new Bs({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:z.ZodDate,...pe(t)});class Kh extends ge{_parse(e){if(this._getType(e)!==H.symbol){const n=this._getOrReturnCtx(e);return B(n,{code:F.invalid_type,expected:H.symbol,received:n.parsedType}),ue}return ir(e.data)}}Kh.create=t=>new Kh({typeName:z.ZodSymbol,...pe(t)});class Xu extends ge{_parse(e){if(this._getType(e)!==H.undefined){const n=this._getOrReturnCtx(e);return B(n,{code:F.invalid_type,expected:H.undefined,received:n.parsedType}),ue}return ir(e.data)}}Xu.create=t=>new Xu({typeName:z.ZodUndefined,...pe(t)});class el extends ge{_parse(e){if(this._getType(e)!==H.null){const n=this._getOrReturnCtx(e);return B(n,{code:F.invalid_type,expected:H.null,received:n.parsedType}),ue}return ir(e.data)}}el.create=t=>new el({typeName:z.ZodNull,...pe(t)});class oo extends ge{constructor(){super(...arguments),this._any=!0}_parse(e){return ir(e.data)}}oo.create=t=>new oo({typeName:z.ZodAny,...pe(t)});class js extends ge{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ir(e.data)}}js.create=t=>new js({typeName:z.ZodUnknown,...pe(t)});class wi extends ge{_parse(e){const r=this._getOrReturnCtx(e);return B(r,{code:F.invalid_type,expected:H.never,received:r.parsedType}),ue}}wi.create=t=>new wi({typeName:z.ZodNever,...pe(t)});class Vh extends ge{_parse(e){if(this._getType(e)!==H.undefined){const n=this._getOrReturnCtx(e);return B(n,{code:F.invalid_type,expected:H.void,received:n.parsedType}),ue}return ir(e.data)}}Vh.create=t=>new Vh({typeName:z.ZodVoid,...pe(t)});class An extends ge{_parse(e){const{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==H.array)return B(r,{code:F.invalid_type,expected:H.array,received:r.parsedType}),ue;if(i.exactLength!==null){const a=r.data.length>i.exactLength.value,o=r.data.length<i.exactLength.value;(a||o)&&(B(r,{code:a?F.too_big:F.too_small,minimum:o?i.exactLength.value:void 0,maximum:a?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),n.dirty())}if(i.minLength!==null&&r.data.length<i.minLength.value&&(B(r,{code:F.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),n.dirty()),i.maxLength!==null&&r.data.length>i.maxLength.value&&(B(r,{code:F.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((a,o)=>i.type._parseAsync(new Qn(r,a,r.path,o)))).then(a=>Jt.mergeArray(n,a));const s=[...r.data].map((a,o)=>i.type._parseSync(new Qn(r,a,r.path,o)));return Jt.mergeArray(n,s)}get element(){return this._def.type}min(e,r){return new An({...this._def,minLength:{value:e,message:ee.toString(r)}})}max(e,r){return new An({...this._def,maxLength:{value:e,message:ee.toString(r)}})}length(e,r){return new An({...this._def,exactLength:{value:e,message:ee.toString(r)}})}nonempty(e){return this.min(1,e)}}An.create=(t,e)=>new An({type:t,minLength:null,maxLength:null,exactLength:null,typeName:z.ZodArray,...pe(e)});function ba(t){if(t instanceof Ye){const e={};for(const r in t.shape){const n=t.shape[r];e[r]=Zn.create(ba(n))}return new Ye({...t._def,shape:()=>e})}else return t instanceof An?new An({...t._def,type:ba(t.element)}):t instanceof Zn?Zn.create(ba(t.unwrap())):t instanceof us?us.create(ba(t.unwrap())):t instanceof Xn?Xn.create(t.items.map(e=>ba(e))):t}class Ye extends ge{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),r=Oe.objectKeys(e);return this._cached={shape:e,keys:r}}_parse(e){if(this._getType(e)!==H.object){const l=this._getOrReturnCtx(e);return B(l,{code:F.invalid_type,expected:H.object,received:l.parsedType}),ue}const{status:n,ctx:i}=this._processInputParams(e),{shape:s,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof wi&&this._def.unknownKeys==="strip"))for(const l in i.data)a.includes(l)||o.push(l);const u=[];for(const l of a){const c=s[l],h=i.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new Qn(i,h,i.path,l)),alwaysSet:l in i.data})}if(this._def.catchall instanceof wi){const l=this._def.unknownKeys;if(l==="passthrough")for(const c of o)u.push({key:{status:"valid",value:c},value:{status:"valid",value:i.data[c]}});else if(l==="strict")o.length>0&&(B(i,{code:F.unrecognized_keys,keys:o}),n.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const c of o){const h=i.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new Qn(i,h,i.path,c)),alwaysSet:c in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const l=[];for(const c of u){const h=await c.key,d=await c.value;l.push({key:h,value:d,alwaysSet:c.alwaysSet})}return l}).then(l=>Jt.mergeObjectSync(n,l)):Jt.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(e){return ee.errToObj,new Ye({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{var i,s,a,o;const u=(a=(s=(i=this._def).errorMap)===null||s===void 0?void 0:s.call(i,r,n).message)!==null&&a!==void 0?a:n.defaultError;return r.code==="unrecognized_keys"?{message:(o=ee.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new Ye({...this._def,unknownKeys:"strip"})}passthrough(){return new Ye({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ye({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ye({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:z.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new Ye({...this._def,catchall:e})}pick(e){const r={};return Oe.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(r[n]=this.shape[n])}),new Ye({...this._def,shape:()=>r})}omit(e){const r={};return Oe.objectKeys(this.shape).forEach(n=>{e[n]||(r[n]=this.shape[n])}),new Ye({...this._def,shape:()=>r})}deepPartial(){return ba(this)}partial(e){const r={};return Oe.objectKeys(this.shape).forEach(n=>{const i=this.shape[n];e&&!e[n]?r[n]=i:r[n]=i.optional()}),new Ye({...this._def,shape:()=>r})}required(e){const r={};return Oe.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])r[n]=this.shape[n];else{let s=this.shape[n];for(;s instanceof Zn;)s=s._def.innerType;r[n]=s}}),new Ye({...this._def,shape:()=>r})}keyof(){return XS(Oe.objectKeys(this.shape))}}Ye.create=(t,e)=>new Ye({shape:()=>t,unknownKeys:"strip",catchall:wi.create(),typeName:z.ZodObject,...pe(e)});Ye.strictCreate=(t,e)=>new Ye({shape:()=>t,unknownKeys:"strict",catchall:wi.create(),typeName:z.ZodObject,...pe(e)});Ye.lazycreate=(t,e)=>new Ye({shape:t,unknownKeys:"strip",catchall:wi.create(),typeName:z.ZodObject,...pe(e)});class tl extends ge{_parse(e){const{ctx:r}=this._processInputParams(e),n=this._def.options;function i(s){for(const o of s)if(o.result.status==="valid")return o.result;for(const o of s)if(o.result.status==="dirty")return r.common.issues.push(...o.ctx.common.issues),o.result;const a=s.map(o=>new Nr(o.ctx.common.issues));return B(r,{code:F.invalid_union,unionErrors:a}),ue}if(r.common.async)return Promise.all(n.map(async s=>{const a={...r,common:{...r.common,issues:[]},parent:null};return{result:await s._parseAsync({data:r.data,path:r.path,parent:a}),ctx:a}})).then(i);{let s;const a=[];for(const u of n){const l={...r,common:{...r.common,issues:[]},parent:null},c=u._parseSync({data:r.data,path:r.path,parent:l});if(c.status==="valid")return c;c.status==="dirty"&&!s&&(s={result:c,ctx:l}),l.common.issues.length&&a.push(l.common.issues)}if(s)return r.common.issues.push(...s.ctx.common.issues),s.result;const o=a.map(u=>new Nr(u));return B(r,{code:F.invalid_union,unionErrors:o}),ue}}get options(){return this._def.options}}tl.create=(t,e)=>new tl({options:t,typeName:z.ZodUnion,...pe(e)});const ni=t=>t instanceof il?ni(t.schema):t instanceof In?ni(t.innerType()):t instanceof sl?[t.value]:t instanceof os?t.options:t instanceof al?Oe.objectValues(t.enum):t instanceof ol?ni(t._def.innerType):t instanceof Xu?[void 0]:t instanceof el?[null]:t instanceof Zn?[void 0,...ni(t.unwrap())]:t instanceof us?[null,...ni(t.unwrap())]:t instanceof Xy||t instanceof ll?ni(t.unwrap()):t instanceof ul?ni(t._def.innerType):[];class uf extends ge{_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==H.object)return B(r,{code:F.invalid_type,expected:H.object,received:r.parsedType}),ue;const n=this.discriminator,i=r.data[n],s=this.optionsMap.get(i);return s?r.common.async?s._parseAsync({data:r.data,path:r.path,parent:r}):s._parseSync({data:r.data,path:r.path,parent:r}):(B(r,{code:F.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),ue)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){const i=new Map;for(const s of r){const a=ni(s.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(i.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);i.set(o,s)}}return new uf({typeName:z.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:i,...pe(n)})}}function lg(t,e){const r=zi(t),n=zi(e);if(t===e)return{valid:!0,data:t};if(r===H.object&&n===H.object){const i=Oe.objectKeys(e),s=Oe.objectKeys(t).filter(o=>i.indexOf(o)!==-1),a={...t,...e};for(const o of s){const u=lg(t[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(r===H.array&&n===H.array){if(t.length!==e.length)return{valid:!1};const i=[];for(let s=0;s<t.length;s++){const a=t[s],o=e[s],u=lg(a,o);if(!u.valid)return{valid:!1};i.push(u.data)}return{valid:!0,data:i}}else return r===H.date&&n===H.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class rl extends ge{_parse(e){const{status:r,ctx:n}=this._processInputParams(e),i=(s,a)=>{if(og(s)||og(a))return ue;const o=lg(s.value,a.value);return o.valid?((ug(s)||ug(a))&&r.dirty(),{status:r.value,value:o.data}):(B(n,{code:F.invalid_intersection_types}),ue)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,a])=>i(s,a)):i(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}rl.create=(t,e,r)=>new rl({left:t,right:e,typeName:z.ZodIntersection,...pe(r)});class Xn extends ge{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==H.array)return B(n,{code:F.invalid_type,expected:H.array,received:n.parsedType}),ue;if(n.data.length<this._def.items.length)return B(n,{code:F.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ue;!this._def.rest&&n.data.length>this._def.items.length&&(B(n,{code:F.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const s=[...n.data].map((a,o)=>{const u=this._def.items[o]||this._def.rest;return u?u._parse(new Qn(n,a,n.path,o)):null}).filter(a=>!!a);return n.common.async?Promise.all(s).then(a=>Jt.mergeArray(r,a)):Jt.mergeArray(r,s)}get items(){return this._def.items}rest(e){return new Xn({...this._def,rest:e})}}Xn.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Xn({items:t,typeName:z.ZodTuple,rest:null,...pe(e)})};class nl extends ge{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==H.object)return B(n,{code:F.invalid_type,expected:H.object,received:n.parsedType}),ue;const i=[],s=this._def.keyType,a=this._def.valueType;for(const o in n.data)i.push({key:s._parse(new Qn(n,o,n.path,o)),value:a._parse(new Qn(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?Jt.mergeObjectAsync(r,i):Jt.mergeObjectSync(r,i)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof ge?new nl({keyType:e,valueType:r,typeName:z.ZodRecord,...pe(n)}):new nl({keyType:Pn.create(),valueType:e,typeName:z.ZodRecord,...pe(r)})}}class Bh extends ge{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==H.map)return B(n,{code:F.invalid_type,expected:H.map,received:n.parsedType}),ue;const i=this._def.keyType,s=this._def.valueType,a=[...n.data.entries()].map(([o,u],l)=>({key:i._parse(new Qn(n,o,n.path,[l,"key"])),value:s._parse(new Qn(n,u,n.path,[l,"value"]))}));if(n.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const u of a){const l=await u.key,c=await u.value;if(l.status==="aborted"||c.status==="aborted")return ue;(l.status==="dirty"||c.status==="dirty")&&r.dirty(),o.set(l.value,c.value)}return{status:r.value,value:o}})}else{const o=new Map;for(const u of a){const l=u.key,c=u.value;if(l.status==="aborted"||c.status==="aborted")return ue;(l.status==="dirty"||c.status==="dirty")&&r.dirty(),o.set(l.value,c.value)}return{status:r.value,value:o}}}}Bh.create=(t,e,r)=>new Bh({valueType:e,keyType:t,typeName:z.ZodMap,...pe(r)});class Hs extends ge{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==H.set)return B(n,{code:F.invalid_type,expected:H.set,received:n.parsedType}),ue;const i=this._def;i.minSize!==null&&n.data.size<i.minSize.value&&(B(n,{code:F.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),r.dirty()),i.maxSize!==null&&n.data.size>i.maxSize.value&&(B(n,{code:F.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),r.dirty());const s=this._def.valueType;function a(u){const l=new Set;for(const c of u){if(c.status==="aborted")return ue;c.status==="dirty"&&r.dirty(),l.add(c.value)}return{status:r.value,value:l}}const o=[...n.data.values()].map((u,l)=>s._parse(new Qn(n,u,n.path,l)));return n.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,r){return new Hs({...this._def,minSize:{value:e,message:ee.toString(r)}})}max(e,r){return new Hs({...this._def,maxSize:{value:e,message:ee.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}}Hs.create=(t,e)=>new Hs({valueType:t,minSize:null,maxSize:null,typeName:z.ZodSet,...pe(e)});class Ha extends ge{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==H.function)return B(r,{code:F.invalid_type,expected:H.function,received:r.parsedType}),ue;function n(o,u){return Uh({data:o,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,zh(),ao].filter(l=>!!l),issueData:{code:F.invalid_arguments,argumentsError:u}})}function i(o,u){return Uh({data:o,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,zh(),ao].filter(l=>!!l),issueData:{code:F.invalid_return_type,returnTypeError:u}})}const s={errorMap:r.common.contextualErrorMap},a=r.data;if(this._def.returns instanceof uo){const o=this;return ir(async function(...u){const l=new Nr([]),c=await o._def.args.parseAsync(u,s).catch(f=>{throw l.addIssue(n(u,f)),l}),h=await Reflect.apply(a,this,c);return await o._def.returns._def.type.parseAsync(h,s).catch(f=>{throw l.addIssue(i(h,f)),l})})}else{const o=this;return ir(function(...u){const l=o._def.args.safeParse(u,s);if(!l.success)throw new Nr([n(u,l.error)]);const c=Reflect.apply(a,this,l.data),h=o._def.returns.safeParse(c,s);if(!h.success)throw new Nr([i(c,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Ha({...this._def,args:Xn.create(e).rest(js.create())})}returns(e){return new Ha({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new Ha({args:e||Xn.create([]).rest(js.create()),returns:r||js.create(),typeName:z.ZodFunction,...pe(n)})}}class il extends ge{get schema(){return this._def.getter()}_parse(e){const{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}il.create=(t,e)=>new il({getter:t,typeName:z.ZodLazy,...pe(e)});class sl extends ge{_parse(e){if(e.data!==this._def.value){const r=this._getOrReturnCtx(e);return B(r,{received:r.data,code:F.invalid_literal,expected:this._def.value}),ue}return{status:"valid",value:e.data}}get value(){return this._def.value}}sl.create=(t,e)=>new sl({value:t,typeName:z.ZodLiteral,...pe(e)});function XS(t,e){return new os({values:t,typeName:z.ZodEnum,...pe(e)})}class os extends ge{constructor(){super(...arguments),eu.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const r=this._getOrReturnCtx(e),n=this._def.values;return B(r,{expected:Oe.joinValues(n),received:r.parsedType,code:F.invalid_type}),ue}if(qh(this,eu)||GS(this,eu,new Set(this._def.values)),!qh(this,eu).has(e.data)){const r=this._getOrReturnCtx(e),n=this._def.values;return B(r,{received:r.data,code:F.invalid_enum_value,options:n}),ue}return ir(e.data)}get options(){return this._def.values}get enum(){const e={};for(const r of this._def.values)e[r]=r;return e}get Values(){const e={};for(const r of this._def.values)e[r]=r;return e}get Enum(){const e={};for(const r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return os.create(e,{...this._def,...r})}exclude(e,r=this._def){return os.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}}eu=new WeakMap;os.create=XS;class al extends ge{constructor(){super(...arguments),tu.set(this,void 0)}_parse(e){const r=Oe.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==H.string&&n.parsedType!==H.number){const i=Oe.objectValues(r);return B(n,{expected:Oe.joinValues(i),received:n.parsedType,code:F.invalid_type}),ue}if(qh(this,tu)||GS(this,tu,new Set(Oe.getValidEnumValues(this._def.values))),!qh(this,tu).has(e.data)){const i=Oe.objectValues(r);return B(n,{received:n.data,code:F.invalid_enum_value,options:i}),ue}return ir(e.data)}get enum(){return this._def.values}}tu=new WeakMap;al.create=(t,e)=>new al({values:t,typeName:z.ZodNativeEnum,...pe(e)});class uo extends ge{unwrap(){return this._def.type}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==H.promise&&r.common.async===!1)return B(r,{code:F.invalid_type,expected:H.promise,received:r.parsedType}),ue;const n=r.parsedType===H.promise?r.data:Promise.resolve(r.data);return ir(n.then(i=>this._def.type.parseAsync(i,{path:r.path,errorMap:r.common.contextualErrorMap})))}}uo.create=(t,e)=>new uo({type:t,typeName:z.ZodPromise,...pe(e)});class In extends ge{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===z.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:r,ctx:n}=this._processInputParams(e),i=this._def.effect||null,s={addIssue:a=>{B(n,a),a.fatal?r.abort():r.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),i.type==="preprocess"){const a=i.transform(n.data,s);if(n.common.async)return Promise.resolve(a).then(async o=>{if(r.value==="aborted")return ue;const u=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return u.status==="aborted"?ue:u.status==="dirty"||r.value==="dirty"?$a(u.value):u});{if(r.value==="aborted")return ue;const o=this._def.schema._parseSync({data:a,path:n.path,parent:n});return o.status==="aborted"?ue:o.status==="dirty"||r.value==="dirty"?$a(o.value):o}}if(i.type==="refinement"){const a=o=>{const u=i.refinement(o,s);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?ue:(o.status==="dirty"&&r.dirty(),a(o.value),{status:r.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?ue:(o.status==="dirty"&&r.dirty(),a(o.value).then(()=>({status:r.value,value:o.value}))))}if(i.type==="transform")if(n.common.async===!1){const a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Zu(a))return a;const o=i.transform(a.value,s);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>Zu(a)?Promise.resolve(i.transform(a.value,s)).then(o=>({status:r.value,value:o})):a);Oe.assertNever(i)}}In.create=(t,e,r)=>new In({schema:t,typeName:z.ZodEffects,effect:e,...pe(r)});In.createWithPreprocess=(t,e,r)=>new In({schema:e,effect:{type:"preprocess",transform:t},typeName:z.ZodEffects,...pe(r)});class Zn extends ge{_parse(e){return this._getType(e)===H.undefined?ir(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Zn.create=(t,e)=>new Zn({innerType:t,typeName:z.ZodOptional,...pe(e)});class us extends ge{_parse(e){return this._getType(e)===H.null?ir(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}us.create=(t,e)=>new us({innerType:t,typeName:z.ZodNullable,...pe(e)});class ol extends ge{_parse(e){const{ctx:r}=this._processInputParams(e);let n=r.data;return r.parsedType===H.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}ol.create=(t,e)=>new ol({innerType:t,typeName:z.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...pe(e)});class ul extends ge{_parse(e){const{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},i=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Yu(i)?i.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Nr(n.common.issues)},input:n.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Nr(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}ul.create=(t,e)=>new ul({innerType:t,typeName:z.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...pe(e)});class Hh extends ge{_parse(e){if(this._getType(e)!==H.nan){const n=this._getOrReturnCtx(e);return B(n,{code:F.invalid_type,expected:H.nan,received:n.parsedType}),ue}return{status:"valid",value:e.data}}}Hh.create=t=>new Hh({typeName:z.ZodNaN,...pe(t)});const hN=Symbol("zod_brand");class Xy extends ge{_parse(e){const{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}class Fl extends ge{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?ue:s.status==="dirty"?(r.dirty(),$a(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})})();{const i=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?ue:i.status==="dirty"?(r.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:n.path,parent:n})}}static create(e,r){return new Fl({in:e,out:r,typeName:z.ZodPipeline})}}class ll extends ge{_parse(e){const r=this._def.innerType._parse(e),n=i=>(Zu(i)&&(i.value=Object.freeze(i.value)),i);return Yu(r)?r.then(i=>n(i)):n(r)}unwrap(){return this._def.innerType}}ll.create=(t,e)=>new ll({innerType:t,typeName:z.ZodReadonly,...pe(e)});function ex(t,e={},r){return t?oo.create().superRefine((n,i)=>{var s,a;if(!t(n)){const o=typeof e=="function"?e(n):typeof e=="string"?{message:e}:e,u=(a=(s=o.fatal)!==null&&s!==void 0?s:r)!==null&&a!==void 0?a:!0,l=typeof o=="string"?{message:o}:o;i.addIssue({code:"custom",...l,fatal:u})}}):oo.create()}const dN={object:Ye.lazycreate};var z;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(z||(z={}));const fN=(t,e={message:`Input not instance of ${t.name}`})=>ex(r=>r instanceof t,e),tx=Pn.create,rx=ss.create,pN=Hh.create,mN=as.create,nx=Qu.create,gN=Bs.create,yN=Kh.create,bN=Xu.create,wN=el.create,vN=oo.create,_N=js.create,PN=wi.create,ON=Vh.create,SN=An.create,xN=Ye.create,EN=Ye.strictCreate,TN=tl.create,AN=uf.create,kN=rl.create,IN=Xn.create,CN=nl.create,RN=Bh.create,jN=Hs.create,NN=Ha.create,$N=il.create,LN=sl.create,DN=os.create,MN=al.create,FN=uo.create,C_=In.create,zN=Zn.create,UN=us.create,qN=In.createWithPreprocess,KN=Fl.create,VN=()=>tx().optional(),BN=()=>rx().optional(),HN=()=>nx().optional(),WN={string:t=>Pn.create({...t,coerce:!0}),number:t=>ss.create({...t,coerce:!0}),boolean:t=>Qu.create({...t,coerce:!0}),bigint:t=>as.create({...t,coerce:!0}),date:t=>Bs.create({...t,coerce:!0})},JN=ue;var Ce=Object.freeze({__proto__:null,defaultErrorMap:ao,setErrorMap:Jj,getErrorMap:zh,makeIssue:Uh,EMPTY_PATH:Gj,addIssueToContext:B,ParseStatus:Jt,INVALID:ue,DIRTY:$a,OK:ir,isAborted:og,isDirty:ug,isValid:Zu,isAsync:Yu,get util(){return Oe},get objectUtil(){return ag},ZodParsedType:H,getParsedType:zi,ZodType:ge,datetimeRegex:QS,ZodString:Pn,ZodNumber:ss,ZodBigInt:as,ZodBoolean:Qu,ZodDate:Bs,ZodSymbol:Kh,ZodUndefined:Xu,ZodNull:el,ZodAny:oo,ZodUnknown:js,ZodNever:wi,ZodVoid:Vh,ZodArray:An,ZodObject:Ye,ZodUnion:tl,ZodDiscriminatedUnion:uf,ZodIntersection:rl,ZodTuple:Xn,ZodRecord:nl,ZodMap:Bh,ZodSet:Hs,ZodFunction:Ha,ZodLazy:il,ZodLiteral:sl,ZodEnum:os,ZodNativeEnum:al,ZodPromise:uo,ZodEffects:In,ZodTransformer:In,ZodOptional:Zn,ZodNullable:us,ZodDefault:ol,ZodCatch:ul,ZodNaN:Hh,BRAND:hN,ZodBranded:Xy,ZodPipeline:Fl,ZodReadonly:ll,custom:ex,Schema:ge,ZodSchema:ge,late:dN,get ZodFirstPartyTypeKind(){return z},coerce:WN,any:vN,array:SN,bigint:mN,boolean:nx,date:gN,discriminatedUnion:AN,effect:C_,enum:DN,function:NN,instanceof:fN,intersection:kN,lazy:$N,literal:LN,map:RN,nan:pN,nativeEnum:MN,never:PN,null:wN,nullable:UN,number:rx,object:xN,oboolean:HN,onumber:BN,optional:zN,ostring:VN,pipeline:KN,preprocess:qN,promise:FN,record:CN,set:jN,strictObject:EN,string:tx,symbol:yN,transformer:C_,tuple:IN,undefined:bN,union:TN,unknown:_N,void:ON,NEVER:JN,ZodIssueCode:F,quotelessJson:Wj,ZodError:Nr});let vc;const GN=new Uint8Array(16);function ZN(){if(!vc&&(vc=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!vc))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return vc(GN)}const YN=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function eb(t){return typeof t=="string"&&YN.test(t)}const Rt=[];for(let t=0;t<256;++t)Rt.push((t+256).toString(16).slice(1));function ix(t,e=0){return Rt[t[e+0]]+Rt[t[e+1]]+Rt[t[e+2]]+Rt[t[e+3]]+"-"+Rt[t[e+4]]+Rt[t[e+5]]+"-"+Rt[t[e+6]]+Rt[t[e+7]]+"-"+Rt[t[e+8]]+Rt[t[e+9]]+"-"+Rt[t[e+10]]+Rt[t[e+11]]+Rt[t[e+12]]+Rt[t[e+13]]+Rt[t[e+14]]+Rt[t[e+15]]}function QN(t){if(!eb(t))throw TypeError("Invalid UUID");let e;const r=new Uint8Array(16);return r[0]=(e=parseInt(t.slice(0,8),16))>>>24,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=e&255,r[4]=(e=parseInt(t.slice(9,13),16))>>>8,r[5]=e&255,r[6]=(e=parseInt(t.slice(14,18),16))>>>8,r[7]=e&255,r[8]=(e=parseInt(t.slice(19,23),16))>>>8,r[9]=e&255,r[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,r[11]=e/4294967296&255,r[12]=e>>>24&255,r[13]=e>>>16&255,r[14]=e>>>8&255,r[15]=e&255,r}function XN(t){t=unescape(encodeURIComponent(t));const e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e}const e$="6ba7b810-9dad-11d1-80b4-00c04fd430c8",t$="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function r$(t,e,r){function n(i,s,a,o){var u;if(typeof i=="string"&&(i=XN(i)),typeof s=="string"&&(s=QN(s)),((u=s)===null||u===void 0?void 0:u.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let l=new Uint8Array(16+i.length);if(l.set(s),l.set(i,s.length),l=r(l),l[6]=l[6]&15|e,l[8]=l[8]&63|128,a){o=o||0;for(let c=0;c<16;++c)a[o+c]=l[c];return a}return ix(l)}try{n.name=t}catch{}return n.DNS=e$,n.URL=t$,n}const n$=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),R_={randomUUID:n$};function Cr(t,e,r){if(R_.randomUUID&&!e&&!t)return R_.randomUUID();t=t||{};const n=t.random||(t.rng||ZN)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,ix(n)}function i$(t,e,r,n){switch(t){case 0:return e&r^~e&n;case 1:return e^r^n;case 2:return e&r^e&n^r&n;case 3:return e^r^n}}function Ip(t,e){return t<<e|t>>>32-e}function s$(t){const e=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof t=="string"){const a=unescape(encodeURIComponent(t));t=[];for(let o=0;o<a.length;++o)t.push(a.charCodeAt(o))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);const n=t.length/4+2,i=Math.ceil(n/16),s=new Array(i);for(let a=0;a<i;++a){const o=new Uint32Array(16);for(let u=0;u<16;++u)o[u]=t[a*64+u*4]<<24|t[a*64+u*4+1]<<16|t[a*64+u*4+2]<<8|t[a*64+u*4+3];s[a]=o}s[i-1][14]=(t.length-1)*8/Math.pow(2,32),s[i-1][14]=Math.floor(s[i-1][14]),s[i-1][15]=(t.length-1)*8&4294967295;for(let a=0;a<i;++a){const o=new Uint32Array(80);for(let f=0;f<16;++f)o[f]=s[a][f];for(let f=16;f<80;++f)o[f]=Ip(o[f-3]^o[f-8]^o[f-14]^o[f-16],1);let u=r[0],l=r[1],c=r[2],h=r[3],d=r[4];for(let f=0;f<80;++f){const p=Math.floor(f/20),y=Ip(u,5)+i$(p,l,c,h)+d+e[p]+o[f]>>>0;d=h,h=c,c=Ip(l,30)>>>0,l=u,u=y}r[0]=r[0]+u>>>0,r[1]=r[1]+l>>>0,r[2]=r[2]+c>>>0,r[3]=r[3]+h>>>0,r[4]=r[4]+d>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,r[0]&255,r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,r[1]&255,r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,r[2]&255,r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,r[3]&255,r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,r[4]&255]}const j_=r$("v5",80,s$);var a$=function(t,e){if(typeof t!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,t.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const o$=Tl(a$);var tb={exports:{}};const u$=/[\p{Lu}]/u,l$=/[\p{Ll}]/u,N_=/^[\p{Lu}](?![\p{Lu}])/gu,sx=/([\p{Alpha}\p{N}_]|$)/u,ax=/[_.\- ]+/,c$=new RegExp("^"+ax.source),$_=new RegExp(ax.source+sx.source,"gu"),L_=new RegExp("\\d+"+sx.source,"gu"),h$=(t,e,r)=>{let n=!1,i=!1,s=!1;for(let a=0;a<t.length;a++){const o=t[a];n&&u$.test(o)?(t=t.slice(0,a)+"-"+t.slice(a),n=!1,s=i,i=!0,a++):i&&s&&l$.test(o)?(t=t.slice(0,a-1)+"-"+t.slice(a-1),s=i,i=!1,n=!0):(n=e(o)===o&&r(o)!==o,s=i,i=r(o)===o&&e(o)!==o)}return t},d$=(t,e)=>(N_.lastIndex=0,t.replace(N_,r=>e(r))),f$=(t,e)=>($_.lastIndex=0,L_.lastIndex=0,t.replace($_,(r,n)=>e(n)).replace(L_,r=>e(r))),ox=(t,e)=>{if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(t)?t=t.map(s=>s.trim()).filter(s=>s.length).join("-"):t=t.trim(),t.length===0)return"";const r=e.locale===!1?s=>s.toLowerCase():s=>s.toLocaleLowerCase(e.locale),n=e.locale===!1?s=>s.toUpperCase():s=>s.toLocaleUpperCase(e.locale);return t.length===1?e.pascalCase?n(t):r(t):(t!==r(t)&&(t=h$(t,r,n)),t=t.replace(c$,""),e.preserveConsecutiveUppercase?t=d$(t,r):t=r(t),e.pascalCase&&(t=n(t.charAt(0))+t.slice(1)),f$(t,n))};tb.exports=ox;tb.exports.default=ox;var p$=tb.exports;const m$=Tl(p$);function g$(t,e){return(e==null?void 0:e[t])||o$(t)}function y$(t,e){return(e==null?void 0:e[t])||m$(t)}function ux(t,e,r){const n={};for(const i in t)Object.hasOwn(t,i)&&(n[e(i,r)]=t[i]);return n}function D_(t){return Array.isArray(t)?[...t]:{...t}}function b$(t,e){const r=D_(t);for(const[n,i]of Object.entries(e)){const[s,...a]=n.split(".").reverse();let o=r;for(const u of a.reverse()){if(o[u]===void 0)break;o[u]=D_(o[u]),o=o[u]}o[s]!==void 0&&(o[s]={lc:1,type:"secret",id:[i]})}return r}function lf(t){const e=Object.getPrototypeOf(t);return typeof t.lc_name=="function"&&(typeof e.lc_name!="function"||t.lc_name()!==e.lc_name())?t.lc_name():t.name}class St{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,lf(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...r){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof St||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},r={},n=Object.keys(this.lc_kwargs).reduce((i,s)=>(i[s]=s in this?this[s]:this.lc_kwargs[s],i),{});for(let i=Object.getPrototypeOf(this);i;i=Object.getPrototypeOf(i))Object.assign(e,Reflect.get(i,"lc_aliases",this)),Object.assign(r,Reflect.get(i,"lc_secrets",this)),Object.assign(n,Reflect.get(i,"lc_attributes",this));return Object.keys(r).forEach(i=>{let s=this,a=n;const[o,...u]=i.split(".").reverse();for(const l of u.reverse()){if(!(l in s)||s[l]===void 0)return;(!(l in a)||a[l]===void 0)&&(typeof s[l]=="object"&&s[l]!=null?a[l]={}:Array.isArray(s[l])&&(a[l]=[])),s=s[l],a=a[l]}o in s&&s[o]!==void 0&&(a[o]=a[o]||s[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:ux(Object.keys(r).length?b$(n,r):n,g$,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}const w$=Object.freeze(Object.defineProperty({__proto__:null,Serializable:St,get_lc_unique_name:lf},Symbol.toStringTag,{value:"Module"}));var Cp={};const lx=()=>typeof window<"u"&&typeof window.document<"u",cx=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",hx=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),rb=()=>typeof Deno<"u",dx=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!rb(),fx=()=>{let t;return lx()?t="browser":dx()?t="node":cx()?t="webworker":hx()?t="jsdom":rb()?t="deno":t="other",t};let Rp;async function px(){return Rp===void 0&&(Rp={library:"langchain-js",runtime:fx()}),Rp}function he(t){try{return typeof process<"u"?Cp==null?void 0:Cp[t]:void 0}catch{return}}const v$=Object.freeze(Object.defineProperty({__proto__:null,getEnv:fx,getEnvironmentVariable:he,getRuntimeEnvironment:px,isBrowser:lx,isDeno:rb,isJsDom:hx,isNode:dx,isWebWorker:cx},Symbol.toStringTag,{value:"Module"}));class _${}class Po extends _${get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,lf(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:he("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return St.prototype.toJSON.call(this)}toJSONNotImplemented(){return St.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class r extends Po{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Cr()}),Object.assign(this,e)}}return new r}}const P$=Object.freeze(Object.defineProperty({__proto__:null,BaseCallbackHandler:Po},Symbol.toStringTag,{value:"Module"}));var nb={exports:{}};nb.exports;(function(t){const r=(s=0)=>a=>`\x1B[${38+s};5;${a}m`,n=(s=0)=>(a,o,u)=>`\x1B[${38+s};2;${a};${o};${u}m`;function i(){const s=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[o,u]of Object.entries(a)){for(const[l,c]of Object.entries(u))a[l]={open:`\x1B[${c[0]}m`,close:`\x1B[${c[1]}m`},u[l]=a[l],s.set(c[0],c[1]);Object.defineProperty(a,o,{value:u,enumerable:!1})}return Object.defineProperty(a,"codes",{value:s,enumerable:!1}),a.color.close="\x1B[39m",a.bgColor.close="\x1B[49m",a.color.ansi256=r(),a.color.ansi16m=n(),a.bgColor.ansi256=r(10),a.bgColor.ansi16m=n(10),Object.defineProperties(a,{rgbToAnsi256:{value:(o,u,l)=>o===u&&u===l?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(u/255*5)+Math.round(l/255*5),enumerable:!1},hexToRgb:{value:o=>{const u=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!u)return[0,0,0];let{colorString:l}=u.groups;l.length===3&&(l=l.split("").map(h=>h+h).join(""));const c=Number.parseInt(l,16);return[c>>16&255,c>>8&255,c&255]},enumerable:!1},hexToAnsi256:{value:o=>a.rgbToAnsi256(...a.hexToRgb(o)),enumerable:!1}}),a}Object.defineProperty(t,"exports",{enumerable:!0,get:i})})(nb);var O$=nb.exports;const mx=Tl(O$);function jp(t,e){return t&&!Array.isArray(t)&&typeof t=="object"?t:{[e]:t}}function S$(t){return t.replace(/[-:.]/g,"")}function x$(t,e,r){const n=r.toFixed(0).slice(0,3).padStart(3,"0");return S$(`${new Date(t).toISOString().slice(0,-1)}${n}Z`)+e}class sn extends Po{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,r){e.child_runs.push(r)}async _startTrace(e){var i;const r=x$(e.start_time,e.id,e.execution_order),n={...e};if(n.parent_run_id!==void 0){const s=this.runMap.get(n.parent_run_id);s&&(this._addChildRun(s,n),s.child_execution_order=Math.max(s.child_execution_order,n.child_execution_order),n.trace_id=s.trace_id,s.dotted_order!==void 0&&(n.dotted_order=[s.dotted_order,r].join(".")))}else n.trace_id=n.id,n.dotted_order=r;this.runMap.set(n.id,n),await((i=this.onRunCreate)==null?void 0:i.call(this,n))}async _endTrace(e){var n;const r=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);r?r.child_execution_order=Math.max(r.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((n=this.onRunUpdate)==null?void 0:n.call(this,e))}_getExecutionOrder(e){const r=e!==void 0&&this.runMap.get(e);return r?r.child_execution_order+1:1}async handleLLMStart(e,r,n,i,s,a,o,u){var f;const l=this._getExecutionOrder(i),c=Date.now(),h=o?{...s,metadata:o}:s,d={id:n,name:u??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:r},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:h??{},tags:a||[]};return await this._startTrace(d),await((f=this.onLLMStart)==null?void 0:f.call(this,d)),d}async handleChatModelStart(e,r,n,i,s,a,o,u){var f;const l=this._getExecutionOrder(i),c=Date.now(),h=o?{...s,metadata:o}:s,d={id:n,name:u??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:r},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:h??{},tags:a||[]};return await this._startTrace(d),await((f=this.onLLMStart)==null?void 0:f.call(this,d)),d}async handleLLMEnd(e,r){var i;const n=this.runMap.get(r);if(!n||(n==null?void 0:n.run_type)!=="llm")throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.outputs=e,n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((i=this.onLLMEnd)==null?void 0:i.call(this,n)),await this._endTrace(n),n}async handleLLMError(e,r){var i;const n=this.runMap.get(r);if(!n||(n==null?void 0:n.run_type)!=="llm")throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((i=this.onLLMError)==null?void 0:i.call(this,n)),await this._endTrace(n),n}async handleChainStart(e,r,n,i,s,a,o,u){var d;const l=this._getExecutionOrder(i),c=Date.now(),h={id:n,name:u??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:r,execution_order:l,child_execution_order:l,run_type:o??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return await this._startTrace(h),await((d=this.onChainStart)==null?void 0:d.call(this,h)),h}async handleChainEnd(e,r,n,i,s){var o;const a=this.runMap.get(r);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=jp(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),(s==null?void 0:s.inputs)!==void 0&&(a.inputs=jp(s.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleChainError(e,r,n,i,s){var o;const a=this.runMap.get(r);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),(s==null?void 0:s.inputs)!==void 0&&(a.inputs=jp(s.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleToolStart(e,r,n,i,s,a,o){var h;const u=this._getExecutionOrder(i),l=Date.now(),c={id:n,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:r},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return await this._startTrace(c),await((h=this.onToolStart)==null?void 0:h.call(this,c)),c}async handleToolEnd(e,r){var i;const n=this.runMap.get(r);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((i=this.onToolEnd)==null?void 0:i.call(this,n)),await this._endTrace(n),n}async handleToolError(e,r){var i;const n=this.runMap.get(r);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((i=this.onToolError)==null?void 0:i.call(this,n)),await this._endTrace(n),n}async handleAgentAction(e,r){var s;const n=this.runMap.get(r);if(!n||(n==null?void 0:n.run_type)!=="chain")return;const i=n;i.actions=i.actions||[],i.actions.push(e),i.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentAction)==null?void 0:s.call(this,n))}async handleAgentEnd(e,r){var i;const n=this.runMap.get(r);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentEnd)==null?void 0:i.call(this,n)))}async handleRetrieverStart(e,r,n,i,s,a,o){var h;const u=this._getExecutionOrder(i),l=Date.now(),c={id:n,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:r},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return await this._startTrace(c),await((h=this.onRetrieverStart)==null?void 0:h.call(this,c)),c}async handleRetrieverEnd(e,r){var i;const n=this.runMap.get(r);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((i=this.onRetrieverEnd)==null?void 0:i.call(this,n)),await this._endTrace(n),n}async handleRetrieverError(e,r){var i;const n=this.runMap.get(r);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((i=this.onRetrieverError)==null?void 0:i.call(this,n)),await this._endTrace(n),n}async handleText(e,r){var i;const n=this.runMap.get(r);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((i=this.onText)==null?void 0:i.call(this,n)))}async handleLLMNewToken(e,r,n,i,s,a){var u;const o=this.runMap.get(n);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:r,chunk:a==null?void 0:a.chunk}}),await((u=this.onLLMNewToken)==null?void 0:u.call(this,o,e,{chunk:a==null?void 0:a.chunk})),o}}const E$=Object.freeze(Object.defineProperty({__proto__:null,BaseTracer:sn},Symbol.toStringTag,{value:"Module"}));function Qt(t,e){return`${t.open}${e}${t.close}`}function un(t,e){try{return JSON.stringify(t,null,2)}catch{return e}}function Ci(t){if(!t.end_time)return"";const e=t.end_time-t.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:cr}=mx;class Wh extends sn{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const r=[];let n=e;for(;n.parent_run_id;){const i=this.runMap.get(n.parent_run_id);if(i)r.push(i),n=i;else break}return r}getBreadcrumbs(e){const n=[...this.getParents(e).reverse(),e].map((i,s,a)=>{const o=`${i.execution_order}:${i.run_type}:${i.name}`;return s===a.length-1?Qt(mx.bold,o):o}).join(" > ");return Qt(cr.grey,n)}onChainStart(e){const r=this.getBreadcrumbs(e);console.log(`${Qt(cr.green,"[chain/start]")} [${r}] Entering Chain run with input: ${un(e.inputs,"[inputs]")}`)}onChainEnd(e){const r=this.getBreadcrumbs(e);console.log(`${Qt(cr.cyan,"[chain/end]")} [${r}] [${Ci(e)}] Exiting Chain run with output: ${un(e.outputs,"[outputs]")}`)}onChainError(e){const r=this.getBreadcrumbs(e);console.log(`${Qt(cr.red,"[chain/error]")} [${r}] [${Ci(e)}] Chain run errored with error: ${un(e.error,"[error]")}`)}onLLMStart(e){const r=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(i=>i.trim())}:e.inputs;console.log(`${Qt(cr.green,"[llm/start]")} [${r}] Entering LLM run with input: ${un(n,"[inputs]")}`)}onLLMEnd(e){const r=this.getBreadcrumbs(e);console.log(`${Qt(cr.cyan,"[llm/end]")} [${r}] [${Ci(e)}] Exiting LLM run with output: ${un(e.outputs,"[response]")}`)}onLLMError(e){const r=this.getBreadcrumbs(e);console.log(`${Qt(cr.red,"[llm/error]")} [${r}] [${Ci(e)}] LLM run errored with error: ${un(e.error,"[error]")}`)}onToolStart(e){var n;const r=this.getBreadcrumbs(e);console.log(`${Qt(cr.green,"[tool/start]")} [${r}] Entering Tool run with input: "${(n=e.inputs.input)==null?void 0:n.trim()}"`)}onToolEnd(e){var n,i;const r=this.getBreadcrumbs(e);console.log(`${Qt(cr.cyan,"[tool/end]")} [${r}] [${Ci(e)}] Exiting Tool run with output: "${(i=(n=e.outputs)==null?void 0:n.output)==null?void 0:i.trim()}"`)}onToolError(e){const r=this.getBreadcrumbs(e);console.log(`${Qt(cr.red,"[tool/error]")} [${r}] [${Ci(e)}] Tool run errored with error: ${un(e.error,"[error]")}`)}onRetrieverStart(e){const r=this.getBreadcrumbs(e);console.log(`${Qt(cr.green,"[retriever/start]")} [${r}] Entering Retriever run with input: ${un(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const r=this.getBreadcrumbs(e);console.log(`${Qt(cr.cyan,"[retriever/end]")} [${r}] [${Ci(e)}] Exiting Retriever run with output: ${un(e.outputs,"[outputs]")}`)}onRetrieverError(e){const r=this.getBreadcrumbs(e);console.log(`${Qt(cr.red,"[retriever/error]")} [${r}] [${Ci(e)}] Retriever run errored with error: ${un(e.error,"[error]")}`)}onAgentAction(e){const r=e,n=this.getBreadcrumbs(e);console.log(`${Qt(cr.blue,"[agent/action]")} [${n}] Agent selected action: ${un(r.actions[r.actions.length-1],"[action]")}`)}}const T$=Object.freeze(Object.defineProperty({__proto__:null,ConsoleCallbackHandler:Wh},Symbol.toStringTag,{value:"Module"}));var cf={exports:{}},gx={};function rn(t,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var A$=rn;rn.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};rn.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};rn.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=new Date().getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},r),this._options.unref&&this._timer.unref(),!0};rn.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};rn.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)};rn.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)};rn.prototype.start=rn.prototype.try;rn.prototype.errors=function(){return this._errors};rn.prototype.attempts=function(){return this._attempts};rn.prototype.mainError=function(){if(this._errors.length===0)return null;for(var t={},e=null,r=0,n=0;n<this._errors.length;n++){var i=this._errors[n],s=i.message,a=(t[s]||0)+1;t[s]=a,a>=r&&(e=i,r=a)}return e};(function(t){var e=A$;t.operation=function(r){var n=t.timeouts(r);return new e(n,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})},t.timeouts=function(r){if(r instanceof Array)return[].concat(r);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in r)n[i]=r[i];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],a=0;a<n.retries;a++)s.push(this.createTimeout(a,n));return r&&r.forever&&!s.length&&s.push(this.createTimeout(a,n)),s.sort(function(o,u){return o-u}),s},t.createTimeout=function(r,n){var i=n.randomize?Math.random()+1:1,s=Math.round(i*Math.max(n.minTimeout,1)*Math.pow(n.factor,r));return s=Math.min(s,n.maxTimeout),s},t.wrap=function(r,n,i){if(n instanceof Array&&(i=n,n=null),!i){i=[];for(var s in r)typeof r[s]=="function"&&i.push(s)}for(var a=0;a<i.length;a++){var o=i[a],u=r[o];r[o]=(function(c){var h=t.operation(n),d=Array.prototype.slice.call(arguments,1),f=d.pop();d.push(function(p){h.retry(p)||(p&&(arguments[0]=h.mainError()),f.apply(this,arguments))}),h.attempt(function(){c.apply(r,d)})}).bind(r,u),r[o].options=n}}})(gx);var k$=gx;const I$=k$,C$=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class yx extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const R$=(t,e,r)=>{const n=r.retries-(e-1);return t.attemptNumber=e,t.retriesLeft=n,t},j$=t=>C$.includes(t),bx=(t,e)=>new Promise((r,n)=>{e={onFailedAttempt:()=>{},retries:10,...e};const i=I$.operation(e);i.attempt(async s=>{try{r(await t(s))}catch(a){if(!(a instanceof Error)){n(new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));return}if(a instanceof yx)i.stop(),n(a.originalError);else if(a instanceof TypeError&&!j$(a.message))i.stop(),n(a);else{R$(a,s,e);try{await e.onFailedAttempt(a)}catch(o){n(o);return}i.retry(a)||n(i.mainError())}}})});cf.exports=bx;cf.exports.default=bx;cf.exports.AbortError=yx;var N$=cf.exports;const Jh=Tl(N$);var wx={},vx={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function i(u,l,c){this.fn=u,this.context=l,this.once=c||!1}function s(u,l,c,h,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new i(c,h||u,d),p=r?r+l:l;return u._events[p]?u._events[p].fn?u._events[p]=[u._events[p],f]:u._events[p].push(f):(u._events[p]=f,u._eventsCount++),u}function a(u,l){--u._eventsCount===0?u._events=new n:delete u._events[l]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],c,h;if(this._eventsCount===0)return l;for(h in c=this._events)e.call(c,h)&&l.push(r?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},o.prototype.listeners=function(l){var c=r?r+l:l,h=this._events[c];if(!h)return[];if(h.fn)return[h.fn];for(var d=0,f=h.length,p=new Array(f);d<f;d++)p[d]=h[d].fn;return p},o.prototype.listenerCount=function(l){var c=r?r+l:l,h=this._events[c];return h?h.fn?1:h.length:0},o.prototype.emit=function(l,c,h,d,f,p){var y=r?r+l:l;if(!this._events[y])return!1;var v=this._events[y],g=arguments.length,m,b;if(v.fn){switch(v.once&&this.removeListener(l,v.fn,void 0,!0),g){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,c),!0;case 3:return v.fn.call(v.context,c,h),!0;case 4:return v.fn.call(v.context,c,h,d),!0;case 5:return v.fn.call(v.context,c,h,d,f),!0;case 6:return v.fn.call(v.context,c,h,d,f,p),!0}for(b=1,m=new Array(g-1);b<g;b++)m[b-1]=arguments[b];v.fn.apply(v.context,m)}else{var S=v.length,E;for(b=0;b<S;b++)switch(v[b].once&&this.removeListener(l,v[b].fn,void 0,!0),g){case 1:v[b].fn.call(v[b].context);break;case 2:v[b].fn.call(v[b].context,c);break;case 3:v[b].fn.call(v[b].context,c,h);break;case 4:v[b].fn.call(v[b].context,c,h,d);break;default:if(!m)for(E=1,m=new Array(g-1);E<g;E++)m[E-1]=arguments[E];v[b].fn.apply(v[b].context,m)}}return!0},o.prototype.on=function(l,c,h){return s(this,l,c,h,!1)},o.prototype.once=function(l,c,h){return s(this,l,c,h,!0)},o.prototype.removeListener=function(l,c,h,d){var f=r?r+l:l;if(!this._events[f])return this;if(!c)return a(this,f),this;var p=this._events[f];if(p.fn)p.fn===c&&(!d||p.once)&&(!h||p.context===h)&&a(this,f);else{for(var y=0,v=[],g=p.length;y<g;y++)(p[y].fn!==c||d&&!p[y].once||h&&p[y].context!==h)&&v.push(p[y]);v.length?this._events[f]=v.length===1?v[0]:v:a(this,f)}return this},o.prototype.removeAllListeners=function(l){var c;return l?(c=r?r+l:l,this._events[c]&&a(this,c)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,t.exports=o})(vx);var $$=vx.exports,hf={exports:{}},L$=(t,e)=>(e=e||(()=>{}),t.then(r=>new Promise(n=>{n(e())}).then(()=>r),r=>new Promise(n=>{n(e())}).then(()=>{throw r})));const D$=L$;class _x extends Error{constructor(e){super(e),this.name="TimeoutError"}}const Px=(t,e,r)=>new Promise((n,i)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){n(t);return}const s=setTimeout(()=>{if(typeof r=="function"){try{n(r())}catch(u){i(u)}return}const a=typeof r=="string"?r:`Promise timed out after ${e} milliseconds`,o=r instanceof Error?r:new _x(a);typeof t.cancel=="function"&&t.cancel(),i(o)},e);D$(t.then(n,i),()=>{clearTimeout(s)})});hf.exports=Px;hf.exports.default=Px;hf.exports.TimeoutError=_x;var M$=hf.exports,ib={},sb={};Object.defineProperty(sb,"__esModule",{value:!0});function F$(t,e,r){let n=0,i=t.length;for(;i>0;){const s=i/2|0;let a=n+s;r(t[a],e)<=0?(n=++a,i-=s+1):i=s}return n}sb.default=F$;Object.defineProperty(ib,"__esModule",{value:!0});const z$=sb;class U${constructor(){this._queue=[]}enqueue(e,r){r=Object.assign({priority:0},r);const n={priority:r.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=r.priority){this._queue.push(n);return}const i=z$.default(this._queue,n,(s,a)=>a.priority-s.priority);this._queue.splice(i,0,n)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(r=>r.priority===e.priority).map(r=>r.run)}get size(){return this._queue.length}}ib.default=U$;Object.defineProperty(wx,"__esModule",{value:!0});const q$=$$,Ox=M$,K$=ib,_c=()=>{},V$=new Ox.TimeoutError;class B$ extends q${constructor(e){var r,n,i,s;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=_c,this._resolveIdle=_c,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:K$.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(r=e.intervalCap)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(s=(i=e.interval)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=_c,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=_c,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const r=this._intervalEnd-e;if(r<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},r)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const r=this._queue.dequeue();return r?(this.emit("active"),r(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,r={}){return new Promise((n,i)=>{const s=async()=>{this._pendingCount++,this._intervalCount++;try{const a=this._timeout===void 0&&r.timeout===void 0?e():Ox.default(Promise.resolve(e()),r.timeout===void 0?this._timeout:r.timeout,()=>{(r.throwOnTimeout===void 0?this._throwOnTimeout:r.throwOnTimeout)&&i(V$)});n(await a)}catch(a){i(a)}this._next()};this._queue.enqueue(s,r),this._tryToStartAnother(),this.emit("add")})}async addAll(e,r){return Promise.all(e.map(async n=>this.add(n,r)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const r=this._resolveEmpty;this._resolveEmpty=()=>{r(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const r=this._resolveIdle;this._resolveIdle=()=>{r(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var fi=wx.default=B$;const H$=[400,401,403,404,405,406,407,408],W$=[409];let M_=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in fi?this.queue=new fi.default({concurrency:this.maxConcurrency}):this.queue=new fi({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...r){const n=this.onFailedResponseHook;return this.queue.add(()=>Jh(()=>e(...r).catch(i=>{throw i instanceof Error?i:new Error(i)}),{async onFailedAttempt(i){if(i.message.startsWith("Cancel")||i.message.startsWith("TimeoutError")||i.message.startsWith("AbortError")||(i==null?void 0:i.code)==="ECONNABORTED")throw i;const s=i==null?void 0:i.response,a=s==null?void 0:s.status;if(a){if(H$.includes(+a))throw i;if(W$.includes(+a))return;n&&await n(s)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,r,...n){return e.signal?Promise.race([this.call(r,...n),new Promise((i,s)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(r,...n)}fetch(...e){return this.call(()=>fetch(...e).then(r=>r.ok?r:Promise.reject(r)))}};function F_(t){return typeof(t==null?void 0:t._getType)=="function"}function z_(t){const e={type:t._getType(),data:{content:t.content}};return t!=null&&t.additional_kwargs&&Object.keys(t.additional_kwargs).length>0&&(e.data.additional_kwargs={...t.additional_kwargs}),e}var Su={};let ri;const J$=()=>typeof window<"u"&&typeof window.document<"u",G$=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Z$=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Sx=()=>typeof Deno<"u",Y$=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Sx(),Q$=()=>ri||(J$()?ri="browser":Y$()?ri="node":G$()?ri="webworker":Z$()?ri="jsdom":Sx()?ri="deno":ri="other",ri);let Np;async function xx(){if(Np===void 0){const t=Q$(),e=tL();Np={library:"langsmith",runtime:t,sdk:"langsmith-js",sdk_version:Tx,...e}}return Np}function X$(){const t=eL()||{},e={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[n,i]of Object.entries(t))n.startsWith("LANGCHAIN_")&&typeof i=="string"&&!r.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=i:e[n]=i);return e}function eL(){try{return typeof process<"u"&&Su?Object.entries(Su).reduce((t,[e,r])=>(t[e]=String(r),t),{}):void 0}catch{return}}function Gr(t){try{return typeof process<"u"?Su==null?void 0:Su[t]:void 0}catch{return}}let $p;function tL(){if($p!==void 0)return $p;const t=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const r of t){const n=Gr(r);n!==void 0&&(e[r]=n)}return $p=e,e}function Je(t){if(!eb(t))throw new Error(`Invalid UUID: ${t}`)}async function U_(t){const e=await xx(),r=X$();return t.map(n=>{const i=n.extra??{},s=i.metadata;return n.extra={...i,runtime:{...e,...i==null?void 0:i.runtime},metadata:{...r,...r.revision_id||n.revision_id?{revision_id:n.revision_id??r.revision_id}:{},...s}},n})}const rL=()=>{const t=Gr("LANGCHAIN_TRACING_SAMPLING_RATE");if(t===void 0)return;const e=parseFloat(t);if(e<0||e>1)throw new Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},nL=t=>{const r=t.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return r==="localhost"||r==="127.0.0.1"||r==="::1"},Ri=async(t,e)=>{const r=await t.text();if(!t.ok)throw new Error(`Failed to ${e}: ${t.status} ${t.statusText} ${r}`)};async function iL(t){const e=[];for await(const r of t)e.push(r);return e}function Lp(t){if(t!==void 0)return t.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const sL=async t=>{if((t==null?void 0:t.status)===429){const e=parseInt(t.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(r=>setTimeout(r,e)),!0}return!1};class aL{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get size(){return this.items.length}push(e){return new Promise(r=>{this.items.push([e,r])})}pop(e){if(e<1)throw new Error("Number of items to pop off may not be less than 1.");const r=[];for(;r.length<e&&this.items.length;){const n=this.items.shift();if(n)r.push(n);else break}return[r.map(n=>n[0]),()=>r.forEach(n=>n[1]())]}}const oL=20971520;let ab=class Ex{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new aL}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const r=Ex.getDefaultClientConfig();this.tracingSampleRate=rL(),this.apiUrl=Lp(e.apiUrl??r.apiUrl)??"",this.apiKey=Lp(e.apiKey??r.apiKey),this.webUrl=Lp(e.webUrl??r.webUrl),this.timeout_ms=e.timeout_ms??12e3,this.caller=new M_(e.callerOptions??{}),this.batchIngestCaller=new M_({...e.callerOptions??{},onFailedResponseHook:sL}),this.hideInputs=e.hideInputs??r.hideInputs,this.hideOutputs=e.hideOutputs??r.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){const e=Gr("LANGCHAIN_API_KEY"),r=Gr("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",n=Gr("LANGCHAIN_HIDE_INPUTS")==="true",i=Gr("LANGCHAIN_HIDE_OUTPUTS")==="true";return{apiUrl:r,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:i}}getHostUrl(){return this.webUrl?this.webUrl:nL(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${Tx}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const r={...e};return r.inputs!==void 0&&(r.inputs=this.processInputs(r.inputs)),r.outputs!==void 0&&(r.outputs=this.processOutputs(r.outputs)),r}async _getResponse(e,r){const n=(r==null?void 0:r.toString())??"",i=`${this.apiUrl}${e}?${n}`,s=await this.caller.call(fetch,i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!s.ok)throw new Error(`Failed to fetch ${e}: ${s.status} ${s.statusText}`);return s}async _get(e,r){return(await this._getResponse(e,r)).json()}async*_getPaginated(e,r=new URLSearchParams){let n=Number(r.get("offset"))||0;const i=Number(r.get("limit"))||100;for(;;){r.set("offset",String(n)),r.set("limit",String(i));const s=`${this.apiUrl}${e}?${r}`,a=await this.caller.call(fetch,s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!a.ok)throw new Error(`Failed to fetch ${e}: ${a.status} ${a.statusText}`);const o=await a.json();if(o.length===0||(yield o,o.length<i))break;n+=o.length}}async*_getCursorPaginatedList(e,r=null,n="POST",i="runs"){const s=r?{...r}:{};for(;;){const o=await(await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(s)})).json();if(!o||!o[i])break;yield o[i];const u=o.cursors;if(!u||!u.next)break;s.cursor=u.next}}_filterForSampling(e,r=!1){if(this.tracingSampleRate===void 0)return e;if(r){const n=[];for(const i of e)this.sampledPostUuids.has(i.id)&&(n.push(i),this.sampledPostUuids.delete(i.id));return n}else{const n=[];for(const i of e)Math.random()<this.tracingSampleRate&&(n.push(i),this.sampledPostUuids.add(i.id));return n}}async drainAutoBatchQueue(){for(;this.autoBatchQueue.size>=0;){const[e,r]=this.autoBatchQueue.pop(this.pendingAutoBatchedRunLimit);if(!e.length){r();return}try{await this.batchIngestRuns({runCreates:e.filter(n=>n.action==="create").map(n=>n.item),runUpdates:e.filter(n=>n.action==="update").map(n=>n.item)})}finally{r()}}}async processRunOperation(e,r){const n=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0;const i=this.autoBatchQueue.push(e);return(r||this.autoBatchQueue.size>this.pendingAutoBatchedRunLimit)&&await this.drainAutoBatchQueue(),this.autoBatchQueue.size>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},n?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),i}async _getServerInfo(){const e=await fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!e.ok)throw await e.text(),new Error("Failed to retrieve server info.");return e.json()}async batchEndpointIsSupported(){try{this.serverInfo=await this._getServerInfo()}catch{return!1}return!0}async createRun(e){if(!this._filterForSampling([e]).length)return;const r={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;const i=this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&i.trace_id!==void 0&&i.dotted_order!==void 0){this.processRunOperation({action:"create",item:i}).catch(console.error);return}const s=await U_([i]),a=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:r,body:JSON.stringify(s[0]),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ri(a,"create run")}async batchIngestRuns({runCreates:e,runUpdates:r}){var l,c;if(e===void 0&&r===void 0)return;let n=(e==null?void 0:e.map(h=>this.prepareRunCreateOrUpdateInputs(h)))??[],i=(r==null?void 0:r.map(h=>this.prepareRunCreateOrUpdateInputs(h)))??[];if(n.length>0&&i.length>0){const h=n.reduce((f,p)=>(p.id&&(f[p.id]=p),f),{}),d=[];for(const f of i)f.id!==void 0&&h[f.id]?h[f.id]={...h[f.id],...f}:d.push(f);n=Object.values(h),i=d}const s={post:this._filterForSampling(n),patch:this._filterForSampling(i,!0)};if(!s.post.length&&!s.patch.length)return;if(n=await U_(n),this.batchEndpointSupported===void 0&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){this.autoBatchTracing=!1;for(const h of s.post)await this.createRun(h);for(const h of s.patch)h.id!==void 0&&await this.updateRun(h.id,h);return}const a=((c=(l=this.serverInfo)==null?void 0:l.batch_ingest_config)==null?void 0:c.size_limit_bytes)??oL,o={post:[],patch:[]};let u=0;for(const h of["post","patch"]){const d=h,f=s[d].reverse();let p=f.pop();for(;p!==void 0;){const y=JSON.stringify(p);u>0&&u+y.length>a&&(await this._postBatchIngestRuns(JSON.stringify(o)),u=0,o.post=[],o.patch=[]),u+=y.length,o[d].push(p),p=f.pop()}}(o.post.length>0||o.patch.length>0)&&await this._postBatchIngestRuns(JSON.stringify(o))}async _postBatchIngestRuns(e){const r={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(fetch,`${this.apiUrl}/runs/batch`,{method:"POST",headers:r,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ri(n,"batch create run")}async updateRun(e,r){Je(e),r.inputs&&(r.inputs=this.processInputs(r.inputs)),r.outputs&&(r.outputs=this.processOutputs(r.outputs));const n={...r,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&n.trace_id!==void 0&&n.dotted_order!==void 0){if(r.end_time!==void 0&&n.parent_run_id===void 0){await this.processRunOperation({action:"update",item:n},!0);return}else this.processRunOperation({action:"update",item:n}).catch(console.error);return}const i={...this.headers,"Content-Type":"application/json"},s=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:i,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ri(s,"update run")}async readRun(e,{loadChildRuns:r}={loadChildRuns:!1}){Je(e);let n=await this._get(`/runs/${e}`);return r&&n.child_run_ids&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:r,projectOpts:n}){if(r!==void 0){let i;r.session_id?i=r.session_id:n!=null&&n.projectName?i=(await this.readProject({projectName:n==null?void 0:n.projectName})).id:n!=null&&n.projectId?i=n==null?void 0:n.projectId:i=(await this.readProject({projectName:Gr("LANGCHAIN_PROJECT")||"default"})).id;const s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${i}/r/${r.id}?poll=true`}else if(e!==void 0){const i=await this.readRun(e);if(!i.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${i.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const r=await iL(this.listRuns({id:e.child_run_ids})),n={},i={};r.sort((s,a)=>((s==null?void 0:s.dotted_order)??"").localeCompare((a==null?void 0:a.dotted_order)??""));for(const s of r){if(s.parent_run_id===null||s.parent_run_id===void 0)throw new Error(`Child run ${s.id} has no parent`);s.parent_run_id in n||(n[s.parent_run_id]=[]),n[s.parent_run_id].push(s),i[s.id]=s}e.child_runs=n[e.id]||[];for(const s in n)s!==e.id&&(i[s].child_runs=n[s]);return e}async*listRuns(e){const{projectId:r,projectName:n,parentRunId:i,traceId:s,referenceExampleId:a,startTime:o,executionOrder:u,isRoot:l,runType:c,error:h,id:d,query:f,filter:p,traceFilter:y,treeFilter:v,limit:g,select:m}=e;let b=[];if(r&&(b=Array.isArray(r)?r:[r]),n){const j=Array.isArray(n)?n:[n],P=await Promise.all(j.map(G=>this.readProject({projectName:G}).then(U=>U.id)));b.push(...P)}const S=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],E={session:b.length?b:null,run_type:c,reference_example:a,query:f,filter:p,trace_filter:y,tree_filter:v,execution_order:u,parent_run:i,start_time:o?o.toISOString():null,error:h,id:d,limit:g,trace:s,select:m||S,is_root:l};let I=0;for await(const j of this._getCursorPaginatedList("/runs/query",E))if(g){if(I>=g)break;if(j.length+I>g){yield*j.slice(0,g-I);break}I+=j.length,yield*j}else yield*j}async shareRun(e,{shareId:r}={}){const n={run_id:e,share_token:r||Cr()};Je(e);const s=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(s===null||!("share_token"in s))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${s.share_token}/r`}async unshareRun(e){Je(e);const r=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ri(r,"unshare run")}async readRunSharedLink(e){Je(e);const n=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:r}={}){const n=new URLSearchParams({share_token:e});if(r!==void 0)for(const a of r)n.append("id",a);return Je(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,r){if(!e&&!r)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:r})).id),Je(e);const i=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async shareDataset(e,r){if(!e&&!r)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:r})).id);const n={dataset_id:e};Je(e);const s=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async unshareDataset(e){Je(e);const r=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ri(r,"unshare dataset")}async readSharedDataset(e){return Je(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createProject({projectName:e,description:r=null,metadata:n=null,upsert:i=!1,projectExtra:s=null,referenceDatasetId:a=null}){const o=i?"?upsert=true":"",u=`${this.apiUrl}/sessions${o}`,l=s||{};n&&(l.metadata=n);const c={name:e,extra:l,description:r};a!==null&&(c.reference_dataset_id=a);const h=await this.caller.call(fetch,u,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),d=await h.json();if(!h.ok)throw new Error(`Failed to create session ${e}: ${h.status} ${h.statusText}`);return d}async updateProject(e,{name:r=null,description:n=null,metadata:i=null,projectExtra:s=null,endTime:a=null}){const o=`${this.apiUrl}/sessions/${e}`;let u=s;i&&(u={...u||{},metadata:i});const l={name:r,extra:u,description:n,end_time:a?new Date(a).toISOString():null},c=await this.caller.call(fetch,o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),h=await c.json();if(!c.ok)throw new Error(`Failed to update project ${e}: ${c.status} ${c.statusText}`);return h}async hasProject({projectId:e,projectName:r}){let n="/sessions";const i=new URLSearchParams;if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Je(e),n+=`/${e}`;else if(r!==void 0)i.append("name",r);else throw new Error("Must provide projectName or projectId");const s=await this.caller.call(fetch,`${this.apiUrl}${n}?${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const a=await s.json();return s.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:r,includeStats:n}){let i="/sessions";const s=new URLSearchParams;if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Je(e),i+=`/${e}`;else if(r!==void 0)s.append("name",r);else throw new Error("Must provide projectName or projectId");n!==void 0&&s.append("include_stats",n.toString());const a=await this._get(i,s);let o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${r}] not found`);o=a[0]}else o=a;return o}async getProjectUrl({projectId:e,projectName:r}){if(e===void 0&&r===void 0)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:r}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:r}){if(e===void 0&&r===void 0)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:r}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const r of this._getPaginated("/sessions",e))return this._tenantId=r[0].tenant_id,r[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:r,nameContains:n,referenceDatasetId:i,referenceDatasetName:s,referenceFree:a}={}){const o=new URLSearchParams;if(e!==void 0)for(const u of e)o.append("id",u);if(r!==void 0&&o.append("name",r),n!==void 0&&o.append("name_contains",n),i!==void 0)o.append("reference_dataset",i);else if(s!==void 0){const u=await this.readDataset({datasetName:s});o.append("reference_dataset",u.id)}a!==void 0&&o.append("reference_free",a.toString());for await(const u of this._getPaginated("/sessions",o))yield*u}async deleteProject({projectId:e,projectName:r}){let n;if(e===void 0&&r===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:r})).id:n=e,Je(n);const i=await this.caller.call(fetch,`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ri(i,`delete session ${n} (${r})`)}async uploadCsv({csvFile:e,fileName:r,inputKeys:n,outputKeys:i,description:s,dataType:a,name:o}){const u=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,r),n.forEach(d=>{l.append("input_keys",d)}),i.forEach(d=>{l.append("output_keys",d)}),s&&l.append("description",s),a&&l.append("data_type",a),o&&l.append("name",o);const c=await this.caller.call(fetch,u,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!c.ok){const d=await c.json();throw d.detail&&d.detail.includes("already exists")?new Error(`Dataset ${r} already exists`):new Error(`Failed to upload CSV: ${c.status} ${c.statusText}`)}return await c.json()}async createDataset(e,{description:r,dataType:n}={}){const i={name:e,description:r};n&&(i.data_type=n);const s=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!s.ok){const o=await s.json();throw o.detail&&o.detail.includes("already exists")?new Error(`Dataset ${e} already exists`):new Error(`Failed to create dataset ${s.status} ${s.statusText}`)}return await s.json()}async readDataset({datasetId:e,datasetName:r}){let n="/datasets";const i=new URLSearchParams({limit:"1"});if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)Je(e),n+=`/${e}`;else if(r!==void 0)i.append("name",r);else throw new Error("Must provide datasetName or datasetId");const s=await this._get(n,i);let a;if(Array.isArray(s)){if(s.length===0)throw new Error(`Dataset[id=${e}, name=${r}] not found`);a=s[0]}else a=s;return a}async hasDataset({datasetId:e,datasetName:r}){try{return await this.readDataset({datasetId:e,datasetName:r}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:r,fromVersion:n,toVersion:i}){let s=e;if(s===void 0&&r===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:r})).id);const a=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof i=="string"?i:i.toISOString()});return await this._get(`/datasets/${s}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:r}){const n="/datasets";if(e===void 0)if(r!==void 0)e=(await this.readDataset({datasetName:r})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:r=0,datasetIds:n,datasetName:i,datasetNameContains:s}={}){const a="/datasets",o=new URLSearchParams({limit:e.toString(),offset:r.toString()});if(n!==void 0)for(const u of n)o.append("id",u);i!==void 0&&o.append("name",i),s!==void 0&&o.append("name_contains",s);for await(const u of this._getPaginated(a,o))yield*u}async deleteDataset({datasetId:e,datasetName:r}){let n="/datasets",i=e;if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(r!==void 0&&(i=(await this.readDataset({datasetName:r})).id),i!==void 0)Je(i),n+=`/${i}`;else throw new Error("Must provide datasetName or datasetId");const s=await this.caller.call(fetch,this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!s.ok)throw new Error(`Failed to delete ${n}: ${s.status} ${s.statusText}`);await s.json()}async createExample(e,r,{datasetId:n,datasetName:i,createdAt:s,exampleId:a,metadata:o,split:u}){let l=n;if(l===void 0&&i===void 0)throw new Error("Must provide either datasetName or datasetId");if(l!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");l===void 0&&(l=(await this.readDataset({datasetName:i})).id);const c=s||new Date,h={dataset_id:l,inputs:e,outputs:r,created_at:c==null?void 0:c.toISOString(),id:a,metadata:o,split:u},d=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(h),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!d.ok)throw new Error(`Failed to create example: ${d.status} ${d.statusText}`);return await d.json()}async createExamples(e){const{inputs:r,outputs:n,metadata:i,sourceRunIds:s,exampleIds:a,datasetId:o,datasetName:u}=e;let l=o;if(l===void 0&&u===void 0)throw new Error("Must provide either datasetName or datasetId");if(l!==void 0&&u!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");l===void 0&&(l=(await this.readDataset({datasetName:u})).id);const c=r.map((f,p)=>({dataset_id:l,inputs:f,outputs:n?n[p]:void 0,metadata:i?i[p]:void 0,split:e.splits?e.splits[p]:void 0,id:a?a[p]:void 0,source_run_id:s?s[p]:void 0})),h=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!h.ok)throw new Error(`Failed to create examples: ${h.status} ${h.statusText}`);return await h.json()}async createLLMExample(e,r,n){return this.createExample({input:e},{output:r},n)}async createChatExample(e,r,n){const i=e.map(a=>F_(a)?z_(a):a),s=F_(r)?z_(r):r;return this.createExample({input:i},{output:s},n)}async readExample(e){Je(e);const r=`/examples/${e}`;return await this._get(r)}async*listExamples({datasetId:e,datasetName:r,exampleIds:n,asOf:i,splits:s,inlineS3Urls:a,metadata:o}={}){let u;if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)u=e;else if(r!==void 0)u=(await this.readDataset({datasetName:r})).id;else throw new Error("Must provide a datasetName or datasetId");const l=new URLSearchParams({dataset:u}),c=i?typeof i=="string"?i:i==null?void 0:i.toISOString():void 0;c&&l.append("as_of",c);const h=a??!0;if(l.append("inline_s3_urls",h.toString()),n!==void 0)for(const d of n)l.append("id",d);if(s!==void 0)for(const d of s)l.append("splits",d);if(o!==void 0){const d=JSON.stringify(o);l.append("metadata",d)}for await(const d of this._getPaginated("/examples",l))yield*d}async deleteExample(e){Je(e);const r=`/examples/${e}`,n=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to delete ${r}: ${n.status} ${n.statusText}`);await n.json()}async updateExample(e,r){Je(e);const n=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to update example ${e}: ${n.status} ${n.statusText}`);return await n.json()}async evaluateRun(e,r,{sourceInfo:n,loadChildRuns:i,referenceExample:s}={loadChildRuns:!1}){let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:i});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);a.reference_example_id!==null&&a.reference_example_id!==void 0&&(s=await this.readExample(a.reference_example_id));const o=await r.evaluateRun(a,s);let u=n??{};o.evaluatorInfo&&(u={...u,...o.evaluatorInfo});const l=o.targetRunId??a.id;return await this.createFeedback(l,o.key,{score:o==null?void 0:o.score,value:o==null?void 0:o.value,comment:o==null?void 0:o.comment,correction:o==null?void 0:o.correction,sourceInfo:u,feedbackSourceType:"model",sourceRunId:o==null?void 0:o.sourceRunId})}async createFeedback(e,r,{score:n,value:i,correction:s,comment:a,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:l,feedbackId:c,feedbackConfig:h,projectId:d,comparativeExperimentId:f}){var m;if(!e&&!d)throw new Error("One of runId or projectId must be provided");if(e&&d)throw new Error("Only one of runId or projectId can be provided");const p={type:u??"api",metadata:o??{}};l!==void 0&&(p==null?void 0:p.metadata)!==void 0&&!p.metadata.__run&&(p.metadata.__run={run_id:l}),(p==null?void 0:p.metadata)!==void 0&&((m=p.metadata.__run)==null?void 0:m.run_id)!==void 0&&Je(p.metadata.__run.run_id);const y={id:c??Cr(),run_id:e,key:r,score:n,value:i,correction:s,comment:a,feedback_source:p,comparative_experiment_id:f,feedbackConfig:h,session_id:d},v=`${this.apiUrl}/feedback`,g=await this.caller.call(fetch,v,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(y),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ri(g,"create feedback"),y}async updateFeedback(e,{score:r,value:n,correction:i,comment:s}){const a={};r!=null&&(a.score=r),n!=null&&(a.value=n),i!=null&&(a.correction=i),s!=null&&(a.comment=s),Je(e);const o=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ri(o,"update feedback")}async readFeedback(e){Je(e);const r=`/feedback/${e}`;return await this._get(r)}async deleteFeedback(e){Je(e);const r=`/feedback/${e}`,n=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to delete ${r}: ${n.status} ${n.statusText}`);await n.json()}async*listFeedback({runIds:e,feedbackKeys:r,feedbackSourceTypes:n}={}){const i=new URLSearchParams;if(e&&i.append("run",e.join(",")),r)for(const s of r)i.append("key",s);if(n)for(const s of n)i.append("source",s);for await(const s of this._getPaginated("/feedback",i))yield*s}async createPresignedFeedbackToken(e,r,{expiration:n,feedbackConfig:i}={}){const s={run_id:e,feedback_key:r,feedback_config:i};return n?typeof n=="string"?s.expires_at=n:(n!=null&&n.hours||n!=null&&n.minutes||n!=null&&n.days)&&(s.expires_in=n):s.expires_in={hours:3},await(await this.caller.call(fetch,`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:r,referenceDatasetId:n,createdAt:i,description:s,metadata:a,id:o}){var c;if(r.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:r[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");const u={id:o,name:e,experiment_ids:r,reference_dataset_id:n,description:s,created_at:(c=i??new Date)==null?void 0:c.toISOString(),extra:{}};return a&&(u.extra.metadata=a),await(await this.caller.call(fetch,`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){Je(e);const r=new URLSearchParams({run_id:e});for await(const n of this._getPaginated("/feedback/tokens",r))yield*n}_selectEvalResults(e){let r;return"results"in e?r=e.results:r=[e],r}async logEvaluationFeedback(e,r,n){const i=this._selectEvalResults(e);for(const s of i){let a=n||{};s.evaluatorInfo&&(a={...s.evaluatorInfo,...a});let o=null;s.targetRunId?o=s.targetRunId:r&&(o=r.id),await this.createFeedback(o,s.key,{score:s.score,value:s.value,comment:s.comment,correction:s.correction,sourceInfo:a,sourceRunId:s.sourceRunId,feedbackConfig:s.feedbackConfig,feedbackSourceType:"model"})}return i}};const uL=t=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(r=>Gr(r)==="true"),q_={};function lL(t){q_[t]||(console.warn(t),q_[t]=!0)}function cL(t){return t.replace(/[-:.]/g,"")}function hL(t,e,r=1){const n=r.toFixed(0).slice(0,3).padStart(3,"0");return cL(`${new Date(t).toISOString().slice(0,-1)}${n}Z`)+e}class Gh{constructor(e,r){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=r}static fromHeader(e){const r=e.split(",");let n={},i=[];for(const s of r){const[a,o]=s.split("="),u=decodeURIComponent(o);a==="langsmith-metadata"?n=JSON.parse(u):a==="langsmith-tags"&&(i=u.split(","))}return new Gh(n,i)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}}class Ui{constructor(e){var o;Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const r=Ui.getDefaultConfig(),{metadata:n,...i}=e,s=i.client??new ab,a={...n,...(o=i==null?void 0:i.extra)==null?void 0:o.metadata};if(i.extra={...i.extra,metadata:a},Object.assign(this,{...r,...i,client:s}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const u=hL(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+u:this.dotted_order=u}}static getDefaultConfig(){return{id:Cr(),run_type:"chain",project_name:Gr("LANGCHAIN_PROJECT")??Gr("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:Gr("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Gr("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}createChild(e){const r=this.child_execution_order+1,n=new Ui({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:r,child_execution_order:r}),i=new Set;let s=this;for(;s!=null&&!i.has(s.id);)i.add(s.id),s.child_execution_order=Math.max(s.child_execution_order,r),s=s.parent_run;return this.child_runs.push(n),n}async end(e,r,n=Date.now()){this.outputs=this.outputs??e,this.error=this.error??r,this.end_time=this.end_time??n}_convertToCreate(e,r,n=!0){var u;const i=e.extra??{};if(i.runtime||(i.runtime={}),r)for(const[l,c]of Object.entries(r))i.runtime[l]||(i.runtime[l]=c);let s,a;return n?(a=(u=e.parent_run)==null?void 0:u.id,s=[]):(s=e.child_runs.map(l=>this._convertToCreate(l,r,n)),a=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:i,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:s,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags}}async postRun(e=!0){const r=await xx(),n=await this._convertToCreate(this,r,!0);if(await this.client.createRun(n),!e){lL("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const i of this.child_runs)await i.postRun(!1)}}async patchRun(){var r;const e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(r=this.parent_run)==null?void 0:r.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags};await this.client.updateRun(this.id,e)}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,r){var l,c,h,d;const n=e==null?void 0:e.callbacks;let i,s,a,o=uL();if(n){const f=((l=n==null?void 0:n.getParentRunId)==null?void 0:l.call(n))??"",p=(c=n==null?void 0:n.handlers)==null?void 0:c.find(y=>(y==null?void 0:y.name)=="langchain_tracer");i=(h=p==null?void 0:p.getRun)==null?void 0:h.call(p,f),s=p==null?void 0:p.projectName,a=p==null?void 0:p.client,o=o||!!p}return i?new Ui({name:i.name,id:i.id,client:a,tracingEnabled:o,project_name:s,tags:[...new Set(((i==null?void 0:i.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(d=i==null?void 0:i.extra)==null?void 0:d.metadata,...e==null?void 0:e.metadata}}}).createChild(r):new Ui({...r,client:a,tracingEnabled:o,project_name:s})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,r){var l;const n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,i=n["langsmith-trace"];if(!i||typeof i!="string")return;const s=i.trim(),a=s.split(".").map(c=>{const[h,d]=c.split("Z");return{strTime:h,time:Date.parse(h+"Z"),uuid:d}}),o=a[0].uuid,u={...r,name:(r==null?void 0:r.name)??"parent",run_type:(r==null?void 0:r.run_type)??"chain",start_time:(r==null?void 0:r.start_time)??Date.now(),id:(l=a.at(-1))==null?void 0:l.uuid,trace_id:o,dotted_order:s};if(n.baggage&&typeof n.baggage=="string"){const c=Gh.fromHeader(n.baggage);u.metadata=c.metadata,u.tags=c.tags}return new Ui(u)}toHeaders(e){var n;const r={"langsmith-trace":this.dotted_order,baggage:new Gh((n=this.extra)==null?void 0:n.metadata,this.tags).toHeader()};if(e)for(const[i,s]of Object.entries(r))e.set(i,s);return r}}const Tx="0.1.31";let dL=class{getStore(){}run(e,r){return r()}},fL=class{constructor(){Object.defineProperty(this,"asyncLocalStorage",{enumerable:!0,configurable:!0,writable:!0,value:new dL}),Object.defineProperty(this,"hasBeenInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1})}getInstance(){return this.asyncLocalStorage}initializeGlobalInstance(e){this.hasBeenInitialized||(this.hasBeenInitialized=!0,this.asyncLocalStorage=e)}};const pL=new fL,mL=()=>{const t=pL.getInstance().getStore();if(t===void 0)throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function or the tracing is enabled."].join(`
`));return t};function ob(t){return typeof t=="function"&&"langsmith:traceable"in t}class ra extends sn{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:r,projectName:n,client:i}=e;this.projectName=n??he("LANGCHAIN_PROJECT")??he("LANGCHAIN_SESSION"),this.exampleId=r,this.client=i??new ab({});const s=this.getTraceableRunTree();if(s){let a=s;const o=new Set;for(;a.parent_run&&!(o.has(a.id)||(o.add(a.id),!a.parent_run));)a=a.parent_run;o.clear();const u=[a];for(;u.length>0;){const l=u.shift();!l||o.has(l.id)||(o.add(l.id),this.runMap.set(l.id,l),l.child_runs&&u.push(...l.child_runs))}this.client=s.client??this.client,this.projectName=s.project_name??this.projectName,this.exampleId=s.reference_example_id??this.exampleId}}async _convertToCreate(e,r=void 0){return{...e,extra:{...e.extra,runtime:await px()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:r}}async persistRun(e){}async onRunCreate(e){const r=await this._convertToCreate(e,this.exampleId);await this.client.createRun(r)}async onRunUpdate(e){const r={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,r)}getRun(e){return this.runMap.get(e)}getTraceableRunTree(){try{return mL()}catch{return}}}const gL=Object.freeze(Object.defineProperty({__proto__:null,LangChainTracer:ra},Symbol.toStringTag,{value:"Module"}));function cg(t,e=lo){t=t.trim();const r=/```(json)?(.*)```/s.exec(t);return e(r?r[2]:t)}function lo(t){if(typeof t>"u")return null;try{return JSON.parse(t)}catch{}let e="";const r=[];let n=!1,i=!1;for(let s of t){if(n)s==='"'&&!i?n=!1:s===`
`&&!i?s="\\n":s==="\\"?i=!i:i=!1;else if(s==='"')n=!0,i=!1;else if(s==="{")r.push("}");else if(s==="[")r.push("]");else if(s==="}"||s==="]")if(r&&r[r.length-1]===s)r.pop();else return null;e+=s}n&&(e+='"');for(let s=r.length-1;s>=0;s-=1)e+=r[s];try{return JSON.parse(e)}catch{return null}}function na(t,e){return typeof t=="string"?typeof e=="string"?t+e:[{type:"text",text:t},...e]:Array.isArray(e)?[...t,...e]:[...t,{type:"text",text:e}]}class $r extends St{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}constructor(e,r){typeof e=="string"&&(e={content:e,additional_kwargs:r,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}function yL(t){return Array.isArray(t)&&t.every(e=>typeof e.index=="number")}function sr(t,e){const r={...t};for(const[n,i]of Object.entries(e))if(r[n]==null)r[n]=i;else{if(i==null)continue;if(typeof r[n]!=typeof i||Array.isArray(r[n])!==Array.isArray(i))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof r[n]=="string")r[n]=r[n]+i;else if(!Array.isArray(r[n])&&typeof r[n]=="object")r[n]=sr(r[n],i);else if(Array.isArray(r[n]))r[n]=ub(r[n],i);else{if(r[n]===i)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return r}function ub(t,e){if(!(t===void 0&&e===void 0)){if(t===void 0||e===void 0)return t||e;{const r=[...t];for(const n of e)if(typeof n=="object"&&"index"in n&&typeof n.index=="number"){const i=r.findIndex(s=>s.index===n.index);i!==-1?r[i]=sr(r[i],n):r.push(n)}else r.push(n);return r}}}class Oi extends $r{}function Vt(t){return typeof(t==null?void 0:t._getType)=="function"}function Ax(t){return Vt(t)&&typeof t.concat=="function"}class ia extends $r{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,r,n){typeof e=="string"&&(e={content:e,name:n,tool_call_id:r}),super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}}class sa extends Oi{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new sa({content:na(this.content,e.content),additional_kwargs:sr(this.additional_kwargs,e.additional_kwargs),response_metadata:sr(this.response_metadata,e.response_metadata),tool_call_id:this.tool_call_id})}}function bL(t){const e=[],r=[];for(const n of t)if(n.function){const i=n.function.name;try{const s=JSON.parse(n.function.arguments),a={name:i||"",args:s||{},id:n.id};e.push(a)}catch{r.push({name:i,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,r]}class Fe extends $r{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,r){var i;let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:r??{}};else{n=e;const s=(i=n.additional_kwargs)==null?void 0:i.tool_calls,a=n.tool_calls;s!=null&&s.length>0&&(a===void 0||a.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(s!=null&&a===void 0){const[o,u]=bL(s);n.tool_calls=o??[],n.invalid_tool_calls=u??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch{n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n!="string"&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=n.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}}function lb(t){return t._getType()==="ai"}class Or extends Oi{constructor(e){let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)r={...e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else{const n=[],i=[];for(const s of e.tool_call_chunks){let a={};try{if(a=lo(s.args??"{}")??{},typeof a!="object"||Array.isArray(a))throw new Error("Malformed tool call chunk args.");n.push({name:s.name??"",args:a,id:s.id})}catch{i.push({name:s.name,args:s.args,id:s.id,error:"Malformed args."})}}r={...e,tool_calls:n,invalid_tool_calls:i}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=r.tool_call_chunks??this.tool_call_chunks,this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=r.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){const r={content:na(this.content,e.content),additional_kwargs:sr(this.additional_kwargs,e.additional_kwargs),response_metadata:sr(this.response_metadata,e.response_metadata),tool_call_chunks:[]};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const n=ub(this.tool_call_chunks,e.tool_call_chunks);n!==void 0&&n.length>0&&(r.tool_call_chunks=n)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const n=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},i=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},s={input_tokens:n.input_tokens+i.input_tokens,output_tokens:n.output_tokens+i.output_tokens,total_tokens:n.total_tokens+i.total_tokens};r.usage_metadata=s}return new Or(r)}}class Ur extends $r{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Ur}constructor(e,r){typeof e=="string"&&(e={content:e,role:r}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}}class fs extends Oi{static lc_name(){return"ChatMessageChunk"}constructor(e,r){typeof e=="string"&&(e={content:e,role:r}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new fs({content:na(this.content,e.content),additional_kwargs:sr(this.additional_kwargs,e.additional_kwargs),response_metadata:sr(this.response_metadata,e.response_metadata),role:this.role})}}class aa extends $r{static lc_name(){return"FunctionMessage"}constructor(e,r){typeof e=="string"&&(e={content:e,name:r}),super(e)}_getType(){return"function"}}class ps extends Oi{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new ps({content:na(this.content,e.content),additional_kwargs:sr(this.additional_kwargs,e.additional_kwargs),response_metadata:sr(this.response_metadata,e.response_metadata),name:this.name??""})}}class ut extends $r{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class ms extends Oi{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new ms({content:na(this.content,e.content),additional_kwargs:sr(this.additional_kwargs,e.additional_kwargs),response_metadata:sr(this.response_metadata,e.response_metadata)})}}class Xr extends $r{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class gs extends Oi{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new gs({content:na(this.content,e.content),additional_kwargs:sr(this.additional_kwargs,e.additional_kwargs),response_metadata:sr(this.response_metadata,e.response_metadata)})}}function Ts(t){if(typeof t=="string")return new ut(t);if(Vt(t))return t;const[e,r]=t;if(e==="human"||e==="user")return new ut({content:r});if(e==="ai"||e==="assistant")return new Fe({content:r});if(e==="system")return new Xr({content:r});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}function kt(t,e="Human",r="AI"){const n=[];for(const i of t){let s;if(i._getType()==="human")s=e;else if(i._getType()==="ai")s=r;else if(i._getType()==="system")s="System";else if(i._getType()==="function")s="Function";else if(i._getType()==="tool")s="Tool";else if(i._getType()==="generic")s=i.role;else throw new Error(`Got unsupported message type: ${i._getType()}`);const a=i.name?`${i.name}, `:"";n.push(`${s}: ${a}${i.content}`)}return n.join(`
`)}function wL(t){if(t.data!==void 0)return t;{const e=t;return{type:e.type,data:{content:e.text,role:e.role,name:void 0,tool_call_id:void 0}}}}function cb(t){const e=wL(t);switch(e.type){case"human":return new ut(e.data);case"ai":return new Fe(e.data);case"system":return new Xr(e.data);case"function":if(e.data.name===void 0)throw new Error("Name must be defined for function messages");return new aa(e.data);case"tool":if(e.data.tool_call_id===void 0)throw new Error("Tool call ID must be defined for tool messages");return new ia(e.data);case"chat":{if(e.data.role===void 0)throw new Error("Role must be defined for chat messages");return new Ur(e.data)}default:throw new Error(`Got unexpected type: ${e.type}`)}}function kx(t){return t.map(cb)}function vL(t){return t.map(e=>e.toDict())}function Ix(t){const e=t._getType();if(e==="human")return new ms({...t});if(e==="ai")return new Or({...t});if(e==="system")return new gs({...t});if(e==="function")return new ps({...t});if(Ur.isInstance(t))return new fs({...t});throw new Error("Unknown message type.")}const _L=Object.freeze(Object.defineProperty({__proto__:null,AIMessage:Fe,AIMessageChunk:Or,BaseMessage:$r,BaseMessageChunk:Oi,ChatMessage:Ur,ChatMessageChunk:fs,FunctionMessage:aa,FunctionMessageChunk:ps,HumanMessage:ut,HumanMessageChunk:ms,SystemMessage:Xr,SystemMessageChunk:gs,ToolMessage:ia,ToolMessageChunk:sa,_mergeDicts:sr,_mergeLists:ub,coerceMessageLikeToMessage:Ts,convertToChunk:Ix,getBufferString:kt,isAIMessage:lb,isBaseMessage:Vt,isBaseMessageChunk:Ax,isOpenAIToolCallArray:yL,mapChatMessagesToStoredMessages:vL,mapStoredMessageToChatMessage:cb,mapStoredMessagesToChatMessages:kx,mergeContent:na},Symbol.toStringTag,{value:"Module"}));class Cx extends sn{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:he("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=he("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){const r={start_time:Date.now(),name:e},n=await this.persistSession(r);return this.session=n,n}async loadSession(e){const r=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(r)}async loadDefaultSession(){const e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){var s;const r=this.session??await this.loadDefaultSession(),n=e.serialized;let i;if(e.run_type==="llm"){const a=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map(u=>kt(u));i={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:n,type:e.run_type,session_id:r.id,prompts:a,response:e.outputs}}else if(e.run_type==="chain"){const a=await Promise.all(e.child_runs.map(u=>this.convertV2RunToRun(u)));i={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:n,type:e.run_type,session_id:r.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:a.filter(u=>u.type==="llm"),child_chain_runs:a.filter(u=>u.type==="chain"),child_tool_runs:a.filter(u=>u.type==="tool")}}else if(e.run_type==="tool"){const a=await Promise.all(e.child_runs.map(u=>this.convertV2RunToRun(u)));i={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:n,type:e.run_type,session_id:r.id,tool_input:e.inputs.input,output:(s=e.outputs)==null?void 0:s.output,action:JSON.stringify(n),child_llm_runs:a.filter(u=>u.type==="llm"),child_chain_runs:a.filter(u=>u.type==="chain"),child_tool_runs:a.filter(u=>u.type==="tool")}}else throw new Error(`Unknown run type: ${e.run_type}`);return i}async persistRun(e){let r,n;e.run_type!==void 0?n=await this.convertV2RunToRun(e):n=e,n.type==="llm"?r=`${this.endpoint}/llm-runs`:n.type==="chain"?r=`${this.endpoint}/chain-runs`:r=`${this.endpoint}/tool-runs`;const i=await fetch(r,{method:"POST",headers:this.headers,body:JSON.stringify(n)});i.ok||console.error(`Failed to persist run: ${i.status} ${i.statusText}`)}async persistSession(e){const r=`${this.endpoint}/sessions`,n=await fetch(r,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return n.ok?{id:(await n.json()).id,...e}:(console.error(`Failed to persist session: ${n.status} ${n.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){const r=await fetch(e,{method:"GET",headers:this.headers});let n;if(!r.ok)return console.error(`Failed to load session: ${r.status} ${r.statusText}`),n={id:1,start_time:Date.now()},this.session=n,n;const i=await r.json();return i.length===0?(n={id:1,start_time:Date.now()},this.session=n,n):([n]=i,this.session=n,n)}}const PL=Object.freeze(Object.defineProperty({__proto__:null,LangChainTracerV1:Cx},Symbol.toStringTag,{value:"Module"}));async function OL(t){const e=new Cx;return t?await e.loadSession(t):await e.loadDefaultSession(),e}async function Rx(){return new ra}const SL=Object.freeze(Object.defineProperty({__proto__:null,getTracingCallbackHandler:OL,getTracingV2CallbackHandler:Rx},Symbol.toStringTag,{value:"Module"}));let xu;function xL(){const t="default"in fi?fi.default:fi;return new t({autoStart:!0,concurrency:1})}async function vt(t,e){e===!0?await t():(typeof xu>"u"&&(xu=xL()),xu.add(t))}function jx(){return typeof xu<"u"?xu.onIdle():Promise.resolve()}const EL=Object.freeze(Object.defineProperty({__proto__:null,awaitAllCallbacks:jx,consumeCallback:vt},Symbol.toStringTag,{value:"Module"}));function Oo(t){return t?Array.isArray(t)||"name"in t?{callbacks:t}:t:{}}class Nx{setHandler(e){return this.setHandlers([e])}}class df{constructor(e,r,n,i,s,a,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}async handleText(e){await Promise.all(this.handlers.map(r=>vt(async()=>{var n;try{await((n=r.handleText)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(i){if(console.error(`Error in handler ${r.constructor.name}, handleText: ${i}`),r.raiseError)throw i}},r.awaitHandlers)))}}class $x extends df{getChild(e){const r=new et(this.runId);return r.setHandlers(this.inheritableHandlers),r.addTags(this.inheritableTags),r.addMetadata(this.inheritableMetadata),e&&r.addTags([e],!1),r}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(r=>vt(async()=>{var n;if(!r.ignoreRetriever)try{await((n=r.handleRetrieverEnd)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(i){if(console.error(`Error in handler ${r.constructor.name}, handleRetriever`),r.raiseError)throw i}},r.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(r=>vt(async()=>{var n;if(!r.ignoreRetriever)try{await((n=r.handleRetrieverError)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(i){if(console.error(`Error in handler ${r.constructor.name}, handleRetrieverError: ${i}`),r.raiseError)throw e}},r.awaitHandlers)))}}class hg extends df{async handleLLMNewToken(e,r,n,i,s,a){await Promise.all(this.handlers.map(o=>vt(async()=>{var u;if(!o.ignoreLLM)try{await((u=o.handleLLMNewToken)==null?void 0:u.call(o,e,r??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(l){if(console.error(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${l}`),o.raiseError)throw l}},o.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(r=>vt(async()=>{var n;if(!r.ignoreLLM)try{await((n=r.handleLLMError)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(i){if(console.error(`Error in handler ${r.constructor.name}, handleLLMError: ${i}`),r.raiseError)throw i}},r.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(r=>vt(async()=>{var n;if(!r.ignoreLLM)try{await((n=r.handleLLMEnd)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(i){if(console.error(`Error in handler ${r.constructor.name}, handleLLMEnd: ${i}`),r.raiseError)throw i}},r.awaitHandlers)))}}class Lx extends df{getChild(e){const r=new et(this.runId);return r.setHandlers(this.inheritableHandlers),r.addTags(this.inheritableTags),r.addMetadata(this.inheritableMetadata),e&&r.addTags([e],!1),r}async handleChainError(e,r,n,i,s){await Promise.all(this.handlers.map(a=>vt(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,s))}catch(u){if(console.error(`Error in handler ${a.constructor.name}, handleChainError: ${u}`),a.raiseError)throw u}},a.awaitHandlers)))}async handleChainEnd(e,r,n,i,s){await Promise.all(this.handlers.map(a=>vt(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,s))}catch(u){if(console.error(`Error in handler ${a.constructor.name}, handleChainEnd: ${u}`),a.raiseError)throw u}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(r=>vt(async()=>{var n;if(!r.ignoreAgent)try{await((n=r.handleAgentAction)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(i){if(console.error(`Error in handler ${r.constructor.name}, handleAgentAction: ${i}`),r.raiseError)throw i}},r.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(r=>vt(async()=>{var n;if(!r.ignoreAgent)try{await((n=r.handleAgentEnd)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(i){if(console.error(`Error in handler ${r.constructor.name}, handleAgentEnd: ${i}`),r.raiseError)throw i}},r.awaitHandlers)))}}class Dx extends df{getChild(e){const r=new et(this.runId);return r.setHandlers(this.inheritableHandlers),r.addTags(this.inheritableTags),r.addMetadata(this.inheritableMetadata),e&&r.addTags([e],!1),r}async handleToolError(e){await Promise.all(this.handlers.map(r=>vt(async()=>{var n;if(!r.ignoreAgent)try{await((n=r.handleToolError)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(i){if(console.error(`Error in handler ${r.constructor.name}, handleToolError: ${i}`),r.raiseError)throw i}},r.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(r=>vt(async()=>{var n;if(!r.ignoreAgent)try{await((n=r.handleToolEnd)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(i){if(console.error(`Error in handler ${r.constructor.name}, handleToolEnd: ${i}`),r.raiseError)throw i}},r.awaitHandlers)))}}class et extends Nx{constructor(e,r){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(r==null?void 0:r.handlers)??this.handlers,this.inheritableHandlers=(r==null?void 0:r.inheritableHandlers)??this.inheritableHandlers,this.tags=(r==null?void 0:r.tags)??this.tags,this.inheritableTags=(r==null?void 0:r.inheritableTags)??this.inheritableTags,this.metadata=(r==null?void 0:r.metadata)??this.metadata,this.inheritableMetadata=(r==null?void 0:r.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,r,n=void 0,i=void 0,s=void 0,a=void 0,o=void 0,u=void 0){return Promise.all(r.map(async(l,c)=>{const h=c===0&&n?n:Cr();return await Promise.all(this.handlers.map(d=>vt(async()=>{var f;if(!d.ignoreLLM)try{await((f=d.handleLLMStart)==null?void 0:f.call(d,e,[l],h,this._parentRunId,s,this.tags,this.metadata,u))}catch(p){if(console.error(`Error in handler ${d.constructor.name}, handleLLMStart: ${p}`),d.raiseError)throw p}},d.awaitHandlers))),new hg(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,r,n=void 0,i=void 0,s=void 0,a=void 0,o=void 0,u=void 0){return Promise.all(r.map(async(l,c)=>{const h=c===0&&n?n:Cr();return await Promise.all(this.handlers.map(d=>vt(async()=>{var f,p;if(!d.ignoreLLM)try{if(d.handleChatModelStart)await((f=d.handleChatModelStart)==null?void 0:f.call(d,e,[l],h,this._parentRunId,s,this.tags,this.metadata,u));else if(d.handleLLMStart){const y=kt(l);await((p=d.handleLLMStart)==null?void 0:p.call(d,e,[y],h,this._parentRunId,s,this.tags,this.metadata,u))}}catch(y){if(console.error(`Error in handler ${d.constructor.name}, handleLLMStart: ${y}`),d.raiseError)throw y}},d.awaitHandlers))),new hg(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,r,n=Cr(),i=void 0,s=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>vt(async()=>{var l;if(!u.ignoreChain)try{await((l=u.handleChainStart)==null?void 0:l.call(u,e,r,n,this._parentRunId,this.tags,this.metadata,i,o))}catch(c){if(console.error(`Error in handler ${u.constructor.name}, handleChainStart: ${c}`),u.raiseError)throw c}},u.awaitHandlers))),new Lx(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,r,n=Cr(),i=void 0,s=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>vt(async()=>{var l;if(!u.ignoreAgent)try{await((l=u.handleToolStart)==null?void 0:l.call(u,e,r,n,this._parentRunId,this.tags,this.metadata,o))}catch(c){if(console.error(`Error in handler ${u.constructor.name}, handleToolStart: ${c}`),u.raiseError)throw c}},u.awaitHandlers))),new Dx(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,r,n=Cr(),i=void 0,s=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>vt(async()=>{var l;if(!u.ignoreRetriever)try{await((l=u.handleRetrieverStart)==null?void 0:l.call(u,e,r,n,this._parentRunId,this.tags,this.metadata,o))}catch(c){if(console.error(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${c}`),u.raiseError)throw c}},u.awaitHandlers))),new $x(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,r=!0){this.handlers.push(e),r&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(r=>r!==e),this.inheritableHandlers=this.inheritableHandlers.filter(r=>r!==e)}setHandlers(e,r=!0){this.handlers=[],this.inheritableHandlers=[];for(const n of e)this.addHandler(n,r)}addTags(e,r=!0){this.removeTags(e),this.tags.push(...e),r&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(r=>!e.includes(r)),this.inheritableTags=this.inheritableTags.filter(r=>!e.includes(r))}addMetadata(e,r=!0){this.metadata={...this.metadata,...e},r&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const r of Object.keys(e))delete this.metadata[r],delete this.inheritableMetadata[r]}copy(e=[],r=!0){const n=new et(this._parentRunId);for(const i of this.handlers){const s=this.inheritableHandlers.includes(i);n.addHandler(i,s)}for(const i of this.tags){const s=this.inheritableTags.includes(i);n.addTags([i],s)}for(const i of Object.keys(this.metadata)){const s=Object.keys(this.inheritableMetadata).includes(i);n.addMetadata({[i]:this.metadata[i]},s)}for(const i of e)n.handlers.filter(s=>s.name==="console_callback_handler").some(s=>s.name===i.name)||n.addHandler(i,r);return n}static fromHandlers(e){class r extends Po{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Cr()}),Object.assign(this,e)}}const n=new this;return n.addHandler(new r),n}static async configure(e,r,n,i,s,a,o){var d;let u;(e||r)&&(Array.isArray(e)||!e?(u=new et,u.setHandlers((e==null?void 0:e.map(cl))??[],!0)):u=e,u=u.copy(Array.isArray(r)?r.map(cl):r==null?void 0:r.handlers,!1));const l=he("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),c=he("LANGCHAIN_TRACING_V2")==="true"||he("LANGSMITH_TRACING")==="true",h=c||(he("LANGCHAIN_TRACING")??!1);if(l||h){if(u||(u=new et),l&&!u.handlers.some(f=>f.name===Wh.prototype.name)){const f=new Wh;u.addHandler(f,!0)}if(h&&!u.handlers.some(f=>f.name==="langchain_tracer")&&c){const f=await Rx();u.addHandler(f,!0),u._parentRunId=((d=f.getTraceableRunTree())==null?void 0:d.id)??u._parentRunId}}return(n||i)&&u&&(u.addTags(n??[]),u.addTags(i??[],!1)),(s||a)&&u&&(u.addMetadata(s??{}),u.addMetadata(a??{},!1)),u}}function cl(t){return"name"in t?t:Po.fromMethods(t)}class Mx{constructor(e,r){Object.defineProperty(this,"groupName",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"runManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async getTraceGroupCallbackManager(e,r,n){const i=new ra(n),s=await et.configure([i]),a=await(s==null?void 0:s.handleChainStart({lc:1,type:"not_implemented",id:["langchain","callbacks","groups",e]},r??{}));if(!a)throw new Error("Failed to create run group callback manager.");return a}async start(e){return this.runManager||(this.runManager=await this.getTraceGroupCallbackManager(this.groupName,e,this.options)),this.runManager.getChild()}async error(e){this.runManager&&(await this.runManager.handleChainError(e),this.runManager=void 0)}async end(e){this.runManager&&(await this.runManager.handleChainEnd(e??{}),this.runManager=void 0)}}function TL(t,e){return t&&!Array.isArray(t)&&typeof t=="object"?t:{[e]:t}}async function AL(t,e,...r){const n=new Mx(t.name,t),i=await n.start({...r});try{const s=await e(i,...r);return await n.end(TL(s,"output")),s}catch(s){throw await n.error(s),s}}const kL=Object.freeze(Object.defineProperty({__proto__:null,BaseCallbackManager:Nx,CallbackManager:et,CallbackManagerForChainRun:Lx,CallbackManagerForLLMRun:hg,CallbackManagerForRetrieverRun:$x,CallbackManagerForToolRun:Dx,TraceGroup:Mx,ensureHandler:cl,parseCallbackConfigArg:Oo,traceAsGroup:AL},Symbol.toStringTag,{value:"Module"}));/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var IL=typeof window=="object"?window:{},me="0123456789abcdef".split(""),CL=[-2147483648,8388608,32768,128],ln=[24,16,8,0],xt=[];function Cn(t){t?(xt[0]=xt[16]=xt[1]=xt[2]=xt[3]=xt[4]=xt[5]=xt[6]=xt[7]=xt[8]=xt[9]=xt[10]=xt[11]=xt[12]=xt[13]=xt[14]=xt[15]=0,this.blocks=xt):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Cn.prototype.update=function(t){if(!this.finalized){var e=typeof t!="string";e&&t.constructor===IL.ArrayBuffer&&(t=new Uint8Array(t));for(var r,n=0,i,s=t.length||0,a=this.blocks;n<s;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),e)for(i=this.start;n<s&&i<64;++n)a[i>>2]|=t[n]<<ln[i++&3];else for(i=this.start;n<s&&i<64;++n)r=t.charCodeAt(n),r<128?a[i>>2]|=r<<ln[i++&3]:r<2048?(a[i>>2]|=(192|r>>6)<<ln[i++&3],a[i>>2]|=(128|r&63)<<ln[i++&3]):r<55296||r>=57344?(a[i>>2]|=(224|r>>12)<<ln[i++&3],a[i>>2]|=(128|r>>6&63)<<ln[i++&3],a[i>>2]|=(128|r&63)<<ln[i++&3]):(r=65536+((r&1023)<<10|t.charCodeAt(++n)&1023),a[i>>2]|=(240|r>>18)<<ln[i++&3],a[i>>2]|=(128|r>>12&63)<<ln[i++&3],a[i>>2]|=(128|r>>6&63)<<ln[i++&3],a[i>>2]|=(128|r&63)<<ln[i++&3]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.block=a[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};Cn.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[16]=this.block,t[e>>2]|=CL[e&3],this.block=t[16],e>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}};Cn.prototype.hash=function(){var t=this.h0,e=this.h1,r=this.h2,n=this.h3,i=this.h4,s,a,o,u=this.blocks;for(a=16;a<80;++a)o=u[a-3]^u[a-8]^u[a-14]^u[a-16],u[a]=o<<1|o>>>31;for(a=0;a<20;a+=5)s=e&r|~e&n,o=t<<5|t>>>27,i=o+s+i+1518500249+u[a]<<0,e=e<<30|e>>>2,s=t&e|~t&r,o=i<<5|i>>>27,n=o+s+n+1518500249+u[a+1]<<0,t=t<<30|t>>>2,s=i&t|~i&e,o=n<<5|n>>>27,r=o+s+r+1518500249+u[a+2]<<0,i=i<<30|i>>>2,s=n&i|~n&t,o=r<<5|r>>>27,e=o+s+e+1518500249+u[a+3]<<0,n=n<<30|n>>>2,s=r&n|~r&i,o=e<<5|e>>>27,t=o+s+t+1518500249+u[a+4]<<0,r=r<<30|r>>>2;for(;a<40;a+=5)s=e^r^n,o=t<<5|t>>>27,i=o+s+i+1859775393+u[a]<<0,e=e<<30|e>>>2,s=t^e^r,o=i<<5|i>>>27,n=o+s+n+1859775393+u[a+1]<<0,t=t<<30|t>>>2,s=i^t^e,o=n<<5|n>>>27,r=o+s+r+1859775393+u[a+2]<<0,i=i<<30|i>>>2,s=n^i^t,o=r<<5|r>>>27,e=o+s+e+1859775393+u[a+3]<<0,n=n<<30|n>>>2,s=r^n^i,o=e<<5|e>>>27,t=o+s+t+1859775393+u[a+4]<<0,r=r<<30|r>>>2;for(;a<60;a+=5)s=e&r|e&n|r&n,o=t<<5|t>>>27,i=o+s+i-1894007588+u[a]<<0,e=e<<30|e>>>2,s=t&e|t&r|e&r,o=i<<5|i>>>27,n=o+s+n-1894007588+u[a+1]<<0,t=t<<30|t>>>2,s=i&t|i&e|t&e,o=n<<5|n>>>27,r=o+s+r-1894007588+u[a+2]<<0,i=i<<30|i>>>2,s=n&i|n&t|i&t,o=r<<5|r>>>27,e=o+s+e-1894007588+u[a+3]<<0,n=n<<30|n>>>2,s=r&n|r&i|n&i,o=e<<5|e>>>27,t=o+s+t-1894007588+u[a+4]<<0,r=r<<30|r>>>2;for(;a<80;a+=5)s=e^r^n,o=t<<5|t>>>27,i=o+s+i-899497514+u[a]<<0,e=e<<30|e>>>2,s=t^e^r,o=i<<5|i>>>27,n=o+s+n-899497514+u[a+1]<<0,t=t<<30|t>>>2,s=i^t^e,o=n<<5|n>>>27,r=o+s+r-899497514+u[a+2]<<0,i=i<<30|i>>>2,s=n^i^t,o=r<<5|r>>>27,e=o+s+e-899497514+u[a+3]<<0,n=n<<30|n>>>2,s=r^n^i,o=e<<5|e>>>27,t=o+s+t-899497514+u[a+4]<<0,r=r<<30|r>>>2;this.h0=this.h0+t<<0,this.h1=this.h1+e<<0,this.h2=this.h2+r<<0,this.h3=this.h3+n<<0,this.h4=this.h4+i<<0};Cn.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,r=this.h2,n=this.h3,i=this.h4;return me[t>>28&15]+me[t>>24&15]+me[t>>20&15]+me[t>>16&15]+me[t>>12&15]+me[t>>8&15]+me[t>>4&15]+me[t&15]+me[e>>28&15]+me[e>>24&15]+me[e>>20&15]+me[e>>16&15]+me[e>>12&15]+me[e>>8&15]+me[e>>4&15]+me[e&15]+me[r>>28&15]+me[r>>24&15]+me[r>>20&15]+me[r>>16&15]+me[r>>12&15]+me[r>>8&15]+me[r>>4&15]+me[r&15]+me[n>>28&15]+me[n>>24&15]+me[n>>20&15]+me[n>>16&15]+me[n>>12&15]+me[n>>8&15]+me[n>>4&15]+me[n&15]+me[i>>28&15]+me[i>>24&15]+me[i>>20&15]+me[i>>16&15]+me[i>>12&15]+me[i>>8&15]+me[i>>4&15]+me[i&15]};Cn.prototype.toString=Cn.prototype.hex;Cn.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,r=this.h2,n=this.h3,i=this.h4;return[t>>24&255,t>>16&255,t>>8&255,t&255,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24&255,r>>16&255,r>>8&255,r&255,n>>24&255,n>>16&255,n>>8&255,n&255,i>>24&255,i>>16&255,i>>8&255,i&255]};Cn.prototype.array=Cn.prototype.digest;Cn.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(20),e=new DataView(t);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),t};const hl=t=>new Cn(!0).update(t).hex(),RL=Object.freeze(Object.defineProperty({__proto__:null,insecureHash:hl},Symbol.toStringTag,{value:"Module"})),dg=(...t)=>hl(t.join("_"));function jL(t){return t.message!==void 0?{text:t.text,message:cb(t.message)}:{text:t.text}}function NL(t){const e={text:t.text};return t.message!==void 0&&(e.message=t.message.toDict()),e}class Fx{}const $L=new Map;class ff extends Fx{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,r){return Promise.resolve(this.cache.get(dg(e,r))??null)}async update(e,r,n){this.cache.set(dg(e,r),n)}static global(){return new ff($L)}}const LL=Object.freeze(Object.defineProperty({__proto__:null,BaseCache:Fx,InMemoryCache:ff,deserializeStoredGeneration:jL,getCacheKey:dg,serializeGeneration:NL},Symbol.toStringTag,{value:"Module"}));class pf extends St{}class So extends pf{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new ut(this.value)]}}class mf extends pf{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return kt(this.messages)}toChatMessages(){return this.messages}}class zx extends pf{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new ut({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}const DL=Object.freeze(Object.defineProperty({__proto__:null,BasePromptValue:pf,ChatPromptValue:mf,ImagePromptValue:zx,StringPromptValue:So},Symbol.toStringTag,{value:"Module"})),ML=[400,401,402,403,404,405,406,407,409],FL=t=>{var r,n;if(t.message.startsWith("Cancel")||t.message.startsWith("AbortError")||t.name==="AbortError"||(t==null?void 0:t.code)==="ECONNABORTED")throw t;const e=((r=t==null?void 0:t.response)==null?void 0:r.status)??(t==null?void 0:t.status);if(e&&ML.includes(+e))throw t;if(((n=t==null?void 0:t.error)==null?void 0:n.code)==="insufficient_quota"){const i=new Error(t==null?void 0:t.message);throw i.name="InsufficientQuotaError",i}};class oa{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??FL;const r="default"in fi?fi.default:fi;this.queue=new r({concurrency:this.maxConcurrency})}call(e,...r){return this.queue.add(()=>Jh(()=>e(...r).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,r,...n){return e.signal?Promise.race([this.call(r,...n),new Promise((i,s)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(r,...n)}fetch(...e){return this.call(()=>fetch(...e).then(r=>r.ok?r:Promise.reject(r)))}}const zL=Object.freeze(Object.defineProperty({__proto__:null,AsyncCaller:oa},Symbol.toStringTag,{value:"Module"}));var gf={};gf.byteLength=KL;gf.toByteArray=BL;gf.fromByteArray=JL;var Kn=[],Br=[],UL=typeof Uint8Array<"u"?Uint8Array:Array,Dp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var ma=0,qL=Dp.length;ma<qL;++ma)Kn[ma]=Dp[ma],Br[Dp.charCodeAt(ma)]=ma;Br[45]=62;Br[95]=63;function Ux(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function KL(t){var e=Ux(t),r=e[0],n=e[1];return(r+n)*3/4-n}function VL(t,e,r){return(e+r)*3/4-r}function BL(t){var e,r=Ux(t),n=r[0],i=r[1],s=new UL(VL(t,n,i)),a=0,o=i>0?n-4:n,u;for(u=0;u<o;u+=4)e=Br[t.charCodeAt(u)]<<18|Br[t.charCodeAt(u+1)]<<12|Br[t.charCodeAt(u+2)]<<6|Br[t.charCodeAt(u+3)],s[a++]=e>>16&255,s[a++]=e>>8&255,s[a++]=e&255;return i===2&&(e=Br[t.charCodeAt(u)]<<2|Br[t.charCodeAt(u+1)]>>4,s[a++]=e&255),i===1&&(e=Br[t.charCodeAt(u)]<<10|Br[t.charCodeAt(u+1)]<<4|Br[t.charCodeAt(u+2)]>>2,s[a++]=e>>8&255,s[a++]=e&255),s}function HL(t){return Kn[t>>18&63]+Kn[t>>12&63]+Kn[t>>6&63]+Kn[t&63]}function WL(t,e,r){for(var n,i=[],s=e;s<r;s+=3)n=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(HL(n));return i.join("")}function JL(t){for(var e,r=t.length,n=r%3,i=[],s=16383,a=0,o=r-n;a<o;a+=s)i.push(WL(t,a,a+s>o?o:a+s));return n===1?(e=t[r-1],i.push(Kn[e>>2]+Kn[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],i.push(Kn[e>>10]+Kn[e>>4&63]+Kn[e<<2&63]+"=")),i.join("")}var GL=Object.defineProperty,ZL=(t,e,r)=>e in t?GL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,YL=(t,e,r)=>(ZL(t,e+"",r),r);function QL(t,e){let r=Array.from({length:t.length},(n,i)=>({start:i,end:i+1}));for(;r.length>1;){let n=null;for(let i=0;i<r.length-1;i++){const s=t.slice(r[i].start,r[i+1].end),a=e.get(s.join(","));a!=null&&(n==null||a<n[0])&&(n=[a,i])}if(n!=null){const i=n[1];r[i]={start:r[i].start,end:r[i+1].end},r.splice(i+1,1)}else break}return r}function XL(t,e){return t.length===1?[e.get(t.join(","))]:QL(t,e).map(r=>e.get(t.slice(r.start,r.end).join(","))).filter(r=>r!=null)}function eD(t){return t.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var fg=class{constructor(t,e){Ai(this,"specialTokens");Ai(this,"inverseSpecialTokens");Ai(this,"patStr");Ai(this,"textEncoder",new TextEncoder);Ai(this,"textDecoder",new TextDecoder("utf-8"));Ai(this,"rankMap",new Map);Ai(this,"textMap",new Map);this.patStr=t.pat_str;const r=t.bpe_ranks.split(`
`).filter(Boolean).reduce((n,i)=>{const[s,a,...o]=i.split(" "),u=Number.parseInt(a,10);return o.forEach((l,c)=>n[l]=u+c),n},{});for(const[n,i]of Object.entries(r)){const s=gf.toByteArray(n);this.rankMap.set(s.join(","),i),this.textMap.set(i,s)}this.specialTokens={...t.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[i,s])=>(n[s]=this.textEncoder.encode(i),n),{})}encode(t,e=[],r="all"){const n=new RegExp(this.patStr,"ug"),i=fg.specialTokenRegex(Object.keys(this.specialTokens)),s=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(r==="all"?Object.keys(this.specialTokens).filter(l=>!a.has(l)):r);if(o.size>0){const l=fg.specialTokenRegex([...o]),c=t.match(l);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let u=0;for(;;){let l=null,c=u;for(;i.lastIndex=c,l=i.exec(t),!(l==null||a.has(l[0]));)c=l.index+1;const h=(l==null?void 0:l.index)??t.length;for(const f of t.substring(u,h).matchAll(n)){const p=this.textEncoder.encode(f[0]),y=this.rankMap.get(p.join(","));if(y!=null){s.push(y);continue}s.push(...XL(p,this.rankMap))}if(l==null)break;let d=this.specialTokens[l[0]];s.push(d),u=l.index+l[0].length}return s}decode(t){const e=[];let r=0;for(let s=0;s<t.length;++s){const a=t[s],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),r+=o.length)}const n=new Uint8Array(r);let i=0;for(const s of e)n.set(s,i),i+=s.length;return this.textDecoder.decode(n)}},qx=fg;YL(qx,"specialTokenRegex",t=>new RegExp(t.map(e=>eD(e)).join("|"),"g"));function tD(t){switch(t){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":return"o200k_base";default:throw new Error("Unknown model")}}const Pc={},rD=new oa({});async function hb(t){return t in Pc||(Pc[t]=rD.fetch(`https://tiktoken.pages.dev/js/${t}.json`).then(e=>e.json()).then(e=>new qx(e)).catch(e=>{throw delete Pc[t],e})),await Pc[t]}async function db(t){return hb(tD(t))}const nD=Object.freeze(Object.defineProperty({__proto__:null,encodingForModel:db,getEncoding:hb},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const iD=Object.prototype.hasOwnProperty;function pg(t,e){return iD.call(t,e)}function mg(t){if(Array.isArray(t)){const r=new Array(t.length);for(let n=0;n<r.length;n++)r[n]=""+n;return r}if(Object.keys)return Object.keys(t);let e=[];for(let r in t)pg(t,r)&&e.push(r);return e}function Hn(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function gg(t){let e=0;const r=t.length;let n;for(;e<r;){if(n=t.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function ga(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function sD(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function yg(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(let r=0,n=t.length;r<n;r++)if(yg(t[r]))return!0}else if(typeof t=="object"){const r=mg(t),n=r.length;for(var e=0;e<n;e++)if(yg(t[r[e]]))return!0}}return!1}function K_(t,e){const r=[t];for(const n in e){const i=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof i<"u"&&r.push(`${n}: ${i}`)}return r.join(`
`)}class aD extends Error{constructor(e,r,n,i,s){super(K_(e,{name:r,index:n,operation:i,tree:s})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.setPrototypeOf(this,new.target.prototype),this.message=K_(e,{name:r,index:n,operation:i,tree:s})}}const ht=aD,La={add:function(t,e,r){return t[e]=this.value,{newDocument:r}},remove:function(t,e,r){var n=t[e];return delete t[e],{newDocument:r,removed:n}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:function(t,e,r){let n=bg(r,this.path);n&&(n=Hn(n));const i=Eu(r,{op:"remove",path:this.from}).removed;return Eu(r,{op:"add",path:this.path,value:i}),{newDocument:r,removed:n}},copy:function(t,e,r){const n=bg(r,this.from);return Eu(r,{op:"add",path:this.path,value:Hn(n)}),{newDocument:r}},test:function(t,e,r){return{newDocument:r,test:Zh(t[e],this.value)}},_get:function(t,e,r){return this.value=t[e],{newDocument:r}}};var oD={add:function(t,e,r){return gg(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:r,index:e}},remove:function(t,e,r){var n=t.splice(e,1);return{newDocument:r,removed:n[0]}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:La.move,copy:La.copy,test:La.test,_get:La._get};function bg(t,e){if(e=="")return t;var r={op:"_get",path:e};return Eu(t,r),r.value}function Eu(t,e,r=!1,n=!0,i=!0,s=0){if(r&&(typeof r=="function"?r(e,0,t,e.path):wg(e,0)),e.path===""){let a={newDocument:t};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=t,a;if(e.op==="move"||e.op==="copy")return a.newDocument=bg(t,e.from),e.op==="move"&&(a.removed=t),a;if(e.op==="test"){if(a.test=Zh(t,e.value),a.test===!1)throw new ht("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return a.newDocument=t,a}else{if(e.op==="remove")return a.removed=t,a.newDocument=null,a;if(e.op==="_get")return e.value=t,a;if(r)throw new ht("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return a}}else{n||(t=Hn(t));const o=(e.path||"").split("/");let u=t,l=1,c=o.length,h,d,f;for(typeof r=="function"?f=r:f=wg;;){if(d=o[l],d&&d.indexOf("~")!=-1&&(d=sD(d)),i&&(d=="__proto__"||d=="prototype"&&l>0&&o[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&h===void 0&&(u[d]===void 0?h=o.slice(0,l).join("/"):l==c-1&&(h=e.path),h!==void 0&&f(e,0,t,h)),l++,Array.isArray(u)){if(d==="-")d=u.length;else{if(r&&!gg(d))throw new ht("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);gg(d)&&(d=~~d)}if(l>=c){if(r&&e.op==="add"&&d>u.length)throw new ht("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);const p=oD[e.op].call(e,u,d,t);if(p.test===!1)throw new ht("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return p}}else if(l>=c){const p=La[e.op].call(e,u,d,t);if(p.test===!1)throw new ht("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return p}if(u=u[d],r&&l<c&&(!u||typeof u!="object"))throw new ht("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function dl(t,e,r,n=!0,i=!0){if(r&&!Array.isArray(e))throw new ht("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(t=Hn(t));const s=new Array(e.length);for(let a=0,o=e.length;a<o;a++)s[a]=Eu(t,e[a],r,!0,i,a),t=s[a].newDocument;return s.newDocument=t,s}function wg(t,e,r,n){if(typeof t!="object"||t===null||Array.isArray(t))throw new ht("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,r);if(La[t.op]){if(typeof t.path!="string")throw new ht("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,r);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new ht('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,r);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new ht("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new ht("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&yg(t.value))throw new ht("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,r);if(r){if(t.op=="add"){var i=t.path.split("/").length,s=n.split("/").length;if(i!==s+1&&i!==s)throw new ht("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,r)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==n)throw new ht("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,r)}else if(t.op==="move"||t.op==="copy"){var a={op:"_get",path:t.from,value:void 0},o=uD([a],r);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new ht("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,r)}}}else throw new ht("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,r)}function uD(t,e,r){try{if(!Array.isArray(t))throw new ht("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)dl(Hn(e),Hn(t),r||!0);else{r=r||wg;for(var n=0;n<t.length;n++)r(t[n],n,e,void 0)}}catch(i){if(i instanceof ht)return i;throw i}}function Zh(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var r=Array.isArray(t),n=Array.isArray(e),i,s,a;if(r&&n){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!Zh(t[i],e[i]))return!1;return!0}if(r!=n)return!1;var o=Object.keys(t);if(s=o.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(o[i]))return!1;for(i=s;i--!==0;)if(a=o[i],!Zh(t[a],e[a]))return!1;return!0}return t!==t&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function Kx(t,e,r,n,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=mg(e),a=mg(t),o=!1,u=a.length-1;u>=0;u--){var l=a[u],c=t[l];if(pg(e,l)&&!(e[l]===void 0&&c!==void 0&&Array.isArray(e)===!1)){var h=e[l];typeof c=="object"&&c!=null&&typeof h=="object"&&h!=null&&Array.isArray(c)===Array.isArray(h)?Kx(c,h,r,n+"/"+ga(l),i):c!==h&&(i&&r.push({op:"test",path:n+"/"+ga(l),value:Hn(c)}),r.push({op:"replace",path:n+"/"+ga(l),value:Hn(h)}))}else Array.isArray(t)===Array.isArray(e)?(i&&r.push({op:"test",path:n+"/"+ga(l),value:Hn(c)}),r.push({op:"remove",path:n+"/"+ga(l)}),o=!0):(i&&r.push({op:"test",path:n,value:t}),r.push({op:"replace",path:n,value:e}))}if(!(!o&&s.length==a.length))for(var u=0;u<s.length;u++){var l=s[u];!pg(t,l)&&e[l]!==void 0&&r.push({op:"add",path:n+"/"+ga(l),value:Hn(e[l])})}}}function yf(t,e,r=!1){var n=[];return Kx(t,e,n,"",r),n}class lD{getStore(){}run(e,r){return r()}}const cD=new lD;class hD{getInstance(){return globalThis.__lc_tracing_async_local_storage??cD}initializeGlobalInstance(e){globalThis.__lc_tracing_async_local_storage===void 0&&(globalThis.__lc_tracing_async_local_storage=e)}}const Ws=new hD;class Gt extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const r=this.reader.cancel();this.reader.releaseLock(),await r}throw e}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const r=e.getReader();return new Gt({start(n){return i();function i(){return r.read().then(({done:s,value:a})=>{if(s){n.close();return}return n.enqueue(a),i()})}},cancel(){r.releaseLock()}})}static fromAsyncGenerator(e){return new Gt({async pull(r){const{value:n,done:i}=await e.next();i&&r.close(),r.enqueue(n)},async cancel(r){await e.return(r)}})}}function fb(t,e=2){const r=Array.from({length:e},()=>[]);return r.map(async function*(i){for(;;)if(i.length===0){const s=await t.next();for(const a of r)a.push(s)}else{if(i[0].done)return;yield i.shift().value}})}function nr(t,e){if(Array.isArray(t)&&Array.isArray(e))return t.concat(e);if(typeof t=="string"&&typeof e=="string")return t+e;if(typeof t=="number"&&typeof e=="number")return t+e;if("concat"in t&&typeof t.concat=="function")return t.concat(e);if(typeof t=="object"&&typeof e=="object"){const r={...t};for(const[n,i]of Object.entries(e))n in r&&!Array.isArray(r[n])?r[n]=nr(r[n],i):r[n]=i;return r}else throw new Error(`Cannot concat ${typeof t} and ${typeof e}`)}class ua{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.setup=new Promise((r,n)=>{Ws.getInstance().run(e.config,async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(r,n):this.firstResult.then(s=>r(void 0),n)})})}async next(...e){return this.firstResultUsed?Ws.getInstance().run(this.config,async()=>this.generator.next(...e)):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}}async function Vx(t,e,r,...n){const i=new ua({generator:e,startSetup:r}),s=await i.setup;return{output:t(i,s,...n),setup:s}}const dD=Object.freeze(Object.defineProperty({__proto__:null,AsyncGeneratorWithSetup:ua,IterableReadableStream:Gt,atee:fb,concat:nr,pipeGeneratorWithSetup:Vx},Symbol.toStringTag,{value:"Module"}));class Fn{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const r=this.ops.concat(e.ops),n=dl({},r);return new Js({ops:r,state:n[n.length-1].newDocument})}}class Js extends Fn{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const r=this.ops.concat(e.ops),n=dl(this.state,e.ops);return new Js({ops:r,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){const r=dl({},e.ops);return new Js({ops:e.ops,state:r[r.length-1].newDocument})}}const bf=t=>t.name==="log_stream_tracer";async function V_(t,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:r}=t;if(["retriever","llm","prompt"].includes(t.run_type))return r;if(!(Object.keys(r).length===1&&(r==null?void 0:r.input)===""))return r.input}async function B_(t,e){const{outputs:r}=t;return e==="original"||["retriever","llm","prompt"].includes(t.run_type)?r:r!==void 0&&Object.keys(r).length===1&&(r==null?void 0:r.output)!==void 0?r.output:r}function fD(t){return t!==void 0&&t.message!==void 0}class vg extends sn{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Gt.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const r=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||r.find(i=>{var s;return(s=this.includeTags)==null?void 0:s.includes(i)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&r.every(i=>{var s;return!((s=this.excludeTags)!=null&&s.includes(i))})),n}async*tapOutputIterable(e,r){for await(const n of r){if(e!==this.rootId){const i=this.keyMapByRunId[e];i&&await this.writer.write(new Fn({ops:[{op:"add",path:`/logs/${i}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){var i;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Fn({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const r=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=r===1?e.name:`${e.name}:${r}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await V_(e,this._schemaFormat)),await this.writer.write(new Fn({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const r=this.keyMapByRunId[e.id];if(r===void 0)return;const n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${r}/inputs`,value:await V_(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${r}/final_output`,value:await B_(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${r}/end_time`,value:new Date(e.end_time).toISOString()});const i=new Fn({ops:n});await this.writer.write(i)}finally{if(e.id===this.rootId){const r=new Fn({ops:[{op:"replace",path:"/final_output",value:await B_(e,this._schemaFormat)}]});await this.writer.write(r),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,r,n){const i=this.keyMapByRunId[e.id];if(i===void 0)return;const s=e.inputs.messages!==void 0;let a;s?fD(n==null?void 0:n.chunk)?a=n==null?void 0:n.chunk:a=new Or(r):a=r;const o=new Fn({ops:[{op:"add",path:`/logs/${i}/streamed_output_str/-`,value:r},{op:"add",path:`/logs/${i}/streamed_output/-`,value:a}]});await this.writer.write(o)}}const pD=Object.freeze(Object.defineProperty({__proto__:null,LogStreamCallbackHandler:vg,RunLog:Js,RunLogPatch:Fn,isLogStreamHandler:bf},Symbol.toStringTag,{value:"Module"})),Pt="__run";class jn{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new jn({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class nn extends jn{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new nn({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}const mD=Object.freeze(Object.defineProperty({__proto__:null,ChatGenerationChunk:nn,GenerationChunk:jn,RUN_KEY:Pt},Symbol.toStringTag,{value:"Module"}));function Oc({name:t,serialized:e}){return t!==void 0?t:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const pb=t=>t.name==="event_stream_tracer";class gD extends sn{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Gt.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const r=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||r.find(i=>{var s;return(s=this.includeTags)==null?void 0:s.includes(i)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&r.every(i=>{var s;return!((s=this.excludeTags)!=null&&s.includes(i))})),n}async*tapOutputIterable(e,r){const n=await r.next();if(n.done)return;const i=this.runInfoMap.get(e);if(i===void 0){yield n.value;return}let s=this.tappedPromises.get(e);if(s===void 0){let a;s=new Promise(o=>{a=o}),this.tappedPromises.set(e,s);try{const o={event:`on_${i.runType}_stream`,run_id:e,name:i.name,tags:i.tags,metadata:i.metadata,data:{}};await this.send({...o,data:{chunk:n.value}},i),yield n.value;for await(const u of r)i.runType!=="tool"&&i.runType!=="retriever"&&await this.send({...o,data:{chunk:u}},i),yield u}finally{a()}}else{yield n.value;for await(const a of r)yield a}}async send(e,r){this._includeRun(r)&&await this.writer.write(e)}async sendEndEvent(e,r){const n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,r)}):await this.send(e,r)}async onLLMStart(e){var a,o;const r=Oc(e),n=e.inputs.messages!==void 0?"chat_model":"llm",i={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:r,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,i);const s=`on_${n}_start`;await this.send({event:s,data:{input:e.inputs},name:r,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},i)}async onLLMNewToken(e,r,n){const i=this.runInfoMap.get(e.id);let s,a;if(i===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(i.runType==="chat_model")a="on_chat_model_stream",(n==null?void 0:n.chunk)===void 0?s=new Or({content:r}):s=n.chunk.message;else if(i.runType==="llm")a="on_llm_stream",(n==null?void 0:n.chunk)===void 0?s=new jn({text:r}):s=n.chunk;else throw new Error(`Unexpected run type ${i.runType}`);await this.send({event:a,data:{chunk:s},run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata},i)}async onLLMEnd(e){var a,o,u;const r=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(r===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const i=(a=e.outputs)==null?void 0:a.generations;let s;if(r.runType==="chat_model"){for(const l of i??[]){if(s!==void 0)break;s=(o=l[0])==null?void 0:o.message}n="on_chat_model_end"}else if(r.runType==="llm")s={generations:i==null?void 0:i.map(l=>l.map(c=>({text:c.text,generationInfo:c.generationInfo}))),llmOutput:((u=e.outputs)==null?void 0:u.llmOutput)??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${r.runType}`);await this.sendEndEvent({event:n,data:{output:s,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async onChainStart(e){var a,o;const r=Oc(e),n=e.run_type??"chain",i={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:r,runType:e.run_type};let s={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(s={},i.inputs={}):e.inputs.input!==void 0?(s.input=e.inputs.input,i.inputs=e.inputs.input):(s.input=e.inputs,i.inputs=e.inputs),this.runInfoMap.set(e.id,i),await this.send({event:`on_${n}_start`,data:s,name:r,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},i)}async onChainEnd(e){var o;const r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,i=e.inputs??r.inputs??{},a={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:i};i.input&&Object.keys(i).length===1&&(a.input=i.input,r.inputs=i.input),await this.sendEndEvent({event:n,data:a,run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata??{}},r)}async onToolStart(e){var i,s;const r=Oc(e),n={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:r,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:r,run_id:e.id,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{}},n)}async onToolEnd(e){var i;const r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(r.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=((i=e.outputs)==null?void 0:i.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async onRetrieverStart(e){var s,a;const r=Oc(e),i={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:r,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,i),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:r,tags:e.tags??[],run_id:e.id,metadata:((a=e.extra)==null?void 0:a.metadata)??{}},i)}async onRetrieverEnd(e){var n;const r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((n=e.outputs)==null?void 0:n.documents)??e.outputs,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const Mp=25;async function Pr(t){return et.configure(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata)}function _g(...t){const e={};for(const r of t.filter(n=>!!n))for(const n of Object.keys(r))if(n==="metadata")e[n]={...e[n],...r[n]};else if(n==="tags"){const i=e[n]??[];e[n]=[...new Set(i.concat(r[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...r[n]};else if(n==="callbacks"){const i=e.callbacks,s=r.callbacks;if(Array.isArray(s))if(!i)e.callbacks=s;else if(Array.isArray(i))e.callbacks=i.concat(s);else{const a=i.copy();for(const o of s)a.addHandler(cl(o),!0);e.callbacks=a}else if(s)if(!i)e.callbacks=s;else if(Array.isArray(i)){const a=s.copy();for(const o of i)a.addHandler(cl(o),!0);e.callbacks=a}else e.callbacks=new et(s._parentRunId,{handlers:i.handlers.concat(s.handlers),inheritableHandlers:i.inheritableHandlers.concat(s.inheritableHandlers),tags:Array.from(new Set(i.tags.concat(s.tags))),inheritableTags:Array.from(new Set(i.inheritableTags.concat(s.inheritableTags))),metadata:{...i.metadata,...s.metadata}})}else{const i=n;e[i]=r[i]??e[i]}return e}const yD=new Set(["string","number","boolean"]);function Pe(t){var n;const e=t??Ws.getInstance().getStore();let r={tags:[],metadata:{},callbacks:void 0,recursionLimit:25,runId:void 0};if(e&&(r={...r,...e}),e!=null&&e.configurable)for(const i of Object.keys(e.configurable))yD.has(typeof e.configurable[i])&&!((n=r.metadata)!=null&&n[i])&&(r.metadata||(r.metadata={}),r.metadata[i]=e.configurable[i]);return r}function Ke(t={},{callbacks:e,maxConcurrency:r,recursionLimit:n,runName:i,configurable:s,runId:a}={}){const o=Pe(t);return e!==void 0&&(delete o.runName,o.callbacks=e),n!==void 0&&(o.recursionLimit=n),r!==void 0&&(o.maxConcurrency=r),i!==void 0&&(o.runName=i),s!==void 0&&(o.configurable={...o.configurable,...s}),a!==void 0&&delete o.runId,o}class Bx extends sn{constructor({config:e,onStart:r,onEnd:n,onError:i}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=r,this.argOnEnd=n,this.argOnError=i}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(this.argOnStart.length===1?await this.argOnStart(e):this.argOnStart.length===2&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(this.argOnError.length===1?await this.argOnError(e):this.argOnError.length===2&&await this.argOnError(e,this.config)):this.argOnEnd&&(this.argOnEnd.length===1?await this.argOnEnd(e):this.argOnEnd.length===2&&await this.argOnEnd(e,this.config)))}}function Hx(t){return t?t.lc_runnable:!1}class bD{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,r){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const i=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(r)),this.includeTags!==void 0&&(n=n||i.some(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(r)),this.excludeTags!==void 0&&(n=n&&i.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),n}}const wD=Symbol("Let zodToJsonSchema decide on which parser to use"),vD={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",emailStrategy:"format:email",base64Strategy:"contentEncoding:base64"},_D=t=>({...vD,...t}),PD=t=>{const e=_D(t),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,i])=>[i._def,{def:i._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function Wx(t,e,r,n){n!=null&&n.errorMessages&&r&&(t.errorMessage={...t.errorMessage,[e]:r})}function Ie(t,e,r,n,i){t[e]=r,Wx(t,e,n,i)}function OD(){return{}}function SD(t,e){var n,i;const r={type:"array"};return((i=(n=t.type)==null?void 0:n._def)==null?void 0:i.typeName)!==z.ZodAny&&(r.items=Te(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&Ie(r,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&Ie(r,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(Ie(r,"minItems",t.exactLength.value,t.exactLength.message,e),Ie(r,"maxItems",t.exactLength.value,t.exactLength.message,e)),r}function xD(t,e){const r={type:"integer",format:"int64"};if(!t.checks)return r;for(const n of t.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Ie(r,"minimum",n.value,n.message,e):Ie(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),Ie(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ie(r,"maximum",n.value,n.message,e):Ie(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),Ie(r,"maximum",n.value,n.message,e));break;case"multipleOf":Ie(r,"multipleOf",n.value,n.message,e);break}return r}function ED(){return{type:"boolean"}}function TD(t,e){return Te(t.type._def,e)}const AD=(t,e)=>Te(t.innerType._def,e);function Jx(t,e,r){const n=r??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((i,s)=>Jx(t,e,i))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return kD(t,e)}}const kD=(t,e)=>{const r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(const n of t.checks)switch(n.kind){case"min":Ie(r,"minimum",n.value,n.message,e);break;case"max":Ie(r,"maximum",n.value,n.message,e);break}return r};function ID(t,e){return{...Te(t.innerType._def,e),default:t.defaultValue()}}function CD(t,e){return e.effectStrategy==="input"?Te(t.schema._def,e):{}}function RD(t){return{type:"string",enum:t.values}}const jD=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function ND(t,e){const r=[Te(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Te(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const i=[];return r.forEach(s=>{if(jD(s))i.push(...s.allOf),s.unevaluatedProperties===void 0&&(n=void 0);else{let a=s;if("additionalProperties"in s&&s.additionalProperties===!1){const{additionalProperties:o,...u}=s;a=u}else n=void 0;i.push(a)}}),i.length?{allOf:i,...n}:void 0}function $D(t,e){const r=typeof t.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[t.value]}:{type:r==="bigint"?"integer":r,const:t.value}}const ws={cuid:"^[cC][^\\s-]{8,}$",cuid2:"^[a-z][a-z0-9]*$",ulid:"^[0-9A-HJKMNP-TV-Z]{26}$",email:"^(?!\\.)(?!.*\\.\\.)([a-zA-Z0-9_+-\\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\\-]*\\.)+[a-zA-Z]{2,}$",emoji:"^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",uuid:"^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$",ipv4:"^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$",ipv6:"^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$",base64:"^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$",nanoid:"^[a-zA-Z0-9_-]{21}$"};function Gx(t,e){const r={type:"string"};function n(i){return e.patternStrategy==="escape"?LD(i):i}if(t.checks)for(const i of t.checks)switch(i.kind){case"min":Ie(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,i.value):i.value,i.message,e);break;case"max":Ie(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,i.value):i.value,i.message,e);break;case"email":switch(e.emailStrategy){case"format:email":cn(r,"email",i.message,e);break;case"format:idn-email":cn(r,"idn-email",i.message,e);break;case"pattern:zod":hn(r,ws.email,i.message,e);break}break;case"url":cn(r,"uri",i.message,e);break;case"uuid":cn(r,"uuid",i.message,e);break;case"regex":hn(r,i.regex.source,i.message,e);break;case"cuid":hn(r,ws.cuid,i.message,e);break;case"cuid2":hn(r,ws.cuid2,i.message,e);break;case"startsWith":hn(r,"^"+n(i.value),i.message,e);break;case"endsWith":hn(r,n(i.value)+"$",i.message,e);break;case"datetime":cn(r,"date-time",i.message,e);break;case"date":cn(r,"date",i.message,e);break;case"time":cn(r,"time",i.message,e);break;case"duration":cn(r,"duration",i.message,e);break;case"length":Ie(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,i.value):i.value,i.message,e),Ie(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,i.value):i.value,i.message,e);break;case"includes":{hn(r,n(i.value),i.message,e);break}case"ip":{i.version!=="v6"&&cn(r,"ipv4",i.message,e),i.version!=="v4"&&cn(r,"ipv6",i.message,e);break}case"emoji":hn(r,ws.emoji,i.message,e);break;case"ulid":{hn(r,ws.ulid,i.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{cn(r,"binary",i.message,e);break}case"contentEncoding:base64":{Ie(r,"contentEncoding","base64",i.message,e);break}case"pattern:zod":{hn(r,ws.base64,i.message,e);break}}break}case"nanoid":hn(r,ws.nanoid,i.message,e)}return r}const LD=t=>Array.from(t).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),cn=(t,e,r,n)=>{var i;t.format||(i=t.anyOf)!=null&&i.some(s=>s.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&n.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...r&&n.errorMessages&&{errorMessage:{format:r}}})):Ie(t,"format",e,r,n)},hn=(t,e,r,n)=>{var i;t.pattern||(i=t.allOf)!=null&&i.some(s=>s.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&n.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:e,...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):Ie(t,"pattern",e,r,n)};function Zx(t,e){var n,i,s,a;if(e.target==="openApi3"&&((n=t.keyType)==null?void 0:n._def.typeName)===z.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((o,u)=>({...o,[u]:Te(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",u]})??{}}),{}),additionalProperties:!1};const r={type:"object",additionalProperties:Te(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return r;if(((i=t.keyType)==null?void 0:i._def.typeName)===z.ZodString&&((s=t.keyType._def.checks)!=null&&s.length)){const o=Object.entries(Gx(t.keyType._def,e)).reduce((u,[l,c])=>l==="type"?u:{...u,[l]:c},{});return{...r,propertyNames:o}}else if(((a=t.keyType)==null?void 0:a._def.typeName)===z.ZodEnum)return{...r,propertyNames:{enum:t.keyType._def.values}};return r}function DD(t,e){if(e.mapStrategy==="record")return Zx(t,e);const r=Te(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=Te(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function MD(t){const e=t.values,n=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),i=Array.from(new Set(n.map(s=>typeof s)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:n}}function FD(){return{not:{}}}function zD(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Yh={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function UD(t,e){if(e.target==="openApi3")return H_(t,e);const r=t.options instanceof Map?Array.from(t.options.values()):t.options;if(r.every(n=>n._def.typeName in Yh&&(!n._def.checks||!n._def.checks.length))){const n=r.reduce((i,s)=>{const a=Yh[s._def.typeName];return a&&!i.includes(a)?[...i,a]:i},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=r.reduce((i,s)=>{const a=typeof s._def.value;switch(a){case"string":case"number":case"boolean":return[...i,a];case"bigint":return[...i,"integer"];case"object":if(s._def.value===null)return[...i,"null"];case"symbol":case"undefined":case"function":default:return i}},[]);if(n.length===r.length){const i=n.filter((s,a,o)=>o.indexOf(s)===a);return{type:i.length>1?i:i[0],enum:r.reduce((s,a)=>s.includes(a._def.value)?s:[...s,a._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,i)=>[...n,...i._def.values.filter(s=>!n.includes(s))],[])};return H_(t,e)}const H_=(t,e)=>{const r=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((n,i)=>Te(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${i}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function qD(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:Yh[t.innerType._def.typeName],nullable:!0}:{type:[Yh[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=Te(t.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const r=Te(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function KD(t,e){const r={type:"number"};if(!t.checks)return r;for(const n of t.checks)switch(n.kind){case"int":r.type="integer",Wx(r,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Ie(r,"minimum",n.value,n.message,e):Ie(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),Ie(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ie(r,"maximum",n.value,n.message,e):Ie(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),Ie(r,"maximum",n.value,n.message,e));break;case"multipleOf":Ie(r,"multipleOf",n.value,n.message,e);break}return r}function VD(t,e){return e.removeAdditionalStrategy==="strict"?t.catchall._def.typeName==="ZodNever"?t.unknownKeys!=="strict":Te(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:t.catchall._def.typeName==="ZodNever"?t.unknownKeys==="passthrough":Te(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function BD(t,e){const r={type:"object",...Object.entries(t.shape()).reduce((n,[i,s])=>{if(s===void 0||s._def===void 0)return n;const a=Te(s._def,{...e,currentPath:[...e.currentPath,"properties",i],propertyPath:[...e.currentPath,"properties",i]});return a===void 0?n:{properties:{...n.properties,[i]:a},required:s.isOptional()?n.required:[...n.required,i]}},{properties:{},required:[]}),additionalProperties:VD(t,e)};return r.required.length||delete r.required,r}const HD=(t,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return Te(t.innerType._def,e);const r=Te(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},WD=(t,e)=>{if(e.pipeStrategy==="input")return Te(t.in._def,e);if(e.pipeStrategy==="output")return Te(t.out._def,e);const r=Te(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=Te(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(i=>i!==void 0)}};function JD(t,e){return Te(t.type._def,e)}function GD(t,e){const n={type:"array",uniqueItems:!0,items:Te(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&Ie(n,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&Ie(n,"maxItems",t.maxSize.value,t.maxSize.message,e),n}function ZD(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((r,n)=>Te(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:Te(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((r,n)=>Te(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function YD(){return{not:{}}}function QD(){return{}}const XD=(t,e)=>Te(t.innerType._def,e);function Te(t,e,r=!1){var a;const n=e.seen.get(t);if(e.override){const o=(a=e.override)==null?void 0:a.call(e,t,e,n,r);if(o!==wD)return o}if(n&&!r){const o=eM(n,e);if(o!==void 0)return o}const i={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,i);const s=rM(t,t.typeName,e);return s&&nM(t,e,s),i.jsonSchema=s,s}const eM=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:tM(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,n)=>e.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},tM=(t,e)=>{let r=0;for(;r<t.length&&r<e.length&&t[r]===e[r];r++);return[(t.length-r).toString(),...e.slice(r)].join("/")},rM=(t,e,r)=>{switch(e){case z.ZodString:return Gx(t,r);case z.ZodNumber:return KD(t,r);case z.ZodObject:return BD(t,r);case z.ZodBigInt:return xD(t,r);case z.ZodBoolean:return ED();case z.ZodDate:return Jx(t,r);case z.ZodUndefined:return YD();case z.ZodNull:return zD(r);case z.ZodArray:return SD(t,r);case z.ZodUnion:case z.ZodDiscriminatedUnion:return UD(t,r);case z.ZodIntersection:return ND(t,r);case z.ZodTuple:return ZD(t,r);case z.ZodRecord:return Zx(t,r);case z.ZodLiteral:return $D(t,r);case z.ZodEnum:return RD(t);case z.ZodNativeEnum:return MD(t);case z.ZodNullable:return qD(t,r);case z.ZodOptional:return HD(t,r);case z.ZodMap:return DD(t,r);case z.ZodSet:return GD(t,r);case z.ZodLazy:return Te(t.getter()._def,r);case z.ZodPromise:return JD(t,r);case z.ZodNaN:case z.ZodNever:return FD();case z.ZodEffects:return CD(t,r);case z.ZodAny:return OD();case z.ZodUnknown:return QD();case z.ZodDefault:return ID(t,r);case z.ZodBranded:return TD(t,r);case z.ZodReadonly:return XD(t,r);case z.ZodCatch:return AD(t,r);case z.ZodPipeline:return WD(t,r);case z.ZodFunction:case z.ZodVoid:case z.ZodSymbol:return;default:return(n=>{})()}},nM=(t,e,r)=>(t.description&&(r.description=t.description,e.markdownDescription&&(r.markdownDescription=t.description)),r),Zt=(t,e)=>{const r=PD(e),n=void 0,i=e==null?void 0:e.name,s=Te(t._def,r,!1)??{},a=i===void 0?n?{...s,[r.definitionPath]:n}:s:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,i].join("/"),[r.definitionPath]:{...n,[i]:s}};return r.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":r.target==="jsonSchema2019-09"&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),a};function iM(t){return Hx(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...Zt(t.data.schema),title:t.data.name}}}class Yx{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){const e={};return Object.values(this.nodes).forEach((r,n)=>{e[r.id]=eb(r.id)?n:r.id}),{nodes:Object.values(this.nodes).map(r=>({id:e[r.id],...iM(r)})),edges:this.edges.map(r=>r.data?{source:e[r.source],target:e[r.target],data:r.data}:{source:e[r.source],target:e[r.target]})}}addNode(e,r){if(r!==void 0&&this.nodes[r]!==void 0)throw new Error(`Node with id ${r} already exists`);const n=r||Cr(),i={id:n,data:e};return this.nodes[n]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(r=>r.source!==e.id&&r.target!==e.id)}addEdge(e,r,n){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[r.id]===void 0)throw new Error(`Target node ${r.id} not in graph`);const i={source:e.id,target:r.id,data:n};return this.edges.push(i),i}firstNode(){const e=new Set(this.edges.map(n=>n.target)),r=[];return Object.values(this.nodes).forEach(n=>{e.has(n.id)||r.push(n)}),r[0]}lastNode(){const e=new Set(this.edges.map(n=>n.source)),r=[];return Object.values(this.nodes).forEach(n=>{e.has(n.id)||r.push(n)}),r[0]}extend(e){Object.entries(e.nodes).forEach(([r,n])=>{this.nodes[r]=n}),this.edges=[...this.edges,...e.edges]}trimFirstNode(){const e=this.firstNode();if(e){const r=this.edges.filter(n=>n.source===e.id);(Object.keys(this.nodes).length===1||r.length===1)&&this.removeNode(e)}}trimLastNode(){const e=this.lastNode();if(e){const r=this.edges.filter(n=>n.target===e.id);(Object.keys(this.nodes).length===1||r.length===1)&&this.removeNode(e)}}}function sM(t){const e=new TextEncoder,r=new ReadableStream({async start(n){for await(const i of t)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(i)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return Gt.fromReadableStream(r)}function W_(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.iterator]=="function"&&typeof t.next=="function"}const aM=t=>t!=null&&typeof t=="object"&&"next"in t&&typeof t.next=="function";function Pg(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.asyncIterator]=="function"}function*J_(t,e){const r=Ws.getInstance();for(;;){const{value:n,done:i}=r.run(t,e.next.bind(e));if(i)break;yield n}}async function*G_(t,e){const r=Ws.getInstance(),n=e[Symbol.asyncIterator]();for(;;){const{value:i,done:s}=await r.run(t,n.next.bind(e));if(s)break;yield i}}function ft(t,e){return t&&!Array.isArray(t)&&!(t instanceof Date)&&typeof t=="object"?t:{[e]:t}}class xe extends St{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const r=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${r}${e}`:r}bind(e){return new pi({bound:this,kwargs:e,config:{}})}map(){return new co({bound:this})}withRetry(e){return new mb({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new pi({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new gb({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,r=0){if(Array.isArray(e)&&e.length!==r)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${r} inputs`);if(Array.isArray(e))return e.map(Pe);if(r>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter(([i])=>i!=="runId"));return Array.from({length:r},(i,s)=>Pe(s===0?e:n))}return Array.from({length:r},()=>Pe(e))}async batch(e,r,n){var u;const i=this._getOptionsList(r??{},e.length),s=((u=i[0])==null?void 0:u.maxConcurrency)??(n==null?void 0:n.maxConcurrency),a=new oa({maxConcurrency:s,onFailedAttempt:l=>{throw l}}),o=e.map((l,c)=>a.call(async()=>{try{return await this.invoke(l,i[c])}catch(h){if(n!=null&&n.returnExceptions)return h;throw h}}));return Promise.all(o)}async*_streamIterator(e,r){yield this.invoke(e,r)}async stream(e,r){const n=Pe(r),i=new ua({generator:this._streamIterator(e,n),config:n});return await i.setup,Gt.fromAsyncGenerator(i)}_separateRunnableConfigFromCallOptions(e){let r;e===void 0?r=Pe(e):r=Pe({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,[r,n]}async _callWithConfig(e,r,n){const i=Pe(n),s=await Pr(i),a=await(s==null?void 0:s.handleChainStart(this.toJSON(),ft(r,"input"),i.runId,i==null?void 0:i.runType,void 0,void 0,(i==null?void 0:i.runName)??this.getName()));delete i.runId;let o;try{o=await e.call(this,r,i,a)}catch(u){throw await(a==null?void 0:a.handleChainError(u)),u}return await(a==null?void 0:a.handleChainEnd(ft(o,"output"))),o}async _batchWithConfig(e,r,n,i){const s=this._getOptionsList(n??{},r.length),a=await Promise.all(s.map(Pr)),o=await Promise.all(a.map(async(l,c)=>{const h=await(l==null?void 0:l.handleChainStart(this.toJSON(),ft(r[c],"input"),s[c].runId,s[c].runType,void 0,void 0,s[c].runName??this.getName()));return delete s[c].runId,h}));let u;try{u=await e.call(this,r,s,o,i)}catch(l){throw await Promise.all(o.map(c=>c==null?void 0:c.handleChainError(l))),l}return await Promise.all(o.map(l=>l==null?void 0:l.handleChainEnd(ft(u,"output")))),u}async*_transformStreamWithConfig(e,r,n){let i,s=!0,a,o=!0;const u=Pe(n),l=await Pr(u);async function*c(){for await(const d of e){if(s)if(i===void 0)i=d;else try{i=nr(i,d)}catch{i=void 0,s=!1}yield d}}let h;try{const d=await Vx(r.bind(this),c(),async()=>l==null?void 0:l.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName()),u);delete u.runId,h=d.setup;const f=h==null?void 0:h.handlers.find(pb);let p=d.output;f!==void 0&&h!==void 0&&(p=f.tapOutputIterable(h.runId,p));const y=h==null?void 0:h.handlers.find(bf);y!==void 0&&h!==void 0&&(p=y.tapOutputIterable(h.runId,p));for await(const v of p)if(yield v,o)if(a===void 0)a=v;else try{a=nr(a,v)}catch{a=void 0,o=!1}}catch(d){throw await(h==null?void 0:h.handleChainError(d,void 0,void 0,void 0,{inputs:ft(i,"input")})),d}await(h==null?void 0:h.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:ft(i,"input")}))}getGraph(e){const r=new Yx,n=r.addNode({name:`${this.getName()}Input`,schema:Ce.any()}),i=r.addNode(this),s=r.addNode({name:`${this.getName()}Output`,schema:Ce.any()});return r.addEdge(n,i),r.addEdge(i,s),r}pipe(e){return new Bt({first:this,last:On(e)})}pick(e){return this.pipe(new vf(e))}assign(e){return this.pipe(new wf(new Si({steps:e})))}async*transform(e,r){let n;for await(const i of e)n===void 0?n=i:n=nr(n,i);yield*this._streamIterator(n,Pe(r))}async*streamLog(e,r,n){const i=new vg({...n,autoClose:!1,_schemaFormat:"original"}),s=Pe(r);yield*this._streamLog(e,i,s)}async*_streamLog(e,r,n){const{callbacks:i}=n;if(i===void 0)n.callbacks=[r];else if(Array.isArray(i))n.callbacks=i.concat([r]);else{const u=i.copy();u.inheritableHandlers.push(r),n.callbacks=u}const s=this.stream(e,n);async function a(){try{const u=await s;for await(const l of u){const c=new Fn({ops:[{op:"add",path:"/streamed_output/-",value:l}]});await r.writer.write(c)}}finally{await r.writer.close()}}const o=a();try{for await(const u of r)yield u}finally{await o}}streamEvents(e,r,n){let i;if(r.version==="v1")i=this._streamEventsV1(e,r,n);else if(r.version==="v2")i=this._streamEventsV2(e,r,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return r.encoding==="text/event-stream"?sM(i):Gt.fromAsyncGenerator(i)}async*_streamEventsV2(e,r,n){var f;const i=new gD({...n,autoClose:!1}),s=Pe(r),a=s.runId??Cr();s.runId=a;const o=s.callbacks;if(o===void 0)s.callbacks=[i];else if(Array.isArray(o))s.callbacks=o.concat(i);else{const p=o.copy();p.inheritableHandlers.push(i),s.callbacks=p}const u=this;async function l(){try{const p=await u.stream(e,s),y=i.tapOutputIterable(a,p);for await(const v of y);}finally{await i.finish()}}const c=l();let h=!1,d;try{for await(const p of i){if(!h){p.data.input=e,h=!0,d=p.run_id,yield p;continue}p.run_id===d&&p.event.endsWith("_end")&&(f=p.data)!=null&&f.input&&delete p.data.input,yield p}}finally{await c}}async*_streamEventsV1(e,r,n){let i,s=!1;const a=Pe(r),o=a.tags??[],u=a.metadata??{},l=a.runName??this.getName(),c=new vg({...n,autoClose:!1,_schemaFormat:"streaming_events"}),h=new bD({...n}),d=this._streamLog(e,c,a);for await(const p of d){if(i?i=i.concat(p):i=Js.fromRunLogPatch(p),i.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!s){s=!0;const m={...i.state},b={run_id:m.id,event:`on_${m.type}_start`,name:l,tags:o,metadata:u,data:{input:e}};h.includeEvent(b,m.type)&&(yield b)}const y=p.ops.filter(m=>m.path.startsWith("/logs/")).map(m=>m.path.split("/")[2]),v=[...new Set(y)];for(const m of v){let b,S={};const E=i.state.logs[m];if(E.end_time===void 0?E.streamed_output.length>0?b="stream":b="start":b="end",b==="start")E.inputs!==void 0&&(S.input=E.inputs);else if(b==="end")E.inputs!==void 0&&(S.input=E.inputs),S.output=E.final_output;else if(b==="stream"){const I=E.streamed_output.length;if(I!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${I} instead. Encountered in: "${E.name}"`);S={chunk:E.streamed_output[0]},E.streamed_output=[]}yield{event:`on_${E.type}_${b}`,name:E.name,run_id:E.id,tags:E.tags,metadata:E.metadata,data:S}}const{state:g}=i;if(g.streamed_output.length>0){const m=g.streamed_output.length;if(m!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${m} instead. Encountered in: "${g.name}"`);const b={chunk:g.streamed_output[0]};g.streamed_output=[];const S={event:`on_${g.type}_stream`,run_id:g.id,tags:o,metadata:u,name:l,data:b};h.includeEvent(S,g.type)&&(yield S)}}const f=i==null?void 0:i.state;if(f!==void 0){const p={event:`on_${f.type}_end`,name:l,run_id:f.id,tags:o,metadata:u,data:{output:f.final_output}};h.includeEvent(p,f.type)&&(yield p)}}static isRunnable(e){return Hx(e)}withListeners({onStart:e,onEnd:r,onError:n}){return new pi({bound:this,config:{},configFactories:[i=>({callbacks:[new Bx({config:i,onStart:e,onEnd:r,onError:n})]})]})}}class pi extends xe{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const r=_g(this.config,...e);return _g(r,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(r))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,r){return this.bound.invoke(e,await this._mergeConfig(Pe(r),this.kwargs))}async batch(e,r,n){const i=Array.isArray(r)?await Promise.all(r.map(async s=>this._mergeConfig(Pe(s),this.kwargs))):await this._mergeConfig(Pe(r),this.kwargs);return this.bound.batch(e,i,n)}async*_streamIterator(e,r){yield*this.bound._streamIterator(e,await this._mergeConfig(Pe(r),this.kwargs))}async stream(e,r){return this.bound.stream(e,await this._mergeConfig(Pe(r),this.kwargs))}async*transform(e,r){yield*this.bound.transform(e,await this._mergeConfig(Pe(r),this.kwargs))}streamEvents(e,r,n){const i=this,s=async function*(){yield*i.bound.streamEvents(e,{...await i._mergeConfig(Pe(r),i.kwargs),version:r.version},n)};return Gt.fromAsyncGenerator(s())}static isRunnableBinding(e){return e.bound&&xe.isRunnable(e.bound)}withListeners({onStart:e,onEnd:r,onError:n}){return new pi({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[i=>({callbacks:[new Bx({config:i,onStart:e,onEnd:r,onError:n})]})]})}}class co extends xe{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new co({bound:this.bound.bind(e)})}async invoke(e,r){return this._callWithConfig(this._invoke,e,r)}async _invoke(e,r,n){return this.bound.batch(e,Ke(r,{callbacks:n==null?void 0:n.getChild()}))}withListeners({onStart:e,onEnd:r,onError:n}){return new co({bound:this.bound.withListeners({onStart:e,onEnd:r,onError:n})})}}class mb extends pi{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,r,n){const i=e>1?`retry:attempt:${e}`:void 0;return Ke(r,{callbacks:n==null?void 0:n.getChild(i)})}async _invoke(e,r,n){return Jh(i=>super.invoke(e,this._patchConfigForRetry(i,r,n)),{onFailedAttempt:i=>this.onFailedAttempt(i,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,r){return this._callWithConfig(this._invoke,e,r)}async _batch(e,r,n,i){const s={};try{await Jh(async a=>{const o=e.map((d,f)=>f).filter(d=>s[d.toString()]===void 0||s[d.toString()]instanceof Error),u=o.map(d=>e[d]),l=o.map(d=>this._patchConfigForRetry(a,r==null?void 0:r[d],n==null?void 0:n[d])),c=await super.batch(u,l,{...i,returnExceptions:!0});let h;for(let d=0;d<c.length;d+=1){const f=c[d],p=o[d];f instanceof Error&&h===void 0&&(h=f,h.input=u[d]),s[p.toString()]=f}if(h)throw h;return c},{onFailedAttempt:a=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if((i==null?void 0:i.returnExceptions)!==!0)throw a}return Object.keys(s).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>s[parseInt(a,10)])}async batch(e,r,n){return this._batchWithConfig(this._batch.bind(this),e,r,n)}}class Bt extends xe{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,r){const n=Pe(r),i=await Pr(n),s=await(i==null?void 0:i.handleChainStart(this.toJSON(),ft(e,"input"),n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;let a=e,o;try{const u=[this.first,...this.middle];for(let l=0;l<u.length;l+=1)a=await u[l].invoke(a,Ke(n,{callbacks:s==null?void 0:s.getChild(`seq:step:${l+1}`)}));o=await this.last.invoke(a,Ke(n,{callbacks:s==null?void 0:s.getChild(`seq:step:${this.steps.length}`)}))}catch(u){throw await(s==null?void 0:s.handleChainError(u)),u}return await(s==null?void 0:s.handleChainEnd(ft(o,"output"))),o}async batch(e,r,n){const i=this._getOptionsList(r??{},e.length),s=await Promise.all(i.map(Pr)),a=await Promise.all(s.map(async(u,l)=>{const c=await(u==null?void 0:u.handleChainStart(this.toJSON(),ft(e[l],"input"),i[l].runId,void 0,void 0,void 0,i[l].runName));return delete i[l].runId,c}));let o=e;try{for(let u=0;u<this.steps.length;u+=1)o=await this.steps[u].batch(o,a.map((c,h)=>{const d=c==null?void 0:c.getChild(`seq:step:${u+1}`);return Ke(i[h],{callbacks:d})}),n)}catch(u){throw await Promise.all(a.map(l=>l==null?void 0:l.handleChainError(u))),u}return await Promise.all(a.map(u=>u==null?void 0:u.handleChainEnd(ft(o,"output")))),o}async*_streamIterator(e,r){const n=await Pr(r),{runId:i,...s}=r??{},a=await(n==null?void 0:n.handleChainStart(this.toJSON(),ft(e,"input"),i,void 0,void 0,void 0,s==null?void 0:s.runName)),o=[this.first,...this.middle,this.last];let u=!0,l;async function*c(){yield e}try{let h=o[0].transform(c(),Ke(s,{callbacks:a==null?void 0:a.getChild("seq:step:1")}));for(let d=1;d<o.length;d+=1)h=await o[d].transform(h,Ke(s,{callbacks:a==null?void 0:a.getChild(`seq:step:${d+1}`)}));for await(const d of h)if(yield d,u)if(l===void 0)l=d;else try{l=nr(l,d)}catch{l=void 0,u=!1}}catch(h){throw await(a==null?void 0:a.handleChainError(h)),h}await(a==null?void 0:a.handleChainEnd(ft(l,"output")))}getGraph(e){const r=new Yx;let n=null;return this.steps.forEach((i,s)=>{const a=i.getGraph(e);s!==0&&a.trimFirstNode(),s!==this.steps.length-1&&a.trimLastNode(),r.extend(a);const o=a.firstNode();if(!o)throw new Error(`Runnable ${i} has no first node`);n&&r.addEdge(n,o),n=a.lastNode()}),r}pipe(e){return Bt.isRunnableSequence(e)?new Bt({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new Bt({first:this.first,middle:[...this.middle,this.last],last:On(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&xe.isRunnable(e)}static from([e,...r],n){return new Bt({first:On(e),middle:r.slice(0,-1).map(On),last:On(r[r.length-1]),name:n})}}class Si extends xe{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[r,n]of Object.entries(e.steps))this.steps[r]=On(n)}static from(e){return new Si({steps:e})}async invoke(e,r){const n=Pe(r),i=await Pr(n),s=await(i==null?void 0:i.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;const a={};try{await Promise.all(Object.entries(this.steps).map(async([o,u])=>{a[o]=await u.invoke(e,Ke(n,{callbacks:s==null?void 0:s.getChild(`map:key:${o}`)}))}))}catch(o){throw await(s==null?void 0:s.handleChainError(o)),o}return await(s==null?void 0:s.handleChainEnd(a)),a}async*_transform(e,r,n){const i={...this.steps},s=fb(e,Object.keys(i).length),a=new Map(Object.entries(i).map(([o,u],l)=>{const c=u.transform(s[l],Ke(n,{callbacks:r==null?void 0:r.getChild(`map:key:${o}`)}));return[o,c.next().then(h=>({key:o,gen:c,result:h}))]}));for(;a.size;){const{key:o,result:u,gen:l}=await Promise.race(a.values());a.delete(o),u.done||(yield{[o]:u.value},a.set(o,l.next().then(c=>({key:o,gen:l,result:c}))))}}transform(e,r){return this._transformStreamWithConfig(e,this._transform.bind(this),r)}async stream(e,r){async function*n(){yield e}const i=Pe(r),s=new ua({generator:this.transform(n(),i),config:i});return await s.setup,Gt.fromAsyncGenerator(s)}}let oM=class Qx extends xe{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!ob(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,r){const[n]=this._getOptionsList(r??{},1),i=await Pr(n);return await this.func(Ke(n,{callbacks:i}),e)}async*_streamIterator(e,r){const n=await this.invoke(e,r);if(Pg(n)){for await(const i of n)yield i;return}if(aM(n)){for(;;){const i=n.next();if(i.done)break;yield i.value}return}yield n}static from(e){return new Qx({func:e})}};function uM(t){if(ob(t))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class xi extends xe{static lc_name(){return"RunnableLambda"}constructor(e){if(ob(e.func))return oM.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),uM(e.func),this.func=e.func}static from(e){return new xi({func:e})}async _invoke(e,r,n){return new Promise((i,s)=>{const a=Ke(r,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??Mp)-1});Ws.getInstance().run(a,async()=>{try{let o=await this.func(e,{...a,config:a});if(o&&xe.isRunnable(o)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");o=await o.invoke(e,{...a,recursionLimit:(a.recursionLimit??Mp)-1})}else if(Pg(o)){let u;for await(const l of G_(a,o))if(u===void 0)u=l;else try{u=nr(u,l)}catch{u=l}o=u}else if(W_(o)){let u;for(const l of J_(a,o))if(u===void 0)u=l;else try{u=nr(u,l)}catch{u=l}o=u}i(o)}catch(o){s(o)}})})}async invoke(e,r){return this._callWithConfig(this._invoke,e,r)}async*_transform(e,r,n){let i;for await(const a of e)if(i===void 0)i=a;else try{i=nr(i,a)}catch{i=a}const s=await new Promise((a,o)=>{Ws.getInstance().run(n,async()=>{try{const u=await this.func(i,{...n,config:n});a(u)}catch(u){o(u)}})});if(s&&xe.isRunnable(s)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");const a=await s.stream(i,Ke(n,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((n==null?void 0:n.recursionLimit)??Mp)-1}));for await(const o of a)yield o}else if(Pg(s))for await(const a of G_(n,s))yield a;else if(W_(s))for(const a of J_(n,s))yield a;else yield s}transform(e,r){return this._transformStreamWithConfig(e,this._transform.bind(this),r)}async stream(e,r){async function*n(){yield e}const i=Pe(r),s=new ua({generator:this.transform(n(),i),config:i});return await s.setup,Gt.fromAsyncGenerator(s)}}class Xx extends Si{}class gb extends xe{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,r){const n=await et.configure(r==null?void 0:r.callbacks,void 0,r==null?void 0:r.tags,void 0,r==null?void 0:r.metadata),{runId:i,...s}=r??{},a=await(n==null?void 0:n.handleChainStart(this.toJSON(),ft(e,"input"),i,void 0,void 0,void 0,s==null?void 0:s.runName));let o;for(const u of this.runnables())try{const l=await u.invoke(e,Ke(s,{callbacks:a==null?void 0:a.getChild()}));return await(a==null?void 0:a.handleChainEnd(ft(l,"output"))),l}catch(l){o===void 0&&(o=l)}throw o===void 0?new Error("No error stored at end of fallback."):(await(a==null?void 0:a.handleChainError(o)),o)}async batch(e,r,n){if(n!=null&&n.returnExceptions)throw new Error("Not implemented.");const i=this._getOptionsList(r??{},e.length),s=await Promise.all(i.map(u=>et.configure(u==null?void 0:u.callbacks,void 0,u==null?void 0:u.tags,void 0,u==null?void 0:u.metadata))),a=await Promise.all(s.map(async(u,l)=>{const c=await(u==null?void 0:u.handleChainStart(this.toJSON(),ft(e[l],"input"),i[l].runId,void 0,void 0,void 0,i[l].runName));return delete i[l].runId,c}));let o;for(const u of this.runnables())try{const l=await u.batch(e,a.map((c,h)=>Ke(i[h],{callbacks:c==null?void 0:c.getChild()})),n);return await Promise.all(a.map((c,h)=>c==null?void 0:c.handleChainEnd(ft(l[h],"output")))),l}catch(l){o===void 0&&(o=l)}throw o?(await Promise.all(a.map(u=>u==null?void 0:u.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function On(t){if(typeof t=="function")return new xi({func:t});if(xe.isRunnable(t))return t;if(!Array.isArray(t)&&typeof t=="object"){const e={};for(const[r,n]of Object.entries(t))e[r]=On(n);return new Si({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class wf extends xe{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Si&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,r){const n=await this.mapper.invoke(e,r);return{...e,...n}}async*_transform(e,r,n){const i=this.mapper.getStepsKeys(),[s,a]=fb(e),o=this.mapper.transform(a,Ke(n,{callbacks:r==null?void 0:r.getChild()})),u=o.next();for await(const l of s){if(typeof l!="object"||Array.isArray(l))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof l}`);const c=Object.fromEntries(Object.entries(l).filter(([h])=>!i.includes(h)));Object.keys(c).length>0&&(yield c)}yield(await u).value;for await(const l of o)yield l}transform(e,r){return this._transformStreamWithConfig(e,this._transform.bind(this),r)}async stream(e,r){async function*n(){yield e}const i=Pe(r),s=new ua({generator:this.transform(n(),i),config:i});return await s.setup,Gt.fromAsyncGenerator(s)}}class vf extends xe{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const r=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return r.length===0?void 0:Object.fromEntries(r)}}async invoke(e,r){return this._callWithConfig(this._pick.bind(this),e,r)}async*_transform(e){for await(const r of e){const n=await this._pick(r);n!==void 0&&(yield n)}}transform(e,r){return this._transformStreamWithConfig(e,this._transform.bind(this),r)}async stream(e,r){async function*n(){yield e}const i=Pe(r),s=new ua({generator:this.transform(n(),i),config:i});return await s.setup,Gt.fromAsyncGenerator(s)}}const _f=t=>t.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":t.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":t.startsWith("gpt-4-32k")?"gpt-4-32k":t.startsWith("gpt-4-")?"gpt-4":t.startsWith("gpt-4o")?"gpt-4o":t,eE=t=>{switch(t){case"text-embedding-ada-002":return 8191;default:return 2046}},yb=t=>{switch(_f(t)){case"gpt-3.5-turbo-16k":return 16384;case"gpt-3.5-turbo":return 4096;case"gpt-4-32k":return 32768;case"gpt-4":return 8192;case"text-davinci-003":return 4097;case"text-curie-001":return 2048;case"text-babbage-001":return 2048;case"text-ada-001":return 2048;case"code-davinci-002":return 8e3;case"code-cushman-001":return 2048;default:return 4097}},tE=async({prompt:t,modelName:e})=>{let r;try{r=(await db(_f(e))).encode(t).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),r=Math.ceil(t.length/4)}return yb(e)-r},lM=()=>!1;class Pf extends xe{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??lM(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class Of extends Pf{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:r,...n}){super({callbacks:e??r,...n}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n.cache=="object"?this.cache=n.cache:n.cache?this.cache=ff.global():this.cache=void 0,this.caller=new oa(n??{})}async getNumTokens(e){if(typeof e!="string")return 0;let r=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await db("modelName"in this?_f(this.modelName):"gpt2")}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}if(this._encoding)try{r=this._encoding.encode(e).length}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}return r}static _convertInputToPromptValue(e){return typeof e=="string"?new So(e):Array.isArray(e)?new mf(e.map(Ts)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...r}){const n={...this._identifyingParams(),...r,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([a,o])=>o!==void 0).map(([a,o])=>`${a}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}const cM=Object.freeze(Object.defineProperty({__proto__:null,BaseLangChain:Pf,BaseLanguageModel:Of,calculateMaxTokens:tE,getEmbeddingContextSize:eE,getModelContextSize:yb,getModelNameForTiktoken:_f},Symbol.toStringTag,{value:"Module"}));class Qh extends Error{constructor(e,r){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=r}}class ys extends Pf{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1})}async invoke(e,r){return this.call(e,Pe(r))}async call(e,r,n){let i;try{i=await this.schema.parseAsync(e)}catch{throw new Qh("Received tool input did not match expected schema",JSON.stringify(e))}const s=Oo(r),a=await et.configure(s.callbacks,this.callbacks,s.tags||n,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),o=await(a==null?void 0:a.handleToolStart(this.toJSON(),typeof i=="string"?i:JSON.stringify(i),s.runId,void 0,void 0,void 0,s.runName));delete s.runId;let u;try{u=await this._call(i,o,s)}catch(l){throw await(o==null?void 0:o.handleToolError(l)),l}return await(o==null?void 0:o.handleToolEnd(u)),u}}class Ei extends ys{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:Ce.object({input:Ce.string().optional()}).transform(r=>r.input)})}call(e,r){return super.call(typeof e=="string"||!e?{input:e}:e,r)}}class zl extends Ei{static lc_name(){return"DynamicTool"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect}async call(e,r){const n=Oo(r);return n.runName===void 0&&(n.runName=this.name),super.call(e,n)}async _call(e,r,n){return this.func(e,r,n)}}class Sf extends ys{static lc_name(){return"DynamicStructuredTool"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}async call(e,r,n){const i=Oo(r);return i.runName===void 0&&(i.runName=this.name),super.call(e,i,n)}_call(e,r,n){return this.func(e,r,n)}}class xo{getTools(){return this.tools}}const hM=Object.freeze(Object.defineProperty({__proto__:null,BaseToolkit:xo,DynamicStructuredTool:Sf,DynamicTool:zl,StructuredTool:ys,Tool:Ei,ToolInputParsingException:Qh},Symbol.toStringTag,{value:"Module"}));class rE extends zl{static lc_name(){return"ChainTool"}constructor({chain:e,...r}){super({...r,func:async(n,i)=>e.run(n,i==null?void 0:i.getChild())}),Object.defineProperty(this,"chain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chain=e}}const dM=Object.freeze(Object.defineProperty({__proto__:null,ChainTool:rE},Symbol.toStringTag,{value:"Module"}));var fl={},fM=/~/,pM=/~[01]/g;function mM(t){switch(t){case"~1":return"/";case"~0":return"~"}throw new Error("Invalid tilde escape: "+t)}function nE(t){return fM.test(t)?t.replace(pM,mM):t}function gM(t,e,r){for(var n,i,s=1,a=e.length;s<a;){if(e[s]==="constructor"||e[s]==="prototype"||e[s]==="__proto__")return t;if(n=nE(e[s++]),i=a>s,typeof t[n]>"u"&&(Array.isArray(t)&&n==="-"&&(n=t.length),i&&(e[s]!==""&&e[s]<1/0||e[s]==="-"?t[n]=[]:t[n]={})),!i)break;t=t[n]}var o=t[n];return r===void 0?delete t[n]:t[n]=r,o}function bb(t){if(typeof t=="string"){if(t=t.split("/"),t[0]==="")return t;throw new Error("Invalid JSON pointer.")}else if(Array.isArray(t)){for(const e of t)if(typeof e!="string"&&typeof e!="number")throw new Error("Invalid JSON pointer. Must be of type string or number.");return t}throw new Error("Invalid JSON pointer.")}function iE(t,e){if(typeof t!="object")throw new Error("Invalid input object.");e=bb(e);var r=e.length;if(r===1)return t;for(var n=1;n<r;){if(t=t[nE(e[n++])],r===n)return t;if(typeof t!="object"||t===null)return}}function sE(t,e,r){if(typeof t!="object")throw new Error("Invalid input object.");if(e=bb(e),e.length===0)throw new Error("Invalid JSON pointer for set.");return gM(t,e,r)}function yM(t){var e=bb(t);return{get:function(r){return iE(r,e)},set:function(r,n){return sE(r,e,n)}}}fl.get=iE;fl.set=sE;fl.compile=yM;class bM extends St{constructor(e,r=4e3){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","tools","json"]}),Object.defineProperty(this,"obj",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxValueLength",{enumerable:!0,configurable:!0,writable:!0,value:4e3}),this.obj=e,this.maxValueLength=r}getKeys(e){const n=fl.compile(e).get(this.obj);if(typeof n=="object"&&!Array.isArray(n)&&n!==null)return Object.keys(n).map(i=>i.replaceAll("~","~0").replaceAll("/","~1")).join(", ");throw new Error(`Value at ${e} is not a dictionary, get the value directly instead.`)}getValue(e){const n=fl.compile(e).get(this.obj);if(n==null)throw new Error(`Value at ${e} is null or undefined.`);const i=typeof n=="object"?JSON.stringify(n):n.toString();return typeof n=="object"&&!Array.isArray(n)&&i.length>this.maxValueLength?"Value is a large dictionary, should explore its keys directly.":i.length>this.maxValueLength?`${i.slice(0,this.maxValueLength)}...`:i}}class aE extends Ei{static lc_name(){return"JsonListKeysTool"}constructor(e){"jsonSpec"in e||(e={jsonSpec:e}),super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"json_list_keys"}),Object.defineProperty(this,"jsonSpec",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:`Can be used to list all keys at a given path.
    Before calling this you should be SURE that the path to this exists.
    The input is a text representation of the path to the json as json pointer syntax (e.g. /key1/0/key2).`}),this.jsonSpec=e.jsonSpec}async _call(e){try{return this.jsonSpec.getKeys(e)}catch(r){return`${r}`}}}class oE extends Ei{static lc_name(){return"JsonGetValueTool"}constructor(e){super(),Object.defineProperty(this,"jsonSpec",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"json_get_value"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:`Can be used to see value in string format at a given path.
    Before calling this you should be SURE that the path to this exists.
    The input is a text representation of the path to the json as json pointer syntax (e.g. /key1/0/key2).`})}async _call(e){try{return this.jsonSpec.getValue(e)}catch(r){return`${r}`}}}class uE extends Ei{static lc_name(){return"RequestsGetTool"}constructor(e={},{maxOutputLength:r}={}){super(...arguments),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"requests_get"}),Object.defineProperty(this,"maxOutputLength",{enumerable:!0,configurable:!0,writable:!0,value:2e3}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:`A portal to the internet. Use this when you need to get specific content from a website.
  Input should be a url string (i.e. "https://www.google.com"). The output will be the text response of the GET request.`}),this.maxOutputLength=r??this.maxOutputLength}async _call(e){return(await(await fetch(e,{headers:this.headers})).text()).slice(0,this.maxOutputLength)}}class lE extends Ei{static lc_name(){return"RequestsPostTool"}constructor(e={},{maxOutputLength:r}={}){super(...arguments),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"requests_post"}),Object.defineProperty(this,"maxOutputLength",{enumerable:!0,configurable:!0,writable:!0,value:1/0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:`Use this when you want to POST to a website.
  Input should be a json string with two keys: "url" and "data".
  The value of "url" should be a string, and the value of "data" should be a dictionary of
  key-value pairs you want to POST to the url as a JSON body.
  Be careful to always use double quotes for strings in the json string
  The output will be the text response of the POST request.`}),this.maxOutputLength=r??this.maxOutputLength}async _call(e){try{const{url:r,data:n}=JSON.parse(e);return(await(await fetch(r,{method:"POST",headers:this.headers,body:JSON.stringify(n)})).text()).slice(0,this.maxOutputLength)}catch(r){return`${r}`}}}const wM="modulepreload",vM=function(t){return"/"+t},Z_={},Hr=function(e,r,n){let i=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));i=Promise.all(r.map(o=>{if(o=vM(o),o in Z_)return;Z_[o]=!0;const u=o.endsWith(".css"),l=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${l}`))return;const c=document.createElement("link");if(c.rel=u?"stylesheet":wM,u||(c.as="script",c.crossOrigin=""),c.href=o,a&&c.setAttribute("nonce",a),document.head.appendChild(c),u)return new Promise((h,d)=>{c.addEventListener("load",h),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${o}`)))})}))}return i.then(()=>e()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})};class Sr extends xe{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,r){const n=Pe(r);return this.func&&await this.func(e,n),this._callWithConfig(i=>Promise.resolve(i),e,n)}async*transform(e,r){const n=Pe(r);let i,s=!0;for await(const a of this._transformStreamWithConfig(e,o=>o,n))if(yield a,s)if(i===void 0)i=a;else try{i=nr(i,a)}catch{i=void 0,s=!1}this.func&&i!==void 0&&await this.func(i,n)}static assign(e){return new wf(new Si({steps:e}))}}class cE extends xe{static lc_name(){return"RouterRunnable"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnables=e.runnables}async invoke(e,r){const{key:n,input:i}=e,s=this.runnables[n];if(s===void 0)throw new Error(`No runnable associated with key "${n}".`);return s.invoke(i,Pe(r))}async batch(e,r,n){var d;const i=e.map(f=>f.key),s=e.map(f=>f.input);if(i.find(f=>this.runnables[f]===void 0)!==void 0)throw new Error("One or more keys do not have a corresponding runnable.");const o=i.map(f=>this.runnables[f]),u=this._getOptionsList(r??{},e.length),l=((d=u[0])==null?void 0:d.maxConcurrency)??(n==null?void 0:n.maxConcurrency),c=l&&l>0?l:e.length,h=[];for(let f=0;f<s.length;f+=c){const p=s.slice(f,f+c).map((v,g)=>o[g].invoke(v,u[g])),y=await Promise.all(p);h.push(y)}return h.flat()}async stream(e,r){const{key:n,input:i}=e,s=this.runnables[n];if(s===void 0)throw new Error(`No runnable associated with key "${n}".`);return s.stream(i,r)}}class wb extends xe{static lc_name(){return"RunnableBranch"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"default",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"branches",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.branches=e.branches,this.default=e.default}static from(e){if(e.length<1)throw new Error("RunnableBranch requires at least one branch");const n=e.slice(0,-1).map(([s,a])=>[On(s),On(a)]),i=On(e[e.length-1]);return new this({branches:n,default:i})}async _invoke(e,r,n){let i;for(let s=0;s<this.branches.length;s+=1){const[a,o]=this.branches[s];if(await a.invoke(e,Ke(r,{callbacks:n==null?void 0:n.getChild(`condition:${s+1}`)}))){i=await o.invoke(e,Ke(r,{callbacks:n==null?void 0:n.getChild(`branch:${s+1}`)}));break}}return i||(i=await this.default.invoke(e,Ke(r,{callbacks:n==null?void 0:n.getChild("branch:default")}))),i}async invoke(e,r={}){return this._callWithConfig(this._invoke,e,r)}async*_streamIterator(e,r){const n=await Pr(r),i=await(n==null?void 0:n.handleChainStart(this.toJSON(),ft(e,"input"),r==null?void 0:r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));let s,a=!0,o;try{for(let u=0;u<this.branches.length;u+=1){const[l,c]=this.branches[u];if(await l.invoke(e,Ke(r,{callbacks:i==null?void 0:i.getChild(`condition:${u+1}`)}))){o=await c.stream(e,Ke(r,{callbacks:i==null?void 0:i.getChild(`branch:${u+1}`)}));for await(const d of o)if(yield d,a)if(s===void 0)s=d;else try{s=nr(s,d)}catch{s=void 0,a=!1}break}}if(o===void 0){o=await this.default.stream(e,Ke(r,{callbacks:i==null?void 0:i.getChild("branch:default")}));for await(const u of o)if(yield u,a)if(s===void 0)s=u;else try{s=nr(s,u)}catch{s=void 0,a=!1}}}catch(u){throw await(i==null?void 0:i.handleChainError(u)),u}await(i==null?void 0:i.handleChainEnd(s??{}))}}class hE extends pi{constructor(e){let r=new xi({func:(a,o)=>this._enterHistory(a,o??{})}).withConfig({runName:"loadHistory"});const n=e.historyMessagesKey??e.inputMessagesKey;n&&(r=Sr.assign({[n]:r}).withConfig({runName:"insertHistory"}));const i=r.pipe(e.runnable.withListeners({onEnd:(a,o)=>this._exitHistory(a,o??{})})).withConfig({runName:"RunnableWithMessageHistory"}),s=e.config??{};super({...e,config:s,bound:i}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"historyMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getMessageHistory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){let r;if(typeof e=="object"&&!Array.isArray(e)&&!Vt(e)){let n;this.inputMessagesKey?n=this.inputMessagesKey:Object.keys(e).length===1?n=Object.keys(e)[0]:n="input",Array.isArray(e[n])&&Array.isArray(e[n][0])?r=e[n][0]:r=e[n]}else r=e;if(typeof r=="string")return[new ut(r)];if(Array.isArray(r))return r;if(Vt(r))return[r];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages.
Got ${JSON.stringify(r,null,2)}`)}_getOutputMessages(e){let r;if(!Array.isArray(e)&&!Vt(e)&&typeof e!="string"){let n;this.outputMessagesKey!==void 0?n=this.outputMessagesKey:Object.keys(e).length===1?n=Object.keys(e)[0]:n="output",e.generations!==void 0?r=e.generations[0][0].message:r=e[n]}else r=e;if(typeof r=="string")return[new Fe(r)];if(Array.isArray(r))return r;if(Vt(r))return[r];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(r,null,2)}`)}async _enterHistory(e,r){var s,a;const i=await((a=(s=r==null?void 0:r.config)==null?void 0:s.configurable)==null?void 0:a.messageHistory).getMessages();return this.historyMessagesKey===void 0?i.concat(this._getInputMessages(e)):i}async _exitHistory(e,r){var u;const n=(u=r.configurable)==null?void 0:u.messageHistory;let i;Array.isArray(e.inputs)&&Array.isArray(e.inputs[0])?i=e.inputs[0]:i=e.inputs;let s=this._getInputMessages(i);if(this.historyMessagesKey===void 0){const l=await n.getMessages();s=s.slice(l.length)}const a=e.outputs;if(!a)throw new Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);const o=this._getOutputMessages(a);await n.addMessages([...s,...o])}async _mergeConfig(...e){const r=await super._mergeConfig(...e);if(!r.configurable||!r.configurable.sessionId){const i={[this.inputMessagesKey??"input"]:"foo"},s={configurable:{sessionId:"123"}};throw new Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(i)}, ${JSON.stringify(s)})`)}const{sessionId:n}=r.configurable;return r.configurable.messageHistory=await this.getMessageHistory(n),r}}const _M=Object.freeze(Object.defineProperty({__proto__:null,RouterRunnable:cE,Runnable:xe,RunnableAssign:wf,RunnableBinding:pi,RunnableBranch:wb,RunnableEach:co,RunnableLambda:xi,RunnableMap:Si,RunnableParallel:Xx,RunnablePassthrough:Sr,RunnablePick:vf,RunnableRetry:mb,RunnableSequence:Bt,RunnableWithFallbacks:gb,RunnableWithMessageHistory:hE,_coerceToRunnable:On,ensureConfig:Pe,getCallbackManagerForConfig:Pr,mergeConfigs:_g,patchConfig:Ke},Symbol.toStringTag,{value:"Module"}));class Ae extends Pf{get lc_namespace(){return["langchain","chains",this._chainType()]}constructor(e,r,n){if(arguments.length===1&&typeof e=="object"&&!("saveContext"in e)){const{memory:i,callbackManager:s,...a}=e;super({...a,callbacks:s??a.callbacks}),this.memory=i}else super({verbose:r,callbacks:n}),this.memory=e}_selectMemoryInputs(e){const r={...e};return"signal"in r&&delete r.signal,"timeout"in r&&delete r.timeout,r}async invoke(e,r){const n=Pe(r),i=await this._formatValues(e),s=await et.configure(n==null?void 0:n.callbacks,this.callbacks,n==null?void 0:n.tags,this.tags,n==null?void 0:n.metadata,this.metadata,{verbose:this.verbose}),a=await(s==null?void 0:s.handleChainStart(this.toJSON(),i,void 0,void 0,void 0,void 0,n==null?void 0:n.runName));let o;try{o=await(i.signal?Promise.race([this._call(i,a,n),new Promise((u,l)=>{var c;(c=i.signal)==null||c.addEventListener("abort",()=>{l(new Error("AbortError"))})})]):this._call(i,a,n))}catch(u){throw await(a==null?void 0:a.handleChainError(u)),u}return this.memory!=null&&await this.memory.saveContext(this._selectMemoryInputs(e),o),await(a==null?void 0:a.handleChainEnd(o)),Object.defineProperty(o,Pt,{value:a?{runId:a==null?void 0:a.runId}:void 0,configurable:!0}),o}_validateOutputs(e){const r=this.outputKeys.filter(n=>!(n in e));if(r.length)throw new Error(`Missing output keys: ${r.join(", ")} from chain ${this._chainType()}`)}async prepOutputs(e,r,n=!1){return this._validateOutputs(r),this.memory&&await this.memory.saveContext(e,r),n?r:{...e,...r}}serialize(){throw new Error("Method not implemented.")}async run(e,r){const n=this.inputKeys.filter(u=>{var l;return!((l=this.memory)!=null&&l.memoryKeys.includes(u))});if(!(n.length<=1))throw new Error(`Chain ${this._chainType()} expects multiple inputs, cannot use 'run' `);const s=n.length?{[n[0]]:e}:{},a=await this.call(s,r),o=Object.keys(a);if(o.length===1)return a[o[0]];throw new Error("return values have multiple keys, `run` only supported when one key currently")}async _formatValues(e){const r={...e};if(r.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout),delete r.timeout),this.memory!=null){const n=await this.memory.loadMemoryVariables(this._selectMemoryInputs(e));for(const[i,s]of Object.entries(n))r[i]=s}return r}async call(e,r,n){const i={tags:n,...Oo(r)};return this.invoke(e,i)}async apply(e,r){return Promise.all(e.map(async(n,i)=>this.call(n,r==null?void 0:r[i])))}static async deserialize(e,r={}){switch(e._type){case"llm_chain":{const{LLMChain:n}=await Hr(()=>Promise.resolve().then(()=>D2),void 0);return n.deserialize(e)}case"sequential_chain":{const{SequentialChain:n}=await Hr(()=>Promise.resolve().then(()=>T0),void 0);return n.deserialize(e)}case"simple_sequential_chain":{const{SimpleSequentialChain:n}=await Hr(()=>Promise.resolve().then(()=>T0),void 0);return n.deserialize(e)}case"stuff_documents_chain":{const{StuffDocumentsChain:n}=await Hr(()=>Promise.resolve().then(()=>zp),void 0);return n.deserialize(e)}case"map_reduce_documents_chain":{const{MapReduceDocumentsChain:n}=await Hr(()=>Promise.resolve().then(()=>zp),void 0);return n.deserialize(e)}case"refine_documents_chain":{const{RefineDocumentsChain:n}=await Hr(()=>Promise.resolve().then(()=>zp),void 0);return n.deserialize(e)}case"vector_db_qa":{const{VectorDBQAChain:n}=await Hr(()=>Promise.resolve().then(()=>mF),void 0);return n.deserialize(e,r)}case"api_chain":{const{APIChain:n}=await Hr(()=>Promise.resolve().then(()=>fq),void 0);return n.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class Eo extends xe{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:r}=e;if(r.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const r=this.partialVariables??{},n={};for(const[s,a]of Object.entries(r))typeof a=="string"?n[s]=a:n[s]=await a();return{...n,...e}}async invoke(e,r){return this._callWithConfig(n=>this.formatPromptValue(n),e,{...r,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:r}=await Hr(()=>Promise.resolve().then(()=>X_),void 0);return r.deserialize(e)}case void 0:{const{PromptTemplate:r}=await Hr(()=>Promise.resolve().then(()=>X_),void 0);return r.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:r}=await Hr(()=>Promise.resolve().then(()=>qM),void 0);return r.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class pl extends Eo{async formatPromptValue(e){const r=await this.format(e);return new So(r)}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var PM=Object.prototype.toString,To=Array.isArray||function(e){return PM.call(e)==="[object Array]"};function vb(t){return typeof t=="function"}function OM(t){return To(t)?"array":typeof t}function Fp(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Y_(t,e){return t!=null&&typeof t=="object"&&e in t}function SM(t,e){return t!=null&&typeof t!="object"&&t.hasOwnProperty&&t.hasOwnProperty(e)}var xM=RegExp.prototype.test;function EM(t,e){return xM.call(t,e)}var TM=/\S/;function AM(t){return!EM(TM,t)}var kM={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function IM(t){return String(t).replace(/[&<>"'`=\/]/g,function(r){return kM[r]})}var CM=/\s*/,RM=/\s+/,Q_=/\s*=/,jM=/\s*\}/,NM=/#|\^|\/|>|\{|&|=|!/;function $M(t,e){if(!t)return[];var r=!1,n=[],i=[],s=[],a=!1,o=!1,u="",l=0;function c(){if(a&&!o)for(;s.length;)delete i[s.pop()];else s=[];a=!1,o=!1}var h,d,f;function p(P){if(typeof P=="string"&&(P=P.split(RM,2)),!To(P)||P.length!==2)throw new Error("Invalid tags: "+P);h=new RegExp(Fp(P[0])+"\\s*"),d=new RegExp("\\s*"+Fp(P[1])),f=new RegExp("\\s*"+Fp("}"+P[1]))}p(e||Dr.tags);for(var y=new Ul(t),v,g,m,b,S,E;!y.eos();){if(v=y.pos,m=y.scanUntil(h),m)for(var I=0,j=m.length;I<j;++I)b=m.charAt(I),AM(b)?(s.push(i.length),u+=b):(o=!0,r=!0,u+=" "),i.push(["text",b,v,v+1]),v+=1,b===`
`&&(c(),u="",l=0,r=!1);if(!y.scan(h))break;if(a=!0,g=y.scan(NM)||"name",y.scan(CM),g==="="?(m=y.scanUntil(Q_),y.scan(Q_),y.scanUntil(d)):g==="{"?(m=y.scanUntil(f),y.scan(jM),y.scanUntil(d),g="&"):m=y.scanUntil(d),!y.scan(d))throw new Error("Unclosed tag at "+y.pos);if(g==">"?S=[g,m,v,y.pos,u,l,r]:S=[g,m,v,y.pos],l++,i.push(S),g==="#"||g==="^")n.push(S);else if(g==="/"){if(E=n.pop(),!E)throw new Error('Unopened section "'+m+'" at '+v);if(E[1]!==m)throw new Error('Unclosed section "'+E[1]+'" at '+v)}else g==="name"||g==="{"||g==="&"?o=!0:g==="="&&p(m)}if(c(),E=n.pop(),E)throw new Error('Unclosed section "'+E[1]+'" at '+y.pos);return DM(LM(i))}function LM(t){for(var e=[],r,n,i=0,s=t.length;i<s;++i)r=t[i],r&&(r[0]==="text"&&n&&n[0]==="text"?(n[1]+=r[1],n[3]=r[3]):(e.push(r),n=r));return e}function DM(t){for(var e=[],r=e,n=[],i,s,a=0,o=t.length;a<o;++a)switch(i=t[a],i[0]){case"#":case"^":r.push(i),n.push(i),r=i[4]=[];break;case"/":s=n.pop(),s[5]=i[2],r=n.length>0?n[n.length-1][4]:e;break;default:r.push(i)}return e}function Ul(t){this.string=t,this.tail=t,this.pos=0}Ul.prototype.eos=function(){return this.tail===""};Ul.prototype.scan=function(e){var r=this.tail.match(e);if(!r||r.index!==0)return"";var n=r[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n};Ul.prototype.scanUntil=function(e){var r=this.tail.search(e),n;switch(r){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,r),this.tail=this.tail.substring(r)}return this.pos+=n.length,n};function ho(t,e){this.view=t,this.cache={".":this.view},this.parent=e}ho.prototype.push=function(e){return new ho(e,this)};ho.prototype.lookup=function(e){var r=this.cache,n;if(r.hasOwnProperty(e))n=r[e];else{for(var i=this,s,a,o,u=!1;i;){if(e.indexOf(".")>0)for(s=i.view,a=e.split("."),o=0;s!=null&&o<a.length;)o===a.length-1&&(u=Y_(s,a[o])||SM(s,a[o])),s=s[a[o++]];else s=i.view[e],u=Y_(i.view,e);if(u){n=s;break}i=i.parent}r[e]=n}return vb(n)&&(n=n.call(this.view)),n};function lr(){this.templateCache={_cache:{},set:function(e,r){this._cache[e]=r},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}lr.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};lr.prototype.parse=function(e,r){var n=this.templateCache,i=e+":"+(r||Dr.tags).join(":"),s=typeof n<"u",a=s?n.get(i):void 0;return a==null&&(a=$M(e,r),s&&n.set(i,a)),a};lr.prototype.render=function(e,r,n,i){var s=this.getConfigTags(i),a=this.parse(e,s),o=r instanceof ho?r:new ho(r,void 0);return this.renderTokens(a,o,n,e,i)};lr.prototype.renderTokens=function(e,r,n,i,s){for(var a="",o,u,l,c=0,h=e.length;c<h;++c)l=void 0,o=e[c],u=o[0],u==="#"?l=this.renderSection(o,r,n,i,s):u==="^"?l=this.renderInverted(o,r,n,i,s):u===">"?l=this.renderPartial(o,r,n,s):u==="&"?l=this.unescapedValue(o,r):u==="name"?l=this.escapedValue(o,r,s):u==="text"&&(l=this.rawValue(o)),l!==void 0&&(a+=l);return a};lr.prototype.renderSection=function(e,r,n,i,s){var a=this,o="",u=r.lookup(e[1]);function l(d){return a.render(d,r,n,s)}if(u){if(To(u))for(var c=0,h=u.length;c<h;++c)o+=this.renderTokens(e[4],r.push(u[c]),n,i,s);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")o+=this.renderTokens(e[4],r.push(u),n,i,s);else if(vb(u)){if(typeof i!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(r.view,i.slice(e[3],e[5]),l),u!=null&&(o+=u)}else o+=this.renderTokens(e[4],r,n,i,s);return o}};lr.prototype.renderInverted=function(e,r,n,i,s){var a=r.lookup(e[1]);if(!a||To(a)&&a.length===0)return this.renderTokens(e[4],r,n,i,s)};lr.prototype.indentPartial=function(e,r,n){for(var i=r.replace(/[^ \t]/g,""),s=e.split(`
`),a=0;a<s.length;a++)s[a].length&&(a>0||!n)&&(s[a]=i+s[a]);return s.join(`
`)};lr.prototype.renderPartial=function(e,r,n,i){if(n){var s=this.getConfigTags(i),a=vb(n)?n(e[1]):n[e[1]];if(a!=null){var o=e[6],u=e[5],l=e[4],c=a;u==0&&l&&(c=this.indentPartial(a,l,o));var h=this.parse(c,s);return this.renderTokens(h,r,n,c,i)}}};lr.prototype.unescapedValue=function(e,r){var n=r.lookup(e[1]);if(n!=null)return n};lr.prototype.escapedValue=function(e,r,n){var i=this.getConfigEscape(n)||Dr.escape,s=r.lookup(e[1]);if(s!=null)return typeof s=="number"&&i===Dr.escape?String(s):i(s)};lr.prototype.rawValue=function(e){return e[1]};lr.prototype.getConfigTags=function(e){return To(e)?e:e&&typeof e=="object"?e.tags:void 0};lr.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!To(e))return e.escape};var Dr={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){ml.templateCache=t},get templateCache(){return ml.templateCache}},ml=new lr;Dr.clearCache=function(){return ml.clearCache()};Dr.parse=function(e,r){return ml.parse(e,r)};Dr.render=function(e,r,n,i){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+OM(e)+'" was given as the first argument for mustache#render(template, view, partials)');return ml.render(e,r,n,i)};Dr.escape=IM;Dr.Scanner=Ul;Dr.Context=ho;Dr.Writer=lr;const gl=t=>{const e=t.split(""),r=[],n=(s,a)=>{for(let o=a;o<e.length;o+=1)if(s.includes(e[o]))return o;return-1};let i=0;for(;i<e.length;)if(e[i]==="{"&&i+1<e.length&&e[i+1]==="{")r.push({type:"literal",text:"{"}),i+=2;else if(e[i]==="}"&&i+1<e.length&&e[i+1]==="}")r.push({type:"literal",text:"}"}),i+=2;else if(e[i]==="{"){const s=n("}",i);if(s<0)throw new Error("Unclosed '{' in template.");r.push({type:"variable",name:e.slice(i+1,s).join("")}),i=s+1}else{if(e[i]==="}")throw new Error("Single '}' in template.");{const s=n("{}",i),a=(s<0?e.slice(i):e.slice(i,s)).join("");r.push({type:"literal",text:a}),i=s<0?e.length:s}}return r},MM=t=>t.map(e=>e[0]==="name"?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:e[0]==="#"?{type:"variable",name:e[1]}:{type:"literal",text:e[1]}),Xh=t=>{const e=Dr.parse(t);return MM(e)},xf=(t,e)=>gl(t).reduce((r,n)=>{if(n.type==="variable"){if(n.name in e)return r+e[n.name];throw new Error(`(f-string) Missing value for input ${n.name}`)}return r+n.text},""),dE=(t,e)=>Dr.render(t,e),ed={"f-string":xf,mustache:dE},fE={"f-string":gl,mustache:Xh},Tt=(t,e,r)=>ed[e](t,r),pE=(t,e)=>fE[e](t),ql=(t,e,r)=>{if(!(e in ed)){const n=Object.keys(ed);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${n}`)}try{const n=r.reduce((i,s)=>(i[s]="foo",i),{});Array.isArray(t)?t.forEach(i=>{if(i.type==="text")Tt(i.text,e,n);else if(i.type==="image_url")if(typeof i.image_url=="string")Tt(i.image_url,e,n);else{const s=i.image_url.url;Tt(s,e,n)}else throw new Error(`Invalid message template received. ${JSON.stringify(i,null,2)}`)}):Tt(t,e,n)}catch(n){throw new Error(`Invalid prompt schema: ${n.message}`)}};class W extends pl{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let r=this.inputVariables;this.partialVariables&&(r=r.concat(Object.keys(this.partialVariables))),ql(this.template,this.templateFormat,r)}}_getPromptType(){return"prompt"}async format(e){const r=await this.mergePartialAndUserVariables(e);return Tt(this.template,this.templateFormat,r)}static fromExamples(e,r,n,i=`

`,s=""){const a=[s,...e,r].join(i);return new W({inputVariables:n,template:a})}static fromTemplate(e,r){const{templateFormat:n="f-string",...i}=r??{},s=new Set;return pE(e,n).forEach(a=>{a.type==="variable"&&s.add(a.name)}),new W({inputVariables:[...s],templateFormat:n,template:e,...i})}async partial(e){const r=this.inputVariables.filter(s=>!(s in e)),n={...this.partialVariables??{},...e},i={...this,inputVariables:r,partialVariables:n};return new W(i)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new W({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}const X_=Object.freeze(Object.defineProperty({__proto__:null,PromptTemplate:W},Symbol.toStringTag,{value:"Module"}));class Ns extends Eo{static lc_name(){return"ImagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.template=e.template,this.templateFormat=e.templateFormat??this.templateFormat,this.validateTemplate=e.validateTemplate??this.validateTemplate,this.validateTemplate){let r=this.inputVariables;this.partialVariables&&(r=r.concat(Object.keys(this.partialVariables))),ql([{type:"image_url",image_url:this.template}],this.templateFormat,r)}}_getPromptType(){return"prompt"}async partial(e){const r=this.inputVariables.filter(s=>!(s in e)),n={...this.partialVariables??{},...e},i={...this,inputVariables:r,partialVariables:n};return new Ns(i)}async format(e){const r={};for(const[a,o]of Object.entries(this.template))typeof o=="string"?r[a]=o.replace(/{([^{}]*)}/g,(u,l)=>{const c=e[l];return typeof c=="string"||typeof c=="number"?String(c):u}):r[a]=o;const n=e.url||r.url,i=e.detail||r.detail;if(!n)throw new Error("Must provide either an image URL.");if(typeof n!="string")throw new Error("url must be a string.");const s={url:n};return i&&(s.detail=i),s}async formatPromptValue(e){const r=await this.format(e);return new zx(r)}}class Ef extends xe{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,r){return this._callWithConfig(n=>this.formatMessages(n),e,{...r,runType:"prompt"})}}class Gs extends Ef{static lc_name(){return"MessagesPlaceholder"}constructor(e){typeof e=="string"&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName,this.optional=e.optional??!1}get inputVariables(){return[this.variableName]}validateInputOrThrow(e,r){if(this.optional&&!e)return!1;if(!e){const i=new Error(`Error: Field "${r}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw i.name="InputFormatError",i}let n=!1;if(Array.isArray(e)?n=e.every(i=>Vt(i)):n=Vt(e),!n){const i=typeof e=="string"?e:JSON.stringify(e,null,2),s=new Error(`Error: Field "${r}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: ${i}`);throw s.name="InputFormatError",s}return!0}async formatMessages(e){return this.validateInputOrThrow(e[this.variableName],this.variableName),e[this.variableName]??[]}}class mE extends Ef{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class Tf extends Eo{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const r=await this.formatMessages(e);return new mf(r)}}class _b extends mE{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,r){"prompt"in e||(e={prompt:e,role:r}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new Ur(await this.prompt.format(e),this.role)}static fromTemplate(e,r,n){return new this(W.fromTemplate(e,{templateFormat:n==null?void 0:n.templateFormat}),r)}}class Pb extends Ef{static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(e,r){if("prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,Array.isArray(this.prompt)){let n=[];this.prompt.forEach(i=>{"inputVariables"in i&&(n=n.concat(i.inputVariables))}),this.inputVariables=n}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=r??this.additionalOptions}createMessage(e){const r=this.constructor;if(r._messageClass()){const n=r._messageClass();return new n({content:e})}else if(r.chatMessageClass){const n=r.chatMessageClass();return new n({content:e,role:this.getRoleFromMessageClass(n.lc_name())})}else throw new Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(e,r){if(typeof e=="string")return new this(W.fromTemplate(e,r));const n=[];for(const i of e)if(typeof i=="string"||typeof i=="object"&&"text"in i){let s="";typeof i=="string"?s=i:typeof i.text=="string"&&(s=i.text??""),n.push(W.fromTemplate(s,r))}else if(typeof i=="object"&&"image_url"in i){let s=i.image_url??"",a,o=[];if(typeof s=="string"){let u;(r==null?void 0:r.templateFormat)==="mustache"?u=Xh(s):u=gl(s);const l=u.flatMap(c=>c.type==="variable"?[c.name]:[]);if(((l==null?void 0:l.length)??0)>0){if(l.length>1)throw new Error(`Only one format variable allowed per image template.
Got: ${l}
From: ${s}`);o=[l[0]]}else o=[];s={url:s},a=new Ns({template:s,inputVariables:o})}else if(typeof s=="object"){if("url"in s){let u;(r==null?void 0:r.templateFormat)==="mustache"?u=Xh(s.url):u=gl(s.url),o=u.flatMap(l=>l.type==="variable"?[l.name]:[])}else o=[];a=new Ns({template:s,inputVariables:o})}else throw new Error("Invalid image template");n.push(a)}return new this({prompt:n,additionalOptions:r})}async format(e){if(this.prompt instanceof pl){const r=await this.prompt.format(e);return this.createMessage(r)}else{const r=[];for(const n of this.prompt){let i={};if(!("inputVariables"in n))throw new Error(`Prompt ${n} does not have inputVariables defined.`);for(const s of n.inputVariables)i||(i={[s]:e[s]}),i={...i,[s]:e[s]};if(n instanceof pl){const s=await n.format(i);r.push({type:"text",text:s})}else if(n instanceof Ns){const s=await n.format(i);r.push({type:"image_url",image_url:s})}}return this.createMessage(r)}}async formatMessages(e){return[await this.format(e)]}}class lt extends Pb{static _messageClass(){return ut}static lc_name(){return"HumanMessagePromptTemplate"}}class la extends Pb{static _messageClass(){return Fe}static lc_name(){return"AIMessagePromptTemplate"}}class xr extends Pb{static _messageClass(){return Xr}static lc_name(){return"SystemMessagePromptTemplate"}}function FM(t){return typeof t.formatMessages=="function"}function zM(t,e){if(FM(t)||Vt(t))return t;if(Array.isArray(t)&&t[0]==="placeholder"){const i=t[1];if(typeof i!="string"||i[0]!=="{"||i[i.length-1]!=="}")throw new Error(`Invalid placeholder template: "${t[1]}". Expected a variable name surrounded by curly braces.`);const s=i.slice(1,-1);return new Gs({variableName:s,optional:!0})}const r=Ts(t);let n;if(typeof r.content=="string"?n=r.content:n=r.content.map(i=>"text"in i?{text:i.text}:"image_url"in i?{image_url:i.image_url}:i),r._getType()==="human")return lt.fromTemplate(n,e);if(r._getType()==="ai")return la.fromTemplate(n,e);if(r._getType()==="system")return xr.fromTemplate(n,e);if(Ur.isInstance(r))return _b.fromTemplate(r.content,r.role,e);throw new Error(`Could not coerce message prompt template from input. Received message type: "${r._getType()}".`)}function UM(t){return t.constructor.lc_name()==="MessagesPlaceholder"}class it extends Tf{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){const r=new Set;for(const o of this.promptMessages)if(!(o instanceof $r))for(const u of o.inputVariables)r.add(u);const n=this.inputVariables,i=new Set(this.partialVariables?n.concat(Object.keys(this.partialVariables)):n),s=new Set([...i].filter(o=>!r.has(o)));if(s.size>0)throw new Error(`Input variables \`${[...s]}\` are not used in any of the prompt messages.`);const a=new Set([...r].filter(o=>!i.has(o)));if(a.size>0)throw new Error(`Input variables \`${[...a]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,r){if(typeof e.content=="string")return e;const n=await Promise.all(e.content.map(async i=>{if(i.type!=="image_url")return i;let s="";typeof i.image_url=="string"?s=i.image_url:s=i.image_url.url;const o=await W.fromTemplate(s,{templateFormat:this.templateFormat}).format(r);return typeof i.image_url!="string"&&"url"in i.image_url?i.image_url.url=o:i.image_url=o,i}));return e.content=n,e}async formatMessages(e){const r=await this.mergePartialAndUserVariables(e);let n=[];for(const i of this.promptMessages)if(i instanceof $r)n.push(await this._parseImagePrompts(i,r));else{const s=i.inputVariables.reduce((o,u)=>{if(!(u in r)&&!(UM(i)&&i.optional))throw new Error(`Missing value for input variable \`${u.toString()}\``);return o[u]=r[u],o},{}),a=await i.formatMessages(s);n=n.concat(a)}return n}async partial(e){const r=this.inputVariables.filter(s=>!(s in e)),n={...this.partialVariables??{},...e},i={...this,inputVariables:r,partialVariables:n};return new it(i)}static fromTemplate(e,r){const n=W.fromTemplate(e,r),i=new lt({prompt:n});return this.fromMessages([i])}static fromMessages(e,r){const n=e.reduce((a,o)=>a.concat(o instanceof it?o.promptMessages:[zM(o,r)]),[]),i=e.reduce((a,o)=>o instanceof it?Object.assign(a,o.partialVariables):a,Object.create(null)),s=new Set;for(const a of n)if(!(a instanceof $r))for(const o of a.inputVariables)o in i||s.add(o);return new this({...r,inputVariables:[...s],promptMessages:n,partialVariables:i,templateFormat:r==null?void 0:r.templateFormat})}static fromPromptMessages(e){return this.fromMessages(e)}}class Zs extends pl{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let r=this.inputVariables;this.partialVariables&&(r=r.concat(Object.keys(this.partialVariables))),ql(this.prefix+this.suffix,this.templateFormat,r)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){const r=this.inputVariables.filter(s=>!(s in e)),n={...this.partialVariables??{},...e},i={...this,inputVariables:r,partialVariables:n};return new Zs(i)}async format(e){const r=await this.mergePartialAndUserVariables(e),n=await this.getExamples(r),i=await Promise.all(n.map(a=>this.examplePrompt.format(a))),s=[this.prefix,...i,this.suffix].join(this.exampleSeparator);return Tt(s,this.templateFormat,r)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){const{example_prompt:r}=e;if(!r)throw new Error("Missing example prompt");const n=await W.deserialize(r);let i;if(Array.isArray(e.examples))i=e.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new Zs({inputVariables:e.input_variables,examplePrompt:n,examples:i,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}class Af extends Tf{_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.examples=e.examples,this.examplePrompt=e.examplePrompt,this.exampleSeparator=e.exampleSeparator??`

`,this.exampleSelector=e.exampleSelector,this.prefix=e.prefix??"",this.suffix=e.suffix??"",this.templateFormat=e.templateFormat??"f-string",this.validateTemplate=e.validateTemplate??!0,this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let r=this.inputVariables;this.partialVariables&&(r=r.concat(Object.keys(this.partialVariables))),ql(this.prefix+this.suffix,this.templateFormat,r)}}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(e){const r=await this.mergePartialAndUserVariables(e);let n=await this.getExamples(r);n=n.map(s=>{const a={};return this.examplePrompt.inputVariables.forEach(o=>{a[o]=s[o]}),a});const i=[];for(const s of n){const a=await this.examplePrompt.formatMessages(s);i.push(...a)}return i}async format(e){const r=await this.mergePartialAndUserVariables(e),n=await this.getExamples(r),s=(await Promise.all(n.map(o=>this.examplePrompt.formatMessages(o)))).flat().map(o=>o.content),a=[this.prefix,...s,this.suffix].join(this.exampleSeparator);return Tt(a,this.templateFormat,r)}async partial(e){const r=this.inputVariables.filter(s=>!(s in e)),n={...this.partialVariables??{},...e},i={...this,inputVariables:r,partialVariables:n};return new Af(i)}}const qM=Object.freeze(Object.defineProperty({__proto__:null,FewShotChatMessagePromptTemplate:Af,FewShotPromptTemplate:Zs},Symbol.toStringTag,{value:"Module"}));class Wa extends Eo{static lc_name(){return"PipelinePromptTemplate"}constructor(e){super({...e,inputVariables:[]}),Object.defineProperty(this,"pipelinePrompts",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"finalPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pipelinePrompts=e.pipelinePrompts,this.finalPrompt=e.finalPrompt,this.inputVariables=this.computeInputValues()}computeInputValues(){const e=this.pipelinePrompts.map(n=>n.name),r=this.pipelinePrompts.map(n=>n.prompt.inputVariables.filter(i=>!e.includes(i))).flat();return[...new Set(r)]}static extractRequiredInputValues(e,r){return r.reduce((n,i)=>(n[i]=e[i],n),{})}async formatPipelinePrompts(e){const r=await this.mergePartialAndUserVariables(e);for(const{name:n,prompt:i}of this.pipelinePrompts){const s=Wa.extractRequiredInputValues(r,i.inputVariables);i instanceof it?r[n]=await i.formatMessages(s):r[n]=await i.format(s)}return Wa.extractRequiredInputValues(r,this.finalPrompt.inputVariables)}async formatPromptValue(e){return this.finalPrompt.formatPromptValue(await this.formatPipelinePrompts(e))}async format(e){return this.finalPrompt.format(await this.formatPipelinePrompts(e))}async partial(e){const r={...this};return r.inputVariables=this.inputVariables.filter(n=>!(n in e)),r.partialVariables={...this.partialVariables??{},...e},new Wa(r)}serialize(){throw new Error("Not implemented.")}_getPromptType(){return"pipeline"}}function e0(t){return typeof t=="object"&&t!=null&&"withStructuredOutput"in t&&typeof t.withStructuredOutput=="function"}function KM(t){return typeof t=="object"&&t!=null&&"lc_id"in t&&Array.isArray(t.lc_id)&&t.lc_id.join("/")==="langchain_core/runnables/RunnableBinding"}class Ob extends it{get lc_aliases(){return{...super.lc_aliases,schema:"schema_"}}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","structured"]}),this.schema=e.schema}pipe(e){if(e0(e))return super.pipe(e.withStructuredOutput(this.schema));if(KM(e)&&e0(e.bound))return super.pipe(e.bound.withStructuredOutput(this.schema).bind(e.kwargs??{}).withConfig(e.config));throw new Error('Structured prompts need to be piped to a language model that supports the "withStructuredOutput()" method.')}static fromMessagesAndSchema(e,r){return Ob.fromMessages(e,{schema:r})}}const VM=Object.freeze(Object.defineProperty({__proto__:null,AIMessagePromptTemplate:la,BaseChatPromptTemplate:Tf,BaseMessagePromptTemplate:Ef,BaseMessageStringPromptTemplate:mE,BasePromptTemplate:Eo,BaseStringPromptTemplate:pl,ChatMessagePromptTemplate:_b,ChatPromptTemplate:it,DEFAULT_FORMATTER_MAPPING:ed,DEFAULT_PARSER_MAPPING:fE,FewShotChatMessagePromptTemplate:Af,FewShotPromptTemplate:Zs,HumanMessagePromptTemplate:lt,ImagePromptTemplate:Ns,MessagesPlaceholder:Gs,PipelinePromptTemplate:Wa,PromptTemplate:W,StructuredPrompt:Ob,SystemMessagePromptTemplate:xr,checkValidTemplate:ql,interpolateFString:xf,interpolateMustache:dE,parseFString:gl,parseMustache:Xh,parseTemplate:pE,renderTemplate:Tt},Symbol.toStringTag,{value:"Module"}));class an extends xe{parseResultWithPrompt(e,r,n){return this.parseResult(e,n)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,r){return typeof e=="string"?this._callWithConfig(async(n,i)=>this.parseResult([{text:n}],i==null?void 0:i.callbacks),e,{...r,runType:"parser"}):this._callWithConfig(async(n,i)=>this.parseResult([{message:n,text:this._baseMessageToString(n)}],i==null?void 0:i.callbacks),e,{...r,runType:"parser"})}}class It extends an{parseResult(e,r){return this.parse(e[0].text,r)}async parseWithPrompt(e,r,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}}class je extends Error{constructor(e,r,n,i=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=r,this.observation=n,this.sendToLLM=i,i&&(n===void 0||r===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true")}}function $s(t,e){const r=typeof t;if(r!==typeof e)return!1;if(Array.isArray(t)){if(!Array.isArray(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(!$s(t[i],e[i]))return!1;return!0}if(r==="object"){if(!t||!e)return t===e;const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const a of n)if(!$s(t[a],e[a]))return!1;return!0}return t===e}function mn(t){return encodeURI(BM(t))}function BM(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}const HM={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},WM={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},JM={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};let GM=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function As(t,e=Object.create(null),r=GM,n=""){if(t&&typeof t=="object"&&!Array.isArray(t)){const s=t.$id||t.id;if(s){const a=new URL(s,r.href);a.hash.length>1?e[a.href]=t:(a.hash="",n===""?r=a:As(t,e,r))}}else if(t!==!0&&t!==!1)return e;const i=r.href+(n?"#"+n:"");if(e[i]!==void 0)throw new Error(`Duplicate schema URI "${i}".`);if(e[i]=t,t===!0||t===!1)return e;if(t.__absolute_uri__===void 0&&Object.defineProperty(t,"__absolute_uri__",{enumerable:!1,value:i}),t.$ref&&t.__absolute_ref__===void 0){const s=new URL(t.$ref,r.href);s.hash=s.hash,Object.defineProperty(t,"__absolute_ref__",{enumerable:!1,value:s.href})}if(t.$recursiveRef&&t.__absolute_recursive_ref__===void 0){const s=new URL(t.$recursiveRef,r.href);s.hash=s.hash,Object.defineProperty(t,"__absolute_recursive_ref__",{enumerable:!1,value:s.href})}if(t.$anchor){const s=new URL("#"+t.$anchor,r.href);e[s.href]=t}for(let s in t){if(JM[s])continue;const a=`${n}/${mn(s)}`,o=t[s];if(Array.isArray(o)){if(HM[s]){const u=o.length;for(let l=0;l<u;l++)As(o[l],e,r,`${a}/${l}`)}}else if(WM[s])for(let u in o)As(o[u],e,r,`${a}/${mn(u)}`);else As(o,e,r,a)}return e}const ZM=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,YM=[0,31,28,31,30,31,30,31,31,30,31,30,31],QM=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,XM=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,e2=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,t2=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,r2=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,n2=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,i2=/^(?:\/(?:[^~/]|~0|~1)*)*$/,s2=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,a2=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,o2=/^\d\d\d\d-[0-1]\d-[0-3]\d$/,u2=/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,l2=/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,c2=/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,h2=t=>{if(t[0]==='"')return!1;const[e,r,...n]=t.split("@");return!e||!r||n.length!==0||e.length>64||r.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(r)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:r.split(".").every(i=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(i))},d2=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,f2=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,p2=t=>t.length>1&&t.length<80&&(/^P\d+([.,]\d+)?W$/.test(t)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(t)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(t));function hr(t){return t.test.bind(t)}const m2={date:gE,time:yE.bind(void 0,!1),"date-time":b2,duration:p2,uri:_2,"uri-reference":hr(e2),"uri-template":hr(t2),url:hr(r2),email:h2,hostname:hr(XM),ipv4:hr(d2),ipv6:hr(f2),regex:O2,uuid:hr(n2),"json-pointer":hr(i2),"json-pointer-uri-fragment":hr(s2),"relative-json-pointer":hr(a2)},t0={...m2,date:hr(o2),time:hr(u2),"date-time":hr(l2),"uri-reference":hr(c2)};function g2(t){return t%4===0&&(t%100!==0||t%400===0)}function gE(t){const e=t.match(ZM);if(!e)return!1;const r=+e[1],n=+e[2],i=+e[3];return n>=1&&n<=12&&i>=1&&i<=(n==2&&g2(r)?29:YM[n])}function yE(t,e){const r=e.match(QM);if(!r)return!1;const n=+r[1],i=+r[2],s=+r[3],a=!!r[5];return(n<=23&&i<=59&&s<=59||n==23&&i==59&&s==60)&&(!t||a)}const y2=/t|\s/i;function b2(t){const e=t.split(y2);return e.length==2&&gE(e[0])&&yE(!0,e[1])}const w2=/\/|:/,v2=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function _2(t){return w2.test(t)&&v2.test(t)}const P2=/[^\\]\\Z/;function O2(t){if(P2.test(t))return!1;try{return new RegExp(t),!0}catch{return!1}}function S2(t){let e=0,r=t.length,n=0,i;for(;n<r;)e++,i=t.charCodeAt(n++),i>=55296&&i<=56319&&n<r&&(i=t.charCodeAt(n),(i&64512)==56320&&n++);return e}function Ze(t,e,r="2019-09",n=As(e),i=!0,s=null,a="#",o="#",u=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:a,keyword:"false",keywordLocation:a,error:"False boolean schema."}]};const l=typeof t;let c;switch(l){case"boolean":case"number":case"string":c=l;break;case"object":t===null?c="null":Array.isArray(t)?c="array":c="object";break;default:throw new Error(`Instances of "${l}" type are not supported.`)}const{$ref:h,$recursiveRef:d,$recursiveAnchor:f,type:p,const:y,enum:v,required:g,not:m,anyOf:b,allOf:S,oneOf:E,if:I,then:j,else:P,format:G,properties:U,patternProperties:le,additionalProperties:ae,unevaluatedProperties:de,minProperties:Ee,maxProperties:ze,propertyNames:ce,dependentRequired:rt,dependentSchemas:q,dependencies:ie,prefixItems:te,items:_e,additionalItems:Ne,unevaluatedItems:qr,contains:Mt,minContains:Ct,maxContains:_,minItems:w,maxItems:N,uniqueItems:T,minimum:ye,maximum:ke,exclusiveMinimum:$e,exclusiveMaximum:He,multipleOf:ct,minLength:Kr,maxLength:We,pattern:Er,__absolute_ref__:O,__absolute_recursive_ref__:A}=e,x=[];if(f===!0&&s===null&&(s=e),d==="#"){const R=s===null?n[A]:s,k=`${o}/$recursiveRef`,$=Ze(t,s===null?e:s,r,n,i,R,a,k,u);$.valid||x.push({instanceLocation:a,keyword:"$recursiveRef",keywordLocation:k,error:"A subschema had errors."},...$.errors)}if(h!==void 0){const k=n[O||h];if(k===void 0){let D=`Unresolved $ref "${h}".`;throw O&&O!==h&&(D+=`  Absolute URI "${O}".`),D+=`
Known schemas:
- ${Object.keys(n).join(`
- `)}`,new Error(D)}const $=`${o}/$ref`,L=Ze(t,k,r,n,i,s,a,$,u);if(L.valid||x.push({instanceLocation:a,keyword:"$ref",keywordLocation:$,error:"A subschema had errors."},...L.errors),r==="4"||r==="7")return{valid:x.length===0,errors:x}}if(Array.isArray(p)){let R=p.length,k=!1;for(let $=0;$<R;$++)if(c===p[$]||p[$]==="integer"&&c==="number"&&t%1===0&&t===t){k=!0;break}k||x.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${c}" is invalid. Expected "${p.join('", "')}".`})}else p==="integer"?(c!=="number"||t%1||t!==t)&&x.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${c}" is invalid. Expected "${p}".`}):p!==void 0&&c!==p&&x.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${c}" is invalid. Expected "${p}".`});if(y!==void 0&&(c==="object"||c==="array"?$s(t,y)||x.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(y)}.`}):t!==y&&x.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(y)}.`})),v!==void 0&&(c==="object"||c==="array"?v.some(R=>$s(t,R))||x.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(v)}.`}):v.some(R=>t===R)||x.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(v)}.`})),m!==void 0){const R=`${o}/not`;Ze(t,m,r,n,i,s,a,R).valid&&x.push({instanceLocation:a,keyword:"not",keywordLocation:R,error:'Instance matched "not" schema.'})}let K=[];if(b!==void 0){const R=`${o}/anyOf`,k=x.length;let $=!1;for(let L=0;L<b.length;L++){const D=b[L],Y=Object.create(u),se=Ze(t,D,r,n,i,f===!0?s:null,a,`${R}/${L}`,Y);x.push(...se.errors),$=$||se.valid,se.valid&&K.push(Y)}$?x.length=k:x.splice(k,0,{instanceLocation:a,keyword:"anyOf",keywordLocation:R,error:"Instance does not match any subschemas."})}if(S!==void 0){const R=`${o}/allOf`,k=x.length;let $=!0;for(let L=0;L<S.length;L++){const D=S[L],Y=Object.create(u),se=Ze(t,D,r,n,i,f===!0?s:null,a,`${R}/${L}`,Y);x.push(...se.errors),$=$&&se.valid,se.valid&&K.push(Y)}$?x.length=k:x.splice(k,0,{instanceLocation:a,keyword:"allOf",keywordLocation:R,error:"Instance does not match every subschema."})}if(E!==void 0){const R=`${o}/oneOf`,k=x.length,$=E.filter((L,D)=>{const Y=Object.create(u),se=Ze(t,L,r,n,i,f===!0?s:null,a,`${R}/${D}`,Y);return x.push(...se.errors),se.valid&&K.push(Y),se.valid}).length;$===1?x.length=k:x.splice(k,0,{instanceLocation:a,keyword:"oneOf",keywordLocation:R,error:`Instance does not match exactly one subschema (${$} matches).`})}if((c==="object"||c==="array")&&Object.assign(u,...K),I!==void 0){const R=`${o}/if`;if(Ze(t,I,r,n,i,s,a,R,u).valid){if(j!==void 0){const $=Ze(t,j,r,n,i,s,a,`${o}/then`,u);$.valid||x.push({instanceLocation:a,keyword:"if",keywordLocation:R,error:'Instance does not match "then" schema.'},...$.errors)}}else if(P!==void 0){const $=Ze(t,P,r,n,i,s,a,`${o}/else`,u);$.valid||x.push({instanceLocation:a,keyword:"if",keywordLocation:R,error:'Instance does not match "else" schema.'},...$.errors)}}if(c==="object"){if(g!==void 0)for(const L of g)L in t||x.push({instanceLocation:a,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${L}".`});const R=Object.keys(t);if(Ee!==void 0&&R.length<Ee&&x.push({instanceLocation:a,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${Ee} properties.`}),ze!==void 0&&R.length>ze&&x.push({instanceLocation:a,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${ze} properties.`}),ce!==void 0){const L=`${o}/propertyNames`;for(const D in t){const Y=`${a}/${mn(D)}`,se=Ze(D,ce,r,n,i,s,Y,L);se.valid||x.push({instanceLocation:a,keyword:"propertyNames",keywordLocation:L,error:`Property name "${D}" does not match schema.`},...se.errors)}}if(rt!==void 0){const L=`${o}/dependantRequired`;for(const D in rt)if(D in t){const Y=rt[D];for(const se of Y)se in t||x.push({instanceLocation:a,keyword:"dependentRequired",keywordLocation:L,error:`Instance has "${D}" but does not have "${se}".`})}}if(q!==void 0)for(const L in q){const D=`${o}/dependentSchemas`;if(L in t){const Y=Ze(t,q[L],r,n,i,s,a,`${D}/${mn(L)}`,u);Y.valid||x.push({instanceLocation:a,keyword:"dependentSchemas",keywordLocation:D,error:`Instance has "${L}" but does not match dependant schema.`},...Y.errors)}}if(ie!==void 0){const L=`${o}/dependencies`;for(const D in ie)if(D in t){const Y=ie[D];if(Array.isArray(Y))for(const se of Y)se in t||x.push({instanceLocation:a,keyword:"dependencies",keywordLocation:L,error:`Instance has "${D}" but does not have "${se}".`});else{const se=Ze(t,Y,r,n,i,s,a,`${L}/${mn(D)}`);se.valid||x.push({instanceLocation:a,keyword:"dependencies",keywordLocation:L,error:`Instance has "${D}" but does not match dependant schema.`},...se.errors)}}}const k=Object.create(null);let $=!1;if(U!==void 0){const L=`${o}/properties`;for(const D in U){if(!(D in t))continue;const Y=`${a}/${mn(D)}`,se=Ze(t[D],U[D],r,n,i,s,Y,`${L}/${mn(D)}`);if(se.valid)u[D]=k[D]=!0;else if($=i,x.push({instanceLocation:a,keyword:"properties",keywordLocation:L,error:`Property "${D}" does not match schema.`},...se.errors),$)break}}if(!$&&le!==void 0){const L=`${o}/patternProperties`;for(const D in le){const Y=new RegExp(D),se=le[D];for(const Ft in t){if(!Y.test(Ft))continue;const ha=`${a}/${mn(Ft)}`,da=Ze(t[Ft],se,r,n,i,s,ha,`${L}/${mn(D)}`);da.valid?u[Ft]=k[Ft]=!0:($=i,x.push({instanceLocation:a,keyword:"patternProperties",keywordLocation:L,error:`Property "${Ft}" matches pattern "${D}" but does not match associated schema.`},...da.errors))}}}if(!$&&ae!==void 0){const L=`${o}/additionalProperties`;for(const D in t){if(k[D])continue;const Y=`${a}/${mn(D)}`,se=Ze(t[D],ae,r,n,i,s,Y,L);se.valid?u[D]=!0:($=i,x.push({instanceLocation:a,keyword:"additionalProperties",keywordLocation:L,error:`Property "${D}" does not match additional properties schema.`},...se.errors))}}else if(!$&&de!==void 0){const L=`${o}/unevaluatedProperties`;for(const D in t)if(!u[D]){const Y=`${a}/${mn(D)}`,se=Ze(t[D],de,r,n,i,s,Y,L);se.valid?u[D]=!0:x.push({instanceLocation:a,keyword:"unevaluatedProperties",keywordLocation:L,error:`Property "${D}" does not match unevaluated properties schema.`},...se.errors)}}}else if(c==="array"){N!==void 0&&t.length>N&&x.push({instanceLocation:a,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${t.length} > ${N}).`}),w!==void 0&&t.length<w&&x.push({instanceLocation:a,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${t.length} < ${w}).`});const R=t.length;let k=0,$=!1;if(te!==void 0){const L=`${o}/prefixItems`,D=Math.min(te.length,R);for(;k<D;k++){const Y=Ze(t[k],te[k],r,n,i,s,`${a}/${k}`,`${L}/${k}`);if(u[k]=!0,!Y.valid&&($=i,x.push({instanceLocation:a,keyword:"prefixItems",keywordLocation:L,error:"Items did not match schema."},...Y.errors),$))break}}if(_e!==void 0){const L=`${o}/items`;if(Array.isArray(_e)){const D=Math.min(_e.length,R);for(;k<D;k++){const Y=Ze(t[k],_e[k],r,n,i,s,`${a}/${k}`,`${L}/${k}`);if(u[k]=!0,!Y.valid&&($=i,x.push({instanceLocation:a,keyword:"items",keywordLocation:L,error:"Items did not match schema."},...Y.errors),$))break}}else for(;k<R;k++){const D=Ze(t[k],_e,r,n,i,s,`${a}/${k}`,L);if(u[k]=!0,!D.valid&&($=i,x.push({instanceLocation:a,keyword:"items",keywordLocation:L,error:"Items did not match schema."},...D.errors),$))break}if(!$&&Ne!==void 0){const D=`${o}/additionalItems`;for(;k<R;k++){const Y=Ze(t[k],Ne,r,n,i,s,`${a}/${k}`,D);u[k]=!0,Y.valid||($=i,x.push({instanceLocation:a,keyword:"additionalItems",keywordLocation:D,error:"Items did not match additional items schema."},...Y.errors))}}}if(Mt!==void 0)if(R===0&&Ct===void 0)x.push({instanceLocation:a,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(Ct!==void 0&&R<Ct)x.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${R}) than minContains (${Ct}).`});else{const L=`${o}/contains`,D=x.length;let Y=0;for(let se=0;se<R;se++){const Ft=Ze(t[se],Mt,r,n,i,s,`${a}/${se}`,L);Ft.valid?(u[se]=!0,Y++):x.push(...Ft.errors)}Y>=(Ct||0)&&(x.length=D),Ct===void 0&&_===void 0&&Y===0?x.splice(D,0,{instanceLocation:a,keyword:"contains",keywordLocation:L,error:"Array does not contain item matching schema."}):Ct!==void 0&&Y<Ct?x.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${Ct} items matching schema. Only ${Y} items were found.`}):_!==void 0&&Y>_&&x.push({instanceLocation:a,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${_} items matching schema. ${Y} items were found.`})}if(!$&&qr!==void 0){const L=`${o}/unevaluatedItems`;for(k;k<R;k++){if(u[k])continue;const D=Ze(t[k],qr,r,n,i,s,`${a}/${k}`,L);u[k]=!0,D.valid||x.push({instanceLocation:a,keyword:"unevaluatedItems",keywordLocation:L,error:"Items did not match unevaluated items schema."},...D.errors)}}if(T)for(let L=0;L<R;L++){const D=t[L],Y=typeof D=="object"&&D!==null;for(let se=0;se<R;se++){if(L===se)continue;const Ft=t[se];(D===Ft||Y&&(typeof Ft=="object"&&Ft!==null)&&$s(D,Ft))&&(x.push({instanceLocation:a,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${L} and ${se}.`}),L=Number.MAX_SAFE_INTEGER,se=Number.MAX_SAFE_INTEGER)}}}else if(c==="number"){if(r==="4"?(ye!==void 0&&($e===!0&&t<=ye||t<ye)&&x.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${t} is less than ${$e?"or equal to ":""} ${ye}.`}),ke!==void 0&&(He===!0&&t>=ke||t>ke)&&x.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${t} is greater than ${He?"or equal to ":""} ${ke}.`})):(ye!==void 0&&t<ye&&x.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${t} is less than ${ye}.`}),ke!==void 0&&t>ke&&x.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${t} is greater than ${ke}.`}),$e!==void 0&&t<=$e&&x.push({instanceLocation:a,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${t} is less than ${$e}.`}),He!==void 0&&t>=He&&x.push({instanceLocation:a,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${t} is greater than or equal to ${He}.`})),ct!==void 0){const R=t%ct;Math.abs(0-R)>=11920929e-14&&Math.abs(ct-R)>=11920929e-14&&x.push({instanceLocation:a,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${t} is not a multiple of ${ct}.`})}}else if(c==="string"){const R=Kr===void 0&&We===void 0?0:S2(t);Kr!==void 0&&R<Kr&&x.push({instanceLocation:a,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${R} < ${Kr}).`}),We!==void 0&&R>We&&x.push({instanceLocation:a,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${R} > ${We}).`}),Er!==void 0&&!new RegExp(Er).test(t)&&x.push({instanceLocation:a,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),G!==void 0&&t0[G]&&!t0[G](t)&&x.push({instanceLocation:a,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${G}".`})}return{valid:x.length===0,errors:x}}class bE{constructor(e,r="2019-09",n=!0){Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"draft",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"shortCircuit",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"lookup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lookup=As(e)}validate(e){return Ze(e,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(e,r){r&&(e={...e,$id:r}),As(e,this.lookup)}}class Ao extends It{async*_transform(e){for await(const r of e)typeof r=="string"?yield this.parseResult([{text:r}]):yield this.parseResult([{message:r,text:this._baseMessageToString(r)}])}async*transform(e,r){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...r,runType:"parser"})}}class kf extends Ao{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let r,n;for await(const i of e){if(typeof i!="string"&&typeof i.content!="string")throw new Error("Cannot handle non-string output.");let s;if(Ax(i)){if(typeof i.content!="string")throw new Error("Cannot handle non-string message output.");s=new nn({message:i,text:i.content})}else if(Vt(i)){if(typeof i.content!="string")throw new Error("Cannot handle non-string message output.");s=new nn({message:Ix(i),text:i.content})}else s=new jn({text:i});n===void 0?n=s:n=n.concat(s);const a=await this.parsePartialResult([n]);a!=null&&!$s(a,r)&&(this.diff?yield this._diff(r,a):yield a,r=a)}}}class x2 extends Ao{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","bytes"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"textEncoder",{enumerable:!0,configurable:!0,writable:!0,value:new TextEncoder})}static lc_name(){return"BytesOutputParser"}parse(e){return Promise.resolve(this.textEncoder.encode(e))}getFormatInstructions(){return""}}class ko extends Ao{constructor(){super(...arguments),Object.defineProperty(this,"re",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async*_transform(e){let r="";for await(const n of e)if(typeof n=="string"?r+=n:r+=n.content,this.re){const i=[...r.matchAll(this.re)];if(i.length>1){let s=0;for(const a of i.slice(0,-1))yield[a[1]],s+=(a.index??0)+a[0].length;r=r.slice(s)}}else{const i=await this.parse(r);if(i.length>1){for(const s of i.slice(0,-1))yield[s];r=i[i.length-1]}}for(const n of await this.parse(r))yield[n]}}class wE extends ko{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"CommaSeparatedListOutputParser"}async parse(e){try{return e.trim().split(",").map(r=>r.trim())}catch{throw new je(`Could not parse output: ${e}`,e)}}getFormatInstructions(){return"Your response should be a list of comma separated values, eg: `foo, bar, baz`"}}class vE extends ko{constructor({length:e,separator:r}){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"length",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"separator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.length=e,this.separator=r||","}async parse(e){try{const r=e.trim().split(this.separator).map(n=>n.trim());if(this.length!==void 0&&r.length!==this.length)throw new je(`Incorrect number of items. Expected ${this.length}, got ${r.length}.`);return r}catch(r){throw Object.getPrototypeOf(r)===je.prototype?r:new je(`Could not parse output: ${e}`)}}getFormatInstructions(){return`Your response should be a list of ${this.length===void 0?"":`${this.length} `}items separated by "${this.separator}" (eg: \`foo${this.separator} bar${this.separator} baz\`)`}}class E2 extends ko{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"re",{enumerable:!0,configurable:!0,writable:!0,value:/\d+\.\s([^\n]+)/g})}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}async parse(e){return[...e.matchAll(this.re)??[]].map(r=>r[1])}}class T2 extends ko{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"re",{enumerable:!0,configurable:!0,writable:!0,value:/^\s*[-*]\s([^\n]+)$/gm})}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}async parse(e){return[...e.matchAll(this.re)??[]].map(r=>r[1])}}class Io extends Ao{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","string"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw new Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentComplexToString(e){switch(e.type){case"text":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw new Error(`Cannot coerce "${e.type}" message part into a string.`)}throw new Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((r,n)=>r+this._messageContentComplexToString(n),"")}}let Sb=class extends It{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const r=Ce.object(Object.fromEntries(Object.entries(e).map(([n,i])=>[n,Ce.string().describe(i)])));return new this(r)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(Zt(this.schema))}
\`\`\`
`}async parse(e){try{const n=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(i,s)=>`"${s.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(n))}catch(r){throw new je(`Failed to parse. Text: "${e}". Error: ${r}`,e)}}},_E=class extends Sb{static lc_name(){return"JsonMarkdownStructuredOutputParser"}getFormatInstructions(e){const r=(e==null?void 0:e.interpolationDepth)??1;if(r<1)throw new Error("f string interpolation depth must be at least 1");return`Return a markdown code snippet with a JSON object formatted to look like:
\`\`\`json
${this._schemaToInstruction(Zt(this.schema)).replaceAll("{","{".repeat(r)).replaceAll("}","}".repeat(r))}
\`\`\``}_schemaToInstruction(e,r=2){const n=e;if("type"in n){let i=!1,s;if(Array.isArray(n.type)){const u=n.type.findIndex(l=>l==="null");u!==-1&&(i=!0,n.type.splice(u,1)),s=n.type.join(" | ")}else s=n.type;if(n.type==="object"&&n.properties){const u=n.description?` // ${n.description}`:"";return`{
${Object.entries(n.properties).map(([c,h])=>{var f;const d=(f=n.required)!=null&&f.includes(c)?"":" (optional)";return`${" ".repeat(r)}"${c}": ${this._schemaToInstruction(h,r+2)}${d}`}).join(`
`)}
${" ".repeat(r-2)}}${u}`}if(n.type==="array"&&n.items){const u=n.description?` // ${n.description}`:"";return`array[
${" ".repeat(r)}${this._schemaToInstruction(n.items,r+2)}
${" ".repeat(r-2)}] ${u}`}const a=i?" (nullable)":"",o=n.description?` // ${n.description}`:"";return`${s}${o}${a}`}if("anyOf"in n)return n.anyOf.map(i=>this._schemaToInstruction(i,r)).join(`
${" ".repeat(r-2)}`);throw new Error("unsupported schema type")}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const r=Ce.object(Object.fromEntries(Object.entries(e).map(([n,i])=>[n,Ce.string().describe(i)])));return new this(r)}},A2=class extends It{constructor({inputSchema:e}){super(...arguments),Object.defineProperty(this,"structuredInputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.structuredInputParser=new _E(e)}async parse(e){let r;try{r=await this.structuredInputParser.parse(e)}catch(n){throw new je(`Failed to parse. Text: "${e}". Error: ${n}`,e)}return this.outputProcessor(r)}getFormatInstructions(){return this.structuredInputParser.getFormatInstructions()}};const k2=Object.freeze(Object.defineProperty({__proto__:null,applyPatch:dl,compare:yf},Symbol.toStringTag,{value:"Module"}));class PE extends kf{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,r){if(r)return e?yf(e,r):[{op:"replace",path:"",value:r}]}async parsePartialResult(e){return cg(e[0].text)}async parse(e){return cg(e,JSON.parse)}getFormatInstructions(){return""}}const I2=function(){const t={};t.parser=function(_,w){return new r(_,w)},t.SAXParser=r,t.SAXStream=l,t.createStream=u,t.MAX_BUFFER_LENGTH=64*1024;const e=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];t.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function r(_,w){if(!(this instanceof r))return new r(_,w);var N=this;i(N),N.q=N.c="",N.bufferCheckPosition=t.MAX_BUFFER_LENGTH,N.opt=w||{},N.opt.lowercase=N.opt.lowercase||N.opt.lowercasetags,N.looseCase=N.opt.lowercase?"toLowerCase":"toUpperCase",N.tags=[],N.closed=N.closedRoot=N.sawRoot=!1,N.tag=N.error=null,N.strict=!!_,N.noscript=!!(_||N.opt.noscript),N.state=P.BEGIN,N.strictEntities=N.opt.strictEntities,N.ENTITIES=N.strictEntities?Object.create(t.XML_ENTITIES):Object.create(t.ENTITIES),N.attribList=[],N.opt.xmlns&&(N.ns=Object.create(p)),N.trackPosition=N.opt.position!==!1,N.trackPosition&&(N.position=N.line=N.column=0),U(N,"onready")}Object.create||(Object.create=function(_){function w(){}w.prototype=_;var N=new w;return N}),Object.keys||(Object.keys=function(_){var w=[];for(var N in _)_.hasOwnProperty(N)&&w.push(N);return w});function n(_){for(var w=Math.max(t.MAX_BUFFER_LENGTH,10),N=0,T=0,ye=e.length;T<ye;T++){var ke=_[e[T]].length;if(ke>w)switch(e[T]){case"textNode":ae(_);break;case"cdata":le(_,"oncdata",_.cdata),_.cdata="";break;case"script":le(_,"onscript",_.script),_.script="";break;default:Ee(_,"Max buffer length exceeded: "+e[T])}N=Math.max(N,ke)}var $e=t.MAX_BUFFER_LENGTH-N;_.bufferCheckPosition=$e+_.position}function i(_){for(var w=0,N=e.length;w<N;w++)_[e[w]]=""}function s(_){ae(_),_.cdata!==""&&(le(_,"oncdata",_.cdata),_.cdata=""),_.script!==""&&(le(_,"onscript",_.script),_.script="")}r.prototype={end:function(){ze(this)},write:Ct,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){s(this)}};var a=ReadableStream;a||(a=function(){});var o=t.EVENTS.filter(function(_){return _!=="error"&&_!=="end"});function u(_,w){return new l(_,w)}function l(_,w){if(!(this instanceof l))return new l(_,w);a.apply(this),this._parser=new r(_,w),this.writable=!0,this.readable=!0;var N=this;this._parser.onend=function(){N.emit("end")},this._parser.onerror=function(T){N.emit("error",T),N._parser.error=null},this._decoder=null,o.forEach(function(T){Object.defineProperty(N,"on"+T,{get:function(){return N._parser["on"+T]},set:function(ye){if(!ye)return N.removeAllListeners(T),N._parser["on"+T]=ye,ye;N.on(T,ye)},enumerable:!0,configurable:!1})})}l.prototype=Object.create(a.prototype,{constructor:{value:l}}),l.prototype.write=function(_){return this._parser.write(_.toString()),this.emit("data",_),!0},l.prototype.end=function(_){return _&&_.length&&this.write(_),this._parser.end(),!0},l.prototype.on=function(_,w){var N=this;return!N._parser["on"+_]&&o.indexOf(_)!==-1&&(N._parser["on"+_]=function(){var T=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);T.splice(0,0,_),N.emit.apply(N,T)}),a.prototype.on.call(N,_,w)};var c="[CDATA[",h="DOCTYPE",d="http://www.w3.org/XML/1998/namespace",f="http://www.w3.org/2000/xmlns/",p={xml:d,xmlns:f},y=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,v=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,g=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,m=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function b(_){return _===" "||_===`
`||_==="\r"||_==="	"}function S(_){return _==='"'||_==="'"}function E(_){return _===">"||b(_)}function I(_,w){return _.test(w)}function j(_,w){return!I(_,w)}var P=0;t.STATE={BEGIN:P++,BEGIN_WHITESPACE:P++,TEXT:P++,TEXT_ENTITY:P++,OPEN_WAKA:P++,SGML_DECL:P++,SGML_DECL_QUOTED:P++,DOCTYPE:P++,DOCTYPE_QUOTED:P++,DOCTYPE_DTD:P++,DOCTYPE_DTD_QUOTED:P++,COMMENT_STARTING:P++,COMMENT:P++,COMMENT_ENDING:P++,COMMENT_ENDED:P++,CDATA:P++,CDATA_ENDING:P++,CDATA_ENDING_2:P++,PROC_INST:P++,PROC_INST_BODY:P++,PROC_INST_ENDING:P++,OPEN_TAG:P++,OPEN_TAG_SLASH:P++,ATTRIB:P++,ATTRIB_NAME:P++,ATTRIB_NAME_SAW_WHITE:P++,ATTRIB_VALUE:P++,ATTRIB_VALUE_QUOTED:P++,ATTRIB_VALUE_CLOSED:P++,ATTRIB_VALUE_UNQUOTED:P++,ATTRIB_VALUE_ENTITY_Q:P++,ATTRIB_VALUE_ENTITY_U:P++,CLOSE_TAG:P++,CLOSE_TAG_SAW_WHITE:P++,SCRIPT:P++,SCRIPT_ENDING:P++},t.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},t.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(t.ENTITIES).forEach(function(_){var w=t.ENTITIES[_],N=typeof w=="number"?String.fromCharCode(w):w;t.ENTITIES[_]=N});for(var G in t.STATE)t.STATE[t.STATE[G]]=G;P=t.STATE;function U(_,w,N){_[w]&&_[w](N)}function le(_,w,N){_.textNode&&ae(_),U(_,w,N)}function ae(_){_.textNode=de(_.opt,_.textNode),_.textNode&&U(_,"ontext",_.textNode),_.textNode=""}function de(_,w){return _.trim&&(w=w.trim()),_.normalize&&(w=w.replace(/\s+/g," ")),w}function Ee(_,w){return ae(_),_.trackPosition&&(w+=`
Line: `+_.line+`
Column: `+_.column+`
Char: `+_.c),w=new Error(w),_.error=w,U(_,"onerror",w),_}function ze(_){return _.sawRoot&&!_.closedRoot&&ce(_,"Unclosed root tag"),_.state!==P.BEGIN&&_.state!==P.BEGIN_WHITESPACE&&_.state!==P.TEXT&&Ee(_,"Unexpected end"),ae(_),_.c="",_.closed=!0,U(_,"onend"),r.call(_,_.strict,_.opt),_}function ce(_,w){if(typeof _!="object"||!(_ instanceof r))throw new Error("bad call to strictFail");_.strict&&Ee(_,w)}function rt(_){_.strict||(_.tagName=_.tagName[_.looseCase]());var w=_.tags[_.tags.length-1]||_,N=_.tag={name:_.tagName,attributes:{}};_.opt.xmlns&&(N.ns=w.ns),_.attribList.length=0,le(_,"onopentagstart",N)}function q(_,w){var N=_.indexOf(":"),T=N<0?["",_]:_.split(":"),ye=T[0],ke=T[1];return w&&_==="xmlns"&&(ye="xmlns",ke=""),{prefix:ye,local:ke}}function ie(_){if(_.strict||(_.attribName=_.attribName[_.looseCase]()),_.attribList.indexOf(_.attribName)!==-1||_.tag.attributes.hasOwnProperty(_.attribName)){_.attribName=_.attribValue="";return}if(_.opt.xmlns){var w=q(_.attribName,!0),N=w.prefix,T=w.local;if(N==="xmlns")if(T==="xml"&&_.attribValue!==d)ce(_,"xml: prefix must be bound to "+d+`
Actual: `+_.attribValue);else if(T==="xmlns"&&_.attribValue!==f)ce(_,"xmlns: prefix must be bound to "+f+`
Actual: `+_.attribValue);else{var ye=_.tag,ke=_.tags[_.tags.length-1]||_;ye.ns===ke.ns&&(ye.ns=Object.create(ke.ns)),ye.ns[T]=_.attribValue}_.attribList.push([_.attribName,_.attribValue])}else _.tag.attributes[_.attribName]=_.attribValue,le(_,"onattribute",{name:_.attribName,value:_.attribValue});_.attribName=_.attribValue=""}function te(_,w){if(_.opt.xmlns){var N=_.tag,T=q(_.tagName);N.prefix=T.prefix,N.local=T.local,N.uri=N.ns[T.prefix]||"",N.prefix&&!N.uri&&(ce(_,"Unbound namespace prefix: "+JSON.stringify(_.tagName)),N.uri=T.prefix);var ye=_.tags[_.tags.length-1]||_;N.ns&&ye.ns!==N.ns&&Object.keys(N.ns).forEach(function(K){le(_,"onopennamespace",{prefix:K,uri:N.ns[K]})});for(var ke=0,$e=_.attribList.length;ke<$e;ke++){var He=_.attribList[ke],ct=He[0],Kr=He[1],We=q(ct,!0),Er=We.prefix,O=We.local,A=Er===""?"":N.ns[Er]||"",x={name:ct,value:Kr,prefix:Er,local:O,uri:A};Er&&Er!=="xmlns"&&!A&&(ce(_,"Unbound namespace prefix: "+JSON.stringify(Er)),x.uri=Er),_.tag.attributes[ct]=x,le(_,"onattribute",x)}_.attribList.length=0}_.tag.isSelfClosing=!!w,_.sawRoot=!0,_.tags.push(_.tag),le(_,"onopentag",_.tag),w||(!_.noscript&&_.tagName.toLowerCase()==="script"?_.state=P.SCRIPT:_.state=P.TEXT,_.tag=null,_.tagName=""),_.attribName=_.attribValue="",_.attribList.length=0}function _e(_){if(!_.tagName){ce(_,"Weird empty close tag."),_.textNode+="</>",_.state=P.TEXT;return}if(_.script){if(_.tagName!=="script"){_.script+="</"+_.tagName+">",_.tagName="",_.state=P.SCRIPT;return}le(_,"onscript",_.script),_.script=""}var w=_.tags.length,N=_.tagName;_.strict||(N=N[_.looseCase]());for(var T=N;w--;){var ye=_.tags[w];if(ye.name!==T)ce(_,"Unexpected close tag");else break}if(w<0){ce(_,"Unmatched closing tag: "+_.tagName),_.textNode+="</"+_.tagName+">",_.state=P.TEXT;return}_.tagName=N;for(var ke=_.tags.length;ke-- >w;){var $e=_.tag=_.tags.pop();_.tagName=_.tag.name,le(_,"onclosetag",_.tagName);var He={};for(var ct in $e.ns)He[ct]=$e.ns[ct];var Kr=_.tags[_.tags.length-1]||_;_.opt.xmlns&&$e.ns!==Kr.ns&&Object.keys($e.ns).forEach(function(We){var Er=$e.ns[We];le(_,"onclosenamespace",{prefix:We,uri:Er})})}w===0&&(_.closedRoot=!0),_.tagName=_.attribValue=_.attribName="",_.attribList.length=0,_.state=P.TEXT}function Ne(_){var w=_.entity,N=w.toLowerCase(),T,ye="";return _.ENTITIES[w]?_.ENTITIES[w]:_.ENTITIES[N]?_.ENTITIES[N]:(w=N,w.charAt(0)==="#"&&(w.charAt(1)==="x"?(w=w.slice(2),T=parseInt(w,16),ye=T.toString(16)):(w=w.slice(1),T=parseInt(w,10),ye=T.toString(10))),w=w.replace(/^0+/,""),isNaN(T)||ye.toLowerCase()!==w?(ce(_,"Invalid character entity"),"&"+_.entity+";"):String.fromCodePoint(T))}function qr(_,w){w==="<"?(_.state=P.OPEN_WAKA,_.startTagPosition=_.position):b(w)||(ce(_,"Non-whitespace before first tag."),_.textNode=w,_.state=P.TEXT)}function Mt(_,w){var N="";return w<_.length&&(N=_.charAt(w)),N}function Ct(_){var w=this;if(this.error)throw this.error;if(w.closed)return Ee(w,"Cannot write after close. Assign an onready handler.");if(_===null)return ze(w);typeof _=="object"&&(_=_.toString());for(var N=0,T="";T=Mt(_,N++),w.c=T,!!T;)switch(w.trackPosition&&(w.position++,T===`
`?(w.line++,w.column=0):w.column++),w.state){case P.BEGIN:if(w.state=P.BEGIN_WHITESPACE,T==="\uFEFF")continue;qr(w,T);continue;case P.BEGIN_WHITESPACE:qr(w,T);continue;case P.TEXT:if(w.sawRoot&&!w.closedRoot){for(var ye=N-1;T&&T!=="<"&&T!=="&";)T=Mt(_,N++),T&&w.trackPosition&&(w.position++,T===`
`?(w.line++,w.column=0):w.column++);w.textNode+=_.substring(ye,N-1)}T==="<"&&!(w.sawRoot&&w.closedRoot&&!w.strict)?(w.state=P.OPEN_WAKA,w.startTagPosition=w.position):(!b(T)&&(!w.sawRoot||w.closedRoot)&&ce(w,"Text data outside of root node."),T==="&"?w.state=P.TEXT_ENTITY:w.textNode+=T);continue;case P.SCRIPT:T==="<"?w.state=P.SCRIPT_ENDING:w.script+=T;continue;case P.SCRIPT_ENDING:T==="/"?w.state=P.CLOSE_TAG:(w.script+="<"+T,w.state=P.SCRIPT);continue;case P.OPEN_WAKA:if(T==="!")w.state=P.SGML_DECL,w.sgmlDecl="";else if(!b(T))if(I(y,T))w.state=P.OPEN_TAG,w.tagName=T;else if(T==="/")w.state=P.CLOSE_TAG,w.tagName="";else if(T==="?")w.state=P.PROC_INST,w.procInstName=w.procInstBody="";else{if(ce(w,"Unencoded <"),w.startTagPosition+1<w.position){var ke=w.position-w.startTagPosition;T=new Array(ke).join(" ")+T}w.textNode+="<"+T,w.state=P.TEXT}continue;case P.SGML_DECL:(w.sgmlDecl+T).toUpperCase()===c?(le(w,"onopencdata"),w.state=P.CDATA,w.sgmlDecl="",w.cdata=""):w.sgmlDecl+T==="--"?(w.state=P.COMMENT,w.comment="",w.sgmlDecl=""):(w.sgmlDecl+T).toUpperCase()===h?(w.state=P.DOCTYPE,(w.doctype||w.sawRoot)&&ce(w,"Inappropriately located doctype declaration"),w.doctype="",w.sgmlDecl=""):T===">"?(le(w,"onsgmldeclaration",w.sgmlDecl),w.sgmlDecl="",w.state=P.TEXT):(S(T)&&(w.state=P.SGML_DECL_QUOTED),w.sgmlDecl+=T);continue;case P.SGML_DECL_QUOTED:T===w.q&&(w.state=P.SGML_DECL,w.q=""),w.sgmlDecl+=T;continue;case P.DOCTYPE:T===">"?(w.state=P.TEXT,le(w,"ondoctype",w.doctype),w.doctype=!0):(w.doctype+=T,T==="["?w.state=P.DOCTYPE_DTD:S(T)&&(w.state=P.DOCTYPE_QUOTED,w.q=T));continue;case P.DOCTYPE_QUOTED:w.doctype+=T,T===w.q&&(w.q="",w.state=P.DOCTYPE);continue;case P.DOCTYPE_DTD:w.doctype+=T,T==="]"?w.state=P.DOCTYPE:S(T)&&(w.state=P.DOCTYPE_DTD_QUOTED,w.q=T);continue;case P.DOCTYPE_DTD_QUOTED:w.doctype+=T,T===w.q&&(w.state=P.DOCTYPE_DTD,w.q="");continue;case P.COMMENT:T==="-"?w.state=P.COMMENT_ENDING:w.comment+=T;continue;case P.COMMENT_ENDING:T==="-"?(w.state=P.COMMENT_ENDED,w.comment=de(w.opt,w.comment),w.comment&&le(w,"oncomment",w.comment),w.comment=""):(w.comment+="-"+T,w.state=P.COMMENT);continue;case P.COMMENT_ENDED:T!==">"?(ce(w,"Malformed comment"),w.comment+="--"+T,w.state=P.COMMENT):w.state=P.TEXT;continue;case P.CDATA:T==="]"?w.state=P.CDATA_ENDING:w.cdata+=T;continue;case P.CDATA_ENDING:T==="]"?w.state=P.CDATA_ENDING_2:(w.cdata+="]"+T,w.state=P.CDATA);continue;case P.CDATA_ENDING_2:T===">"?(w.cdata&&le(w,"oncdata",w.cdata),le(w,"onclosecdata"),w.cdata="",w.state=P.TEXT):T==="]"?w.cdata+="]":(w.cdata+="]]"+T,w.state=P.CDATA);continue;case P.PROC_INST:T==="?"?w.state=P.PROC_INST_ENDING:b(T)?w.state=P.PROC_INST_BODY:w.procInstName+=T;continue;case P.PROC_INST_BODY:if(!w.procInstBody&&b(T))continue;T==="?"?w.state=P.PROC_INST_ENDING:w.procInstBody+=T;continue;case P.PROC_INST_ENDING:T===">"?(le(w,"onprocessinginstruction",{name:w.procInstName,body:w.procInstBody}),w.procInstName=w.procInstBody="",w.state=P.TEXT):(w.procInstBody+="?"+T,w.state=P.PROC_INST_BODY);continue;case P.OPEN_TAG:I(v,T)?w.tagName+=T:(rt(w),T===">"?te(w):T==="/"?w.state=P.OPEN_TAG_SLASH:(b(T)||ce(w,"Invalid character in tag name"),w.state=P.ATTRIB));continue;case P.OPEN_TAG_SLASH:T===">"?(te(w,!0),_e(w)):(ce(w,"Forward-slash in opening tag not followed by >"),w.state=P.ATTRIB);continue;case P.ATTRIB:if(b(T))continue;T===">"?te(w):T==="/"?w.state=P.OPEN_TAG_SLASH:I(y,T)?(w.attribName=T,w.attribValue="",w.state=P.ATTRIB_NAME):ce(w,"Invalid attribute name");continue;case P.ATTRIB_NAME:T==="="?w.state=P.ATTRIB_VALUE:T===">"?(ce(w,"Attribute without value"),w.attribValue=w.attribName,ie(w),te(w)):b(T)?w.state=P.ATTRIB_NAME_SAW_WHITE:I(v,T)?w.attribName+=T:ce(w,"Invalid attribute name");continue;case P.ATTRIB_NAME_SAW_WHITE:if(T==="=")w.state=P.ATTRIB_VALUE;else{if(b(T))continue;ce(w,"Attribute without value"),w.tag.attributes[w.attribName]="",w.attribValue="",le(w,"onattribute",{name:w.attribName,value:""}),w.attribName="",T===">"?te(w):I(y,T)?(w.attribName=T,w.state=P.ATTRIB_NAME):(ce(w,"Invalid attribute name"),w.state=P.ATTRIB)}continue;case P.ATTRIB_VALUE:if(b(T))continue;S(T)?(w.q=T,w.state=P.ATTRIB_VALUE_QUOTED):(ce(w,"Unquoted attribute value"),w.state=P.ATTRIB_VALUE_UNQUOTED,w.attribValue=T);continue;case P.ATTRIB_VALUE_QUOTED:if(T!==w.q){T==="&"?w.state=P.ATTRIB_VALUE_ENTITY_Q:w.attribValue+=T;continue}ie(w),w.q="",w.state=P.ATTRIB_VALUE_CLOSED;continue;case P.ATTRIB_VALUE_CLOSED:b(T)?w.state=P.ATTRIB:T===">"?te(w):T==="/"?w.state=P.OPEN_TAG_SLASH:I(y,T)?(ce(w,"No whitespace between attributes"),w.attribName=T,w.attribValue="",w.state=P.ATTRIB_NAME):ce(w,"Invalid attribute name");continue;case P.ATTRIB_VALUE_UNQUOTED:if(!E(T)){T==="&"?w.state=P.ATTRIB_VALUE_ENTITY_U:w.attribValue+=T;continue}ie(w),T===">"?te(w):w.state=P.ATTRIB;continue;case P.CLOSE_TAG:if(w.tagName)T===">"?_e(w):I(v,T)?w.tagName+=T:w.script?(w.script+="</"+w.tagName,w.tagName="",w.state=P.SCRIPT):(b(T)||ce(w,"Invalid tagname in closing tag"),w.state=P.CLOSE_TAG_SAW_WHITE);else{if(b(T))continue;j(y,T)?w.script?(w.script+="</"+T,w.state=P.SCRIPT):ce(w,"Invalid tagname in closing tag."):w.tagName=T}continue;case P.CLOSE_TAG_SAW_WHITE:if(b(T))continue;T===">"?_e(w):ce(w,"Invalid characters in closing tag");continue;case P.TEXT_ENTITY:case P.ATTRIB_VALUE_ENTITY_Q:case P.ATTRIB_VALUE_ENTITY_U:var $e,He;switch(w.state){case P.TEXT_ENTITY:$e=P.TEXT,He="textNode";break;case P.ATTRIB_VALUE_ENTITY_Q:$e=P.ATTRIB_VALUE_QUOTED,He="attribValue";break;case P.ATTRIB_VALUE_ENTITY_U:$e=P.ATTRIB_VALUE_UNQUOTED,He="attribValue";break}if(T===";")if(w.opt.unparsedEntities){var ct=Ne(w);w.entity="",w.state=$e,w.write(ct)}else w[He]+=Ne(w),w.entity="",w.state=$e;else I(w.entity.length?m:g,T)?w.entity+=T:(ce(w,"Invalid character in entity name"),w[He]+="&"+w.entity+T,w.entity="",w.state=$e);continue;default:throw new Error(w,"Unknown state: "+w.state)}return w.position>=w.bufferCheckPosition&&n(w),w}/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */return String.fromCodePoint||function(){var _=String.fromCharCode,w=Math.floor,N=function(){var T=16384,ye=[],ke,$e,He=-1,ct=arguments.length;if(!ct)return"";for(var Kr="";++He<ct;){var We=Number(arguments[He]);if(!isFinite(We)||We<0||We>1114111||w(We)!==We)throw RangeError("Invalid code point: "+We);We<=65535?ye.push(We):(We-=65536,ke=(We>>10)+55296,$e=We%1024+56320,ye.push(ke,$e)),(He+1===ct||ye.length>T)&&(Kr+=_.apply(null,ye),ye.length=0)}return Kr};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:N,configurable:!0,writable:!0}):String.fromCodePoint=N}(),t},C2=I2(),Og=`The output should be formatted as a XML file.
1. Output should conform to the tags below. 
2. If tags are not given, make them on your own.
3. Remember to always open and close all the tags.

As an example, for the tags ["foo", "bar", "baz"]:
1. String "<foo>
   <bar>
      <baz></baz>
   </bar>
</foo>" is a well-formatted instance of the schema. 
2. String "<foo>
   <bar>
   </foo>" is a badly-formatted instance.
3. String "<foo>
   <tag>
   </tag>
</foo>" is a badly-formatted instance.

Here are the output tags:
\`\`\`
{tags}
\`\`\``;class R2 extends kf{constructor(e){super(e),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.tags=e==null?void 0:e.tags}static lc_name(){return"XMLOutputParser"}_diff(e,r){if(r)return e?yf(e,r):[{op:"replace",path:"",value:r}]}async parsePartialResult(e){return Sg(e[0].text)}async parse(e){return Sg(e)}getFormatInstructions(){var r;return!!(this.tags&&this.tags.length>0)?Og.replace("{tags}",((r=this.tags)==null?void 0:r.join(", "))??""):Og}}const j2=t=>t.split(`
`).map(e=>e.replace(/^\s+/,"")).join(`
`).trim(),OE=t=>{if(Object.keys(t).length===0)return{};const e={};return t.children.length>0?(e[t.name]=t.children.map(OE),e):(e[t.name]=t.text??void 0,e)};function Sg(t){const e=j2(t),r=C2.parser(!0);let n={};const i=[];r.onopentag=o=>{const u={name:o.name,attributes:o.attributes,children:[],text:"",isSelfClosing:o.isSelfClosing};i.length>0?i[i.length-1].children.push(u):n=u,o.isSelfClosing||i.push(u)},r.onclosetag=()=>{if(i.length>0){const o=i.pop();i.length===0&&o&&(n=o)}},r.ontext=o=>{if(i.length>0){const u=i[i.length-1];u.text+=o}},r.onattribute=o=>{if(i.length>0){const u=i[i.length-1];u.attributes[o.name]=o.value}};const s=/```(xml)?(.*)```/s.exec(e),a=s?s[2]:e;return r.write(a).close(),n&&n.name==="?xml"&&(n=n.children[0]),OE(n)}const N2=Object.freeze(Object.defineProperty({__proto__:null,AsymmetricStructuredOutputParser:A2,BaseCumulativeTransformOutputParser:kf,BaseLLMOutputParser:an,BaseOutputParser:It,BaseTransformOutputParser:Ao,BytesOutputParser:x2,CommaSeparatedListOutputParser:wE,CustomListOutputParser:vE,JsonMarkdownStructuredOutputParser:_E,JsonOutputParser:PE,ListOutputParser:ko,MarkdownListOutputParser:T2,NumberedListOutputParser:E2,OutputParserException:je,StringOutputParser:Io,StructuredOutputParser:Sb,XMLOutputParser:R2,XML_FORMAT_INSTRUCTIONS:Og,parseJsonMarkdown:cg,parsePartialJson:lo,parseXMLMarkdown:Sg},Symbol.toStringTag,{value:"Module"}));class $2 extends It{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","default"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"NoOpOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}}function L2(t){return typeof t._llmType=="function"}function Wc(t){if(L2(t))return t;if("bound"in t&&xe.isRunnable(t.bound))return Wc(t.bound);if("runnable"in t&&"fallbacks"in t&&xe.isRunnable(t.runnable))return Wc(t.runnable);if("default"in t&&xe.isRunnable(t.default))return Wc(t.default);throw new Error("Unable to extract BaseLanguageModel from llmLike object.")}class Q extends Ae{static lc_name(){return"LLMChain"}get inputKeys(){return this.prompt.inputVariables}get outputKeys(){return[this.outputKey]}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llmKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"text"}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,this.llm=e.llm,this.llmKwargs=e.llmKwargs,this.outputKey=e.outputKey??this.outputKey,this.outputParser=e.outputParser??new $2,this.prompt.outputParser){if(e.outputParser)throw new Error("Cannot set both outputParser and prompt.outputParser");this.outputParser=this.prompt.outputParser}}getCallKeys(){return"callKeys"in this.llm?this.llm.callKeys:[]}_selectMemoryInputs(e){const r=super._selectMemoryInputs(e),n=this.getCallKeys();for(const i of n)i in e&&delete r[i];return r}async _getFinalOutput(e,r,n){let i;return this.outputParser?i=await this.outputParser.parseResultWithPrompt(e,r,n==null?void 0:n.getChild()):i=e[0].text,i}call(e,r){return super.call(e,r)}async _call(e,r){const n={...e},i={...this.llmKwargs},s=this.getCallKeys();for(const l of s)l in e&&i&&(i[l]=e[l],delete n[l]);const a=await this.prompt.formatPromptValue(n);if("generatePrompt"in this.llm){const{generations:l}=await this.llm.generatePrompt([a],i,r==null?void 0:r.getChild());return{[this.outputKey]:await this._getFinalOutput(l[0],a,r)}}const u=await(this.outputParser?this.llm.pipe(this.outputParser):this.llm).invoke(a,r==null?void 0:r.getChild());return{[this.outputKey]:u}}async predict(e,r){return(await this.call(e,r))[this.outputKey]}_chainType(){return"llm"}static async deserialize(e){const{llm:r,prompt:n}=e;if(!r)throw new Error("LLMChain must have llm");if(!n)throw new Error("LLMChain must have prompt");return new Q({llm:await Of.deserialize(r),prompt:await Eo.deserialize(n)})}serialize(){const e="serialize"in this.llm?this.llm.serialize():void 0;return{_type:`${this._chainType()}_chain`,llm:e,prompt:this.prompt.serialize()}}_getNumTokens(e){return Wc(this.llm).getNumTokens(e)}}const D2=Object.freeze(Object.defineProperty({__proto__:null,LLMChain:Q},Symbol.toStringTag,{value:"Module"}));class vi extends Ae{static lc_name(){return"StuffDocumentsChain"}get inputKeys(){return[this.inputKey,...this.llmChain.inputKeys].filter(e=>e!==this.documentVariableName)}get outputKeys(){return this.llmChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),this.llmChain=e.llmChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey}_prepInputs(e){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:r,...n}=e,s=r.map(({pageContent:a})=>a).join(`

`);return{...n,[this.documentVariableName]:s}}async _call(e,r){return await this.llmChain.call(this._prepInputs(e),r==null?void 0:r.getChild("combine_documents"))}_chainType(){return"stuff_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");return new vi({llmChain:await Q.deserialize(e.llm_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize()}}}class Co extends Ae{static lc_name(){return"MapReduceDocumentsChain"}get inputKeys(){return[this.inputKey,...this.combineDocumentChain.inputKeys]}get outputKeys(){return this.combineDocumentChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"ensureMapStep",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineDocumentChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain,this.combineDocumentChain=e.combineDocumentChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.ensureMapStep=e.ensureMapStep??this.ensureMapStep,this.inputKey=e.inputKey??this.inputKey,this.maxTokens=e.maxTokens??this.maxTokens,this.maxIterations=e.maxIterations??this.maxIterations,this.returnIntermediateSteps=e.returnIntermediateSteps??!1}async _call(e,r){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:n,...i}=e;let s=n,a=[];for(let l=0;l<this.maxIterations;l+=1){const c=s.map(p=>({[this.documentVariableName]:p.pageContent,...i}));if(l!==0||!this.ensureMapStep){const p=await this.combineDocumentChain.llmChain.prompt.format(this.combineDocumentChain._prepInputs({[this.combineDocumentChain.inputKey]:s,...i}));if(await this.combineDocumentChain.llmChain._getNumTokens(p)<this.maxTokens)break}const d=await this.llmChain.apply(c,r?Array.from({length:c.length},(p,y)=>r.getChild(`map_${y+1}`)):void 0),{outputKey:f}=this.llmChain;this.returnIntermediateSteps&&(a=a.concat(d.map(p=>p[f]))),s=d.map(p=>({pageContent:p[f],metadata:{}}))}const o={[this.combineDocumentChain.inputKey]:s,...i},u=await this.combineDocumentChain.call(o,r==null?void 0:r.getChild("combine_documents"));return this.returnIntermediateSteps?{...u,intermediateSteps:a}:u}_chainType(){return"map_reduce_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");if(!e.combine_document_chain)throw new Error("Missing combine_document_chain");return new Co({llmChain:await Q.deserialize(e.llm_chain),combineDocumentChain:await vi.deserialize(e.combine_document_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),combine_document_chain:this.combineDocumentChain.serialize()}}}class Ro extends Ae{static lc_name(){return"RefineDocumentsChain"}get defaultDocumentPrompt(){return new W({inputVariables:["page_content"],template:"{page_content}"})}get inputKeys(){return[...new Set([this.inputKey,...this.llmChain.inputKeys,...this.refineLLMChain.inputKeys])].filter(e=>e!==this.documentVariableName&&e!==this.initialResponseName)}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"initialResponseName",{enumerable:!0,configurable:!0,writable:!0,value:"existing_answer"}),Object.defineProperty(this,"refineLLMChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentPrompt",{enumerable:!0,configurable:!0,writable:!0,value:this.defaultDocumentPrompt}),this.llmChain=e.llmChain,this.refineLLMChain=e.refineLLMChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.documentPrompt=e.documentPrompt??this.documentPrompt,this.initialResponseName=e.initialResponseName??this.initialResponseName}async _constructInitialInputs(e,r){const n={page_content:e.pageContent,...e.metadata},i={};return this.documentPrompt.inputVariables.forEach(o=>{i[o]=n[o]}),{...{[this.documentVariableName]:await this.documentPrompt.format({...i})},...r}}async _constructRefineInputs(e,r){const n={page_content:e.pageContent,...e.metadata},i={};this.documentPrompt.inputVariables.forEach(o=>{i[o]=n[o]});const s={[this.documentVariableName]:await this.documentPrompt.format({...i})};return{[this.initialResponseName]:r,...s}}async _call(e,r){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:n,...i}=e,s=n,a=await this._constructInitialInputs(s[0],i);let o=await this.llmChain.predict({...a},r==null?void 0:r.getChild("answer"));for(let u=1;u<s.length;u+=1){const c={...await this._constructRefineInputs(s[u],o),...i};o=await this.refineLLMChain.predict({...c},r==null?void 0:r.getChild("refine"))}return{[this.outputKey]:o}}_chainType(){return"refine_documents_chain"}static async deserialize(e){const r=e.llm_chain;if(!r)throw new Error("Missing llm_chain");const n=e.refine_llm_chain;if(!n)throw new Error("Missing refine_llm_chain");return new Ro({llmChain:await Q.deserialize(r),refineLLMChain:await Q.deserialize(n)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),refine_llm_chain:this.refineLLMChain.serialize()}}}const zp=Object.freeze(Object.defineProperty({__proto__:null,MapReduceDocumentsChain:Co,RefineDocumentsChain:Ro,StuffDocumentsChain:vi},Symbol.toStringTag,{value:"Module"}));class xb extends St{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","example_selectors","base"]})}}class SE{async getPromptAsync(e,r){return this.getPrompt(e).partial((r==null?void 0:r.partialVariables)??{})}}class jo extends SE{constructor(e,r=[]){super(),Object.defineProperty(this,"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultPrompt=e,this.conditionals=r}getPrompt(e){for(const[r,n]of this.conditionals)if(r(e))return n;return this.defaultPrompt}}function M2(t){return t._modelType()==="base_llm"}function No(t){return t._modelType()==="base_chat_model"}function r0(t){return t.split(/\n| /).length}class Eb extends xb{constructor(e){super(e),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getTextLength",{enumerable:!0,configurable:!0,writable:!0,value:r0}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"exampleTextLengths",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.examplePrompt=e.examplePrompt,this.maxLength=e.maxLength??2048,this.getTextLength=e.getTextLength??r0}async addExample(e){this.examples.push(e);const r=await this.examplePrompt.format(e);this.exampleTextLengths.push(this.getTextLength(r))}async calculateExampleTextLengths(e,r){if(e.length>0)return e;const{examples:n,examplePrompt:i}=r;return(await Promise.all(n.map(a=>i.format(a)))).map(a=>this.getTextLength(a))}async selectExamples(e){const r=Object.values(e).join(" ");let n=this.maxLength-this.getTextLength(r),i=0;const s=[];for(;n>0&&i<this.examples.length;){const a=n-this.exampleTextLengths[i];if(a<0)break;s.push(this.examples[i]),n=a,i+=1}return s}static async fromExamples(e,r){const n=new Eb(r);return await Promise.all(e.map(i=>n.addExample(i))),n}}class Lt{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent?e.pageContent.toString():this.pageContent,this.metadata=e.metadata??{}}}function Up(t){return Object.keys(t).sort().map(e=>t[e])}class Tb extends xb{constructor(e){if(super(e),Object.defineProperty(this,"vectorStoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.exampleKeys=e.exampleKeys,this.inputKeys=e.inputKeys,e.vectorStore!==void 0)this.vectorStoreRetriever=e.vectorStore.asRetriever({k:e.k??4,filter:e.filter});else if(e.vectorStoreRetriever)this.vectorStoreRetriever=e.vectorStoreRetriever;else throw new Error('You must specify one of "vectorStore" and "vectorStoreRetriever".')}async addExample(e){const r=this.inputKeys??Object.keys(e),n=Up(r.reduce((i,s)=>({...i,[s]:e[s]}),{})).join(" ");await this.vectorStoreRetriever.addDocuments([new Lt({pageContent:n,metadata:e})])}async selectExamples(e){const r=this.inputKeys??Object.keys(e),n=Up(r.reduce((a,o)=>({...a,[o]:e[o]}),{})).join(" "),s=(await this.vectorStoreRetriever.invoke(n)).map(a=>a.metadata);return this.exampleKeys?s.map(a=>this.exampleKeys.reduce((o,u)=>({...o,[u]:a[u]}),{})):s}static async fromExamples(e,r,n,i={}){const s=i.inputKeys??null,a=e.map(u=>Up(s?s.reduce((l,c)=>({...l,[c]:u[c]}),{}):u).join(" ")),o=await n.fromTexts(a,e,r,i);return new Tb({vectorStore:o,k:i.k??4,exampleKeys:i.exampleKeys,inputKeys:i.inputKeys})}}const F2=Object.freeze(Object.defineProperty({__proto__:null,BaseExampleSelector:xb,BasePromptSelector:SE,ConditionalPromptSelector:jo,LengthBasedExampleSelector:Eb,SemanticSimilarityExampleSelector:Tb,isChatModel:No,isLLM:M2},Symbol.toStringTag,{value:"Module"})),z2=new W({template:`Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.

{context}

Question: {question}
Helpful Answer:`,inputVariables:["context","question"]}),U2=`Use the following pieces of context to answer the users question. 
If you don't know the answer, just say that you don't know, don't try to make up an answer.
----------------
{context}`,q2=[xr.fromTemplate(U2),lt.fromTemplate("{question}")],K2=it.fromMessages(q2),V2=new jo(z2,[[No,K2]]),B2=`Use the following portion of a long document to see if any of the text is relevant to answer the question. 
Return any relevant text verbatim.
{context}
Question: {question}
Relevant text, if any:`,H2=W.fromTemplate(B2),W2=`Use the following portion of a long document to see if any of the text is relevant to answer the question. 
Return any relevant text verbatim.
----------------
{context}`,J2=[xr.fromTemplate(W2),lt.fromTemplate("{question}")],G2=it.fromMessages(J2),Z2=new jo(H2,[[No,G2]]),Y2=`Given the following extracted parts of a long document and a question, create a final answer. 
If you don't know the answer, just say that you don't know. Don't try to make up an answer.

QUESTION: Which state/country's law governs the interpretation of the contract?
=========
Content: This Agreement is governed by English law and the parties submit to the exclusive jurisdiction of the English courts in  relation to any dispute (contractual or non-contractual) concerning this Agreement save that either party may apply to any court for an  injunction or other relief to protect its Intellectual Property Rights.

Content: No Waiver. Failure or delay in exercising any right or remedy under this Agreement shall not constitute a waiver of such (or any other)  right or remedy.

11.7 Severability. The invalidity, illegality or unenforceability of any term (or part of a term) of this Agreement shall not affect the continuation  in force of the remainder of the term (if any) and this Agreement.

11.8 No Agency. Except as expressly stated otherwise, nothing in this Agreement shall create an agency, partnership or joint venture of any  kind between the parties.

11.9 No Third-Party Beneficiaries.

Content: (b) if Google believes, in good faith, that the Distributor has violated or caused Google to violate any Anti-Bribery Laws (as  defined in Clause 8.5) or that such a violation is reasonably likely to occur,
=========
FINAL ANSWER: This Agreement is governed by English law.

QUESTION: What did the president say about Michael Jackson?
=========
Content: Madam Speaker, Madam Vice President, our First Lady and Second Gentleman. Members of Congress and the Cabinet. Justices of the Supreme Court. My fellow Americans.  

Last year COVID-19 kept us apart. This year we are finally together again. 

Tonight, we meet as Democrats Republicans and Independents. But most importantly as Americans. 

With a duty to one another to the American people to the Constitution. 

And with an unwavering resolve that freedom will always triumph over tyranny. 

Six days ago, Russias Vladimir Putin sought to shake the foundations of the free world thinking he could make it bend to his menacing ways. But he badly miscalculated. 

He thought he could roll into Ukraine and the world would roll over. Instead he met a wall of strength he never imagined. 

He met the Ukrainian people. 

From President Zelenskyy to every Ukrainian, their fearlessness, their courage, their determination, inspires the world. 

Groups of citizens blocking tanks with their bodies. Everyone from students to retirees teachers turned soldiers defending their homeland.

Content: And we wont stop. 

We have lost so much to COVID-19. Time with one another. And worst of all, so much loss of life. 

Lets use this moment to reset. Lets stop looking at COVID-19 as a partisan dividing line and see it for what it is: A God-awful disease.  

Lets stop seeing each other as enemies, and start seeing each other for who we really are: Fellow Americans.  

We cant change how divided weve been. But we can change how we move forwardon COVID-19 and other issues we must face together. 

I recently visited the New York City Police Department days after the funerals of Officer Wilbert Mora and his partner, Officer Jason Rivera. 

They were responding to a 9-1-1 call when a man shot and killed them with a stolen gun. 

Officer Mora was 27 years old. 

Officer Rivera was 22. 

Both Dominican Americans whod grown up on the same streets they later chose to patrol as police officers. 

I spoke with their families and told them that we are forever in debt for their sacrifice, and we will carry on their mission to restore the trust and safety every community deserves.

Content: And a proud Ukrainian people, who have known 30 years  of independence, have repeatedly shown that they will not tolerate anyone who tries to take their country backwards.  

To all Americans, I will be honest with you, as Ive always promised. A Russian dictator, invading a foreign country, has costs around the world. 

And Im taking robust action to make sure the pain of our sanctions  is targeted at Russias economy. And I will use every tool at our disposal to protect American businesses and consumers. 

Tonight, I can announce that the United States has worked with 30 other countries to release 60 Million barrels of oil from reserves around the world.  

America will lead that effort, releasing 30 Million barrels from our own Strategic Petroleum Reserve. And we stand ready to do more if necessary, unified with our allies.  

These steps will help blunt gas prices here at home. And I know the news about whats happening can seem alarming. 

But I want you to know that we are going to be okay.

Content: More support for patients and families. 

To get there, I call on Congress to fund ARPA-H, the Advanced Research Projects Agency for Health. 

Its based on DARPAthe Defense Department project that led to the Internet, GPS, and so much more.  

ARPA-H will have a singular purposeto drive breakthroughs in cancer, Alzheimers, diabetes, and more. 

A unity agenda for the nation. 

We can do this. 

My fellow Americanstonight , we have gathered in a sacred spacethe citadel of our democracy. 

In this Capitol, generation after generation, Americans have debated great questions amid great strife, and have done great things. 

We have fought for freedom, expanded liberty, defeated totalitarianism and terror. 

And built the strongest, freest, and most prosperous nation the world has ever known. 

Now is the hour. 

Our moment of responsibility. 

Our test of resolve and conscience, of history itself. 

It is in this moment that our character is formed. Our purpose is found. Our future is forged. 

Well I know this nation.
=========
FINAL ANSWER: The president did not mention Michael Jackson.

QUESTION: {question}
=========
{summaries}
=========
FINAL ANSWER:`,Q2=W.fromTemplate(Y2),X2=`Given the following extracted parts of a long document and a question, create a final answer. 
If you don't know the answer, just say that you don't know. Don't try to make up an answer.
----------------
{summaries}`,eF=[xr.fromTemplate(X2),lt.fromTemplate("{question}")],tF=it.fromMessages(eF),rF=new jo(Q2,[[No,tF]]),nF=`The original question is as follows: {question}
We have provided an existing answer: {existing_answer}
We have the opportunity to refine the existing answer
(only if needed) with some more context below.
------------
{context}
------------
Given the new context, refine the original answer to better answer the question. 
If the context isn't useful, return the original answer.`,iF=new W({inputVariables:["question","existing_answer","context"],template:nF}),sF=`The original question is as follows: {question}
We have provided an existing answer: {existing_answer}
We have the opportunity to refine the existing answer
(only if needed) with some more context below.
------------
{context}
------------
Given the new context, refine the original answer to better answer the question. 
If the context isn't useful, return the original answer.`,aF=[lt.fromTemplate("{question}"),la.fromTemplate("{existing_answer}"),lt.fromTemplate(sF)],oF=it.fromMessages(aF),uF=new jo(iF,[[No,oF]]),lF=`Context information is below. 
---------------------
{context}
---------------------
Given the context information and no prior knowledge, answer the question: {question}`,cF=new W({inputVariables:["context","question"],template:lF}),hF=`Context information is below. 
---------------------
{context}
---------------------
Given the context information and no prior knowledge, answer any questions`,dF=[xr.fromTemplate(hF),lt.fromTemplate("{question}")],fF=it.fromMessages(dF),pF=new jo(cF,[[No,fF]]),xE=(t,e={type:"stuff"})=>{const{type:r}=e;if(r==="stuff")return Kl(t,e);if(r==="map_reduce")return EE(t,e);if(r==="refine")return TE(t,e);throw new Error(`Invalid _type: ${r}`)};function Kl(t,e={}){const{prompt:r=V2.getPrompt(t),verbose:n}=e,i=new Q({prompt:r,llm:t,verbose:n});return new vi({llmChain:i,verbose:n})}function EE(t,e={}){const{combineMapPrompt:r=Z2.getPrompt(t),combinePrompt:n=rF.getPrompt(t),verbose:i,combineLLM:s,returnIntermediateSteps:a}=e,o=new Q({prompt:r,llm:t,verbose:i}),u=new Q({prompt:n,llm:s??t,verbose:i}),l=new vi({llmChain:u,documentVariableName:"summaries",verbose:i});return new Co({llmChain:o,combineDocumentChain:l,returnIntermediateSteps:a,verbose:i})}function TE(t,e={}){const{questionPrompt:r=pF.getPrompt(t),refinePrompt:n=uF.getPrompt(t),refineLLM:i,verbose:s}=e,a=new Q({prompt:r,llm:t,verbose:s}),o=new Q({prompt:n,llm:i??t,verbose:s});return new Ro({llmChain:a,refineLLMChain:o,verbose:s})}class Vl extends Ae{static lc_name(){return"VectorDBQAChain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(e){super(e),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"query"}),Object.defineProperty(this,"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.vectorstore=e.vectorstore,this.combineDocumentsChain=e.combineDocumentsChain,this.inputKey=e.inputKey??this.inputKey,this.k=e.k??this.k,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments}async _call(e,r){if(!(this.inputKey in e))throw new Error(`Question key ${this.inputKey} not found.`);const n=e[this.inputKey],i=await this.vectorstore.similaritySearch(n,this.k,e.filter,r==null?void 0:r.getChild("vectorstore")),s={question:n,input_documents:i},a=await this.combineDocumentsChain.call(s,r==null?void 0:r.getChild("combine_documents"));return this.returnSourceDocuments?{...a,sourceDocuments:i}:a}_chainType(){return"vector_db_qa"}static async deserialize(e,r){if(!("vectorstore"in r))throw new Error("Need to pass in a vectorstore to deserialize VectorDBQAChain");const{vectorstore:n}=r;if(!e.combine_documents_chain)throw new Error("VectorDBQAChain must have combine_documents_chain in serialized data");return new Vl({combineDocumentsChain:await Ae.deserialize(e.combine_documents_chain),k:e.k,vectorstore:n})}serialize(){return{_type:this._chainType(),combine_documents_chain:this.combineDocumentsChain.serialize(),k:this.k}}static fromLLM(e,r,n){const i=Kl(e);return new this({vectorstore:r,combineDocumentsChain:i,...n})}}const mF=Object.freeze(Object.defineProperty({__proto__:null,VectorDBQAChain:Vl},Symbol.toStringTag,{value:"Module"}));class yl extends Ei{static lc_name(){return"VectorStoreQATool"}constructor(e,r,n){super(...arguments),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e,this.description=r,this.vectorStore=n.vectorStore,this.llm=n.llm,this.chain=Vl.fromLLM(this.llm,this.vectorStore)}static getDescription(e,r){return`Useful for when you need to answer questions about ${e}. Whenever you need information about ${r} you should ALWAYS use this. Input should be a fully formed question.`}async _call(e){return this.chain.run(e)}}class gF extends ys{static lc_name(){return"ReadFileTool"}constructor({store:e}){super(...arguments),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:Ce.object({file_path:Ce.string().describe("name of file")})}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"read_file"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"Read file from disk"}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.store=e}async _call({file_path:e}){return await this.store.readFile(e)}}class yF extends ys{static lc_name(){return"WriteFileTool"}constructor({store:e,...r}){super(r),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:Ce.object({file_path:Ce.string().describe("name of file"),text:Ce.string().describe("text to write to file")})}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"write_file"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"Write file from disk"}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.store=e}async _call({file_path:e,text:r}){return await this.store.writeFile(e,r),"File written to successfully."}}function Bl(t){return{name:t.name,description:t.description,parameters:Zt(t.schema)}}function bl(t){return AE(t)?{type:"function",function:Bl(t)}:t}function AE(t){return t!==void 0&&Array.isArray(t.lc_namespace)}const bF=Object.freeze(Object.defineProperty({__proto__:null,convertToOpenAIFunction:Bl,convertToOpenAITool:bl,isStructuredTool:AE},Symbol.toStringTag,{value:"Module"})),wF=Object.freeze(Object.defineProperty({__proto__:null,ChainTool:rE,DynamicStructuredTool:Sf,DynamicTool:zl,JsonGetValueTool:oE,JsonListKeysTool:aE,JsonSpec:bM,ReadFileTool:gF,RequestsGetTool:uE,RequestsPostTool:lE,StructuredTool:ys,Tool:Ei,VectorStoreQATool:yl,WriteFileTool:yF,formatToOpenAIFunction:Bl,formatToOpenAITool:bl},Symbol.toStringTag,{value:"Module"})),wa="4.50.0";let n0=!1,Tu,kE,IE,xg,CE,RE,jE,NE,$E;function vF(t,e={auto:!1}){if(n0)throw new Error(`you must \`import 'openai/shims/${t.kind}'\` before importing anything else from openai`);if(Tu)throw new Error(`can't \`import 'openai/shims/${t.kind}'\` after \`import 'openai/shims/${Tu}'\``);n0=e.auto,Tu=t.kind,kE=t.fetch,IE=t.FormData,xg=t.File,CE=t.ReadableStream,RE=t.getMultipartRequestOptions,jE=t.getDefaultAgent,NE=t.fileFromPath,$E=t.isFsReadStream}class _F{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function PF({manuallyImported:t}={}){const e=t?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let r,n,i,s;try{r=fetch,n=Request,i=Response,s=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:r,Request:n,Response:i,Headers:s,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new _F(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}Tu||vF(PF(),{auto:!0});let ve=class extends Error{},ar=class Eg extends ve{constructor(e,r,n,i){super(`${Eg.makeMessage(e,r,n)}`),this.status=e,this.headers=i,this.request_id=i==null?void 0:i["x-request-id"];const s=r;this.error=s,this.code=s==null?void 0:s.code,this.param=s==null?void 0:s.param,this.type=s==null?void 0:s.type}static makeMessage(e,r,n){const i=r!=null&&r.message?typeof r.message=="string"?r.message:JSON.stringify(r.message):r?JSON.stringify(r):n;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,r,n,i){if(!e)return new Hl({cause:Ag(r)});const s=r==null?void 0:r.error;return e===400?new Ab(e,s,n,i):e===401?new kb(e,s,n,i):e===403?new Ib(e,s,n,i):e===404?new Cb(e,s,n,i):e===409?new Rb(e,s,n,i):e===422?new jb(e,s,n,i):e===429?new Nb(e,s,n,i):e>=500?new $b(e,s,n,i):new Eg(e,s,n,i)}},gr=class extends ar{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},Hl=class extends ar{constructor({message:e,cause:r}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,r&&(this.cause=r)}},If=class extends Hl{constructor({message:e}={}){super({message:e??"Request timed out."})}},Ab=class extends ar{constructor(){super(...arguments),this.status=400}},kb=class extends ar{constructor(){super(...arguments),this.status=401}},Ib=class extends ar{constructor(){super(...arguments),this.status=403}},Cb=class extends ar{constructor(){super(...arguments),this.status=404}},Rb=class extends ar{constructor(){super(...arguments),this.status=409}},jb=class extends ar{constructor(){super(...arguments),this.status=422}},Nb=class extends ar{constructor(){super(...arguments),this.status=429}},$b=class extends ar{};const OF=Object.freeze(Object.defineProperty({__proto__:null,APIConnectionError:Hl,APIConnectionTimeoutError:If,APIError:ar,APIUserAbortError:gr,AuthenticationError:kb,BadRequestError:Ab,ConflictError:Rb,InternalServerError:$b,NotFoundError:Cb,OpenAIError:ve,PermissionDeniedError:Ib,RateLimitError:Nb,UnprocessableEntityError:jb},Symbol.toStringTag,{value:"Module"}));class Wn{constructor(e,r){this.iterator=e,this.controller=r}static fromSSEResponse(e,r){let n=!1;async function*i(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let s=!1;try{for await(const a of SF(e,r))if(!s){if(a.data.startsWith("[DONE]")){s=!0;continue}if(a.event===null){let o;try{o=JSON.parse(a.data)}catch(u){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),u}if(o&&o.error)throw new ar(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(a.data)}catch(u){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),u}if(a.event=="error")throw new ar(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}s=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{s||r.abort()}}return new Wn(i,r)}static fromReadableStream(e,r){let n=!1;async function*i(){const a=new Ys,o=LE(e);for await(const u of o)for(const l of a.decode(u))yield l;for(const u of a.flush())yield u}async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const o of i())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||r.abort()}}return new Wn(s,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],r=[],n=this.iterator(),i=s=>({next:()=>{if(s.length===0){const a=n.next();e.push(a),r.push(a)}return s.shift()}});return[new Wn(()=>i(e),this.controller),new Wn(()=>i(r),this.controller)]}toReadableStream(){const e=this;let r;const n=new TextEncoder;return new CE({async start(){r=e[Symbol.asyncIterator]()},async pull(i){try{const{value:s,done:a}=await r.next();if(a)return i.close();const o=n.encode(JSON.stringify(s)+`
`);i.enqueue(o)}catch(s){i.error(s)}},async cancel(){var i;await((i=r.return)==null?void 0:i.call(r))}})}}async function*SF(t,e){if(!t.body)throw e.abort(),new ve("Attempted to iterate over a response with no body");const r=new TF,n=new Ys,i=LE(t.body);for await(const s of xF(i))for(const a of n.decode(s)){const o=r.decode(a);o&&(yield o)}for(const s of n.flush()){const a=r.decode(s);a&&(yield a)}}async function*xF(t){let e=new Uint8Array;for await(const r of t){if(r==null)continue;const n=r instanceof ArrayBuffer?new Uint8Array(r):typeof r=="string"?new TextEncoder().encode(r):r;let i=new Uint8Array(e.length+n.length);i.set(e),i.set(n,e.length),e=i;let s;for(;(s=EF(e))!==-1;)yield e.slice(0,s),e=e.slice(s)}e.length>0&&(yield e)}function EF(t){for(let n=0;n<t.length-2;n++){if(t[n]===10&&t[n+1]===10||t[n]===13&&t[n+1]===13)return n+2;if(t[n]===13&&t[n+1]===10&&n+3<t.length&&t[n+2]===13&&t[n+3]===10)return n+4}return-1}class TF{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const s={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],s}if(this.chunks.push(e),e.startsWith(":"))return null;let[r,n,i]=AF(e,":");return i.startsWith(" ")&&(i=i.substring(1)),r==="event"?this.event=i:r==="data"&&this.data.push(i),null}}class Ys{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let r=this.decodeText(e);if(this.trailingCR&&(r="\r"+r,this.trailingCR=!1),r.endsWith("\r")&&(this.trailingCR=!0,r=r.slice(0,-1)),!r)return[];const n=Ys.NEWLINE_CHARS.has(r[r.length-1]||"");let i=r.split(Ys.NEWLINE_REGEXP);return n&&i.pop(),i.length===1&&!n?(this.buffer.push(i[0]),[]):(this.buffer.length>0&&(i=[this.buffer.join("")+i[0],...i.slice(1)],this.buffer=[]),n||(this.buffer=[i.pop()||""]),i)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new ve(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new ve(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new ve("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}Ys.NEWLINE_CHARS=new Set([`
`,"\r"]);Ys.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function AF(t,e){const r=t.indexOf(e);return r!==-1?[t.substring(0,r),e,t.substring(r+e.length)]:[t,"",""]}function LE(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const r=await e.read();return r!=null&&r.done&&e.releaseLock(),r}catch(r){throw e.releaseLock(),r}},async return(){const r=e.cancel();return e.releaseLock(),await r,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const DE=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function",ME=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&Lb(t),Lb=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",kF=t=>ME(t)||DE(t)||$E(t);async function FE(t,e,r){var i;if(t=await t,r??(r=ME(t)?{lastModified:t.lastModified,type:t.type}:{}),DE(t)){const s=await t.blob();return e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new xg([s],e,r)}const n=await IF(t);if(e||(e=RF(t)??"unknown_file"),!r.type){const s=(i=n[0])==null?void 0:i.type;typeof s=="string"&&(r={...r,type:s})}return new xg(n,e,r)}async function IF(t){var r;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(Lb(t))e.push(await t.arrayBuffer());else if(jF(t))for await(const n of t)e.push(n);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${(r=t==null?void 0:t.constructor)==null?void 0:r.name}; props: ${CF(t)}`);return e}function CF(t){return`[${Object.getOwnPropertyNames(t).map(r=>`"${r}"`).join(", ")}]`}function RF(t){var e;return qp(t.name)||qp(t.filename)||((e=qp(t.path))==null?void 0:e.split(/[\\/]/).pop())}const qp=t=>{if(typeof t=="string")return t;if(typeof Buffer<"u"&&t instanceof Buffer)return String(t)},jF=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",i0=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody",wl=async t=>{const e=await NF(t.body);return RE(e,t)},NF=async t=>{const e=new IE;return await Promise.all(Object.entries(t||{}).map(([r,n])=>Tg(e,r,n))),e},Tg=async(t,e,r)=>{if(r!==void 0){if(r==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")t.append(e,String(r));else if(kF(r)){const n=await FE(r);t.append(e,n)}else if(Array.isArray(r))await Promise.all(r.map(n=>Tg(t,e+"[]",n)));else if(typeof r=="object")await Promise.all(Object.entries(r).map(([n,i])=>Tg(t,`${e}[${n}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}};var Ja={},$F=function(t,e,r,n,i){if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,r),r},LF=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Sc;async function zE(t){const{response:e}=t;if(t.options.stream)return Ga("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):Wn.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;const r=e.headers.get("content-type");if((r==null?void 0:r.includes("application/json"))||(r==null?void 0:r.includes("application/vnd.api+json"))){const s=await e.json();return Ga("response",e.status,e.url,e.headers,s),s}const i=await e.text();return Ga("response",e.status,e.url,e.headers,i),i}class Cf extends Promise{constructor(e,r=zE){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=r}_thenUnwrap(e){return new Cf(this.responsePromise,async r=>e(await this.parseResponse(r)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,r]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:r}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,r){return this.parse().then(e,r)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class DF{constructor({baseURL:e,maxRetries:r=2,timeout:n=6e5,httpAgent:i,fetch:s}){this.baseURL=e,this.maxRetries=Kp("maxRetries",r),this.timeout=Kp("timeout",n),this.httpAgent=i,this.fetch=s??kE}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...KF(),...this.authHeaders(e)}}validateHeaders(e,r){}defaultIdempotencyKey(){return`stainless-node-retry-${WF()}`}get(e,r){return this.methodRequest("get",e,r)}post(e,r){return this.methodRequest("post",e,r)}patch(e,r){return this.methodRequest("patch",e,r)}put(e,r){return this.methodRequest("put",e,r)}delete(e,r){return this.methodRequest("delete",e,r)}methodRequest(e,r,n){return this.request(Promise.resolve(n).then(async i=>{const s=i&&Lb(i==null?void 0:i.body)?new DataView(await i.body.arrayBuffer()):(i==null?void 0:i.body)instanceof DataView?i.body:(i==null?void 0:i.body)instanceof ArrayBuffer?new DataView(i.body):i&&ArrayBuffer.isView(i==null?void 0:i.body)?new DataView(i.body.buffer):i==null?void 0:i.body;return{method:e,path:r,...i,body:s}}))}getAPIList(e,r,n){return this.requestAPIList(r,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e){var p;const{method:r,path:n,query:i,headers:s={}}=e,a=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:i0(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,o=this.calculateContentLength(a),u=this.buildURL(n,i);"timeout"in e&&Kp("timeout",e.timeout);const l=e.timeout??this.timeout,c=e.httpAgent??this.httpAgent??jE(u),h=l+1e3;typeof((p=c==null?void 0:c.options)==null?void 0:p.timeout)=="number"&&h>(c.options.timeout??0)&&(c.options.timeout=h),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=e.idempotencyKey);const d=this.buildHeaders({options:e,headers:s,contentLength:o});return{req:{method:r,...a&&{body:a},headers:d,...c&&{agent:c},signal:e.signal??null},url:u,timeout:l}}buildHeaders({options:e,headers:r,contentLength:n}){const i={};n&&(i["content-length"]=n);const s=this.defaultHeaders(e);return u0(i,s),u0(i,r),i0(e.body)&&Tu!=="node"&&delete i["content-type"],this.validateHeaders(i,r),i}async prepareOptions(e){}async prepareRequest(e,{url:r,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(r=>[...r])):{...e}:{}}makeStatusError(e,r,n,i){return ar.generate(e,r,n,i)}request(e,r=null){return new Cf(this.makeRequest(e,r))}async makeRequest(e,r){var c,h;const n=await e;r==null&&(r=n.maxRetries??this.maxRetries),await this.prepareOptions(n);const{req:i,url:s,timeout:a}=this.buildRequest(n);if(await this.prepareRequest(i,{url:s,options:n}),Ga("request",s,n,i.headers),(c=n.signal)!=null&&c.aborted)throw new gr;const o=new AbortController,u=await this.fetchWithTimeout(s,i,a,o).catch(Ag);if(u instanceof Error){if((h=n.signal)!=null&&h.aborted)throw new gr;if(r)return this.retryRequest(n,r);throw u.name==="AbortError"?new If:new Hl({cause:u})}const l=FF(u.headers);if(!u.ok){if(r&&this.shouldRetry(u)){const g=`retrying, ${r} attempts remaining`;return Ga(`response (error; ${g})`,u.status,s,l),this.retryRequest(n,r,l)}const d=await u.text().catch(g=>Ag(g).message),f=VF(d),p=f?void 0:d;throw Ga(`response (error; ${r?"(error; no more retries left)":"(error; not retryable)"})`,u.status,s,l,p),this.makeStatusError(u.status,f,p,l)}return{response:u,options:n,controller:o}}requestAPIList(e,r){const n=this.makeRequest(r,null);return new MF(this,n,e)}buildURL(e,r){const n=HF(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return qE(i)||(r={...i,...r}),typeof r=="object"&&r&&!Array.isArray(r)&&(n.search=this.stringifyQuery(r)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([r,n])=>typeof n<"u").map(([r,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(r)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(r)}=`;throw new ve(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,r,n,i){const{signal:s,...a}=r||{};s&&s.addEventListener("abort",()=>i.abort());const o=setTimeout(()=>i.abort(),n);return this.getRequestClient().fetch.call(void 0,e,{signal:i.signal,...a}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const r=e.headers.get("x-should-retry");return r==="true"?!0:r==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,r,n){let i;const s=n==null?void 0:n["retry-after-ms"];if(s){const o=parseFloat(s);Number.isNaN(o)||(i=o)}const a=n==null?void 0:n["retry-after"];if(a&&!i){const o=parseFloat(a);Number.isNaN(o)?i=Date.parse(a)-Date.now():i=o*1e3}if(!(i&&0<=i&&i<60*1e3)){const o=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(r,o)}return await Wl(i),this.makeRequest(e,r-1)}calculateDefaultRetryTimeoutMillis(e,r){const s=r-e,a=Math.min(.5*Math.pow(2,s),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${wa}`}}class UE{constructor(e,r,n,i){Sc.set(this,void 0),$F(this,Sc,e),this.options=i,this.response=r,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new ve("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const r={...this.options};if("params"in e&&typeof r.query=="object")r.query={...r.query,...e.params};else if("url"in e){const n=[...Object.entries(r.query||{}),...e.url.searchParams.entries()];for(const[i,s]of n)e.url.searchParams.set(i,s);r.query=void 0,r.path=e.url.toString()}return await LF(this,Sc,"f").requestAPIList(this.constructor,r)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Sc=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const r of e.getPaginatedItems())yield r}}class MF extends Cf{constructor(e,r,n){super(r,async i=>new n(e,i.response,await zE(i),i.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const r of e)yield r}}const FF=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,r){const n=r.toString();return e[n.toLowerCase()]||e[n]}}),zF={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Mr=t=>typeof t=="object"&&t!==null&&!qE(t)&&Object.keys(t).every(e=>KE(zF,e)),UF=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wa,"X-Stainless-OS":a0(Deno.build.os),"X-Stainless-Arch":s0(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wa,"X-Stainless-OS":a0(process.platform),"X-Stainless-Arch":s0(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const t=qF();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function qF(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:r}of t){const n=r.exec(navigator.userAgent);if(n){const i=n[1]||0,s=n[2]||0,a=n[3]||0;return{browser:e,version:`${i}.${s}.${a}`}}}return null}const s0=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",a0=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let o0;const KF=()=>o0??(o0=UF()),VF=t=>{try{return JSON.parse(t)}catch{return}},BF=new RegExp("^(?:[a-z]+:)?//","i"),HF=t=>BF.test(t),Wl=t=>new Promise(e=>setTimeout(e,t)),Kp=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ve(`${t} must be an integer`);if(e<0)throw new ve(`${t} must be a positive integer`);return e},Ag=t=>t instanceof Error?t:new Error(t),xc=t=>{var e,r,n,i;if(typeof process<"u")return((e=Ja==null?void 0:Ja[t])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(i=(n=(r=Deno.env)==null?void 0:r.get)==null?void 0:n.call(r,t))==null?void 0:i.trim()};function qE(t){if(!t)return!0;for(const e in t)return!1;return!0}function KE(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function u0(t,e){for(const r in e){if(!KE(e,r))continue;const n=r.toLowerCase();if(!n)continue;const i=e[r];i===null?delete t[n]:i!==void 0&&(t[n]=i)}}function Ga(t,...e){typeof process<"u"&&(Ja==null?void 0:Ja.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${t}`,...e)}const WF=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),JF=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function l0(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}class Db extends UE{constructor(e,r,n,i){super(e,r,n,i),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Nn extends UE{constructor(e,r,n,i){super(e,r,n,i),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const r=Object.fromEntries(e.url.searchParams);return Object.keys(r).length?r:null}nextPageInfo(){var n;const e=this.getPaginatedItems();if(!e.length)return null;const r=(n=e[e.length-1])==null?void 0:n.id;return r?{params:{after:r}}:null}}class De{constructor(e){this._client=e}}let td=class extends De{create(e,r){return this._client.post("/chat/completions",{body:e,...r,stream:e.stream??!1})}};td||(td={});let rd=class extends De{constructor(){super(...arguments),this.completions=new td(this._client)}};(function(t){t.Completions=td})(rd||(rd={}));class nd extends De{create(e,r){return this._client.post("/audio/speech",{body:e,...r,__binaryResponse:!0})}}nd||(nd={});class id extends De{create(e,r){return this._client.post("/audio/transcriptions",wl({body:e,...r}))}}id||(id={});class sd extends De{create(e,r){return this._client.post("/audio/translations",wl({body:e,...r}))}}sd||(sd={});class ad extends De{constructor(){super(...arguments),this.transcriptions=new id(this._client),this.translations=new sd(this._client),this.speech=new nd(this._client)}}(function(t){t.Transcriptions=id,t.Translations=sd,t.Speech=nd})(ad||(ad={}));class od extends De{create(e,r){return this._client.post("/batches",{body:e,...r})}retrieve(e,r){return this._client.get(`/batches/${e}`,r)}list(e={},r){return Mr(e)?this.list({},e):this._client.getAPIList("/batches",Mb,{query:e,...r})}cancel(e,r){return this._client.post(`/batches/${e}/cancel`,r)}}class Mb extends Nn{}(function(t){t.BatchesPage=Mb})(od||(od={}));class ud extends De{create(e,r){return this._client.post("/assistants",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,r){return this._client.get(`/assistants/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,r,n){return this._client.post(`/assistants/${e}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},r){return Mr(e)?this.list({},e):this._client.getAPIList("/assistants",Fb,{query:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,r){return this._client.delete(`/assistants/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class Fb extends Nn{}(function(t){t.AssistantsPage=Fb})(ud||(ud={}));function c0(t){return typeof t.parse=="function"}const Za=t=>(t==null?void 0:t.role)==="assistant",VE=t=>(t==null?void 0:t.role)==="function",BE=t=>(t==null?void 0:t.role)==="tool";var dn=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},be=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},qt,Jc,Gc,ru,nu,Zc,iu,ii,su,Yc,Qc,va,kg,ld,Ig,Cg,Rg,jg,HE,Ng;const h0=10;class WE{constructor(){qt.add(this),this.controller=new AbortController,Jc.set(this,void 0),Gc.set(this,()=>{}),ru.set(this,()=>{}),nu.set(this,void 0),Zc.set(this,()=>{}),iu.set(this,()=>{}),ii.set(this,{}),this._chatCompletions=[],this.messages=[],su.set(this,!1),Yc.set(this,!1),Qc.set(this,!1),va.set(this,!1),jg.set(this,e=>{if(dn(this,Yc,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new gr),e instanceof gr)return dn(this,Qc,!0,"f"),this._emit("abort",e);if(e instanceof ve)return this._emit("error",e);if(e instanceof Error){const r=new ve(e.message);return r.cause=e,this._emit("error",r)}return this._emit("error",new ve(String(e)))}),dn(this,Jc,new Promise((e,r)=>{dn(this,Gc,e,"f"),dn(this,ru,r,"f")}),"f"),dn(this,nu,new Promise((e,r)=>{dn(this,Zc,e,"f"),dn(this,iu,r,"f")}),"f"),be(this,Jc,"f").catch(()=>{}),be(this,nu,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},be(this,jg,"f"))},0)}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const r=(n=e.choices[0])==null?void 0:n.message;return r&&this._addMessage(r),e}_addMessage(e,r=!0){if("content"in e||(e.content=null),this.messages.push(e),r){if(this._emit("message",e),(VE(e)||BE(e))&&e.content)this._emit("functionCallResult",e.content);else if(Za(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Za(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}_connected(){this.ended||(be(this,Gc,"f").call(this),this._emit("connect"))}get ended(){return be(this,su,"f")}get errored(){return be(this,Yc,"f")}get aborted(){return be(this,Qc,"f")}abort(){this.controller.abort()}on(e,r){return(be(this,ii,"f")[e]||(be(this,ii,"f")[e]=[])).push({listener:r}),this}off(e,r){const n=be(this,ii,"f")[e];if(!n)return this;const i=n.findIndex(s=>s.listener===r);return i>=0&&n.splice(i,1),this}once(e,r){return(be(this,ii,"f")[e]||(be(this,ii,"f")[e]=[])).push({listener:r,once:!0}),this}emitted(e){return new Promise((r,n)=>{dn(this,va,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,r)})}async done(){dn(this,va,!0,"f"),await be(this,nu,"f")}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new ve("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),be(this,qt,"m",kg).call(this)}async finalMessage(){return await this.done(),be(this,qt,"m",ld).call(this)}async finalFunctionCall(){return await this.done(),be(this,qt,"m",Ig).call(this)}async finalFunctionCallResult(){return await this.done(),be(this,qt,"m",Cg).call(this)}async totalUsage(){return await this.done(),be(this,qt,"m",Rg).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...r){if(be(this,su,"f"))return;e==="end"&&(dn(this,su,!0,"f"),be(this,Zc,"f").call(this));const n=be(this,ii,"f")[e];if(n&&(be(this,ii,"f")[e]=n.filter(i=>!i.once),n.forEach(({listener:i})=>i(...r))),e==="abort"){const i=r[0];!be(this,va,"f")&&!(n!=null&&n.length)&&Promise.reject(i),be(this,ru,"f").call(this,i),be(this,iu,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=r[0];!be(this,va,"f")&&!(n!=null&&n.length)&&Promise.reject(i),be(this,ru,"f").call(this,i),be(this,iu,"f").call(this,i),this._emit("end")}}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const r=be(this,qt,"m",ld).call(this);r&&this._emit("finalMessage",r);const n=be(this,qt,"m",kg).call(this);n&&this._emit("finalContent",n);const i=be(this,qt,"m",Ig).call(this);i&&this._emit("finalFunctionCall",i);const s=be(this,qt,"m",Cg).call(this);s!=null&&this._emit("finalFunctionCallResult",s),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",be(this,qt,"m",Rg).call(this))}async _createChatCompletion(e,r,n){const i=n==null?void 0:n.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),be(this,qt,"m",HE).call(this,r);const s=await e.create({...r,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(s)}async _runChatCompletion(e,r,n){for(const i of r.messages)this._addMessage(i,!1);return await this._createChatCompletion(e,r,n)}async _runFunctions(e,r,n){var d;const i="function",{function_call:s="auto",stream:a,...o}=r,u=typeof s!="string"&&(s==null?void 0:s.name),{maxChatCompletions:l=h0}=n||{},c={};for(const f of r.functions)c[f.name||f.function.name]=f;const h=r.functions.map(f=>({name:f.name||f.function.name,parameters:f.parameters,description:f.description}));for(const f of r.messages)this._addMessage(f,!1);for(let f=0;f<l;++f){const y=(d=(await this._createChatCompletion(e,{...o,function_call:s,functions:h,messages:[...this.messages]},n)).choices[0])==null?void 0:d.message;if(!y)throw new ve("missing message in ChatCompletion response");if(!y.function_call)return;const{name:v,arguments:g}=y.function_call,m=c[v];if(m){if(u&&u!==v){const I=`Invalid function_call: ${JSON.stringify(v)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:i,name:v,content:I});continue}}else{const I=`Invalid function_call: ${JSON.stringify(v)}. Available options are: ${h.map(j=>JSON.stringify(j.name)).join(", ")}. Please try again`;this._addMessage({role:i,name:v,content:I});continue}let b;try{b=c0(m)?await m.parse(g):g}catch(I){this._addMessage({role:i,name:v,content:I instanceof Error?I.message:String(I)});continue}const S=await m.function(b,this),E=be(this,qt,"m",Ng).call(this,S);if(this._addMessage({role:i,name:v,content:E}),u)return}}async _runTools(e,r,n){var d,f;const i="tool",{tool_choice:s="auto",stream:a,...o}=r,u=typeof s!="string"&&((d=s==null?void 0:s.function)==null?void 0:d.name),{maxChatCompletions:l=h0}=n||{},c={};for(const p of r.tools)p.type==="function"&&(c[p.function.name||p.function.function.name]=p.function);const h="tools"in r?r.tools.map(p=>p.type==="function"?{type:"function",function:{name:p.function.name||p.function.function.name,parameters:p.function.parameters,description:p.function.description}}:p):void 0;for(const p of r.messages)this._addMessage(p,!1);for(let p=0;p<l;++p){const v=(f=(await this._createChatCompletion(e,{...o,tool_choice:s,tools:h,messages:[...this.messages]},n)).choices[0])==null?void 0:f.message;if(!v)throw new ve("missing message in ChatCompletion response");if(!v.tool_calls)return;for(const g of v.tool_calls){if(g.type!=="function")continue;const m=g.id,{name:b,arguments:S}=g.function,E=c[b];if(E){if(u&&u!==b){const G=`Invalid tool_call: ${JSON.stringify(b)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:i,tool_call_id:m,content:G});continue}}else{const G=`Invalid tool_call: ${JSON.stringify(b)}. Available options are: ${h.map(U=>JSON.stringify(U.function.name)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:m,content:G});continue}let I;try{I=c0(E)?await E.parse(S):S}catch(G){const U=G instanceof Error?G.message:String(G);this._addMessage({role:i,tool_call_id:m,content:U});continue}const j=await E.function(I,this),P=be(this,qt,"m",Ng).call(this,j);if(this._addMessage({role:i,tool_call_id:m,content:P}),u)return}}}}Jc=new WeakMap,Gc=new WeakMap,ru=new WeakMap,nu=new WeakMap,Zc=new WeakMap,iu=new WeakMap,ii=new WeakMap,su=new WeakMap,Yc=new WeakMap,Qc=new WeakMap,va=new WeakMap,jg=new WeakMap,qt=new WeakSet,kg=function(){return be(this,qt,"m",ld).call(this).content??null},ld=function(){let e=this.messages.length;for(;e-- >0;){const r=this.messages[e];if(Za(r)){const{function_call:n,...i}=r,s={...i,content:r.content??null};return n&&(s.function_call=n),s}}throw new ve("stream ended without producing a ChatCompletionMessage with role=assistant")},Ig=function(){var e,r;for(let n=this.messages.length-1;n>=0;n--){const i=this.messages[n];if(Za(i)&&(i!=null&&i.function_call))return i.function_call;if(Za(i)&&((e=i==null?void 0:i.tool_calls)!=null&&e.length))return(r=i.tool_calls.at(-1))==null?void 0:r.function}},Cg=function(){for(let e=this.messages.length-1;e>=0;e--){const r=this.messages[e];if(VE(r)&&r.content!=null||BE(r)&&r.content!=null&&this.messages.some(n=>{var i;return n.role==="assistant"&&((i=n.tool_calls)==null?void 0:i.some(s=>s.type==="function"&&s.id===r.tool_call_id))}))return r.content}},Rg=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:r}of this._chatCompletions)r&&(e.completion_tokens+=r.completion_tokens,e.prompt_tokens+=r.prompt_tokens,e.total_tokens+=r.total_tokens);return e},HE=function(e){if(e.n!=null&&e.n>1)throw new ve("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Ng=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class vl extends WE{static runFunctions(e,r,n){const i=new vl,s={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,r,s)),i}static runTools(e,r,n){const i=new vl,s={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,r,s)),i}_addMessage(e){super._addMessage(e),Za(e)&&e.content&&this._emit("content",e.content)}}var fn=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Vp=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},Ln,ji,Bp,Hp,Ec,d0;class _l extends WE{constructor(){super(...arguments),Ln.add(this),ji.set(this,void 0)}get currentChatCompletionSnapshot(){return fn(this,ji,"f")}static fromReadableStream(e){const r=new _l;return r._run(()=>r._fromReadableStream(e)),r}static createChatCompletion(e,r,n){const i=new _l;return i._run(()=>i._runChatCompletion(e,{...r,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(e,r,n){var a;const i=n==null?void 0:n.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),fn(this,Ln,"m",Bp).call(this);const s=await e.create({...r,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of s)fn(this,Ln,"m",Hp).call(this,o);if((a=s.controller.signal)!=null&&a.aborted)throw new gr;return this._addChatCompletion(fn(this,Ln,"m",Ec).call(this))}async _fromReadableStream(e,r){var a;const n=r==null?void 0:r.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),fn(this,Ln,"m",Bp).call(this),this._connected();const i=Wn.fromReadableStream(e,this.controller);let s;for await(const o of i)s&&s!==o.id&&this._addChatCompletion(fn(this,Ln,"m",Ec).call(this)),fn(this,Ln,"m",Hp).call(this,o),s=o.id;if((a=i.controller.signal)!=null&&a.aborted)throw new gr;return this._addChatCompletion(fn(this,Ln,"m",Ec).call(this))}[(ji=new WeakMap,Ln=new WeakSet,Bp=function(){this.ended||Vp(this,ji,void 0,"f")},Hp=function(r){var a,o,u;if(this.ended)return;const n=fn(this,Ln,"m",d0).call(this,r);this._emit("chunk",r,n);const i=(o=(a=r.choices[0])==null?void 0:a.delta)==null?void 0:o.content,s=(u=n.choices[0])==null?void 0:u.message;i!=null&&(s==null?void 0:s.role)==="assistant"&&(s!=null&&s.content)&&this._emit("content",i,s.content)},Ec=function(){if(this.ended)throw new ve("stream has ended, this shouldn't happen");const r=fn(this,ji,"f");if(!r)throw new ve("request ended without sending any chunks");return Vp(this,ji,void 0,"f"),GF(r)},d0=function(r){var n,i,s;let a=fn(this,ji,"f");const{choices:o,...u}=r;a?Object.assign(a,u):a=Vp(this,ji,{...u,choices:[]},"f");for(const{delta:l,finish_reason:c,index:h,logprobs:d=null,...f}of r.choices){let p=a.choices[h];if(p||(p=a.choices[h]={finish_reason:c,index:h,message:{},logprobs:d,...f}),d)if(!p.logprobs)p.logprobs=Object.assign({},d);else{const{content:S,...E}=d;Object.assign(p.logprobs,E),S&&((n=p.logprobs).content??(n.content=[]),p.logprobs.content.push(...S))}if(c&&(p.finish_reason=c),Object.assign(p,f),!l)continue;const{content:y,function_call:v,role:g,tool_calls:m,...b}=l;if(Object.assign(p.message,b),y&&(p.message.content=(p.message.content||"")+y),g&&(p.message.role=g),v&&(p.message.function_call?(v.name&&(p.message.function_call.name=v.name),v.arguments&&((i=p.message.function_call).arguments??(i.arguments=""),p.message.function_call.arguments+=v.arguments)):p.message.function_call=v),m){p.message.tool_calls||(p.message.tool_calls=[]);for(const{index:S,id:E,type:I,function:j,...P}of m){const G=(s=p.message.tool_calls)[S]??(s[S]={});Object.assign(G,P),E&&(G.id=E),I&&(G.type=I),j&&(G.function??(G.function={arguments:""})),j!=null&&j.name&&(G.function.name=j.name),j!=null&&j.arguments&&(G.function.arguments+=j.arguments)}}}return a},Symbol.asyncIterator)](){const e=[],r=[];let n=!1;return this.on("chunk",i=>{const s=r.shift();s?s.resolve(i):e.push(i)}),this.on("end",()=>{n=!0;for(const i of r)i.resolve(void 0);r.length=0}),this.on("abort",i=>{n=!0;for(const s of r)s.reject(i);r.length=0}),this.on("error",i=>{n=!0;for(const s of r)s.reject(i);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,a)=>r.push({resolve:s,reject:a})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Wn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function GF(t){const{id:e,choices:r,created:n,model:i,system_fingerprint:s,...a}=t;return{...a,id:e,choices:r.map(({message:o,finish_reason:u,index:l,logprobs:c,...h})=>{if(!u)throw new ve(`missing finish_reason for choice ${l}`);const{content:d=null,function_call:f,tool_calls:p,...y}=o,v=o.role;if(!v)throw new ve(`missing role for choice ${l}`);if(f){const{arguments:g,name:m}=f;if(g==null)throw new ve(`missing function_call.arguments for choice ${l}`);if(!m)throw new ve(`missing function_call.name for choice ${l}`);return{...h,message:{content:d,function_call:{arguments:g,name:m},role:v},finish_reason:u,index:l,logprobs:c}}return p?{...h,index:l,finish_reason:u,logprobs:c,message:{...y,role:v,content:d,tool_calls:p.map((g,m)=>{const{function:b,type:S,id:E,...I}=g,{arguments:j,name:P,...G}=b||{};if(E==null)throw new ve(`missing choices[${l}].tool_calls[${m}].id
${Tc(t)}`);if(S==null)throw new ve(`missing choices[${l}].tool_calls[${m}].type
${Tc(t)}`);if(P==null)throw new ve(`missing choices[${l}].tool_calls[${m}].function.name
${Tc(t)}`);if(j==null)throw new ve(`missing choices[${l}].tool_calls[${m}].function.arguments
${Tc(t)}`);return{...I,id:E,type:S,function:{...G,name:P,arguments:j}}})}}:{...h,message:{...y,content:d,role:v},finish_reason:u,index:l,logprobs:c}}),created:n,model:i,object:"chat.completion",...s?{system_fingerprint:s}:{}}}function Tc(t){return JSON.stringify(t)}class Ya extends _l{static fromReadableStream(e){const r=new Ya;return r._run(()=>r._fromReadableStream(e)),r}static runFunctions(e,r,n){const i=new Ya,s={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,r,s)),i}static runTools(e,r,n){const i=new Ya,s={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,r,s)),i}}let JE=class extends De{runFunctions(e,r){return e.stream?Ya.runFunctions(this._client.chat.completions,e,r):vl.runFunctions(this._client.chat.completions,e,r)}runTools(e,r){return e.stream?Ya.runTools(this._client.chat.completions,e,r):vl.runTools(this._client.chat.completions,e,r)}stream(e,r){return _l.createChatCompletion(this._client.chat.completions,e,r)}};class cd extends De{constructor(){super(...arguments),this.completions=new JE(this._client)}}(function(t){t.Completions=JE})(cd||(cd={}));var pn=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},Ge=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Xc,eh,au,ou,th,uu,si,lu,rh,nh,_a,$g;class ZF{constructor(){this.controller=new AbortController,Xc.set(this,void 0),eh.set(this,()=>{}),au.set(this,()=>{}),ou.set(this,void 0),th.set(this,()=>{}),uu.set(this,()=>{}),si.set(this,{}),lu.set(this,!1),rh.set(this,!1),nh.set(this,!1),_a.set(this,!1),$g.set(this,e=>{if(pn(this,rh,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new gr),e instanceof gr)return pn(this,nh,!0,"f"),this._emit("abort",e);if(e instanceof ve)return this._emit("error",e);if(e instanceof Error){const r=new ve(e.message);return r.cause=e,this._emit("error",r)}return this._emit("error",new ve(String(e)))}),pn(this,Xc,new Promise((e,r)=>{pn(this,eh,e,"f"),pn(this,au,r,"f")}),"f"),pn(this,ou,new Promise((e,r)=>{pn(this,th,e,"f"),pn(this,uu,r,"f")}),"f"),Ge(this,Xc,"f").catch(()=>{}),Ge(this,ou,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emit("end")},Ge(this,$g,"f"))},0)}_addRun(e){return e}_connected(){this.ended||(Ge(this,eh,"f").call(this),this._emit("connect"))}get ended(){return Ge(this,lu,"f")}get errored(){return Ge(this,rh,"f")}get aborted(){return Ge(this,nh,"f")}abort(){this.controller.abort()}on(e,r){return(Ge(this,si,"f")[e]||(Ge(this,si,"f")[e]=[])).push({listener:r}),this}off(e,r){const n=Ge(this,si,"f")[e];if(!n)return this;const i=n.findIndex(s=>s.listener===r);return i>=0&&n.splice(i,1),this}once(e,r){return(Ge(this,si,"f")[e]||(Ge(this,si,"f")[e]=[])).push({listener:r,once:!0}),this}emitted(e){return new Promise((r,n)=>{pn(this,_a,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,r)})}async done(){pn(this,_a,!0,"f"),await Ge(this,ou,"f")}_emit(e,...r){if(Ge(this,lu,"f"))return;e==="end"&&(pn(this,lu,!0,"f"),Ge(this,th,"f").call(this));const n=Ge(this,si,"f")[e];if(n&&(Ge(this,si,"f")[e]=n.filter(i=>!i.once),n.forEach(({listener:i})=>i(...r))),e==="abort"){const i=r[0];!Ge(this,_a,"f")&&!(n!=null&&n.length)&&Promise.reject(i),Ge(this,au,"f").call(this,i),Ge(this,uu,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=r[0];!Ge(this,_a,"f")&&!(n!=null&&n.length)&&Promise.reject(i),Ge(this,au,"f").call(this,i),Ge(this,uu,"f").call(this,i),this._emit("end")}}async _threadAssistantStream(e,r,n){return await this._createThreadAssistantStream(r,e,n)}async _runAssistantStream(e,r,n,i){return await this._createAssistantStream(r,e,n,i)}async _runToolAssistantStream(e,r,n,i,s){return await this._createToolAssistantStream(n,e,r,i,s)}async _createThreadAssistantStream(e,r,n){const i=n==null?void 0:n.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const s=await e.createAndRun({...r,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addRun(s)}async _createToolAssistantStream(e,r,n,i,s){const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o=await e.submitToolOutputs(r,n,{...i,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addRun(o)}async _createAssistantStream(e,r,n,i){const s=i==null?void 0:i.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a=await e.create(r,{...n,stream:!1},{...i,signal:this.controller.signal});return this._connected(),this._addRun(a)}}Xc=new WeakMap,eh=new WeakMap,au=new WeakMap,ou=new WeakMap,th=new WeakMap,uu=new WeakMap,si=new WeakMap,lu=new WeakMap,rh=new WeakMap,nh=new WeakMap,_a=new WeakMap,$g=new WeakMap;var re=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Tr=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},Nt,Lg,Mn,ih,yn,ks,Da,Ps,hd,Ar,sh,ah,Au,cu,hu,f0,p0,m0,g0,y0,b0,w0;class Sn extends ZF{constructor(){super(...arguments),Nt.add(this),Lg.set(this,[]),Mn.set(this,{}),ih.set(this,{}),yn.set(this,void 0),ks.set(this,void 0),Da.set(this,void 0),Ps.set(this,void 0),hd.set(this,void 0),Ar.set(this,void 0),sh.set(this,void 0),ah.set(this,void 0),Au.set(this,void 0)}[(Lg=new WeakMap,Mn=new WeakMap,ih=new WeakMap,yn=new WeakMap,ks=new WeakMap,Da=new WeakMap,Ps=new WeakMap,hd=new WeakMap,Ar=new WeakMap,sh=new WeakMap,ah=new WeakMap,Au=new WeakMap,Nt=new WeakSet,Symbol.asyncIterator)](){const e=[],r=[];let n=!1;return this.on("event",i=>{const s=r.shift();s?s.resolve(i):e.push(i)}),this.on("end",()=>{n=!0;for(const i of r)i.resolve(void 0);r.length=0}),this.on("abort",i=>{n=!0;for(const s of r)s.reject(i);r.length=0}),this.on("error",i=>{n=!0;for(const s of r)s.reject(i);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,a)=>r.push({resolve:s,reject:a})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const r=new Sn;return r._run(()=>r._fromReadableStream(e)),r}async _fromReadableStream(e,r){var s;const n=r==null?void 0:r.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const i=Wn.fromReadableStream(e,this.controller);for await(const a of i)re(this,Nt,"m",cu).call(this,a);if((s=i.controller.signal)!=null&&s.aborted)throw new gr;return this._addRun(re(this,Nt,"m",hu).call(this))}toReadableStream(){return new Wn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,r,n,i,s){const a=new Sn;return a._run(()=>a._runToolAssistantStream(e,r,n,i,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,r,n,i,s){var l;const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...i,stream:!0},u=await e.submitToolOutputs(r,n,o,{...s,signal:this.controller.signal});this._connected();for await(const c of u)re(this,Nt,"m",cu).call(this,c);if((l=u.controller.signal)!=null&&l.aborted)throw new gr;return this._addRun(re(this,Nt,"m",hu).call(this))}static createThreadAssistantStream(e,r,n){const i=new Sn;return i._run(()=>i._threadAssistantStream(e,r,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,r,n,i){const s=new Sn;return s._run(()=>s._runAssistantStream(e,r,n,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),s}currentEvent(){return re(this,sh,"f")}currentRun(){return re(this,ah,"f")}currentMessageSnapshot(){return re(this,yn,"f")}currentRunStepSnapshot(){return re(this,Au,"f")}async finalRunSteps(){return await this.done(),Object.values(re(this,Mn,"f"))}async finalMessages(){return await this.done(),Object.values(re(this,ih,"f"))}async finalRun(){if(await this.done(),!re(this,ks,"f"))throw Error("Final run was not received.");return re(this,ks,"f")}async _createThreadAssistantStream(e,r,n){var o;const i=n==null?void 0:n.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const s={...r,stream:!0},a=await e.createAndRun(s,{...n,signal:this.controller.signal});this._connected();for await(const u of a)re(this,Nt,"m",cu).call(this,u);if((o=a.controller.signal)!=null&&o.aborted)throw new gr;return this._addRun(re(this,Nt,"m",hu).call(this))}async _createAssistantStream(e,r,n,i){var u;const s=i==null?void 0:i.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a={...n,stream:!0},o=await e.create(r,a,{...i,signal:this.controller.signal});this._connected();for await(const l of o)re(this,Nt,"m",cu).call(this,l);if((u=o.controller.signal)!=null&&u.aborted)throw new gr;return this._addRun(re(this,Nt,"m",hu).call(this))}static accumulateDelta(e,r){for(const[n,i]of Object.entries(r)){if(!e.hasOwnProperty(n)){e[n]=i;continue}let s=e[n];if(s==null){e[n]=i;continue}if(n==="index"||n==="type"){e[n]=i;continue}if(typeof s=="string"&&typeof i=="string")s+=i;else if(typeof s=="number"&&typeof i=="number")s+=i;else if(l0(s)&&l0(i))s=this.accumulateDelta(s,i);else if(Array.isArray(s)&&Array.isArray(i)){if(s.every(a=>typeof a=="string"||typeof a=="number")){s.push(...i);continue}}else throw Error(`Unhandled record type: ${n}, deltaValue: ${i}, accValue: ${s}`);e[n]=s}return e}}cu=function(e){if(!this.ended)switch(Tr(this,sh,e,"f"),re(this,Nt,"m",m0).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":re(this,Nt,"m",w0).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":re(this,Nt,"m",p0).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":re(this,Nt,"m",f0).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},hu=function(){if(this.ended)throw new ve("stream has ended, this shouldn't happen");if(!re(this,ks,"f"))throw Error("Final run has not been received");return re(this,ks,"f")},f0=function(e){const[r,n]=re(this,Nt,"m",y0).call(this,e,re(this,yn,"f"));Tr(this,yn,r,"f"),re(this,ih,"f")[r.id]=r;for(const i of n){const s=r.content[i.index];(s==null?void 0:s.type)=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,r),e.data.delta.content)for(const i of e.data.delta.content){if(i.type=="text"&&i.text){let s=i.text,a=r.content[i.index];if(a&&a.type=="text")this._emit("textDelta",s,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=re(this,Da,"f")){if(re(this,Ps,"f"))switch(re(this,Ps,"f").type){case"text":this._emit("textDone",re(this,Ps,"f").text,re(this,yn,"f"));break;case"image_file":this._emit("imageFileDone",re(this,Ps,"f").image_file,re(this,yn,"f"));break}Tr(this,Da,i.index,"f")}Tr(this,Ps,r.content[i.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(re(this,Da,"f")!==void 0){const i=e.data.content[re(this,Da,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,re(this,yn,"f"));break;case"text":this._emit("textDone",i.text,re(this,yn,"f"));break}}re(this,yn,"f")&&this._emit("messageDone",e.data),Tr(this,yn,void 0,"f")}},p0=function(e){const r=re(this,Nt,"m",g0).call(this,e);switch(Tr(this,Au,r,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&r.step_details.type=="tool_calls")for(const s of n.step_details.tool_calls)s.index==re(this,hd,"f")?this._emit("toolCallDelta",s,r.step_details.tool_calls[s.index]):(re(this,Ar,"f")&&this._emit("toolCallDone",re(this,Ar,"f")),Tr(this,hd,s.index,"f"),Tr(this,Ar,r.step_details.tool_calls[s.index],"f"),re(this,Ar,"f")&&this._emit("toolCallCreated",re(this,Ar,"f")));this._emit("runStepDelta",e.data.delta,r);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Tr(this,Au,void 0,"f"),e.data.step_details.type=="tool_calls"&&re(this,Ar,"f")&&(this._emit("toolCallDone",re(this,Ar,"f")),Tr(this,Ar,void 0,"f")),this._emit("runStepDone",e.data,r);break}},m0=function(e){re(this,Lg,"f").push(e),this._emit("event",e)},g0=function(e){switch(e.event){case"thread.run.step.created":return re(this,Mn,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let r=re(this,Mn,"f")[e.data.id];if(!r)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const i=Sn.accumulateDelta(r,n.delta);re(this,Mn,"f")[e.data.id]=i}return re(this,Mn,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":re(this,Mn,"f")[e.data.id]=e.data;break}if(re(this,Mn,"f")[e.data.id])return re(this,Mn,"f")[e.data.id];throw new Error("No snapshot available")},y0=function(e,r){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!r)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(const s of i.delta.content)if(s.index in r.content){let a=r.content[s.index];r.content[s.index]=re(this,Nt,"m",b0).call(this,s,a)}else r.content[s.index]=s,n.push(s);return[r,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(r)return[r,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},b0=function(e,r){return Sn.accumulateDelta(r,e)},w0=function(e){switch(Tr(this,ah,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Tr(this,ks,e.data,"f"),re(this,Ar,"f")&&(this._emit("toolCallDone",re(this,Ar,"f")),Tr(this,Ar,void 0,"f"));break}};class dd extends De{create(e,r,n){return this._client.post(`/threads/${e}/messages`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,r,n){return this._client.get(`/threads/${e}/messages/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,r,n,i){return this._client.post(`/threads/${e}/messages/${r}`,{body:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,r={},n){return Mr(r)?this.list(e,{},r):this._client.getAPIList(`/threads/${e}/messages`,zb,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,r,n){return this._client.delete(`/threads/${e}/messages/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class zb extends Nn{}(function(t){t.MessagesPage=zb})(dd||(dd={}));class fd extends De{retrieve(e,r,n,i){return this._client.get(`/threads/${e}/runs/${r}/steps/${n}`,{...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,r,n={},i){return Mr(n)?this.list(e,r,{},n):this._client.getAPIList(`/threads/${e}/runs/${r}/steps`,Ub,{query:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}}class Ub extends Nn{}(function(t){t.RunStepsPage=Ub})(fd||(fd={}));class pd extends De{constructor(){super(...arguments),this.steps=new fd(this._client)}create(e,r,n){return this._client.post(`/threads/${e}/runs`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:r.stream??!1})}retrieve(e,r,n){return this._client.get(`/threads/${e}/runs/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,r,n,i){return this._client.post(`/threads/${e}/runs/${r}`,{body:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,r={},n){return Mr(r)?this.list(e,{},r):this._client.getAPIList(`/threads/${e}/runs`,qb,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,r,n){return this._client.post(`/threads/${e}/runs/${r}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,r,n){const i=await this.create(e,r,n);return await this.poll(e,i.id,n)}createAndStream(e,r,n){return Sn.createAssistantStream(e,this._client.beta.threads.runs,r,n)}async poll(e,r,n){const i={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:s,response:a}=await this.retrieve(e,r,{...n,headers:{...n==null?void 0:n.headers,...i}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const u=a.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(o=l)}}await Wl(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,r,n){return Sn.createAssistantStream(e,this._client.beta.threads.runs,r,n)}submitToolOutputs(e,r,n,i){return this._client.post(`/threads/${e}/runs/${r}/submit_tool_outputs`,{body:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,r,n,i){const s=await this.submitToolOutputs(e,r,n,i);return await this.poll(e,s.id,i)}submitToolOutputsStream(e,r,n,i){return Sn.createToolAssistantStream(e,r,this._client.beta.threads.runs,n,i)}}class qb extends Nn{}(function(t){t.RunsPage=qb,t.Steps=fd,t.RunStepsPage=Ub})(pd||(pd={}));class md extends De{constructor(){super(...arguments),this.runs=new pd(this._client),this.messages=new dd(this._client)}create(e={},r){return Mr(e)?this.create({},e):this._client.post("/threads",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,r){return this._client.get(`/threads/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,r,n){return this._client.post(`/threads/${e}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,r){return this._client.delete(`/threads/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}createAndRun(e,r){return this._client.post("/threads/runs",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:e.stream??!1})}async createAndRunPoll(e,r){const n=await this.createAndRun(e,r);return await this.runs.poll(n.thread_id,n.id,r)}createAndRunStream(e,r){return Sn.createThreadAssistantStream(e,this._client.beta.threads,r)}}(function(t){t.Runs=pd,t.RunsPage=qb,t.Messages=dd,t.MessagesPage=zb})(md||(md={}));const YF=async t=>{const e=await Promise.allSettled(t),r=e.filter(i=>i.status==="rejected");if(r.length){for(const i of r)console.error(i.reason);throw new Error(`${r.length} promise(s) failed - see the above errors`)}const n=[];for(const i of e)i.status==="fulfilled"&&n.push(i.value);return n};let gd=class extends De{create(e,r,n){return this._client.post(`/vector_stores/${e}/files`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,r,n){return this._client.get(`/vector_stores/${e}/files/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e,r={},n){return Mr(r)?this.list(e,{},r):this._client.getAPIList(`/vector_stores/${e}/files`,Rf,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,r,n){return this._client.delete(`/vector_stores/${e}/files/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,r,n){const i=await this.create(e,r,n);return await this.poll(e,i.id,n)}async poll(e,r,n){const i={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const s=await this.retrieve(e,r,{...n,headers:i}).withResponse(),a=s.data;switch(a.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const u=s.response.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(o=l)}}await Wl(o);break;case"failed":case"completed":return a}}}async upload(e,r,n){const i=await this._client.files.create({file:r,purpose:"assistants"},n);return this.create(e,{file_id:i.id},n)}async uploadAndPoll(e,r,n){const i=await this.upload(e,r,n);return await this.poll(e,i.id,n)}};class Rf extends Nn{}(function(t){t.VectorStoreFilesPage=Rf})(gd||(gd={}));class yd extends De{create(e,r,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,r,n){return this._client.get(`/vector_stores/${e}/file_batches/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,r,n){return this._client.post(`/vector_stores/${e}/file_batches/${r}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,r,n){const i=await this.create(e,r);return await this.poll(e,i.id,n)}listFiles(e,r,n={},i){return Mr(n)?this.listFiles(e,r,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${r}/files`,Rf,{query:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}async poll(e,r,n){const i={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:s,response:a}=await this.retrieve(e,r,{...n,headers:i}).withResponse();switch(s.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const u=a.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(o=l)}}await Wl(o);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(e,{files:r,fileIds:n=[]},i){if(r===null||r.length==0)throw new Error("No files provided to process.");const s=(i==null?void 0:i.maxConcurrency)??5,a=Math.min(s,r.length),o=this._client,u=r.values(),l=[...n];async function c(d){for(let f of d){const p=await o.files.create({file:f,purpose:"assistants"},i);l.push(p.id)}}const h=Array(a).fill(u).map(c);return await YF(h),await this.createAndPoll(e,{file_ids:l})}}yd||(yd={});class bd extends De{constructor(){super(...arguments),this.files=new gd(this._client),this.fileBatches=new yd(this._client)}create(e,r){return this._client.post("/vector_stores",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,r){return this._client.get(`/vector_stores/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,r,n){return this._client.post(`/vector_stores/${e}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},r){return Mr(e)?this.list({},e):this._client.getAPIList("/vector_stores",Kb,{query:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,r){return this._client.delete(`/vector_stores/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class Kb extends Nn{}(function(t){t.VectorStoresPage=Kb,t.Files=gd,t.VectorStoreFilesPage=Rf,t.FileBatches=yd})(bd||(bd={}));class wd extends De{constructor(){super(...arguments),this.vectorStores=new bd(this._client),this.chat=new cd(this._client),this.assistants=new ud(this._client),this.threads=new md(this._client)}}(function(t){t.VectorStores=bd,t.VectorStoresPage=Kb,t.Chat=cd,t.Assistants=ud,t.AssistantsPage=Fb,t.Threads=md})(wd||(wd={}));class vd extends De{create(e,r){return this._client.post("/completions",{body:e,...r,stream:e.stream??!1})}}vd||(vd={});let _d=class extends De{create(e,r){return this._client.post("/embeddings",{body:e,...r})}};_d||(_d={});class Pd extends De{create(e,r){return this._client.post("/files",wl({body:e,...r}))}retrieve(e,r){return this._client.get(`/files/${e}`,r)}list(e={},r){return Mr(e)?this.list({},e):this._client.getAPIList("/files",Vb,{query:e,...r})}del(e,r){return this._client.delete(`/files/${e}`,r)}content(e,r){return this._client.get(`/files/${e}/content`,{...r,__binaryResponse:!0})}retrieveContent(e,r){return this._client.get(`/files/${e}/content`,{...r,headers:{Accept:"application/json",...r==null?void 0:r.headers}})}async waitForProcessing(e,{pollInterval:r=5e3,maxWait:n=30*60*1e3}={}){const i=new Set(["processed","error","deleted"]),s=Date.now();let a=await this.retrieve(e);for(;!a.status||!i.has(a.status);)if(await Wl(r),a=await this.retrieve(e),Date.now()-s>n)throw new If({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}}class Vb extends Db{}(function(t){t.FileObjectsPage=Vb})(Pd||(Pd={}));class Od extends De{list(e,r={},n){return Mr(r)?this.list(e,{},r):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Bb,{query:r,...n})}}class Bb extends Nn{}(function(t){t.FineTuningJobCheckpointsPage=Bb})(Od||(Od={}));class Sd extends De{constructor(){super(...arguments),this.checkpoints=new Od(this._client)}create(e,r){return this._client.post("/fine_tuning/jobs",{body:e,...r})}retrieve(e,r){return this._client.get(`/fine_tuning/jobs/${e}`,r)}list(e={},r){return Mr(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Hb,{query:e,...r})}cancel(e,r){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,r)}listEvents(e,r={},n){return Mr(r)?this.listEvents(e,{},r):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Wb,{query:r,...n})}}class Hb extends Nn{}class Wb extends Nn{}(function(t){t.FineTuningJobsPage=Hb,t.FineTuningJobEventsPage=Wb,t.Checkpoints=Od,t.FineTuningJobCheckpointsPage=Bb})(Sd||(Sd={}));class xd extends De{constructor(){super(...arguments),this.jobs=new Sd(this._client)}}(function(t){t.Jobs=Sd,t.FineTuningJobsPage=Hb,t.FineTuningJobEventsPage=Wb})(xd||(xd={}));class Ed extends De{createVariation(e,r){return this._client.post("/images/variations",wl({body:e,...r}))}edit(e,r){return this._client.post("/images/edits",wl({body:e,...r}))}generate(e,r){return this._client.post("/images/generations",{body:e,...r})}}Ed||(Ed={});class Td extends De{retrieve(e,r){return this._client.get(`/models/${e}`,r)}list(e){return this._client.getAPIList("/models",Jb,e)}del(e,r){return this._client.delete(`/models/${e}`,r)}}class Jb extends Db{}(function(t){t.ModelsPage=Jb})(Td||(Td={}));class Ad extends De{create(e,r){return this._client.post("/moderations",{body:e,...r})}}Ad||(Ad={});var GE;let Le=class extends DF{constructor({baseURL:e=xc("OPENAI_BASE_URL"),apiKey:r=xc("OPENAI_API_KEY"),organization:n=xc("OPENAI_ORG_ID")??null,project:i=xc("OPENAI_PROJECT_ID")??null,...s}={}){if(r===void 0)throw new ve("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:r,organization:n,project:i,...s,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&JF())throw new ve(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new vd(this),this.chat=new rd(this),this.embeddings=new _d(this),this.files=new Pd(this),this.images=new Ed(this),this.audio=new ad(this),this.moderations=new Ad(this),this.models=new Td(this),this.fineTuning=new xd(this),this.beta=new wd(this),this.batches=new od(this),this._options=a,this.apiKey=r,this.organization=n,this.project=i}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}};GE=Le;Le.OpenAI=GE;Le.OpenAIError=ve;Le.APIError=ar;Le.APIConnectionError=Hl;Le.APIConnectionTimeoutError=If;Le.APIUserAbortError=gr;Le.NotFoundError=Cb;Le.ConflictError=Rb;Le.RateLimitError=Nb;Le.BadRequestError=Ab;Le.AuthenticationError=kb;Le.InternalServerError=$b;Le.PermissionDeniedError=Ib;Le.UnprocessableEntityError=jb;Le.toFile=FE;Le.fileFromPath=NE;const{OpenAIError:v9,APIError:_9,APIConnectionError:P9,APIConnectionTimeoutError:QF,APIUserAbortError:XF,NotFoundError:O9,ConflictError:S9,RateLimitError:x9,BadRequestError:E9,AuthenticationError:T9,InternalServerError:A9,PermissionDeniedError:k9,UnprocessableEntityError:I9}=OF;(function(t){t.Page=Db,t.CursorPage=Nn,t.Completions=vd,t.Chat=rd,t.Embeddings=_d,t.Files=Pd,t.FileObjectsPage=Vb,t.Images=Ed,t.Audio=ad,t.Moderations=Ad,t.Models=Td,t.ModelsPage=Jb,t.FineTuning=xd,t.Beta=wd,t.Batches=od,t.BatchesPage=Mb})(Le||(Le={}));function ez(){const t=new TextEncoder;return new TransformStream({transform(e,r){r.enqueue(t.encode(typeof e.content=="string"?e.content:JSON.stringify(e.content)))}})}class pr extends Of{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[r,n]=super._separateRunnableConfigFromCallOptions(e);return n!=null&&n.timeout&&!n.signal&&(n.signal=AbortSignal.timeout(n.timeout)),[r,n]}async invoke(e,r){const n=pr._convertInputToPromptValue(e);return(await this.generatePrompt([n],r,r==null?void 0:r.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,r,n){throw new Error("Not implemented.")}async*_streamIterator(e,r){if(this._streamResponseChunks===pr.prototype._streamResponseChunks)yield this.invoke(e,r);else{const i=pr._convertInputToPromptValue(e).toChatMessages(),[s,a]=this._separateRunnableConfigFromCallOptions(r),o={...s.metadata,...this.getLsParams(a)},u=await et.configure(s.callbacks,this.callbacks,s.tags,this.tags,o,this.metadata,{verbose:this.verbose}),l={options:a,invocation_params:this==null?void 0:this.invocationParams(a),batch_size:1},c=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),[i],s.runId,void 0,l,void 0,void 0,s.runName));let h;try{for await(const d of this._streamResponseChunks(i,a,c==null?void 0:c[0]))d.message.response_metadata={...d.generationInfo,...d.message.response_metadata},yield d.message,h?h=h.concat(d):h=d}catch(d){throw await Promise.all((c??[]).map(f=>f==null?void 0:f.handleLLMError(d))),d}await Promise.all((c??[]).map(d=>d==null?void 0:d.handleLLMEnd({generations:[[h]]})))}}getLsParams(e){return{ls_model_type:"chat",ls_stop:e.stop}}async _generateUncached(e,r,n){var f;const i=e.map(p=>p.map(Ts)),s={...n.metadata,...this.getLsParams(r)},a=await et.configure(n.callbacks,this.callbacks,n.tags,this.tags,s,this.metadata,{verbose:this.verbose}),o={options:r,invocation_params:this==null?void 0:this.invocationParams(r),batch_size:1},u=await(a==null?void 0:a.handleChatModelStart(this.toJSON(),i,n.runId,void 0,o,void 0,void 0,n.runName)),l=[],c=[];if(!!(u!=null&&u[0].handlers.find(p=>pb(p)||bf(p)))&&i.length===1&&this._streamResponseChunks!==pr.prototype._streamResponseChunks)try{const p=await this._streamResponseChunks(i[0],r,u==null?void 0:u[0]);let y;for await(const v of p)y===void 0?y=v:y=nr(y,v);if(y===void 0)throw new Error("Received empty response from chat model call.");l.push([y]),await(u==null?void 0:u[0].handleLLMEnd({generations:l,llmOutput:{}}))}catch(p){throw await(u==null?void 0:u[0].handleLLMError(p)),p}else{const p=await Promise.allSettled(i.map((y,v)=>this._generate(y,{...r,promptIndex:v},u==null?void 0:u[v])));await Promise.all(p.map(async(y,v)=>{var g,m;if(y.status==="fulfilled"){const b=y.value;for(const S of b.generations)S.message.response_metadata={...S.generationInfo,...S.message.response_metadata};return b.generations.length===1&&(b.generations[0].message.response_metadata={...b.llmOutput,...b.generations[0].message.response_metadata}),l[v]=b.generations,c[v]=b.llmOutput,(g=u==null?void 0:u[v])==null?void 0:g.handleLLMEnd({generations:[b.generations],llmOutput:b.llmOutput})}else return await((m=u==null?void 0:u[v])==null?void 0:m.handleLLMError(y.reason)),Promise.reject(y.reason)}))}const d={generations:l,llmOutput:c.length?(f=this._combineLLMOutput)==null?void 0:f.call(this,...c):void 0};return Object.defineProperty(d,Pt,{value:u?{runIds:u==null?void 0:u.map(p=>p.runId)}:void 0,configurable:!0}),d}async _generateCached({messages:e,cache:r,llmStringKey:n,parsedOptions:i,handledOptions:s}){const a=e.map(v=>v.map(Ts)),o={...s.metadata,...this.getLsParams(i)},u=await et.configure(s.callbacks,this.callbacks,s.tags,this.tags,o,this.metadata,{verbose:this.verbose}),l={options:i,invocation_params:this==null?void 0:this.invocationParams(i),batch_size:1,cached:!0},c=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),a,s.runId,void 0,l,void 0,void 0,s.runName)),h=[],f=(await Promise.allSettled(a.map(async(v,g)=>{const m=pr._convertInputToPromptValue(v).toString(),b=await r.lookup(m,n);return b==null&&h.push(g),b}))).map((v,g)=>({result:v,runManager:c==null?void 0:c[g]})).filter(({result:v})=>v.status==="fulfilled"&&v.value!=null||v.status==="rejected"),p=[];await Promise.all(f.map(async({result:v,runManager:g},m)=>{if(v.status==="fulfilled"){const b=v.value;return p[m]=b,b.length&&await(g==null?void 0:g.handleLLMNewToken(b[0].text)),g==null?void 0:g.handleLLMEnd({generations:[b]})}else return await(g==null?void 0:g.handleLLMError(v.reason)),Promise.reject(v.reason)}));const y={generations:p,missingPromptIndices:h};return Object.defineProperty(y,Pt,{value:c?{runIds:c==null?void 0:c.map(v=>v.runId)}:void 0,configurable:!0}),y}async generate(e,r,n){let i;Array.isArray(r)?i={stop:r}:i=r;const s=e.map(f=>f.map(Ts)),[a,o]=this._separateRunnableConfigFromCallOptions(i);if(a.callbacks=a.callbacks??n,!this.cache)return this._generateUncached(s,o,a);const{cache:u}=this,l=this._getSerializedCacheKeyParametersForCall(o),{generations:c,missingPromptIndices:h}=await this._generateCached({messages:s,cache:u,llmStringKey:l,parsedOptions:o,handledOptions:a});let d={};if(h.length>0){const f=await this._generateUncached(h.map(p=>s[p]),o,a);await Promise.all(f.generations.map(async(p,y)=>{const v=h[y];c[v]=p;const g=pr._convertInputToPromptValue(s[v]).toString();return u.update(g,l,p)})),d=f.llmOutput??{}}return{generations:c,llmOutput:d}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,r,n){const i=e.map(s=>s.toChatMessages());return this.generate(i,r,n)}async call(e,r,n){return(await this.generate([e.map(Ts)],r,n)).generations[0][0].message}async callPrompt(e,r,n){const i=e.toChatMessages();return this.call(i,r,n)}async predictMessages(e,r,n){return this.call(e,r,n)}async predict(e,r,n){const i=new ut(e),s=await this.call([i],r,n);if(typeof s.content!="string")throw new Error("Cannot use predict when output is not a string.");return s.content}}class tz extends pr{async _generate(e,r,n){const i=await this._call(e,r,n),s=new Fe(i);if(typeof s.content!="string")throw new Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:s.content,message:s}]}}}const rz=Object.freeze(Object.defineProperty({__proto__:null,BaseChatModel:pr,SimpleChatModel:tz,createChatMessageChunkEncoderStream:ez},Symbol.toStringTag,{value:"Module"}));function ZE(t,e){if(t.function===void 0)return;let r;if(e!=null&&e.partial)try{r=lo(t.function.arguments??"{}")}catch{return}else try{r=JSON.parse(t.function.arguments)}catch(i){throw new je([`Function "${t.function.name}" arguments:`,"",t.function.arguments,"","are not valid JSON.",`Error: ${i.message}`].join(`
`))}const n={name:t.function.name,args:r};return e!=null&&e.returnId&&(n.id=t.id),n}function nz(t){if(t.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:t.id,type:"function",function:{name:t.name,arguments:JSON.stringify(t.args)}}}function iz(t,e){var r,n;return{name:(r=t.function)==null?void 0:r.name,args:(n=t.function)==null?void 0:n.arguments,id:t.id,error:e}}let sz=class extends an{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}async parseResult(e){const r=e[0].message.additional_kwargs.tool_calls;if(!r)throw new Error(`No tools_call in message ${JSON.stringify(e)}`);const n=JSON.parse(JSON.stringify(r)),i=[];for(const s of n){const a=ZE(s,{partial:!0});if(a!==void 0){const o={type:a.name,args:a.args,id:a.id};Object.defineProperty(o,"name",{get(){return this.type}}),Object.defineProperty(o,"arguments",{get(){return this.args}}),i.push(o)}}return i}},v0=class extends an{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"initialParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.initialParser=new sz(e),this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const r=await this.zodSchema.safeParseAsync(e);if(r.success)return r.data;throw new je(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(r.error.errors)}`,JSON.stringify(e,null,2))}async parseResult(e){const n=(await this.initialParser.parseResult(e)).filter(a=>a.type===this.keyName);let i=n;return this.returnId||(i=n.map(a=>a.args)),this.returnSingle?this._validateResult(i[0]):await Promise.all(i.map(a=>this._validateResult(a)))}};function jf(t){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:r,azureOpenAIApiKey:n,azureOpenAIBasePath:i,baseURL:s,azureADTokenProvider:a}=t;if((n||a)&&i&&e)return`${i}/${e}`;if(n||a){if(!r)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${r}.openai.azure.com/openai/deployments/${e}`}return s}function Nf(t){let e;return t.constructor.name===QF.name?(e=new Error(t.message),e.name="TimeoutError"):t.constructor.name===XF.name?(e=new Error(t.message),e.name="AbortError"):e=t,e}function az(t){return{type:"function",function:{name:t.name,description:t.description,parameters:Zt(t.schema)}}}function oz(t){return t.anyOf!==void 0&&Array.isArray(t.anyOf)}function uz(t){const e=["namespace functions {",""];for(const r of t)r.description&&e.push(`// ${r.description}`),Object.keys(r.parameters.properties??{}).length>0?(e.push(`type ${r.name} = (_: {`),e.push(YE(r.parameters,0)),e.push("}) => any;")):e.push(`type ${r.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function YE(t,e){var n;const r=[];for(const[i,s]of Object.entries(t.properties??{}))s.description&&e<2&&r.push(`// ${s.description}`),(n=t.required)!=null&&n.includes(i)?r.push(`${i}: ${kd(s,e)},`):r.push(`${i}?: ${kd(s,e)},`);return r.map(i=>" ".repeat(e)+i).join(`
`)}function kd(t,e){if(oz(t))return t.anyOf.map(r=>kd(r,e)).join(" | ");switch(t.type){case"string":return t.enum?t.enum.map(r=>`"${r}"`).join(" | "):"string";case"number":return t.enum?t.enum.map(r=>`${r}`).join(" | "):"number";case"integer":return t.enum?t.enum.map(r=>`${r}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",YE(t,e+2),"}"].join(`
`);case"array":return t.items?`${kd(t.items,e)}[]`:"any[]";default:return""}}function lz(t){return t.role!=="system"&&t.role!=="assistant"&&t.role!=="user"&&t.role!=="function"&&t.role!=="tool"&&console.warn(`Unknown message role: ${t.role}`),t.role}function QE(t){const e=t._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Ur.isInstance(t))throw new Error("Invalid generic chat message");return lz(t)}default:throw new Error(`Unknown message type: ${e}`)}}function cz(t){const e=t.tool_calls;switch(t.role){case"assistant":{const r=[],n=[];for(const i of e??[])try{r.push(ZE(i,{returnId:!0}))}catch(s){n.push(iz(i,s.message))}return new Fe({content:t.content||"",tool_calls:r,invalid_tool_calls:n,additional_kwargs:{function_call:t.function_call,tool_calls:e}})}default:return new Ur(t.content||"",t.role??"unknown")}}function hz(t,e){var s,a;const r=t.role??e,n=t.content??"";let i;if(t.function_call?i={function_call:t.function_call}:t.tool_calls?i={tool_calls:t.tool_calls}:i={},r==="user")return new ms({content:n});if(r==="assistant"){const o=[];if(Array.isArray(t.tool_calls))for(const u of t.tool_calls)o.push({name:(s=u.function)==null?void 0:s.name,args:(a=u.function)==null?void 0:a.arguments,id:u.id,index:u.index});return new Or({content:n,tool_call_chunks:o,additional_kwargs:i})}else return r==="system"?new gs({content:n}):r==="function"?new ps({content:n,additional_kwargs:i,name:t.name}):r==="tool"?new sa({content:n,additional_kwargs:i,tool_call_id:t.tool_call_id}):new fs({content:n,role:r})}function _0(t){return t.map(e=>{var n;const r={role:QE(e),content:e.content};return e.name!=null&&(r.name=e.name),e.additional_kwargs.function_call!=null&&(r.function_call=e.additional_kwargs.function_call),lb(e)&&((n=e.tool_calls)!=null&&n.length)?r.tool_calls=e.tool_calls.map(nz):(e.additional_kwargs.tool_calls!=null&&(r.tool_calls=e.additional_kwargs.tool_calls),e.tool_call_id!=null&&(r.tool_call_id=e.tool_call_id)),r})}class $o extends pr{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,r){var n,i,s,a,o,u,l,c;if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureADTokenProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??he("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??he("AZURE_OPENAI_API_KEY"),this.azureADTokenProvider=(e==null?void 0:e.azureADTokenProvider)??void 0,!this.azureOpenAIApiKey&&!this.apiKey&&!this.azureADTokenProvider)throw new Error("OpenAI or Azure OpenAI API key or Token Provider not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??he("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=(e==null?void 0:e.azureOpenAIApiDeploymentName)??he("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??he("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??he("AZURE_OPENAI_BASE_PATH"),this.organization=((n=e==null?void 0:e.configuration)==null?void 0:n.organization)??he("OPENAI_ORGANIZATION"),this.modelName=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.model=this.modelName,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.maxTokens=e==null?void 0:e.maxTokens,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this==null?void 0:this.stop,this.user=e==null?void 0:e.user,this.streaming=(e==null?void 0:e.streaming)??!1,this.azureOpenAIApiKey||this.azureADTokenProvider){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.apiKey=this.apiKey??""}this.clientConfig={apiKey:this.apiKey,organization:this.organization,baseURL:(r==null?void 0:r.basePath)??((i=e==null?void 0:e.configuration)==null?void 0:i.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((s=r==null?void 0:r.baseOptions)==null?void 0:s.headers)??((o=(a=e==null?void 0:e.configuration)==null?void 0:a.baseOptions)==null?void 0:o.headers),defaultQuery:((u=r==null?void 0:r.baseOptions)==null?void 0:u.params)??((c=(l=e==null?void 0:e.configuration)==null?void 0:l.baseOptions)==null?void 0:c.params),...r,...e==null?void 0:e.configuration}}getLsParams(e){const r=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:r.temperature??void 0,ls_max_tokens:r.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,r){return this.bind({tools:e.map(bl),...r})}invocationParams(e){function r(i){return i!==void 0&&i.every(s=>Array.isArray(s.lc_namespace))}return{model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:r(e==null?void 0:e.tools)?e==null?void 0:e.tools.map(bl):e==null?void 0:e.tools,tool_choice:e==null?void 0:e.tool_choice,response_format:e==null?void 0:e.response_format,seed:e==null?void 0:e.seed,...(e==null?void 0:e.stream_options)!==void 0?{stream_options:e.stream_options}:{},parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.modelKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,r,n){var l;const i=_0(e),s={...this.invocationParams(r),messages:i,stream:!0};let a;const o=await this.completionWithRetry(s,r);let u;for await(const c of o){const h=c==null?void 0:c.choices[0];if(c.usage&&(u=c.usage),!h)continue;const{delta:d}=h;if(!d)continue;const f=hz(d,a);a=d.role??a;const p={prompt:r.promptIndex??0,completion:h.index??0};if(typeof f.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const y={...p};h.finish_reason!==void 0&&(y.finish_reason=h.finish_reason),this.logprobs&&(y.logprobs=h.logprobs);const v=new nn({message:f,text:f.content,generationInfo:y});yield v,n==null||n.handleLLMNewToken(v.text??"",p,void 0,void 0,void 0,{chunk:v})}if(u&&(yield new nn({message:new Or({content:"",usage_metadata:{input_tokens:u.prompt_tokens,output_tokens:u.completion_tokens,total_tokens:u.total_tokens}}),text:""})),(l=r.signal)!=null&&l.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,r,n){var o,u;const i={},s=this.invocationParams(r),a=_0(e);if(s.stream){const l=this._streamResponseChunks(e,r,n),c={};for await(const v of l){v.message.response_metadata={...v.generationInfo,...v.message.response_metadata};const g=((o=v.generationInfo)==null?void 0:o.completion)??0;c[g]===void 0?c[g]=v:c[g]=c[g].concat(v)}const h=Object.entries(c).sort(([v],[g])=>parseInt(v,10)-parseInt(g,10)).map(([v,g])=>g),{functions:d,function_call:f}=this.invocationParams(r),p=await this.getEstimatedTokenCountFromPrompt(e,d,f),y=await this.getNumTokensFromGenerations(h);return i.promptTokens=p,i.completionTokens=y,i.totalTokens=p+y,{generations:h,llmOutput:{estimatedTokenUsage:i}}}else{const l=await this.completionWithRetry({...s,stream:!1,messages:a},{signal:r==null?void 0:r.signal,...r==null?void 0:r.options}),{completion_tokens:c,prompt_tokens:h,total_tokens:d}=(l==null?void 0:l.usage)??{};c&&(i.completionTokens=(i.completionTokens??0)+c),h&&(i.promptTokens=(i.promptTokens??0)+h),d&&(i.totalTokens=(i.totalTokens??0)+d);const f=[];for(const p of(l==null?void 0:l.choices)??[]){const v={text:((u=p.message)==null?void 0:u.content)??"",message:cz(p.message??{role:"assistant"})};v.generationInfo={...p.finish_reason?{finish_reason:p.finish_reason}:{},...p.logprobs?{logprobs:p.logprobs}:{}},lb(v.message)&&(v.message.usage_metadata={input_tokens:i.promptTokens??0,output_tokens:i.completionTokens??0,total_tokens:i.totalTokens??0}),f.push(v)}return{generations:f,llmOutput:{tokenUsage:i}}}}async getEstimatedTokenCountFromPrompt(e,r,n){let i=(await this.getNumTokensFromMessages(e)).totalCount;if(r&&n!=="auto"){const s=uz(r);i+=await this.getNumTokens(s),i+=9}return r&&e.find(s=>s._getType()==="system")&&(i-=4),n==="none"?i+=1:typeof n=="object"&&(i+=await this.getNumTokens(n.name)+4),i}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>{var i;return(i=n.message.additional_kwargs)!=null&&i.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)}))).reduce((n,i)=>n+i,0)}async getNumTokensFromMessages(e){let r=0,n=0,i=0;this.model==="gpt-3.5-turbo-0301"?(n=4,i=-1):(n=3,i=1);const s=await Promise.all(e.map(async a=>{var d,f,p,y,v,g;const o=await this.getNumTokens(a.content),u=await this.getNumTokens(QE(a)),l=a.name!==void 0?i+await this.getNumTokens(a.name):0;let c=o+n+u+l;const h=a;if(h._getType()==="function"&&(c-=2),(d=h.additional_kwargs)!=null&&d.function_call&&(c+=3),(f=h==null?void 0:h.additional_kwargs.function_call)!=null&&f.name&&(c+=await this.getNumTokens((p=h.additional_kwargs.function_call)==null?void 0:p.name)),(y=h.additional_kwargs.function_call)!=null&&y.arguments)try{c+=await this.getNumTokens(JSON.stringify(JSON.parse((v=h.additional_kwargs.function_call)==null?void 0:v.arguments)))}catch(m){console.error("Error parsing function arguments",m,JSON.stringify(h.additional_kwargs.function_call)),c+=await this.getNumTokens((g=h.additional_kwargs.function_call)==null?void 0:g.arguments)}return r+=c,c}));return r+=3,{totalCount:r,countPerMessage:s}}async completionWithRetry(e,r){const n=this._getClientOptions(r);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(i){throw Nf(i)}})}_getClientOptions(e){if(!this.client){const n={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},i=jf(n),s={...this.clientConfig,baseURL:i,timeout:this.timeout,maxRetries:0};s.baseURL||delete s.baseURL,this.client=new Le(s)}const r={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(r.headers={"api-key":this.azureOpenAIApiKey,...r.headers},r.query={"api-version":this.azureOpenAIApiVersion,...r.query}),r}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((r,n)=>(n&&n.tokenUsage&&(r.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,r.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,r.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),r),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,r){let n,i,s,a;dz(e)?(n=e.schema,i=e.name,s=e.method,a=e.includeRaw):(n=e,i=r==null?void 0:r.name,s=r==null?void 0:r.method,a=r==null?void 0:r.includeRaw);let o,u;if(s==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),P0(n)?u=Sb.fromZodSchema(n):u=new PE;else{let d=i??"extract";if(P0(n)){const f=Zt(n);o=this.bind({tools:[{type:"function",function:{name:d,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:d}}}),u=new v0({returnSingle:!0,keyName:d,zodSchema:n})}else{let f;typeof n.name=="string"&&typeof n.parameters=="object"&&n.parameters!=null?(f=n,d=n.name):(d=n.title??d,f={name:d,description:n.description??"",parameters:n}),o=this.bind({tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:d}}}),u=new v0({returnSingle:!0,keyName:d})}}if(!a)return o.pipe(u);const l=Sr.assign({parsed:(d,f)=>u.invoke(d.raw,f)}),c=Sr.assign({parsed:()=>null}),h=l.withFallbacks({fallbacks:[c]});return Bt.from([{raw:o},h])}}function P0(t){return typeof(t==null?void 0:t.parse)=="function"}function dz(t){return t!==void 0&&typeof t.schema=="object"}class Hi extends Of{constructor({concurrency:e,...r}){super(e?{maxConcurrency:e,...r}:r),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","llms",this._llmType()]})}async invoke(e,r){const n=Hi._convertInputToPromptValue(e);return(await this.generatePrompt([n],r,r==null?void 0:r.callbacks)).generations[0][0].text}async*_streamResponseChunks(e,r,n){throw new Error("Not implemented.")}_separateRunnableConfigFromCallOptions(e){const[r,n]=super._separateRunnableConfigFromCallOptions(e);return n!=null&&n.timeout&&!n.signal&&(n.signal=AbortSignal.timeout(n.timeout)),[r,n]}async*_streamIterator(e,r){if(this._streamResponseChunks===Hi.prototype._streamResponseChunks)yield this.invoke(e,r);else{const n=Hi._convertInputToPromptValue(e),[i,s]=this._separateRunnableConfigFromCallOptions(r),a=await et.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),o={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1},u=await(a==null?void 0:a.handleLLMStart(this.toJSON(),[n.toString()],i.runId,void 0,o,void 0,void 0,i.runName));let l=new jn({text:""});try{for await(const c of this._streamResponseChunks(e.toString(),s,u==null?void 0:u[0]))l?l=l.concat(c):l=c,typeof c.text=="string"&&(yield c.text)}catch(c){throw await Promise.all((u??[]).map(h=>h==null?void 0:h.handleLLMError(c))),c}await Promise.all((u??[]).map(c=>c==null?void 0:c.handleLLMEnd({generations:[[l]]})))}}async generatePrompt(e,r,n){const i=e.map(s=>s.toString());return this.generate(i,r,n)}invocationParams(e){return{}}_flattenLLMResult(e){const r=[];for(let n=0;n<e.generations.length;n+=1){const i=e.generations[n];if(n===0)r.push({generations:[i],llmOutput:e.llmOutput});else{const s=e.llmOutput?{...e.llmOutput,tokenUsage:{}}:void 0;r.push({generations:[i],llmOutput:s})}}return r}async _generateUncached(e,r,n){const i=await et.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),s={options:r,invocation_params:this==null?void 0:this.invocationParams(r),batch_size:e.length},a=await(i==null?void 0:i.handleLLMStart(this.toJSON(),e,n.runId,void 0,s,void 0,void 0,n==null?void 0:n.runName)),o=!!(a!=null&&a[0].handlers.find(c=>pb(c)||bf(c)));let u;if(o&&e.length===1&&this._streamResponseChunks!==Hi.prototype._streamResponseChunks)try{const c=await this._streamResponseChunks(e[0],r,a==null?void 0:a[0]);let h;for await(const d of c)h===void 0?h=d:h=nr(h,d);if(h===void 0)throw new Error("Received empty response from chat model call.");u={generations:[[h]],llmOutput:{}},await(a==null?void 0:a[0].handleLLMEnd(u))}catch(c){throw await(a==null?void 0:a[0].handleLLMError(c)),c}else{try{u=await this._generate(e,r,a==null?void 0:a[0])}catch(h){throw await Promise.all((a??[]).map(d=>d==null?void 0:d.handleLLMError(h))),h}const c=this._flattenLLMResult(u);await Promise.all((a??[]).map((h,d)=>h==null?void 0:h.handleLLMEnd(c[d])))}const l=(a==null?void 0:a.map(c=>c.runId))||void 0;return Object.defineProperty(u,Pt,{value:l?{runIds:l}:void 0,configurable:!0}),u}async _generateCached({prompts:e,cache:r,llmStringKey:n,parsedOptions:i,handledOptions:s,runId:a}){const o=await et.configure(s.callbacks,this.callbacks,s.tags,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),u={options:i,invocation_params:this==null?void 0:this.invocationParams(i),batch_size:e.length,cached:!0},l=await(o==null?void 0:o.handleLLMStart(this.toJSON(),e,a,void 0,u,void 0,void 0,s==null?void 0:s.runName)),c=[],d=(await Promise.allSettled(e.map(async(y,v)=>{const g=await r.lookup(y,n);return g==null&&c.push(v),g}))).map((y,v)=>({result:y,runManager:l==null?void 0:l[v]})).filter(({result:y})=>y.status==="fulfilled"&&y.value!=null||y.status==="rejected"),f=[];await Promise.all(d.map(async({result:y,runManager:v},g)=>{if(y.status==="fulfilled"){const m=y.value;return f[g]=m,m.length&&await(v==null?void 0:v.handleLLMNewToken(m[0].text)),v==null?void 0:v.handleLLMEnd({generations:[m]})}else return await(v==null?void 0:v.handleLLMError(y.reason)),Promise.reject(y.reason)}));const p={generations:f,missingPromptIndices:c};return Object.defineProperty(p,Pt,{value:l?{runIds:l==null?void 0:l.map(y=>y.runId)}:void 0,configurable:!0}),p}async generate(e,r,n){if(!Array.isArray(e))throw new Error("Argument 'prompts' is expected to be a string[]");let i;Array.isArray(r)?i={stop:r}:i=r;const[s,a]=this._separateRunnableConfigFromCallOptions(i);if(s.callbacks=s.callbacks??n,!this.cache)return this._generateUncached(e,a,s);const{cache:o}=this,u=this._getSerializedCacheKeyParametersForCall(a),{generations:l,missingPromptIndices:c}=await this._generateCached({prompts:e,cache:o,llmStringKey:u,parsedOptions:a,handledOptions:s,runId:s.runId});let h={};if(c.length>0){const d=await this._generateUncached(c.map(f=>e[f]),a,s);await Promise.all(d.generations.map(async(f,p)=>{const y=c[p];return l[y]=f,o.update(e[y],u,f)})),h=d.llmOutput??{}}return{generations:l,llmOutput:h}}async call(e,r,n){const{generations:i}=await this.generate([e],r,n);return i[0][0].text}async predict(e,r,n){return this.call(e,r,n)}async predictMessages(e,r,n){const i=kt(e),s=await this.call(i,r,n);return new Fe(s)}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}_modelType(){return"base_llm"}}class $f extends Hi{async _generate(e,r,n){return{generations:await Promise.all(e.map((s,a)=>this._call(s,{...r,promptIndex:a},n).then(o=>[{text:o}])))}}}const fz=Object.freeze(Object.defineProperty({__proto__:null,BaseLLM:Hi,LLM:$f},Symbol.toStringTag,{value:"Module"})),Id=(t,e)=>t.reduce((r,n,i)=>{const s=Math.floor(i/e),a=r[s]||[];return r[s]=a.concat([n]),r},[]),pz=Object.freeze(Object.defineProperty({__proto__:null,chunkArray:Id},Symbol.toStringTag,{value:"Module"}));class mz extends $f{static lc_name(){return"OpenAIChat"}get callKeys(){return[...super.callKeys,"options","promptIndex"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,r){var n,i,s,a,o,u,l,c;if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"prefixMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??he("OPENAI_API_KEY"),this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??he("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??he("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=((e==null?void 0:e.azureOpenAIApiCompletionsDeploymentName)||(e==null?void 0:e.azureOpenAIApiDeploymentName))??(he("AZURE_OPENAI_API_COMPLETIONS_DEPLOYMENT_NAME")||he("AZURE_OPENAI_API_DEPLOYMENT_NAME")),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??he("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??he("AZURE_OPENAI_BASE_PATH"),this.organization=((n=e==null?void 0:e.configuration)==null?void 0:n.organization)??he("OPENAI_ORGANIZATION"),this.modelName=(e==null?void 0:e.modelName)??this.modelName,this.prefixMessages=(e==null?void 0:e.prefixMessages)??this.prefixMessages,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.maxTokens=e==null?void 0:e.maxTokens,this.stop=e==null?void 0:e.stop,this.user=e==null?void 0:e.user,this.streaming=(e==null?void 0:e.streaming)??!1,this.n>1)throw new Error("Cannot use n > 1 in OpenAIChat LLM. Use ChatOpenAI Chat Model instead.");if(this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:(r==null?void 0:r.basePath)??((i=e==null?void 0:e.configuration)==null?void 0:i.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((s=r==null?void 0:r.baseOptions)==null?void 0:s.headers)??((o=(a=e==null?void 0:e.configuration)==null?void 0:a.baseOptions)==null?void 0:o.headers),defaultQuery:((u=r==null?void 0:r.baseOptions)==null?void 0:u.params)??((c=(l=e==null?void 0:e.configuration)==null?void 0:l.baseOptions)==null?void 0:c.params),...r,...e==null?void 0:e.configuration}}invocationParams(e){return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,n:this.n,logit_bias:this.logitBias,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,stop:(e==null?void 0:e.stop)??this.stop,user:this.user,stream:this.streaming,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}formatMessages(e){const r={role:"user",content:e};return this.prefixMessages?[...this.prefixMessages,r]:[r]}async*_streamResponseChunks(e,r,n){var a;const i={...this.invocationParams(r),messages:this.formatMessages(e),stream:!0},s=await this.completionWithRetry(i,r);for await(const o of s){const u=o==null?void 0:o.choices[0];if(!u)continue;const{delta:l}=u,c=new jn({text:l.content??""});yield c;const h={prompt:r.promptIndex??0,completion:u.index??0};n==null||n.handleLLMNewToken(c.text??"",h)}if((a=r.signal)!=null&&a.aborted)throw new Error("AbortError")}async _call(e,r,n){var s,a;const i=this.invocationParams(r);if(i.stream){const o=await this._streamResponseChunks(e,r,n);let u;for await(const l of o)u===void 0?u=l:u=u.concat(l);return(u==null?void 0:u.text)??""}else{const o=await this.completionWithRetry({...i,stream:!1,messages:this.formatMessages(e)},{signal:r.signal,...r.options});return((a=(s=o==null?void 0:o.choices[0])==null?void 0:s.message)==null?void 0:a.content)??""}}async completionWithRetry(e,r){const n=this._getClientOptions(r);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(i){throw Nf(i)}})}_getClientOptions(e){if(!this.client){const n={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},i=jf(n),s={...this.clientConfig,baseURL:i,timeout:this.timeout,maxRetries:0};s.baseURL||delete s.baseURL,this.client=new Le(s)}const r={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(r.headers={"api-key":this.azureOpenAIApiKey,...r.headers},r.query={"api-version":this.azureOpenAIApiVersion,...r.query}),r}_llmType(){return"openai"}}class gz extends Hi{static lc_name(){return"OpenAI"}get callKeys(){return[...super.callKeys,"options"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,r){var i,s,a,o,u,l,c,h;let n=(e==null?void 0:e.model)??(e==null?void 0:e.modelName);if((n!=null&&n.startsWith("gpt-3.5-turbo")||n!=null&&n.startsWith("gpt-4"))&&!(n!=null&&n.includes("-instruct")))return new mz(e,r);if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:.7}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:256}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"bestOf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo-instruct"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo-instruct"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:20}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureADTokenProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n=n??this.model,this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??he("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??he("AZURE_OPENAI_API_KEY"),this.azureADTokenProvider=(e==null?void 0:e.azureADTokenProvider)??void 0,!this.azureOpenAIApiKey&&!this.apiKey&&!this.azureADTokenProvider)throw new Error("OpenAI or Azure OpenAI API key or Token Provider not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??he("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=((e==null?void 0:e.azureOpenAIApiCompletionsDeploymentName)||(e==null?void 0:e.azureOpenAIApiDeploymentName))??(he("AZURE_OPENAI_API_COMPLETIONS_DEPLOYMENT_NAME")||he("AZURE_OPENAI_API_DEPLOYMENT_NAME")),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??he("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??he("AZURE_OPENAI_BASE_PATH"),this.organization=((i=e==null?void 0:e.configuration)==null?void 0:i.organization)??he("OPENAI_ORGANIZATION"),this.modelName=n,this.model=n,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.batchSize=(e==null?void 0:e.batchSize)??this.batchSize,this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.maxTokens=(e==null?void 0:e.maxTokens)??this.maxTokens,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.n=(e==null?void 0:e.n)??this.n,this.bestOf=(e==null?void 0:e.bestOf)??this.bestOf,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=e==null?void 0:e.stopSequences,this.user=e==null?void 0:e.user,this.streaming=(e==null?void 0:e.streaming)??!1,this.streaming&&this.bestOf&&this.bestOf>1)throw new Error("Cannot stream results when bestOf > 1");if(this.azureOpenAIApiKey||this.azureADTokenProvider){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.apiKey=this.apiKey??""}this.clientConfig={apiKey:this.apiKey,organization:this.organization,baseURL:(r==null?void 0:r.basePath)??((s=e==null?void 0:e.configuration)==null?void 0:s.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((a=r==null?void 0:r.baseOptions)==null?void 0:a.headers)??((u=(o=e==null?void 0:e.configuration)==null?void 0:o.baseOptions)==null?void 0:u.headers),defaultQuery:((l=r==null?void 0:r.baseOptions)==null?void 0:l.params)??((h=(c=e==null?void 0:e.configuration)==null?void 0:c.baseOptions)==null?void 0:h.params),...r,...e==null?void 0:e.configuration}}invocationParams(e){return{model:this.model,temperature:this.temperature,max_tokens:this.maxTokens,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,n:this.n,best_of:this.bestOf,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,...this.modelKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return this._identifyingParams()}async _generate(e,r,n){const i=Id(e,this.batchSize),s=[],a={},o=this.invocationParams(r);if(o.max_tokens===-1){if(e.length!==1)throw new Error("max_tokens set to -1 not supported for multiple inputs");o.max_tokens=await tE({prompt:e[0],modelName:this.model})}for(let l=0;l<i.length;l+=1){const c=o.stream?await(async()=>{var g;const p=[];let y;const v=await this.completionWithRetry({...o,stream:!0,prompt:i[l]},r);for await(const m of v){y||(y={id:m.id,object:m.object,created:m.created,model:m.model});for(const b of m.choices){if(!p[b.index])p[b.index]=b;else{const S=p[b.index];S.text+=b.text,S.finish_reason=b.finish_reason,S.logprobs=b.logprobs}n==null||n.handleLLMNewToken(b.text,{prompt:Math.floor(b.index/this.n),completion:b.index%this.n})}}if((g=r.signal)!=null&&g.aborted)throw new Error("AbortError");return{...y,choices:p}})():await this.completionWithRetry({...o,stream:!1,prompt:i[l]},{signal:r.signal,...r.options});s.push(...c.choices);const{completion_tokens:h,prompt_tokens:d,total_tokens:f}=c.usage?c.usage:{completion_tokens:void 0,prompt_tokens:void 0,total_tokens:void 0};h&&(a.completionTokens=(a.completionTokens??0)+h),d&&(a.promptTokens=(a.promptTokens??0)+d),f&&(a.totalTokens=(a.totalTokens??0)+f)}return{generations:Id(s,this.n).map(l=>l.map(c=>({text:c.text??"",generationInfo:{finishReason:c.finish_reason,logprobs:c.logprobs}}))),llmOutput:{tokenUsage:a}}}async*_streamResponseChunks(e,r,n){var a;const i={...this.invocationParams(r),prompt:e,stream:!0},s=await this.completionWithRetry(i,r);for await(const o of s){const u=o==null?void 0:o.choices[0];if(!u)continue;const l=new jn({text:u.text,generationInfo:{finishReason:u.finish_reason}});yield l,n==null||n.handleLLMNewToken(l.text??"")}if((a=r.signal)!=null&&a.aborted)throw new Error("AbortError")}async completionWithRetry(e,r){const n=this._getClientOptions(r);return this.caller.call(async()=>{try{return await this.client.completions.create(e,n)}catch(i){throw Nf(i)}})}_getClientOptions(e){if(!this.client){const n={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},i=jf(n),s={...this.clientConfig,baseURL:i,timeout:this.timeout,maxRetries:0};s.baseURL||delete s.baseURL,this.client=new Le(s)}const r={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(r.headers={"api-key":this.azureOpenAIApiKey,...r.headers},r.query={"api-version":this.azureOpenAIApiVersion,...r.query}),r}_llmType(){return"openai"}}class Jl{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new oa(e??{})}}const yz=Object.freeze(Object.defineProperty({__proto__:null,Embeddings:Jl},Symbol.toStringTag,{value:"Module"}));class Gb extends Jl{constructor(e,r){var l,c,h;const n={maxConcurrency:2,...e};super(n),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),Object.defineProperty(this,"stripNewLines",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"dimensions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureADTokenProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let i=(n==null?void 0:n.apiKey)??(n==null?void 0:n.openAIApiKey)??he("OPENAI_API_KEY");const s=(n==null?void 0:n.azureOpenAIApiKey)??he("AZURE_OPENAI_API_KEY");if(this.azureADTokenProvider=(e==null?void 0:e.azureADTokenProvider)??void 0,!s&&!i&&!this.azureADTokenProvider)throw new Error("OpenAI or Azure OpenAI API key or Token Provider not found");const a=(n==null?void 0:n.azureOpenAIApiInstanceName)??he("AZURE_OPENAI_API_INSTANCE_NAME"),o=((n==null?void 0:n.azureOpenAIApiEmbeddingsDeploymentName)||(n==null?void 0:n.azureOpenAIApiDeploymentName))??(he("AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME")||he("AZURE_OPENAI_API_DEPLOYMENT_NAME")),u=(n==null?void 0:n.azureOpenAIApiVersion)??he("AZURE_OPENAI_API_VERSION");if(this.azureOpenAIBasePath=(n==null?void 0:n.azureOpenAIBasePath)??he("AZURE_OPENAI_BASE_PATH"),this.organization=((l=n==null?void 0:n.configuration)==null?void 0:l.organization)??he("OPENAI_ORGANIZATION"),this.modelName=(n==null?void 0:n.model)??(n==null?void 0:n.modelName)??this.model,this.model=this.modelName,this.batchSize=(n==null?void 0:n.batchSize)??(s?1:this.batchSize),this.stripNewLines=(n==null?void 0:n.stripNewLines)??this.stripNewLines,this.timeout=n==null?void 0:n.timeout,this.dimensions=n==null?void 0:n.dimensions,this.azureOpenAIApiVersion=u,this.azureOpenAIApiKey=s,this.azureOpenAIApiInstanceName=a,this.azureOpenAIApiDeploymentName=o,this.azureOpenAIApiKey||this.azureADTokenProvider){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");i=i??""}this.clientConfig={apiKey:i,organization:this.organization,baseURL:r==null?void 0:r.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:(c=r==null?void 0:r.baseOptions)==null?void 0:c.headers,defaultQuery:(h=r==null?void 0:r.baseOptions)==null?void 0:h.params,...r,...e==null?void 0:e.configuration}}async embedDocuments(e){const r=Id(this.stripNewLines?e.map(a=>a.replace(/\n/g," ")):e,this.batchSize),n=r.map(a=>{const o={model:this.model,input:a};return this.dimensions&&(o.dimensions=this.dimensions),this.embeddingWithRetry(o)}),i=await Promise.all(n),s=[];for(let a=0;a<i.length;a+=1){const o=r[a],{data:u}=i[a];for(let l=0;l<o.length;l+=1)s.push(u[l].embedding)}return s}async embedQuery(e){const r={model:this.model,input:this.stripNewLines?e.replace(/\n/g," "):e};this.dimensions&&(r.dimensions=this.dimensions);const{data:n}=await this.embeddingWithRetry(r);return n[0].embedding}async embeddingWithRetry(e){if(!this.client){const n={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},i=jf(n),s={...this.clientConfig,baseURL:i,timeout:this.timeout,maxRetries:0};s.baseURL||delete s.baseURL,this.client=new Le(s)}const r={};return this.azureOpenAIApiKey&&(r.headers={"api-key":this.azureOpenAIApiKey,...r.headers},r.query={"api-version":this.azureOpenAIApiVersion,...r.query}),this.caller.call(async()=>{try{return await this.client.embeddings.create(e,r)}catch(n){throw Nf(n)}})}}var Wp={};function Dg(t){try{return typeof process<"u"?Wp==null?void 0:Wp[t]:void 0}catch{return}}function bz(t){return t??Dg("LANGCHAIN_HUB_API_KEY")??Dg("LANGCHAIN_API_KEY")}function wz(t){const r=t??Dg("LANGCHAIN_HUB_API_URL")??"https://api.hub.langchain.com";if(!r)throw new Error("LangChain Hub API URL cannot be empty");return r}function O0(t){let e=t,r;if(t.includes(":")&&([e,r]=t.split(":",2)),!e.includes("/"))return["-",e,r];const[n,i]=e.split("/");return[n,i,r]}class vz{constructor(e){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.apiKey=bz(e==null?void 0:e.apiKey),this.apiUrl=wz(e==null?void 0:e.apiUrl)}get _hostUrl(){return this.apiUrl.includes("localhost")||this.apiUrl.includes("127.0.0.1")||this.apiUrl.includes("::1")?"http://localhost":this.apiUrl.split(".")[0].includes("beta")?"https://beta.smith.langchain.com":this.apiUrl.split(".")[0].includes("dev")?"https://dev.smith.langchain.com":"https://smith.langchain.com"}_getHeaders(e){const r={};return this.apiKey!==void 0&&(r["x-api-key"]=this.apiKey),(e==="POST"||e==="PATCH")&&(r["content-type"]="application/json"),r}async getSettings(){const e=await fetch(`${this.apiUrl}/settings`,{headers:this._getHeaders()}),r=await e.json();if(!e.ok){const n=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),i=new Error(`Error ${e.status}: ${e.statusText}
${n}`);throw i.statusCode=e.status,i}return r}async setTenantHandle(e){const r=await fetch(`${this.apiUrl}/settings/handle`,{method:"POST",headers:this._getHeaders("POST"),body:JSON.stringify({tenant_handle:e})}),n=await r.json();if(!r.ok){const i=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),s=new Error(`Error ${r.status}: ${r.statusText}
${i}`);throw s.statusCode=r.status,s}return n}async listRepos(e){const{limit:r=100,offset:n=0}=e??{},i=await fetch(`${this.apiUrl}/repos?limit=${r}&offset=${n}`,{headers:this._getHeaders()}),s=await i.json();if(!i.ok){const a=typeof s.detail=="string"?s.detail:JSON.stringify(s.detail),o=new Error(`Error ${i.status}: ${i.statusText}
${a}`);throw o.statusCode=i.status,o}return s}async getRepo(e){const r=await fetch(`${this.apiUrl}/repos/${e}`,{headers:this._getHeaders()}),n=await r.json();if(!r.ok){const i=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),s=new Error(`Error ${r.status}: ${r.statusText}
${i}`);throw s.statusCode=r.status,s}return n}async createRepo(e,r){const{isPublic:n=!0,description:i=""}=r??{},s=await fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:this._getHeaders("POST"),body:JSON.stringify({repo_handle:e,is_public:n,description:i})}),a=await s.json();if(!s.ok){const o=typeof a.detail=="string"?a.detail:JSON.stringify(a.detail),u=new Error(`Error ${s.status}: ${s.statusText}
${o}`);throw u.statusCode=s.status,u}return a}async listCommits(e,r){const{limit:n=100,offset:i=0}=r??{},s=await fetch(`${this.apiUrl}/commits/${e}/?limit=${n}&offset=${i}`,{headers:this._getHeaders()}),a=await s.json();if(!s.ok){const o=typeof a.detail=="string"?a.detail:JSON.stringify(a.detail),u=new Error(`Error ${s.status}: ${s.statusText}
${o}`);throw u.statusCode=s.status,u}return a}async likeRepo(e){const r=await fetch(`${this.apiUrl}/likes/${e}`,{method:"POST",headers:this._getHeaders("POST"),body:JSON.stringify({like:!0})}),n=await r.json();if(!r.ok){const i=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),s=new Error(`Error ${r.status}: ${r.statusText}
${i}`);throw s.statusCode=r.status,s}return n}async unlikeRepo(e){const r=await fetch(`${this.apiUrl}/likes/${e}`,{method:"POST",headers:this._getHeaders("POST"),body:JSON.stringify({like:!1})}),n=await r.json();if(!r.ok){const i=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),s=new Error(`Error ${r.status}: ${r.statusText}
${i}`);throw s.statusCode=r.status,s}return n}async _getLatestCommitHash(e){const n=(await this.listCommits(e)).commits;if(n.length!==0)return n[0].commit_hash}async updateRepo(e,r){const n=await fetch(`${this.apiUrl}/repos/${e}`,{method:"PATCH",headers:this._getHeaders("PATCH"),body:JSON.stringify(r)}),i=await n.json();if(!n.ok){const s=typeof i.detail=="string"?i.detail:JSON.stringify(i.detail),a=new Error(`Error ${n.status}: ${n.statusText}
${s}`);throw a.statusCode=n.status,a}return i}async push(e,r,n){var g;const{parentCommitHash:i="latest",newRepoIsPublic:s=!1,newRepoDescription:a=""}=n??{},o=await this.getSettings();if(s&&!o.tenant_handle)throw new Error(`
          Cannot create public prompt without first creating a LangChain Hub handle.
          
          You can add a handle by creating a public prompt at:
              https://smith.langchain.com/prompts
          
          This is a workspace-level handle and will be associated with all of your workspace's public prompts in the LangChain Hub.
        `);const[u,l,c]=O0(e),h=`${u}/${l}`;try{await this.getRepo(h)}catch(m){if(m.statusCode!==404)throw m;if(o.tenant_handle&&u!=="-"&&o.tenant_handle!==u)throw new Error(`Tenant "${o.tenant_handle}" is not the owner of repo "${e}".`);await this.createRepo(l,{description:a,isPublic:s})}const d=i==="latest"?await this._getLatestCommitHash(h):i,f=await fetch(`${this.apiUrl}/commits/${h}`,{method:"POST",headers:this._getHeaders("POST"),body:JSON.stringify({parent_commit:d,manifest:JSON.parse(r)})}),p=await f.json();if(!f.ok){const m=typeof p.detail=="string"?p.detail:JSON.stringify(p.detail),b=new Error(`Error ${f.status}: ${f.statusText}
${m}`);throw b.statusCode=f.status,b}const v=((g=p.commit)==null?void 0:g.commit_hash).slice(0,8);return`${this._hostUrl}/prompts/${l}/${v}?organizationId=${o.id}`}async pull(e){const r=O0(e),[n,i]=r;let s=r[2];if((s===void 0||s==="latest")&&(s=await this._getLatestCommitHash(`${n}/${i}`),s===void 0))throw new Error("No commits found.");const a=await fetch(`${this.apiUrl}/commits/${n}/${i}/${s}`,{method:"GET",headers:this._getHeaders()}),o=await a.json();if(!a.ok){const l=typeof o.detail=="string"?o.detail:JSON.stringify(o.detail),c=new Error(`Error ${a.status}: ${a.statusText}
${l}`);throw c.statusCode=a.status,c}const u=await o;return JSON.stringify(u.manifest)}}const _z=[],Pz=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class XE extends St{async addMessages(e){for(const r of e)await this.addMessage(r)}}class Zb extends St{addUserMessage(e){return this.addMessage(new ut(e))}addAIChatMessage(e){return this.addMessage(new Fe(e))}addAIMessage(e){return this.addMessage(new Fe(e))}async addMessages(e){for(const r of e)await this.addMessage(r)}clear(){throw new Error("Not implemented.")}}class Lf extends Zb{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","stores","message","in_memory"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.messages=e??[]}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async clear(){this.messages=[]}}const Oz=Object.freeze(Object.defineProperty({__proto__:null,BaseChatMessageHistory:XE,BaseListChatMessageHistory:Zb,InMemoryChatMessageHistory:Lf},Symbol.toStringTag,{value:"Module"}));class Yb extends xe{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","documents","transformers"]})}invoke(e,r){return this.transformDocuments(e)}}class eT extends Yb{async transformDocuments(e){const r=[];for(const n of e){const i=await this._transformDocument(n);r.push(i)}return r}}const Sz=Object.freeze(Object.defineProperty({__proto__:null,BaseDocumentTransformer:Yb,Document:Lt,MappingDocumentTransformer:eT},Symbol.toStringTag,{value:"Module"}));class Gl{}const tT=(t,e)=>{if(e!==void 0)return t[e];const r=Object.keys(t);if(r.length===1)return t[r[0]]},Zl=(t,e)=>{const r=tT(t,e);if(!r){const n=Object.keys(t);throw new Error(`input values have ${n.length} keys, you must specify an input key or pass only 1 key as input`)}return r},Df=(t,e)=>{const r=tT(t,e);if(!r){const n=Object.keys(t);throw new Error(`output values have ${n.length} keys, you must specify an output key or pass only 1 key as output`)}return r};function Mg(t,e){const r=Object.keys(t).filter(n=>!e.includes(n)&&n!=="stop");if(r.length!==1)throw new Error(`One input key expected, but got ${r.length}`);return r[0]}const xz=Object.freeze(Object.defineProperty({__proto__:null,BaseMemory:Gl,getInputValue:Zl,getOutputValue:Df,getPromptInputKey:Mg},Symbol.toStringTag,{value:"Module"}));class bs extends xe{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e==null?void 0:e.callbacks,this.tags=(e==null?void 0:e.tags)??[],this.metadata=(e==null?void 0:e.metadata)??{},this.verbose=(e==null?void 0:e.verbose)??!1}_getRelevantDocuments(e,r){throw new Error("Not implemented!")}async invoke(e,r){return this.getRelevantDocuments(e,Pe(r))}async getRelevantDocuments(e,r){const n=Pe(Oo(r)),i=await et.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),s=await(i==null?void 0:i.handleRetrieverStart(this.toJSON(),e,n.runId,void 0,void 0,void 0,n.runName));try{const a=await this._getRelevantDocuments(e,s);return await(s==null?void 0:s.handleRetrieverEnd(a)),a}catch(a){throw await(s==null?void 0:s.handleRetrieverError(a)),a}}}const Ez=Object.freeze(Object.defineProperty({__proto__:null,BaseRetriever:bs},Symbol.toStringTag,{value:"Module"}));class Qb extends St{}class rT extends Qb{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","storage"]}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:{}})}async mget(e){return e.map(r=>this.store[r])}async mset(e){for(const[r,n]of e)this.store[r]=n}async mdelete(e){for(const r of e)delete this.store[r]}async*yieldKeys(e){const r=Object.keys(this.store);for(const n of r)(e===void 0||n.startsWith(e))&&(yield n)}}const Tz=Object.freeze(Object.defineProperty({__proto__:null,BaseStore:Qb,InMemoryStore:rT},Symbol.toStringTag,{value:"Module"}));class nT extends sn{constructor({exampleId:e}={}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"run_collector"}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracedRuns",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.exampleId=e,this.tracedRuns=[]}async persistRun(e){const r={...e};r.reference_example_id=this.exampleId,this.tracedRuns.push(r)}}const Az=Object.freeze(Object.defineProperty({__proto__:null,RunCollectorCallbackHandler:nT},Symbol.toStringTag,{value:"Module"})),kz=Object.freeze(Object.defineProperty({__proto__:null,Validator:bE,deepCompareStrict:$s},Symbol.toStringTag,{value:"Module"}));function Iz(t,e){let r=0;for(let n=0;n<t.length;n++)r+=(t[n]-e[n])*(t[n]-e[n]);return r}function iT(t,e){return Math.sqrt(Iz(t,e))}function Cz(t,e){let r=0,n=0;for(let i=0;i<t.length;i++)n=Math.abs(t[i]-e[i]),r<n&&(r=n);return r}function Rz(t,e){let r=0;for(let n=0;n<t.length;n++)r+=t[n]*e[n];return r}function jz(t,e){let r=0;for(let n=0;n<t.length;n++)r+=Math.abs(t[n]-e[n]);return r}function Xb(t,e){let r=0,n=0,i=0;for(let s=0;s<t.length;s++)r+=t[s]*e[s],n+=t[s]*t[s],i+=e[s]*e[s];return r/(Math.sqrt(n)*Math.sqrt(i))}function Yl(t,e,r){if(t.length===0||t[0].length===0||e.length===0||e[0].length===0)return[[]];if(t[0].length!==e[0].length)throw new Error(`Number of columns in X and Y must be the same. X has shape ${[t.length,t[0].length]} and Y has shape ${[e.length,e[0].length]}.`);return t.map(n=>e.map(i=>r(n,i)).map(i=>Number.isNaN(i)?0:i))}function sT(t,e=!1){const r=Nz(t);return t.map(n=>n.map(i=>e?1-i/r:i/r))}function fo(t,e){return Yl(t,e,Xb)}function ew(t,e){return Yl(t,e,Rz)}function tw(t,e){return Yl(t,e,iT)}function aT(t,e,r=.5,n=4){if(Math.min(n,e.length)<=0)return[];const i=Array.isArray(t[0])?t:[t],s=fo(i,e)[0],a=oT(s).maxIndex,o=[e[a]],u=[a];for(;u.length<Math.min(n,e.length);){let l=-1/0,c=-1;const h=fo(e,o);s.forEach((d,f)=>{if(u.includes(f))return;const p=Math.max(...h[f]),y=r*d-(1-r)*p;y>l&&(l=y,c=f)}),o.push(e[c]),u.push(c)}return u}function oT(t){if(t.length===0)return{maxIndex:-1,maxValue:NaN};let e=t[0],r=0;for(let n=1;n<t.length;n+=1)t[n]>e&&(r=n,e=t[n]);return{maxIndex:r,maxValue:e}}function Nz(t){return t.reduce((e,r)=>Math.max(e,oT(r).maxValue),0)}const $z=Object.freeze(Object.defineProperty({__proto__:null,cosineSimilarity:fo,euclideanDistance:tw,innerProduct:ew,matrixFunc:Yl,maximalMarginalRelevance:aT,normalize:sT},Symbol.toStringTag,{value:"Module"}));class uT extends It{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["tests","fake"]})}getFormatInstructions(){return""}async parse(e){return e.split(",").map(r=>r.trim())}}class lT extends xe{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["tests","fake"]}),Object.defineProperty(this,"returnOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.returnOptions=e.returnOptions}async invoke(e,r){return this.returnOptions?r??{}:{input:e}}}class cT extends $f{constructor(e){super(e),Object.defineProperty(this,"response",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"thrownErrorString",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.response=e.response,this.thrownErrorString=e.thrownErrorString}_llmType(){return"fake"}async _call(e,r,n){if(this.thrownErrorString)throw new Error(this.thrownErrorString);const i=this.response??e;return await(n==null?void 0:n.handleLLMNewToken(i)),i}}class hT extends $f{constructor(e){super(e),Object.defineProperty(this,"sleep",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"responses",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"thrownErrorString",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.sleep=e.sleep??this.sleep,this.responses=e.responses,this.thrownErrorString=e.thrownErrorString}_llmType(){return"fake"}async _call(e){var n,i;if(this.thrownErrorString)throw new Error(this.thrownErrorString);const r=(n=this.responses)==null?void 0:n[0];return this.responses=(i=this.responses)==null?void 0:i.slice(1),r??e}async*_streamResponseChunks(e,r,n){var s,a;if(this.thrownErrorString)throw new Error(this.thrownErrorString);const i=(s=this.responses)==null?void 0:s[0];this.responses=(a=this.responses)==null?void 0:a.slice(1);for(const o of i??e)await new Promise(u=>setTimeout(u,this.sleep)),yield{text:o,generationInfo:{}},await(n==null?void 0:n.handleLLMNewToken(o))}}class dT extends pr{_combineLLMOutput(){return[]}_llmType(){return"fake"}async _generate(e,r,n){var s;if((s=r==null?void 0:r.stop)!=null&&s.length)return{generations:[{message:new Fe(r.stop[0]),text:r.stop[0]}]};const i=e.map(a=>a.content).join(`
`);return await(n==null?void 0:n.handleLLMNewToken(i)),{generations:[{message:new Fe(i),text:i}],llmOutput:{}}}}class fT extends pr{constructor(e){super(e),Object.defineProperty(this,"sleep",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"responses",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"thrownErrorString",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.sleep=e.sleep??this.sleep,this.responses=e.responses,this.thrownErrorString=e.thrownErrorString}_llmType(){return"fake"}async _generate(e,r,n){var a;if(this.thrownErrorString)throw new Error(this.thrownErrorString);const i=((a=this.responses)==null?void 0:a[0].content)??e[0].content;return{generations:[{text:"",message:new Fe({content:i})}]}}async*_streamResponseChunks(e,r,n){var s;if(this.thrownErrorString)throw new Error(this.thrownErrorString);const i=((s=this.responses)==null?void 0:s[0].content)??e[0].content;if(typeof i!="string")for(const a of this.responses??e)yield new nn({text:"",message:new Or({content:i})});else for(const a of this.responses??e)yield new nn({text:i,message:new Or({content:i})})}}class pT extends bs{constructor(e){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["test","fake"]}),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:[new Lt({pageContent:"foo"}),new Lt({pageContent:"bar"})]}),this.output=(e==null?void 0:e.output)??this.output}async _getRelevantDocuments(e){return this.output}}class mT extends pr{static lc_name(){return"FakeListChatModel"}constructor({responses:e,sleep:r}){super({}),Object.defineProperty(this,"responses",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"i",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sleep",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.responses=e,this.sleep=r}_combineLLMOutput(){return[]}_llmType(){return"fake-list"}async _generate(e,r){var n;if(await this._sleepIfRequested(),(n=r==null?void 0:r.stop)!=null&&n.length)return{generations:[this._formatGeneration(r.stop[0])]};{const i=this._currentResponse();return this._incrementResponse(),{generations:[this._formatGeneration(i)],llmOutput:{}}}}_formatGeneration(e){return{message:new Fe(e),text:e}}async*_streamResponseChunks(e,r,n){const i=this._currentResponse();this._incrementResponse();for await(const s of i)await this._sleepIfRequested(),yield this._createResponseChunk(s),n==null||n.handleLLMNewToken(s)}async _sleepIfRequested(){this.sleep!==void 0&&await this._sleep()}async _sleep(){return new Promise(e=>{setTimeout(()=>e(),this.sleep)})}_createResponseChunk(e){return new nn({message:new Or({content:e}),text:e})}_currentResponse(){return this.responses[this.i]}_incrementResponse(){this.i<this.responses.length-1?this.i+=1:this.i=0}withStructuredOutput(e,r){return xi.from(async n=>{const i=await this.invoke(n);return JSON.parse(i.content)})}}class gT extends XE{constructor(){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","message","fake"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]})}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async addUserMessage(e){this.messages.push(new ut(e))}async addAIChatMessage(e){this.messages.push(new Fe(e))}async clear(){this.messages=[]}}class yT extends Zb{constructor(){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","message","fake"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]})}async addMessage(e){this.messages.push(e)}async getMessages(){return this.messages}}class bT extends sn{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"fake_tracer"}),Object.defineProperty(this,"runs",{enumerable:!0,configurable:!0,writable:!0,value:[]})}persistRun(e){return this.runs.push(e),Promise.resolve()}}class wT extends ys{constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}async _call(e,r){return JSON.stringify(e)}}class vT extends Jl{constructor(e){super(e??{})}embedDocuments(e){return Promise.resolve(e.map(()=>[.1,.2,.3,.4]))}embedQuery(e){return Promise.resolve([.1,.2,.3,.4])}}class _T extends Jl{constructor(e){super(e??{}),Object.defineProperty(this,"vectorSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorSize=(e==null?void 0:e.vectorSize)??4}async embedDocuments(e){return Promise.all(e.map(r=>this.embedQuery(r)))}async embedQuery(e){let r=e;r=r.toLowerCase().replaceAll(/[^a-z ]/g,"");const n=r.length%this.vectorSize,i=n===0?0:this.vectorSize-n,s=r.length+i;r=r.padEnd(s," ");const a=r.length/this.vectorSize,o=[];for(let l=0;l<r.length;l+=a)o.push(r.slice(l,l+a));return o.map(l=>{let c=0;for(let d=0;d<l.length;d+=1)c+=l===" "?0:l.charCodeAt(d);return c%26/26})}}let PT=class extends sn{constructor(){super(),Object.defineProperty(this,"runPromiseResolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"single_run_extractor"}),this.runPromise=new Promise(e=>{this.runPromiseResolver=e})}async persistRun(e){this.runPromiseResolver(e)}async extract(){return this.runPromise}};const Lz=Object.freeze(Object.defineProperty({__proto__:null,FakeChatMessageHistory:gT,FakeChatModel:dT,FakeEmbeddings:vT,FakeLLM:cT,FakeListChatMessageHistory:yT,FakeListChatModel:mT,FakeRetriever:pT,FakeRunnable:lT,FakeSplitIntoListParser:uT,FakeStreamingChatModel:fT,FakeStreamingLLM:hT,FakeTool:wT,FakeTracer:bT,SingleRunExtractor:PT,SyntheticEmbeddings:_T},Symbol.toStringTag,{value:"Module"}));function Dz(t){return typeof(t==null?void 0:t.parse)=="function"}const Mz=Object.freeze(Object.defineProperty({__proto__:null,isZodSchema:Dz},Symbol.toStringTag,{value:"Module"}));class Ls extends bs{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain_core","vectorstores"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,e.searchType==="mmr"&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,r){if(this.searchType==="mmr"){if(typeof this.vectorStore.maxMarginalRelevanceSearch!="function")throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},r==null?void 0:r.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,r==null?void 0:r.getChild("vectorstore"))}async addDocuments(e,r){return this.vectorStore.addDocuments(e,r)}}class rw extends St{constructor(e,r){super(r),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,r=4,n=void 0,i=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),r,n)).map(a=>a[0])}async similaritySearchWithScore(e,r=4,n=void 0,i=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),r,n)}static fromTexts(e,r,n,i){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,r,n){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,r,n,i,s,a){if(typeof e=="number")return new Ls({vectorStore:this,k:e,filter:r,tags:[...i??[],this._vectorstoreType()],metadata:s,verbose:a,callbacks:n});{const o={vectorStore:this,k:e==null?void 0:e.k,filter:e==null?void 0:e.filter,tags:[...(e==null?void 0:e.tags)??[],this._vectorstoreType()],metadata:e==null?void 0:e.metadata,verbose:e==null?void 0:e.verbose,callbacks:e==null?void 0:e.callbacks,searchType:e==null?void 0:e.searchType};return(e==null?void 0:e.searchType)==="mmr"?new Ls({...o,searchKwargs:e.searchKwargs}):new Ls({...o})}}}class Fz extends rw{static load(e,r){throw new Error("Not implemented")}}const zz=Object.freeze(Object.defineProperty({__proto__:null,SaveableVectorStore:Fz,VectorStore:rw,VectorStoreRetriever:Ls},Symbol.toStringTag,{value:"Module"})),Uz=Object.freeze(Object.defineProperty({__proto__:null,agents:Pz,caches:LL,callbacks__base:P$,callbacks__manager:kL,callbacks__promises:EL,chat_history:Oz,documents:Sz,embeddings:yz,example_selectors:F2,language_models__base:cM,language_models__chat_models:rz,language_models__llms:fz,load__serializable:w$,memory:xz,messages:_L,output_parsers:N2,outputs:mD,prompt_values:DL,prompts:VM,retrievers:Ez,runnables:_M,stores:Tz,tools:hM,tracers__base:E$,tracers__console:T$,tracers__initialize:SL,tracers__log_stream:pD,tracers__run_collector:Az,tracers__tracer_langchain:gL,tracers__tracer_langchain_v1:PL,utils__async_caller:zL,utils__chunk_array:pz,utils__env:v$,utils__function_calling:bF,utils__hash:RL,utils__json_patch:k2,utils__json_schema:kz,utils__math:$z,utils__stream:dD,utils__testing:Lz,utils__tiktoken:nD,utils__types:Mz,vectorstores:zz},Symbol.toStringTag,{value:"Module"}));function qz(t){const e={};for(let r=t;r&&r.prototype;r=Object.getPrototypeOf(r))Object.assign(e,Reflect.get(r.prototype,"lc_aliases"));return Object.entries(e).reduce((r,[n,i])=>(r[i]=n,r),{})}async function oh(t){const{optionalImportsMap:e={},optionalImportEntrypoints:r=[],importMap:n={},secretsMap:i={},path:s=["$"]}=this,a=s.join(".");if(typeof t=="object"&&t!==null&&!Array.isArray(t)&&"lc"in t&&"type"in t&&"id"in t&&t.lc===1&&t.type==="secret"){const o=t,[u]=o.id;if(u in i)return i[u];{const l=he(u);if(l)return l;throw new Error(`Missing key "${u}" for ${a} in load(secretsMap={})`)}}else if(typeof t=="object"&&t!==null&&!Array.isArray(t)&&"lc"in t&&"type"in t&&"id"in t&&t.lc===1&&t.type==="not_implemented"){const u=JSON.stringify(t);throw new Error(`Trying to load an object that doesn't implement serialization: ${a} -> ${u}`)}else if(typeof t=="object"&&t!==null&&!Array.isArray(t)&&"lc"in t&&"type"in t&&"id"in t&&"kwargs"in t&&t.lc===1){const o=t,u=JSON.stringify(o),[l,...c]=o.id.slice().reverse(),h=c.reverse(),d={langchain_core:Uz,langchain:n};let f=null;const p=[h.join("/")];h[0]==="langchain_community"&&p.push(["langchain",...h.slice(1)].join("/"));const y=p.find(m=>m in e);if(_z.concat(r).includes(h.join("/"))||y)if(y!==void 0)f=await e[y];else throw new Error(`Missing key "${h.join("/")}" for ${a} in load(optionalImportsMap={})`);else{let m;if(h[0]==="langchain"||h[0]==="langchain_core")m=d[h[0]],h.shift();else throw new Error(`Invalid namespace: ${a} -> ${u}`);if(h.length===0)throw new Error(`Invalid namespace: ${a} -> ${u}`);let b;do{if(b=h.join("__"),b in m)break;h.pop()}while(h.length>0);b in m&&(f=m[b])}if(typeof f!="object"||f===null)throw new Error(`Invalid namespace: ${a} -> ${u}`);const v=f[l]??Object.values(f).find(m=>typeof m=="function"&&lf(m)===l);if(typeof v!="function")throw new Error(`Invalid identifer: ${a} -> ${u}`);const g=await oh.call({...this,path:[...s,"kwargs"]},o.kwargs);if(o.type==="constructor"){const m=new v(ux(g,y$,qz(v)));return Object.defineProperty(m.constructor,"name",{value:l}),m}else throw new Error(`Invalid type: ${a} -> ${u}`)}else if(typeof t=="object"&&t!==null)return Array.isArray(t)?Promise.all(t.map((o,u)=>oh.call({...this,path:[...s,`${u}`]},o))):Object.fromEntries(await Promise.all(Object.entries(t).map(async([o,u])=>[o,await oh.call({...this,path:[...s,o]},u)])));return t}async function Kz(t,e){const r=JSON.parse(t);return oh.call({...e},r)}const Vz=["langchain/agents/load","langchain/agents/toolkits/sql","langchain/tools/sql","langchain/tools/webbrowser","langchain/chains/load","langchain/chains/query_constructor","langchain/chains/query_constructor/ir","langchain/chains/sql_db","langchain/chains/graph_qa/cypher","langchain/document_loaders/web/apify_dataset","langchain/document_loaders/web/assemblyai","langchain/document_loaders/web/azure_blob_storage_container","langchain/document_loaders/web/azure_blob_storage_file","langchain/document_loaders/web/browserbase","langchain/document_loaders/web/cheerio","langchain/document_loaders/web/puppeteer","langchain/document_loaders/web/playwright","langchain/document_loaders/web/college_confidential","langchain/document_loaders/web/gitbook","langchain/document_loaders/web/hn","langchain/document_loaders/web/imsdb","langchain/document_loaders/web/figma","langchain/document_loaders/web/firecrawl","langchain/document_loaders/web/github","langchain/document_loaders/web/notiondb","langchain/document_loaders/web/notionapi","langchain/document_loaders/web/pdf","langchain/document_loaders/web/recursive_url","langchain/document_loaders/web/s3","langchain/document_loaders/web/sitemap","langchain/document_loaders/web/sonix_audio","langchain/document_loaders/web/confluence","langchain/document_loaders/web/couchbase","langchain/document_loaders/web/youtube","langchain/document_loaders/fs/directory","langchain/document_loaders/fs/buffer","langchain/document_loaders/fs/chatgpt","langchain/document_loaders/fs/text","langchain/document_loaders/fs/json","langchain/document_loaders/fs/srt","langchain/document_loaders/fs/pdf","langchain/document_loaders/fs/docx","langchain/document_loaders/fs/epub","langchain/document_loaders/fs/csv","langchain/document_loaders/fs/notion","langchain/document_loaders/fs/obsidian","langchain/document_loaders/fs/unstructured","langchain/document_loaders/fs/openai_whisper_audio","langchain/document_loaders/fs/pptx","langchain/sql_db","langchain/output_parsers/expression","langchain/retrievers/self_query","langchain/retrievers/self_query/functional","langchain/cache/file_system","langchain/stores/file/node","langchain/storage/file_system","langchain/hub","langchain/experimental/prompts/handlebars","langchain/experimental/tools/pyinterpreter"];class Bz extends Error{constructor(e,r){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=r}}class OT extends St{get returnValues(){return["output"]}get allowedTools(){}_agentType(){throw new Error("Not implemented")}returnStoppedResponse(e,r,n,i){if(e==="force")return Promise.resolve({returnValues:{output:"Agent stopped due to max iterations."},log:""});throw new Error(`Invalid stopping method: ${e}`)}async prepareForOutput(e,r){return{}}}class Ql extends OT{_agentActionType(){return"single"}}class ST extends OT{_agentActionType(){return"multi"}}function Hz(t){return!Array.isArray(t)&&(t==null?void 0:t.tool)!==void 0}function Wz(t){return t.runnable!==void 0}class ca extends Bt{constructor(){super(...arguments),Object.defineProperty(this,"streamRunnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"singleAction",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}static fromRunnables([e,...r],n){const i=Bt.from([e,...r],n.name);return i.singleAction=n.singleAction,i.streamRunnable=n.streamRunnable,i}static isAgentRunnableSequence(e){return typeof e.singleAction=="boolean"}}class Jz extends Ql{get inputKeys(){return[]}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","runnable"]}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamRunnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"defaultRunName",{enumerable:!0,configurable:!0,writable:!0,value:"RunnableAgent"}),this.runnable=e.runnable,this.defaultRunName=e.defaultRunName??this.runnable.name??this.defaultRunName,this.streamRunnable=e.streamRunnable??this.streamRunnable}async plan(e,r,n,i){const s={...r,steps:e},a=Ke(i,{callbacks:n,runName:this.defaultRunName});if(this.streamRunnable){const o=await this.runnable.stream(s,a);let u;for await(const l of o)if(u===void 0)u=l;else throw new Error(["Multiple agent actions/finishes received in streamed agent output.",'Set "streamRunnable: false" when initializing the agent to invoke this agent in non-streaming mode.'].join(`
`));if(u===void 0)throw new Error(["No streaming output received from underlying runnable.",'Set "streamRunnable: false" when initializing the agent to invoke this agent in non-streaming mode.'].join(`
`));return u}else return this.runnable.invoke(s,a)}}class Fg extends ST{get inputKeys(){return[]}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","runnable"]}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultRunName",{enumerable:!0,configurable:!0,writable:!0,value:"RunnableAgent"}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamRunnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.runnable=e.runnable,this.stop=e.stop,this.defaultRunName=e.defaultRunName??this.runnable.name??this.defaultRunName,this.streamRunnable=e.streamRunnable??this.streamRunnable}async plan(e,r,n,i){const s={...r,steps:e},a=Ke(i,{callbacks:n,runName:this.defaultRunName});let o;if(this.streamRunnable){const u=await this.runnable.stream(s,a);let l;for await(const c of u)if(l===void 0)l=c;else throw new Error(["Multiple agent actions/finishes received in streamed agent output.",'Set "streamRunnable: false" when initializing the agent to invoke this agent in non-streaming mode.'].join(`
`));if(l===void 0)throw new Error(["No streaming output received from underlying runnable.",'Set "streamRunnable: false" when initializing the agent to invoke this agent in non-streaming mode.'].join(`
`));o=l}else o=await this.runnable.invoke(s,a);return Hz(o)?[o]:o}}class Gz extends Fg{}class Zz extends Ql{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents"]}),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.stop=e.stop,this.llmChain=e.llmChain,this.outputParser=e.outputParser}get inputKeys(){return this.llmChain.inputKeys}async plan(e,r,n){const i=await this.llmChain.call({intermediate_steps:e,stop:this.stop,...r},n);return this.outputParser.parse(i[this.llmChain.outputKey],n)}}class Lo extends Ql{get allowedTools(){return this._allowedTools}get inputKeys(){return this.llmChain.inputKeys.filter(e=>e!=="agent_scratchpad")}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_allowedTools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain,this._allowedTools=e.allowedTools,this.outputParser=e.outputParser}static getDefaultOutputParser(e){throw new Error("Not implemented")}static createPrompt(e,r){throw new Error("Not implemented")}static fromLLMAndTools(e,r,n){throw new Error("Not implemented")}static validateTools(e){}_stop(){return[`
${this.observationPrefix()}`]}finishToolName(){return"Final Answer"}async constructScratchPad(e){return e.reduce((r,{action:n,observation:i})=>r+[n.log,`${this.observationPrefix()}${i}`,this.llmPrefix()].join(`
`),"")}async _plan(e,r,n,i){const s=await this.constructScratchPad(e),a={...r,agent_scratchpad:n?`${s}${n}`:s};this._stop().length!==0&&(a.stop=this._stop());const o=await this.llmChain.predict(a,i);if(!this.outputParser)throw new Error("Output parser not set");return this.outputParser.parse(o,i)}plan(e,r,n){return this._plan(e,r,void 0,n)}async returnStoppedResponse(e,r,n,i){if(e==="force")return{returnValues:{output:"Agent stopped due to max iterations."},log:""};if(e==="generate")try{const s=await this._plan(r,n,`

I now need to return a final answer based on the previous steps:`,i);return"returnValues"in s?s:{returnValues:{output:s.log},log:s.log}}catch(s){if(!(s instanceof Bz))throw s;return{returnValues:{output:s.output},log:s.output}}throw new Error(`Invalid stopping method: ${e}`)}static async deserialize(e){switch(e._type){case"zero-shot-react-description":{const{ZeroShotAgent:r}=await Hr(()=>Promise.resolve().then(()=>rU),void 0);return r.deserialize(e)}default:throw new Error("Unknown agent type")}}}const Yz=`You are an agent designed to interact with JSON.
Your goal is to return a final answer by interacting with the JSON.
You have access to the following tools which help you learn more about the JSON you are interacting with.
Only use the below tools. Only use the information returned by the below tools to construct your final answer.
Do not make up any information that is not contained in the JSON.
Your input to the tools should be in the form of in json pointer syntax (e.g. /key1/0/key2).
You must escape a slash in a key with a ~1, and escape a tilde with a ~0.
For example, to access the key /foo, you would use /~1foo
You should only use keys that you know for a fact exist. You must validate that a key exists by seeing it previously when calling 'json_list_keys'.
If you have not seen a key in one of those responses, you cannot use it.
You should only add one key at a time to the path. You cannot add multiple keys at once.
If you encounter a null or undefined value, go back to the previous key, look at the available keys, and try again.

If the question does not seem to be related to the JSON, just return "I don't know" as the answer.
Always begin your interaction with the 'json_list_keys' with an empty string as the input to see what keys exist in the JSON.

Note that sometimes the value at a given path is large. In this case, you will get an error "Value is a large dictionary, should explore its keys directly".
In this case, you should ALWAYS follow up by using the 'json_list_keys' tool to see what keys exist at that path.
Do not simply refer the user to the JSON or a section of the JSON, as this is not a valid answer. Keep digging until you find the answer and explicitly return it.`,Qz=`Begin!"

Question: {input}
Thought: I should look at the keys that exist to see what I can query. I should use the 'json_list_keys' tool with an empty string as the input.
{agent_scratchpad}`,Xz=async(t,e,r,n,i)=>{if(r.load_from_llm_and_tools){if(!t)throw new Error("Loading from llm and tools, llm must be provided.");if(!e)throw new Error("Loading from llm and tools, tools must be provided.");return n(t,e,r)}if(!r.llm_chain)throw new Error("Loading from constructor, llm_chain must be provided.");const s=await Q.deserialize(r.llm_chain);return i({...r,llmChain:s})};class ei extends It{}class xT extends It{}const eU="Answer the following questions as best you can. You have access to the following tools:",ET=`Use the following format in your response:

Question: the input question you must answer
Thought: you should always think about what to do
Action: the action to take, should be one of [{tool_names}]
Action Input: the input to the action
Observation: the result of the action
... (this Thought/Action/Action Input/Observation can repeat N times)
Thought: I now know the final answer
Final Answer: the final answer to the original input question`,nw=`Begin!

Question: {input}
Thought:{agent_scratchpad}`,tU="Final Answer:";class TT extends ei{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","mrkl"]}),Object.defineProperty(this,"finishToolName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.finishToolName=(e==null?void 0:e.finishToolName)||tU}async parse(e){if(e.includes(this.finishToolName)){const n=e.split(this.finishToolName);return{returnValues:{output:n[n.length-1].trim()},log:e}}const r=/Action:([\s\S]*?)(?:\nAction Input:([\s\S]*?))?$/.exec(e);if(!r)throw new je(`Could not parse LLM output: ${e}`);return{tool:r[1].trim(),toolInput:r[2]?r[2].trim().replace(/^("+)(.*?)(\1)$/,"$2"):"",log:e}}getFormatInstructions(){return ET}}class dt extends Lo{static lc_name(){return"ZeroShotAgent"}constructor(e){const r=(e==null?void 0:e.outputParser)??dt.getDefaultOutputParser();super({...e,outputParser:r}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","mrkl"]})}_agentType(){return"zero-shot-react-description"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}static getDefaultOutputParser(e){return new TT(e)}static validateTools(e){const r=e.find(n=>!n.description);if(r){const n=`Got a tool ${r.name} without a description. This agent requires descriptions for all tools.`;throw new Error(n)}}static createPrompt(e,r){const{prefix:n=eU,suffix:i=nw,inputVariables:s=["input","agent_scratchpad"]}=r??{},a=e.map(c=>`${c.name}: ${c.description}`).join(`
`),o=e.map(c=>c.name),u=Tt(ET,"f-string",{tool_names:o}),l=[n,a,u,i].join(`

`);return new W({template:l,inputVariables:s})}static fromLLMAndTools(e,r,n){dt.validateTools(r);const i=dt.createPrompt(r,n),s=(n==null?void 0:n.outputParser)??dt.getDefaultOutputParser(),a=new Q({prompt:i,llm:e,callbacks:(n==null?void 0:n.callbacks)??(n==null?void 0:n.callbackManager)});return new dt({llmChain:a,allowedTools:r.map(o=>o.name),outputParser:s})}static async deserialize(e){const{llm:r,tools:n,...i}=e;return Xz(r,n,i,(s,a,o)=>dt.fromLLMAndTools(s,a,{prefix:o.prefix,suffix:o.suffix,inputVariables:o.input_variables}),s=>new dt(s))}}const rU=Object.freeze(Object.defineProperty({__proto__:null,ZeroShotAgent:dt},Symbol.toStringTag,{value:"Module"}));class nU extends St{get finalOutputs(){return this._finalOutputs}async setFinalOutputs(e){if(this._finalOutputs=void 0,e){const r=await this.agentExecutor.prepOutputs(this.inputs,e,!0);this._finalOutputs=r}}get nameToToolMap(){const e=this.agentExecutor.tools.map(r=>({[r.name]:r}));return Object.assign({},...e)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","executor_iterator"]}),Object.defineProperty(this,"agentExecutor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_finalOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"intermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"iterations",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.agentExecutor=e.agentExecutor,this.inputs=e.inputs,this.callbacks=e.callbacks,this.tags=e.tags,this.metadata=e.metadata,this.runName=e.runName,this.runManager=e.runManager,this.config=e.config}reset(){this.intermediateSteps=[],this.iterations=0,this._finalOutputs=void 0}updateIterations(){this.iterations+=1}async*streamIterator(){for(this.reset();;)try{this.iterations===0&&await this.onFirstStep(),yield await this._callNext()}catch(e){if("message"in e&&e.message.startsWith("Final outputs already reached: ")){if(!this.finalOutputs)throw e;return this.finalOutputs}throw this.runManager&&await this.runManager.handleChainError(e),e}}async onFirstStep(){var e,r,n,i,s,a,o;if(this.iterations===0){const u=await et.configure(this.callbacks??((e=this.config)==null?void 0:e.callbacks),this.agentExecutor.callbacks,this.tags??((r=this.config)==null?void 0:r.tags),this.agentExecutor.tags,this.metadata??((n=this.config)==null?void 0:n.metadata),this.agentExecutor.metadata,{verbose:this.agentExecutor.verbose});this.runManager=await(u==null?void 0:u.handleChainStart(this.agentExecutor.toJSON(),this.inputs,(i=this.config)==null?void 0:i.runId,void 0,this.tags??((s=this.config)==null?void 0:s.tags),this.metadata??((a=this.config)==null?void 0:a.metadata),this.runName??((o=this.config)==null?void 0:o.runName))),this.config!==void 0&&delete this.config.runId}}async _executeNextStep(e){return this.agentExecutor._takeNextStep(this.nameToToolMap,this.inputs,this.intermediateSteps,e,this.config)}async _processNextStepOutput(e,r){var i;if("returnValues"in e){const s=await this.agentExecutor._return(e,this.intermediateSteps,r);return this.runManager&&await this.runManager.handleChainEnd(s),await this.setFinalOutputs(s),s}this.intermediateSteps=this.intermediateSteps.concat(e);let n={};if(Array.isArray(e)&&e.length===1){const s=e[0],a=await this.agentExecutor._getToolReturn(s);a&&(n=await this.agentExecutor._return(a,this.intermediateSteps,r),await((i=this.runManager)==null?void 0:i.handleChainEnd(n)),await this.setFinalOutputs(n))}return n={intermediateSteps:e},n}async _stop(){var n;const e=await this.agentExecutor.agent.returnStoppedResponse(this.agentExecutor.earlyStoppingMethod,this.intermediateSteps,this.inputs),r=await this.agentExecutor._return(e,this.intermediateSteps,this.runManager);return await this.setFinalOutputs(r),await((n=this.runManager)==null?void 0:n.handleChainEnd(r)),r}async _callNext(){if(this.finalOutputs)throw new Error(`Final outputs already reached: ${JSON.stringify(this.finalOutputs,null,2)}`);if(!this.agentExecutor.shouldContinueGetter(this.iterations))return this._stop();const e=await this._executeNextStep(this.runManager),r=await this._processNextStepOutput(e,this.runManager);return this.updateIterations(),r}}class Jp extends Ei{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"_Exception"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"Exception tool"})}async _call(e){return e}}class wt extends Ae{static lc_name(){return"AgentExecutor"}get lc_namespace(){return["langchain","agents","executor"]}get inputKeys(){return this.agent.inputKeys}get outputKeys(){return this.agent.returnValues}constructor(e){let r,n=!0;if(xe.isRunnable(e.agent)?(ca.isAgentRunnableSequence(e.agent)?e.agent.singleAction?r=new Jz({runnable:e.agent,streamRunnable:e.agent.streamRunnable}):r=new Fg({runnable:e.agent,streamRunnable:e.agent.streamRunnable}):r=new Fg({runnable:e.agent}),n=!1):(Wz(e.agent)&&(n=!1),r=e.agent),super(e),Object.defineProperty(this,"agent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:15}),Object.defineProperty(this,"earlyStoppingMethod",{enumerable:!0,configurable:!0,writable:!0,value:"force"}),Object.defineProperty(this,"returnOnlyOutputs",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"handleParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.agent=r,this.tools=e.tools,this.handleParsingErrors=e.handleParsingErrors??this.handleParsingErrors,this.returnOnlyOutputs=n,this.agent._agentActionType()==="multi"){for(const i of this.tools)if(i.returnDirect)throw new Error(`Tool with return direct ${i.name} not supported for multi-action agent.`)}this.returnIntermediateSteps=e.returnIntermediateSteps??this.returnIntermediateSteps,this.maxIterations=e.maxIterations??this.maxIterations,this.earlyStoppingMethod=e.earlyStoppingMethod??this.earlyStoppingMethod}static fromAgentAndTools(e){return new wt(e)}get shouldContinueGetter(){return this.shouldContinue.bind(this)}shouldContinue(e){return this.maxIterations===void 0||e<this.maxIterations}async _call(e,r,n){var l;const i=Object.fromEntries(this.tools.map(c=>[c.name.toLowerCase(),c])),s=[];let a=0;const o=async c=>{const{returnValues:h}=c,d=await this.agent.prepareForOutput(h,s);await(r==null?void 0:r.handleAgentEnd(c));let f;return this.returnIntermediateSteps?f={...h,intermediateSteps:s,...d}:f={...h,...d},this.returnOnlyOutputs||(f={...e,...f}),f};for(;this.shouldContinue(a);){let c;try{c=await this.agent.plan(s,e,r==null?void 0:r.getChild(),n)}catch(y){if(y instanceof je){let v,g=y.message;if(this.handleParsingErrors===!0)y.sendToLLM?(v=y.observation,g=y.llmOutput??""):v="Invalid or incomplete response";else if(typeof this.handleParsingErrors=="string")v=this.handleParsingErrors;else if(typeof this.handleParsingErrors=="function")v=this.handleParsingErrors(y);else throw y;c={tool:"_Exception",toolInput:v,log:g}}else throw y}if("returnValues"in c)return o(c);let h;Array.isArray(c)?h=c:h=[c];const d=await Promise.all(h.map(async y=>{var m;await(r==null?void 0:r.handleAgentAction(y));const v=y.tool==="_Exception"?new Jp:i[(m=y.tool)==null?void 0:m.toLowerCase()];let g;try{g=v?await v.invoke(y.toolInput,Ke(n,{callbacks:r==null?void 0:r.getChild()})):`${y.tool} is not a valid tool, try another one.`}catch(b){if(b instanceof Qh){if(this.handleParsingErrors===!0)g="Invalid or incomplete tool input. Please try again.";else if(typeof this.handleParsingErrors=="string")g=this.handleParsingErrors;else if(typeof this.handleParsingErrors=="function")g=this.handleParsingErrors(b);else throw b;return g=await new Jp().call(g,r==null?void 0:r.getChild()),{action:y,observation:g??""}}}return{action:y,observation:g??""}}));s.push(...d);const f=s[s.length-1],p=i[(l=f.action.tool)==null?void 0:l.toLowerCase()];if(p!=null&&p.returnDirect)return o({returnValues:{[this.agent.returnValues[0]]:f.observation},log:""});a+=1}const u=await this.agent.returnStoppedResponse(this.earlyStoppingMethod,s,e);return o(u)}async _takeNextStep(e,r,n,i,s){let a;try{a=await this.agent.plan(n,r,i==null?void 0:i.getChild(),s)}catch(l){if(l instanceof je){let c,h=l.message;if(this.handleParsingErrors===!0)l.sendToLLM?(c=l.observation,h=l.llmOutput??""):c="Invalid or incomplete response";else if(typeof this.handleParsingErrors=="string")c=this.handleParsingErrors;else if(typeof this.handleParsingErrors=="function")c=this.handleParsingErrors(l);else throw l;a={tool:"_Exception",toolInput:c,log:h}}else throw l}if("returnValues"in a)return a;let o;Array.isArray(a)?o=a:o=[a];const u=[];for(const l of o){let c="";if(i&&await(i==null?void 0:i.handleAgentAction(l)),l.tool in e){const h=e[l.tool];try{c=await h.call(l.toolInput,i==null?void 0:i.getChild())}catch(d){if(d instanceof Qh){if(this.handleParsingErrors===!0)c="Invalid or incomplete tool input. Please try again.";else if(typeof this.handleParsingErrors=="string")c=this.handleParsingErrors;else if(typeof this.handleParsingErrors=="function")c=this.handleParsingErrors(d);else throw d;c=await new Jp().call(c,i==null?void 0:i.getChild())}}}else c=`${l.tool} is not a valid tool, try another available tool: ${Object.keys(e).join(", ")}`;u.push({action:l,observation:c})}return u}async _return(e,r,n){n&&await n.handleAgentEnd(e);const i=e.returnValues;return this.returnIntermediateSteps&&(i.intermediateSteps=r),i}async _getToolReturn(e){const{action:r,observation:n}=e,i=Object.fromEntries(this.tools.map(a=>[a.name.toLowerCase(),a])),[s="output"]=this.agent.returnValues;return r.tool in i&&i[r.tool].returnDirect?{returnValues:{[s]:n},log:""}:null}_returnStoppedResponse(e){if(e==="force")return{returnValues:{output:"Agent stopped due to iteration limit or time limit."},log:""};throw new Error(`Got unsupported early_stopping_method: ${e}`)}async*_streamIterator(e,r){const i=new nU({inputs:e,agentExecutor:this,config:r,metadata:r==null?void 0:r.metadata,tags:r==null?void 0:r.tags,callbacks:r==null?void 0:r.callbacks}).streamIterator();for await(const s of i)s&&(yield s)}_chainType(){return"agent_executor"}serialize(){throw new Error("Cannot serialize an AgentExecutor")}}class iw extends xo{constructor(e){super(),Object.defineProperty(this,"jsonSpec",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tools=[new aE(e),new oE(e)]}}function sw(t,e,r){const{prefix:n=Yz,suffix:i=Qz,inputVariables:s=["input","agent_scratchpad"]}=r??{},{tools:a}=e,o=dt.createPrompt(a,{prefix:n,suffix:i,inputVariables:s}),u=new Q({prompt:o,llm:t}),l=new dt({llmChain:u,allowedTools:a.map(c=>c.name)});return wt.fromAgentAndTools({agent:l,tools:a,returnIntermediateSteps:!0})}const iU=`You are an agent designed to answer questions by making web requests to an API given the OpenAPI spec.

If the question does not seem related to the API, return I don't know. Do not make up an answer.
Only use information provided by the tools to construct your response.

To find information in the OpenAPI spec, use the 'json_explorer' tool. The input to this tool is a question about the API.

Take the following steps:
First, find the base URL needed to make the request.

Second, find the relevant paths needed to answer the question. Take note that, sometimes, you might need to make more than one request to more than one path to answer the question.

Third, find the required parameters needed to make the request. For GET requests, these are usually URL parameters and for POST requests, these are request body parameters.

Fourth, make the requests needed to answer the question. Ensure that you are sending the correct parameters to the request by checking which parameters are required. For parameters with a fixed set of values, please use the spec to look at which values are allowed.

Use the exact parameter names as listed in the spec, do not make up any names or abbreviate the names of parameters.
If you get a not found error, ensure that you are using a path that actually exists in the spec.`,sU=`Begin!"

Question: {input}
Thought: I should explore the spec to find the base url for the API.
{agent_scratchpad}`,aU=`
Can be used to answer questions about the openapi spec for the API. Always use this tool before trying to make a request. 
Example inputs to this tool: 
    'What are the required query parameters for a GET request to the /bar endpoint?'
    'What are the required parameters in the request body for a POST request to the /foo endpoint?'
Always give this tool a specific question.`;class aw extends xo{constructor(e){super(),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tools=[new uE(e),new lE(e)]}}class AT extends aw{constructor(e,r,n){super(n);const i=sw(r,new iw(e));this.tools=[...this.tools,new zl({name:"json_explorer",func:async s=>(await i.call({input:s})).output,description:aU})]}}function kT(t,e,r){const{prefix:n=iU,suffix:i=sU,inputVariables:s=["input","agent_scratchpad"]}=r??{},{tools:a}=e,o=dt.createPrompt(a,{prefix:n,suffix:i,inputVariables:s}),u=new Q({prompt:o,llm:t}),l=a.map(h=>h.name),c=new dt({llmChain:u,allowedTools:l});return wt.fromAgentAndTools({agent:c,tools:a,returnIntermediateSteps:!0})}const oU=`You are an agent designed to answer questions about sets of documents.
You have access to tools for interacting with the documents, and the inputs to the tools are questions.
Sometimes, you will be asked to provide sources for your questions, in which case you should use the appropriate tool to do so.
If the question does not seem relevant to any of the tools provided, just return "I don't know" as the answer.`,uU=`You are an agent designed to answer questions.
You have access to tools for interacting with different sources, and the inputs to the tools are questions.
Your main task is to decide which of the tools is relevant for answering question at hand.
For complex questions, you can break the question down into sub questions and use tools to answers the sub questions.`;class IT extends xo{constructor(e,r){super(),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const n=yl.getDescription(e.name,e.description);this.llm=r,this.tools=[new yl(e.name,n,{vectorStore:e.vectorStore,llm:this.llm})]}}class CT extends xo{constructor(e,r){super(),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"vectorStoreInfos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llm=r,this.vectorStoreInfos=e,this.tools=e.map(n=>{const i=yl.getDescription(n.name,n.description);return new yl(n.name,i,{vectorStore:n.vectorStore,llm:this.llm})})}}function RT(t,e,r){const{prefix:n=oU,suffix:i=nw,inputVariables:s=["input","agent_scratchpad"]}=r??{},{tools:a}=e,o=dt.createPrompt(a,{prefix:n,suffix:i,inputVariables:s}),u=new Q({prompt:o,llm:t}),l=new dt({llmChain:u,allowedTools:a.map(c=>c.name)});return wt.fromAgentAndTools({agent:l,tools:a,returnIntermediateSteps:!0})}function jT(t,e,r){const{prefix:n=uU,suffix:i=nw,inputVariables:s=["input","agent_scratchpad"]}=r??{},{tools:a}=e,o=dt.createPrompt(a,{prefix:n,suffix:i,inputVariables:s}),u=new Q({prompt:o,llm:t}),l=new dt({llmChain:u,allowedTools:a.map(c=>c.name)});return wt.fromAgentAndTools({agent:l,tools:a,returnIntermediateSteps:!0})}const Mf=t=>t.map(e=>e.pageContent).join(`

`),lU=Object.freeze(Object.defineProperty({__proto__:null,formatDocumentsAsString:Mf},Symbol.toStringTag,{value:"Module"}));function cU(t,e){const r=async({input:i},s)=>{const a=await t.getRelevantDocuments(i,s==null?void 0:s.getChild("retriever"));return Mf(a)},n=Ce.object({input:Ce.string().describe("Natural language query used as input to the retriever")});return new Sf({...e,func:r,schema:n})}const hU=`Progressively summarize the lines of conversation provided, adding onto the previous summary returning a new summary.

EXAMPLE
Current summary:
The human asks what the AI thinks of artificial intelligence. The AI thinks artificial intelligence is a force for good.

New lines of conversation:
Human: Why do you think artificial intelligence is a force for good?
AI: Because artificial intelligence will help humans reach their full potential.

New summary:
The human asks what the AI thinks of artificial intelligence. The AI thinks artificial intelligence is a force for good because it will help humans reach their full potential.
END OF EXAMPLE

Current summary:
{summary}

New lines of conversation:
{new_lines}

New summary:`,dU=new W({inputVariables:["summary","new_lines"],template:hU}),fU=`You are an assistant to a human, powered by a large language model trained by OpenAI.

You are designed to be able to assist with a wide range of tasks, from answering simple questions to providing in-depth explanations and discussions on a wide range of topics. As a language model, you are able to generate human-like text based on the input you receive, allowing you to engage in natural-sounding conversations and provide responses that are coherent and relevant to the topic at hand.

You are constantly learning and improving, and your capabilities are constantly evolving. You are able to process and understand large amounts of text, and can use this knowledge to provide accurate and informative responses to a wide range of questions. You have access to some personalized information provided by the human in the Context section below. Additionally, you are able to generate your own text based on the input you receive, allowing you to engage in discussions and provide explanations and descriptions on a wide range of topics.

Overall, you are a powerful tool that can help with a wide range of tasks and provide valuable insights and information on a wide range of topics. Whether the human needs help with a specific question or just wants to have a conversation about a particular topic, you are here to assist.

Context:
{entities}

Current conversation:
{history}
Last line:
Human: {input}
You:`,pU=new W({inputVariables:["entities","history","input"],template:fU}),mU=`You are an AI assistant reading the transcript of a conversation between an AI and a human. Extract all of the proper nouns from the last line of conversation. As a guideline, a proper noun is generally capitalized. You should definitely extract all names and places.

The conversation history is provided just in case of a coreference (e.g. "What do you know about him" where "him" is defined in a previous line) -- ignore items mentioned there that are not in the last line.

Return the output as a single comma-separated list, or NONE if there is nothing of note to return (e.g. the user is just issuing a greeting or having a simple conversation).

EXAMPLE
Conversation history:
Person #1: my name is Jacob. how's it going today?
AI: "It's going great! How about you?"
Person #1: good! busy working on Langchain. lots to do.
AI: "That sounds like a lot of work! What kind of things are you doing to make Langchain better?"
Last line:
Person #1: i'm trying to improve Langchain's interfaces, the UX, its integrations with various products the user might want ... a lot of stuff.
Output: Jacob,Langchain
END OF EXAMPLE

EXAMPLE
Conversation history:
Person #1: how's it going today?
AI: "It's going great! How about you?"
Person #1: good! busy working on Langchain. lots to do.
AI: "That sounds like a lot of work! What kind of things are you doing to make Langchain better?"
Last line:
Person #1: i'm trying to improve Langchain's interfaces, the UX, its integrations with various products the user might want ... a lot of stuff. I'm working with Person #2.
Output: Langchain, Person #2
END OF EXAMPLE

Conversation history (for reference only):
{history}
Last line of conversation (for extraction):
Human: {input}

Output:`,gU=new W({inputVariables:["history","input"],template:mU}),yU=`You are an AI assistant helping a human keep track of facts about relevant people, places, and concepts in their life. Update and add to the summary of the provided entity in the "Entity" section based on the last line of your conversation with the human. If you are writing the summary for the first time, return a single sentence.
The update should only include facts that are relayed in the last line of conversation about the provided entity, and should only contain facts about the provided entity.

If there is no new information about the provided entity or the information is not worth noting (not an important or relevant fact to remember long-term), output the exact string "UNCHANGED" below.

Full conversation history (for context):
{history}

Entity to summarize:
{entity}

Existing summary of {entity}:
{summary}

Last line of conversation:
Human: {input}
Updated summary (or the exact string "UNCHANGED" if there is no new information about {entity} above):`,bU=new W({inputVariables:["entity","summary","history","input"],template:yU}),wU=Object.freeze(Object.defineProperty({__proto__:null,ChatMessageHistory:Lf},Symbol.toStringTag,{value:"Module"}));class Ti extends Gl{constructor(e){super(),Object.defineProperty(this,"chatHistory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnMessages",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chatHistory=(e==null?void 0:e.chatHistory)??new Lf,this.returnMessages=(e==null?void 0:e.returnMessages)??this.returnMessages,this.inputKey=(e==null?void 0:e.inputKey)??this.inputKey,this.outputKey=(e==null?void 0:e.outputKey)??this.outputKey}async saveContext(e,r){await this.chatHistory.addUserMessage(Zl(e,this.inputKey)),await this.chatHistory.addAIChatMessage(Df(r,this.outputKey))}async clear(){await this.chatHistory.clear()}}const vU=Object.freeze(Object.defineProperty({__proto__:null,BaseChatMemory:Ti},Symbol.toStringTag,{value:"Module"}));class ow extends Ti{constructor(e){const{returnMessages:r,inputKey:n,outputKey:i,chatHistory:s,humanPrefix:a,aiPrefix:o,llm:u,prompt:l,summaryChatMessageClass:c}=e;super({returnMessages:r,inputKey:n,outputKey:i,chatHistory:s}),Object.defineProperty(this,"memoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"history"}),Object.defineProperty(this,"humanPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"Human"}),Object.defineProperty(this,"aiPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"AI"}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:dU}),Object.defineProperty(this,"summaryChatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:Xr}),this.memoryKey=(e==null?void 0:e.memoryKey)??this.memoryKey,this.humanPrefix=a??this.humanPrefix,this.aiPrefix=o??this.aiPrefix,this.llm=u,this.prompt=l??this.prompt,this.summaryChatMessageClass=c??this.summaryChatMessageClass}async predictNewSummary(e,r){const n=kt(e,this.humanPrefix,this.aiPrefix);return await new Q({llm:this.llm,prompt:this.prompt}).predict({summary:r,new_lines:n})}}class _U extends ow{constructor(e){super(e),Object.defineProperty(this,"buffer",{enumerable:!0,configurable:!0,writable:!0,value:""})}get memoryKeys(){return[this.memoryKey]}async loadMemoryVariables(e){return this.returnMessages?{[this.memoryKey]:[new this.summaryChatMessageClass(this.buffer)]}:{[this.memoryKey]:this.buffer}}async saveContext(e,r){await super.saveContext(e,r);const n=await this.chatHistory.getMessages();this.buffer=await this.predictNewSummary(n.slice(-2),this.buffer)}async clear(){await super.clear(),this.buffer=""}}class NT extends ow{constructor(e){super(e),Object.defineProperty(this,"movingSummaryBuffer",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"maxTokenLimit",{enumerable:!0,configurable:!0,writable:!0,value:2e3}),this.maxTokenLimit=(e==null?void 0:e.maxTokenLimit)??this.maxTokenLimit}get memoryKeys(){return[this.memoryKey]}async loadMemoryVariables(e){let r=await this.chatHistory.getMessages();this.movingSummaryBuffer&&(r=[new this.summaryChatMessageClass(this.movingSummaryBuffer),...r]);let n;return this.returnMessages?n=r:n=kt(r,this.humanPrefix,this.aiPrefix),{[this.memoryKey]:n}}async saveContext(e,r){await super.saveContext(e,r),await this.prune()}async prune(){let e=await this.chatHistory.getMessages();this.movingSummaryBuffer&&(e=[new this.summaryChatMessageClass(this.movingSummaryBuffer),...e]);let r=await this.llm.getNumTokens(kt(e,this.humanPrefix,this.aiPrefix));if(r>this.maxTokenLimit){const n=[];for(;r>this.maxTokenLimit;){const i=e.shift();i&&(n.push(i),r=await this.llm.getNumTokens(kt(e,this.humanPrefix,this.aiPrefix)))}this.movingSummaryBuffer=await this.predictNewSummary(n,this.movingSummaryBuffer)}}async clear(){await super.clear(),this.movingSummaryBuffer=""}}class Cd extends Ti{constructor(e){super({chatHistory:e==null?void 0:e.chatHistory,returnMessages:(e==null?void 0:e.returnMessages)??!1,inputKey:e==null?void 0:e.inputKey,outputKey:e==null?void 0:e.outputKey}),Object.defineProperty(this,"humanPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"Human"}),Object.defineProperty(this,"aiPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"AI"}),Object.defineProperty(this,"memoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"history"}),this.humanPrefix=(e==null?void 0:e.humanPrefix)??this.humanPrefix,this.aiPrefix=(e==null?void 0:e.aiPrefix)??this.aiPrefix,this.memoryKey=(e==null?void 0:e.memoryKey)??this.memoryKey}get memoryKeys(){return[this.memoryKey]}async loadMemoryVariables(e){const r=await this.chatHistory.getMessages();return this.returnMessages?{[this.memoryKey]:r}:{[this.memoryKey]:kt(r,this.humanPrefix,this.aiPrefix)}}}const PU="Answer the following questions as best you can. You have access to the following tools:",$T=`The way you use the tools is by specifying a json blob, denoted below by $JSON_BLOB
Specifically, this $JSON_BLOB should have a "action" key (with the name of the tool to use) and a "action_input" key (with the input to the tool going here). 
The $JSON_BLOB should only contain a SINGLE action, do NOT return a list of multiple actions. Here is an example of a valid $JSON_BLOB:

\`\`\`
{{
  "action": "calculator",
  "action_input": "1 + 2"
}}
\`\`\`

ALWAYS use the following format:

Question: the input question you must answer
Thought: you should always think about what to do
Action: 
\`\`\`
$JSON_BLOB
\`\`\`
Observation: the result of the action
... (this Thought/Action/Observation can repeat N times)
Thought: I now know the final answer
Final Answer: the final answer to the original input question`,OU="Begin! Reminder to always use the exact characters `Final Answer` when responding.",S0="Final Answer:";class LT extends ei{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","chat"]})}async parse(e){if(e.includes(S0)||!e.includes('"action":')){const n=e.split(S0);return{returnValues:{output:n[n.length-1].trim()},log:e}}const r=e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim();try{const n=JSON.parse(r.trim());return{tool:n.action,toolInput:n.action_input,log:e}}catch{throw new je(`Unable to parse JSON response from chat agent.

${e}`)}}getFormatInstructions(){return $T}}const SU=`{input}

{agent_scratchpad}`;class Vn extends Lo{static lc_name(){return"ChatAgent"}constructor(e){const r=(e==null?void 0:e.outputParser)??Vn.getDefaultOutputParser();super({...e,outputParser:r}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","chat"]})}_agentType(){return"chat-zero-shot-react-description"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}_stop(){return["Observation:"]}static validateTools(e){const r=e.find(n=>!n.description);if(r){const n=`Got a tool ${r.name} without a description. This agent requires descriptions for all tools.`;throw new Error(n)}}static getDefaultOutputParser(e){return new LT}async constructScratchPad(e){const r=await super.constructScratchPad(e);return r&&`This was your previous work (but I haven't seen any of it! I only see what you return as final answer):
${r}`}static createPrompt(e,r){const{prefix:n=PU,suffix:i=OU,humanMessageTemplate:s=SU,formatInstructions:a=$T}=r??{},o=e.map(c=>`${c.name}: ${c.description}`).join(`
`),u=[n,o,a,i].join(`

`),l=[xr.fromTemplate(u),lt.fromTemplate(s)];return it.fromMessages(l)}static fromLLMAndTools(e,r,n){Vn.validateTools(r);const i=Vn.createPrompt(r,n),s=new Q({prompt:i,llm:e,callbacks:(n==null?void 0:n.callbacks)??(n==null?void 0:n.callbackManager)}),a=(n==null?void 0:n.outputParser)??Vn.getDefaultOutputParser();return new Vn({llmChain:s,outputParser:a,allowedTools:r.map(o=>o.name)})}}const xU=`Assistant is a large language model trained by OpenAI.

Assistant is designed to be able to assist with a wide range of tasks, from answering simple questions to providing in-depth explanations and discussions on a wide range of topics. As a language model, Assistant is able to generate human-like text based on the input it receives, allowing it to engage in natural-sounding conversations and provide responses that are coherent and relevant to the topic at hand.

Assistant is constantly learning and improving, and its capabilities are constantly evolving. It is able to process and understand large amounts of text, and can use this knowledge to provide accurate and informative responses to a wide range of questions. Additionally, Assistant is able to generate its own text based on the input it receives, allowing it to engage in discussions and provide explanations and descriptions on a wide range of topics.

Overall, Assistant is a powerful system that can help with a wide range of tasks and provide valuable insights and information on a wide range of topics. Whether you need help with a specific question or just want to have a conversation about a particular topic, Assistant is here to assist.`,EU=" However, above all else, all responses must adhere to the format of RESPONSE FORMAT INSTRUCTIONS.",zg=`RESPONSE FORMAT INSTRUCTIONS
----------------------------

Output a JSON markdown code snippet containing a valid JSON object in one of two formats:

**Option 1:**
Use this if you want the human to use a tool.
Markdown code snippet formatted in the following schema:

\`\`\`json
{{{{
    "action": string, // The action to take. Must be one of [{tool_names}]
    "action_input": string // The input to the action. May be a stringified object.
}}}}
\`\`\`

**Option #2:**
Use this if you want to respond directly and conversationally to the human. Markdown code snippet formatted in the following schema:

\`\`\`json
{{{{
    "action": "Final Answer",
    "action_input": string // You should put what you want to return to use here and make sure to use valid json newline characters.
}}}}
\`\`\`

For both options, remember to always include the surrounding markdown code snippet delimiters (begin with "\`\`\`json" and end with "\`\`\`")!
`,TU=`TOOLS
------
Assistant can ask the user to use tools to look up information that may be helpful in answering the users original question. The tools the human can use are:

{tools}

{format_instructions}

USER'S INPUT
--------------------
Here is the user's input (remember to respond with a markdown code snippet of a json blob with a single action, and NOTHING else):

{{input}}`,DT=`TOOL RESPONSE:
---------------------
{observation}

USER'S INPUT
--------------------

Okay, so what is the response to my last comment? If using information obtained from the tools you must mention it explicitly without mentioning the tool names - I have forgotten all TOOL RESPONSES! Remember to respond with a markdown code snippet of a json blob with a single action, and NOTHING else.`,AU=`Instructions:
--------------
{instructions}
--------------
Completion:
--------------
{completion}
--------------

Above, the Completion did not satisfy the constraints given in the Instructions.
Error:
--------------
{error}
--------------

Please try again. Please only respond with an answer that satisfies the constraints laid out in the Instructions:`,kU=W.fromTemplate(AU);function IU(t){return t.prompt!==void 0&&t.llm!==void 0}class Xl extends It{static lc_name(){return"OutputFixingParser"}static fromLLM(e,r,n){const i=(n==null?void 0:n.prompt)??kU,s=new Q({llm:e,prompt:i});return new Xl({parser:r,retryChain:s})}constructor({parser:e,retryChain:r}){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","fix"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"parser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"retryChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.parser=e,this.retryChain=r}async parse(e,r){try{return await this.parser.parse(e,r)}catch(n){if(n instanceof je){const i={instructions:this.parser.getFormatInstructions(),completion:e,error:n};if(IU(this.retryChain)){const a=(await this.retryChain.call(i,r))[this.retryChain.outputKey];return this.parser.parse(a,r)}else return await this.retryChain.invoke(i,{callbacks:r})}throw n}}getFormatInstructions(){return this.parser.getFormatInstructions()}}class Ug extends ei{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","chat_convo"]}),Object.defineProperty(this,"toolNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.toolNames=e.toolNames}async parse(e){let r=e.trim();if(r.includes("```json")||r.includes("```")){const n=r.includes("```json")?"```json":"```",i=r.indexOf(n);if(r.indexOf("action_input")>i){r=r.slice(i+n.length).trimStart();const a=r.lastIndexOf("```");a!==-1&&(r=r.slice(0,a).trimEnd())}}try{const n=JSON.parse(r),{action:i,action_input:s}=n;return i==="Final Answer"?{returnValues:{output:s},log:e}:{tool:i,toolInput:s,log:e}}catch(n){throw new je(`Failed to parse. Text: "${e}". Error: ${n}`)}}getFormatInstructions(){return Tt(zg,"f-string",{tool_names:this.toolNames.join(", ")})}}class Pl extends ei{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","chat_convo"]}),Object.defineProperty(this,"baseParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputFixingParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"toolNames",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.toolNames=e.toolNames??this.toolNames,this.baseParser=(e==null?void 0:e.baseParser)??new Ug({toolNames:this.toolNames}),this.outputFixingParser=e==null?void 0:e.outputFixingParser}getFormatInstructions(e){return e.raw?zg:Tt(zg,"f-string",{tool_names:e.toolNames.join(", ")})}async parse(e){return this.outputFixingParser!==void 0?this.outputFixingParser.parse(e):this.baseParser.parse(e)}static fromLLM(e,r){const n=r.baseParser??new Ug({toolNames:r.toolNames??[]}),i=Xl.fromLLM(e,n);return new Pl({baseParser:n,outputFixingParser:i,toolNames:r.toolNames})}}class zn extends Lo{static lc_name(){return"ChatConversationalAgent"}constructor(e){const r=e.outputParser??zn.getDefaultOutputParser();super({...e,outputParser:r}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","chat_convo"]})}_agentType(){return"chat-conversational-react-description"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}_stop(){return["Observation:"]}static validateTools(e){const r=e.find(n=>!n.description);if(r){const n=`Got a tool ${r.name} without a description. This agent requires descriptions for all tools.`;throw new Error(n)}}async constructScratchPad(e){const r=[];for(const n of e)r.push(new Fe(n.action.log)),r.push(new ut(Tt(DT,"f-string",{observation:n.observation})));return r}static getDefaultOutputParser(e){return e!=null&&e.llm?Pl.fromLLM(e.llm,{toolNames:e.toolNames}):new Pl({toolNames:e==null?void 0:e.toolNames})}static createPrompt(e,r){const n=((r==null?void 0:r.systemMessage)??xU)+EU,i=(r==null?void 0:r.humanMessage)??TU,s=e.map(h=>`${h.name}: ${h.description}`).join(`
`),a=e.map(h=>h.name),u=((r==null?void 0:r.outputParser)??zn.getDefaultOutputParser({toolNames:a})).getFormatInstructions({toolNames:a}),l=Tt(i,"f-string",{format_instructions:u,tools:s}),c=[xr.fromTemplate(n),new Gs("chat_history"),lt.fromTemplate(l),new Gs("agent_scratchpad")];return it.fromMessages(c)}static fromLLMAndTools(e,r,n){zn.validateTools(r);const i=(n==null?void 0:n.outputParser)??zn.getDefaultOutputParser({llm:e,toolNames:r.map(o=>o.name)}),s=zn.createPrompt(r,{...n,outputParser:i}),a=new Q({prompt:s,llm:e,callbacks:(n==null?void 0:n.callbacks)??(n==null?void 0:n.callbackManager)});return new zn({llmChain:a,outputParser:i,allowedTools:r.map(o=>o.name)})}}const CU="Answer the following questions truthfully and as best you can.",MT=`Output a JSON markdown code snippet containing a valid JSON blob (denoted below by $JSON_BLOB).
This $JSON_BLOB must have a "action" key (with the name of the tool to use) and an "action_input" key (tool input).

Valid "action" values: "Final Answer" (which you must use when giving your final response to the user), or one of [{tool_names}].

The $JSON_BLOB must be valid, parseable JSON and only contain a SINGLE action. Here is an example of an acceptable output:

\`\`\`json
{{
  "action": $TOOL_NAME,
  "action_input": $INPUT
}}
\`\`\`

Remember to include the surrounding markdown code snippet delimiters (begin with "\`\`\`" json and close with "\`\`\`")!
`,FT=`You have access to the following tools.
You must format your inputs to these tools to match their "JSON schema" definitions below.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Here are the JSON Schema instances for the tools you have access to:

{tool_schemas}

The way you use the tools is as follows:

------------------------

${MT}

If you are using a tool, "action_input" must adhere to the tool's input schema, given above.

------------------------

ALWAYS use the following format:

Question: the input question you must answer
Thought: you should always think about what to do
Action:
\`\`\`json
$JSON_BLOB
\`\`\`
Observation: the result of the action
... (this Thought/Action/Observation can repeat N times)
Thought: I now know the final answer
Action:
\`\`\`json
{{
  "action": "Final Answer",
  "action_input": "Final response to human"
}}
\`\`\``,RU="Begin! Reminder to ALWAYS use the above format, and to use tools if appropriate.";class qg extends ei{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","structured_chat"]}),Object.defineProperty(this,"toolNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.toolNames=e.toolNames}async parse(e){try{const n=/```(?:json)?(.*)(```)/gs.exec(e);if(n===null)throw new je('Could not parse an action. The agent action must be within a markdown code block, and "action" must be a provided tool or "Final Answer"');const i=JSON.parse(n[1].trim()),{action:s,action_input:a}=i;return s==="Final Answer"?{returnValues:{output:a},log:e}:{tool:s,toolInput:a||{},log:e}}catch(r){throw new je(`Failed to parse. Text: "${e}". Error: ${r}`)}}getFormatInstructions(){return Tt(MT,"f-string",{tool_names:this.toolNames.join(", ")})}}class po extends ei{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","structured_chat"]}),Object.defineProperty(this,"baseParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputFixingParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"toolNames",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.toolNames=e.toolNames??this.toolNames,this.baseParser=(e==null?void 0:e.baseParser)??new qg({toolNames:this.toolNames}),this.outputFixingParser=e==null?void 0:e.outputFixingParser}async parse(e,r){return this.outputFixingParser!==void 0?this.outputFixingParser.parse(e,r):this.baseParser.parse(e)}getFormatInstructions(){return Tt(FT,"f-string",{tool_names:this.toolNames.join(", ")})}static fromLLM(e,r){const n=r.baseParser??new qg({toolNames:r.toolNames??[]}),i=Xl.fromLLM(e,n);return new po({baseParser:n,outputFixingParser:i,toolNames:r.toolNames})}}function uw(t){return t.map(e=>`${e.name}: ${e.description}`).join(`
`)}function zT(t){return t.map(e=>`${e.name}: ${e.description}, args: ${JSON.stringify(Zt(e.schema).properties)}`).join(`
`)}const jU=Object.freeze(Object.defineProperty({__proto__:null,renderTextDescription:uw,renderTextDescriptionAndArgs:zT},Symbol.toStringTag,{value:"Module"}));function lw(t,e="Observation: ",r="Thought: "){return t.reduce((i,{action:s,observation:a})=>i+[s.log,`
${e}${a}`,r].join(`
`),"")}const NU=Object.freeze(Object.defineProperty({__proto__:null,formatLogToString:lw},Symbol.toStringTag,{value:"Module"}));class Un extends Lo{static lc_name(){return"StructuredChatAgent"}constructor(e){const r=(e==null?void 0:e.outputParser)??Un.getDefaultOutputParser();super({...e,outputParser:r}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","structured_chat"]})}_agentType(){return"structured-chat-zero-shot-react-description"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}_stop(){return["Observation:"]}static validateTools(e){const r=e.find(n=>!n.description);if(r){const n=`Got a tool ${r.name} without a description. This agent requires descriptions for all tools.`;throw new Error(n)}}static getDefaultOutputParser(e){return e!=null&&e.llm?po.fromLLM(e.llm,{toolNames:e.toolNames}):new po({toolNames:e==null?void 0:e.toolNames})}async constructScratchPad(e){const r=await super.constructScratchPad(e);return r&&`This was your previous work (but I haven't seen any of it! I only see what you return as final answer):
${r}`}static createToolSchemasString(e){return e.map(r=>`${r.name}: ${r.description}, args: ${JSON.stringify(Zt(r.schema).properties)}`).join(`
`)}static createPrompt(e,r){const{prefix:n=CU,suffix:i=RU,inputVariables:s=["input","agent_scratchpad"],humanMessageTemplate:a=`{input}

{agent_scratchpad}`,memoryPrompts:o=[]}=r??{},u=[n,FT,i].join(`

`),l=[new xr(new W({template:u,inputVariables:s,partialVariables:{tool_schemas:Un.createToolSchemasString(e),tool_names:e.map(c=>c.name).join(", ")}})),...o,new lt(new W({template:a,inputVariables:s}))];return it.fromMessages(l)}static fromLLMAndTools(e,r,n){Un.validateTools(r);const i=Un.createPrompt(r,n),s=(n==null?void 0:n.outputParser)??Un.getDefaultOutputParser({llm:e,toolNames:r.map(o=>o.name)}),a=new Q({prompt:i,llm:e,callbacks:n==null?void 0:n.callbacks});return new Un({llmChain:a,outputParser:s,allowedTools:r.map(o=>o.name)})}}async function $U({llm:t,tools:e,prompt:r,streamRunnable:n}){const i=["tools","tool_names","agent_scratchpad"].filter(l=>!r.inputVariables.includes(l));if(i.length>0)throw new Error(`Provided prompt is missing required input variables: ${JSON.stringify(i)}`);const s=e.map(l=>l.name),a=await r.partial({tools:zT(e),tool_names:s.join(", ")}),o=t.bind({stop:["Observation"]});return ca.fromRunnables([Sr.assign({agent_scratchpad:l=>lw(l.steps)}),a,o,po.fromLLM(t,{toolNames:s})],{name:"StructuredChatAgent",streamRunnable:n,singleAction:!0})}const LU="You are a helpful AI assistant.";class cw extends ei{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","openai"]})}static lc_name(){return"OpenAIFunctionsAgentOutputParser"}async parse(e){throw new Error(`OpenAIFunctionsAgentOutputParser can only parse messages.
Passed input: ${e}`)}async parseResult(e){if("message"in e[0]&&Vt(e[0].message))return this.parseAIMessage(e[0].message);throw new Error("parseResult on OpenAIFunctionsAgentOutputParser only works on ChatGeneration output")}parseAIMessage(e){if(e.content&&typeof e.content!="string")throw new Error("This agent cannot parse non-string model responses.");if(e.additional_kwargs.function_call){const r=e.additional_kwargs.function_call;try{const n=r.arguments?JSON.parse(r.arguments):{};return{tool:r.name,toolInput:n,log:`Invoking "${r.name}" with ${r.arguments??"{}"}
${e.content}`,messageLog:[e]}}catch(n){throw new je(`Failed to parse function arguments from chat model response. Text: "${r.arguments}". ${n}`)}}else return{returnValues:{output:e.content},log:e.content}}getFormatInstructions(){throw new Error("getFormatInstructions not implemented inside OpenAIFunctionsAgentOutputParser.")}}class UT extends xT{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","openai"]})}static lc_name(){return"OpenAIToolsAgentOutputParser"}async parse(e){throw new Error(`OpenAIFunctionsAgentOutputParser can only parse messages.
Passed input: ${e}`)}async parseResult(e){if("message"in e[0]&&Vt(e[0].message))return this.parseAIMessage(e[0].message);throw new Error("parseResult on OpenAIFunctionsAgentOutputParser only works on ChatGeneration output")}parseAIMessage(e){if(e.content&&typeof e.content!="string")throw new Error("This agent cannot parse non-string model responses.");if(e.additional_kwargs.tool_calls){const r=e.additional_kwargs.tool_calls;try{return r.map((n,i)=>{const s=n.function.arguments?JSON.parse(n.function.arguments):{},a=i===0?[e]:[];return{tool:n.function.name,toolInput:s,toolCallId:n.id,log:`Invoking "${n.function.name}" with ${n.function.arguments??"{}"}
${e.content}`,messageLog:a}})}catch(n){throw new je(`Failed to parse tool arguments from chat model response. Text: "${JSON.stringify(r)}". ${n}`)}}else return{returnValues:{output:e.content},log:e.content}}getFormatInstructions(){throw new Error("getFormatInstructions not implemented inside OpenAIToolsAgentOutputParser.")}}const DU=Object.freeze(Object.defineProperty({__proto__:null,OpenAIFunctionsAgentOutputParser:cw,OpenAIToolsAgentOutputParser:UT},Symbol.toStringTag,{value:"Module"}));function MU(t){const e=[];for(const r of t)e.push(new Fe(r.action.log)),e.push(new ut(Tt(DT,"f-string",{observation:r.observation})));return e}function qT(t){return t.flatMap(({action:e,observation:r})=>"messageLog"in e&&e.messageLog!==void 0?e.messageLog.concat(new aa(r,e.tool)):[new Fe(e.log)])}const FU=Object.freeze(Object.defineProperty({__proto__:null,formatForOpenAIFunctions:MU,formatToOpenAIFunctionMessages:qT},Symbol.toStringTag,{value:"Module"}));function zU(t){return t.messageLog!==void 0}function UU(t,e){var r;return zU(t)&&t.messageLog!==void 0?(r=t.messageLog)==null?void 0:r.concat(new aa(e,t.tool)):[new Fe(t.log)]}function KT(t){return t.flatMap(({action:e,observation:r})=>UU(e,r))}class Qa extends Lo{static lc_name(){return"OpenAIAgent"}_agentType(){return"openai-functions"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}_stop(){return["Observation:"]}constructor(e){super({...e,outputParser:void 0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","openai"]}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:new cw}),this.tools=e.tools}static createPrompt(e,r){const{prefix:n=LU}=r||{};return it.fromMessages([xr.fromTemplate(n),new Gs("chat_history"),lt.fromTemplate("{input}"),new Gs("agent_scratchpad")])}static fromLLMAndTools(e,r,n){if(Qa.validateTools(r),e._modelType()!=="base_chat_model"||e._llmType()!=="openai")throw new Error("OpenAIAgent requires an OpenAI chat model");const i=Qa.createPrompt(r,n),s=new Q({prompt:i,llm:e,callbacks:n==null?void 0:n.callbacks});return new Qa({llmChain:s,allowedTools:r.map(a=>a.name),tools:r})}async constructScratchPad(e){return KT(e)}async plan(e,r,n){const i=await this.constructScratchPad(e),s={...r,agent_scratchpad:i};this._stop().length!==0&&(s.stop=this._stop());const a=this.llmChain.llm,o={...s},u={functions:this.tools.map(Bl)},l="callKeys"in this.llmChain.llm?this.llmChain.llm.callKeys:[];for(const d of l)d in r&&(u[d]=r[d],delete o[d]);const c=await this.llmChain.prompt.formatPromptValue(o),h=await a.invoke(c.toChatMessages(),{...u,callbacks:n});return this.outputParser.parseAIMessage(h)}}async function VT({llm:t,tools:e,prompt:r,streamRunnable:n}){if(!r.inputVariables.includes("agent_scratchpad"))throw new Error(['Prompt must have an input variable named "agent_scratchpad".',`Found ${JSON.stringify(r.inputVariables)} instead.`].join(`
`));const i=t.bind({functions:e.map(Bl)});return ca.fromRunnables([Sr.assign({agent_scratchpad:a=>qT(a.steps)}),r,i,new cw],{name:"OpenAIFunctionsAgent",streamRunnable:n,singleAction:!0})}const qU=`You are a helpful assistant. Help the user answer any questions.

You have access to the following tools:

{tools}

In order to use a tool, you can use <tool></tool> and <tool_input></tool_input> tags.
You will then get back a response in the form <observation></observation>
For example, if you have a tool called 'search' that could run a google search, in order to search for the weather in SF you would respond:

<tool>search</tool><tool_input>weather in SF</tool_input>
<observation>64 degrees</observation>

When you are done, respond with a final answer between <final_answer></final_answer>. For example:

<final_answer>The weather in SF is 64 degrees</final_answer>

Begin!

Question: {question}`;class hw extends ei{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","xml"]})}static lc_name(){return"XMLAgentOutputParser"}async parse(e){if(e.includes("</tool>")){const[r,n]=e.split("</tool>"),i=r.split("<tool>")[1],s=n.split("<tool_input>")[1];return{tool:i,toolInput:s,log:e}}else if(e.includes("<final_answer>")){const[,r]=e.split("<final_answer>");return{returnValues:{output:r},log:e}}else throw new je(`Could not parse LLM output: ${e}`)}getFormatInstructions(){throw new Error("getFormatInstructions not implemented inside OpenAIFunctionsAgentOutputParser.")}}const KU=Object.freeze(Object.defineProperty({__proto__:null,XMLAgentOutputParser:hw},Symbol.toStringTag,{value:"Module"}));function BT(t){let e="";for(const r of t){const{action:n,observation:i}=r;e+=`<tool>${n.tool}</tool><tool_input>${n.toolInput}
</tool_input><observation>${i}</observation>`}return e}const VU=Object.freeze(Object.defineProperty({__proto__:null,formatXml:BT},Symbol.toStringTag,{value:"Module"}));class Ol extends Ql{static lc_name(){return"XMLAgent"}_agentType(){return"xml"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","xml"]}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:new hw}),this.tools=e.tools,this.llmChain=e.llmChain}get inputKeys(){return["input"]}static createPrompt(){return it.fromMessages([lt.fromTemplate(qU),la.fromTemplate("{intermediate_steps}")])}async plan(e,r,n){let i="";for(const{action:u,observation:l}of e)i+=`<tool>${u.tool}</tool><tool_input>${u.toolInput}</tool_input><observation>${l}</observation>`;let s="";for(const u of this.tools)s+=`${u.name}: ${u.description}
`;const a={intermediate_steps:i,tools:s,question:r.input,stop:["</tool_input>","</final_answer>"]},o=await this.llmChain.call(a,n);return this.outputParser.parse(o[this.llmChain.outputKey])}static fromLLMAndTools(e,r,n){const i=Ol.createPrompt(),s=new Q({prompt:i,llm:e,callbacks:n==null?void 0:n.callbacks});return new Ol({llmChain:s,tools:r})}}async function BU({llm:t,tools:e,prompt:r,streamRunnable:n}){const i=["tools","agent_scratchpad"].filter(u=>!r.inputVariables.includes(u));if(i.length>0)throw new Error(`Provided prompt is missing required input variables: ${JSON.stringify(i)}`);const s=await r.partial({tools:uw(e)}),a=t.bind({stop:["</tool_input>","</final_answer>"]});return ca.fromRunnables([Sr.assign({agent_scratchpad:u=>BT(u.steps)}),s,a,new hw],{name:"XMLAgent",streamRunnable:n,singleAction:!0})}const HU=async(t,e,r,n,i)=>{const s=r??"zero-shot-react-description",a=n,o=i;switch(s){case"zero-shot-react-description":return wt.fromAgentAndTools({agent:dt.fromLLMAndTools(e,t),tools:t,returnIntermediateSteps:!0,verbose:a,callbackManager:o});case"chat-zero-shot-react-description":return wt.fromAgentAndTools({agent:Vn.fromLLMAndTools(e,t),tools:t,returnIntermediateSteps:!0,verbose:a,callbackManager:o});case"chat-conversational-react-description":return wt.fromAgentAndTools({agent:zn.fromLLMAndTools(e,t),tools:t,verbose:a,callbackManager:o});default:throw new Error("Unknown agent type")}};async function HT(t,e,r={agentType:e._modelType()==="base_chat_model"?"chat-zero-shot-react-description":"zero-shot-react-description"}){switch(r.agentType){case"zero-shot-react-description":{const{agentArgs:n,tags:i,...s}=r;return wt.fromAgentAndTools({tags:[...i??[],"zero-shot-react-description"],agent:dt.fromLLMAndTools(e,t,n),tools:t,...s})}case"chat-zero-shot-react-description":{const{agentArgs:n,tags:i,...s}=r;return wt.fromAgentAndTools({tags:[...i??[],"chat-zero-shot-react-description"],agent:Vn.fromLLMAndTools(e,t,n),tools:t,...s})}case"chat-conversational-react-description":{const{agentArgs:n,memory:i,tags:s,...a}=r;return wt.fromAgentAndTools({tags:[...s??[],"chat-conversational-react-description"],agent:zn.fromLLMAndTools(e,t,n),tools:t,memory:i??new Cd({returnMessages:!0,memoryKey:"chat_history",inputKey:"input",outputKey:"output"}),...a})}case"xml":{const{agentArgs:n,tags:i,...s}=r;return wt.fromAgentAndTools({tags:[...i??[],"xml"],agent:Ol.fromLLMAndTools(e,t,n),tools:t,...s})}case"structured-chat-zero-shot-react-description":{const{agentArgs:n,memory:i,tags:s,...a}=r;return wt.fromAgentAndTools({tags:[...s??[],"structured-chat-zero-shot-react-description"],agent:Un.fromLLMAndTools(e,t,n),tools:t,memory:i,...a})}case"openai-functions":{const{agentArgs:n,memory:i,tags:s,...a}=r;return wt.fromAgentAndTools({tags:[...s??[],"openai-functions"],agent:Qa.fromLLMAndTools(e,t,n),tools:t,memory:i??new Cd({returnMessages:!0,memoryKey:"chat_history",inputKey:"input",outputKey:"output"}),...a})}default:throw new Error("Unknown agent type")}}class WT extends Ti{constructor(e){super(e),Object.defineProperty(this,"humanPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"Human"}),Object.defineProperty(this,"aiPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"AI"}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"memoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"history"}),Object.defineProperty(this,"maxTokenLimit",{enumerable:!0,configurable:!0,writable:!0,value:12e3}),Object.defineProperty(this,"returnMessages",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),Object.defineProperty(this,"intermediateStepsKey",{enumerable:!0,configurable:!0,writable:!0,value:"intermediateSteps"}),this.humanPrefix=e.humanPrefix??this.humanPrefix,this.aiPrefix=e.aiPrefix??this.aiPrefix,this.llm=e.llm,this.memoryKey=e.memoryKey??this.memoryKey,this.maxTokenLimit=e.maxTokenLimit??this.maxTokenLimit,this.returnMessages=e.returnMessages??this.returnMessages,this.outputKey=e.outputKey??this.outputKey,this.intermediateStepsKey=e.intermediateStepsKey??this.intermediateStepsKey}get memoryKeys(){return[this.memoryKey]}async getMessages(){return this.chatHistory.getMessages()}async loadMemoryVariables(e){const r=await this.getMessages();if(this.returnMessages)return{[this.memoryKey]:r};{const n=kt(r,this.humanPrefix,this.aiPrefix);return{[this.memoryKey]:n}}}async saveContext(e,r){const n=Zl(e,this.inputKey),i=Df(r,this.outputKey);await this.chatHistory.addUserMessage(n);const s=KT(r[this.intermediateStepsKey]);for(const u of s)await this.chatHistory.addMessage(u);await this.chatHistory.addAIChatMessage(i);const a=await this.chatHistory.getMessages();let o=await this.llm.getNumTokensFromMessages(a);if(o.totalCount>this.maxTokenLimit){const u=[];for(;o.totalCount>this.maxTokenLimit;){const l=a.pop();if(!l){console.warn(`Could not prune enough messages from chat history to stay under ${this.maxTokenLimit} tokens.`);break}u.push(l),o=await this.llm.getNumTokensFromMessages(a)}await this.chatHistory.clear();for(const l of u)await this.chatHistory.addMessage(l)}}}async function WU(t,e,r){const{rememberIntermediateSteps:n=!0,memoryKey:i="chat_history",outputKey:s="output",inputKey:a="input",prefix:o,verbose:u}=r??{};let l;return n?l=new WT({memoryKey:i,llm:t,outputKey:s,inputKey:a}):l=new NT({memoryKey:i,llm:t,maxTokenLimit:12e3,returnMessages:!0,outputKey:s,inputKey:a}),await HT(e,t,{agentType:"openai-functions",memory:l,verbose:u,returnIntermediateSteps:n,agentArgs:{prefix:o??"Do your best to answer the questions. Feel free to use any tools available to look up relevant information, only if necessary."}})}const JU=Object.freeze(Object.defineProperty({__proto__:null,JsonToolkit:iw,OpenAIAgentTokenBufferMemory:WT,OpenApiToolkit:AT,RequestsToolkit:aw,VectorStoreRouterToolkit:CT,VectorStoreToolkit:IT,createConversationalRetrievalAgent:WU,createJsonAgent:sw,createOpenApiAgent:kT,createRetrieverTool:cU,createVectorStoreAgent:RT,createVectorStoreRouterAgent:jT},Symbol.toStringTag,{value:"Module"}));function GU(t){return new ia({tool_call_id:t.action.toolCallId,content:t.observation,additional_kwargs:{name:t.action.tool}})}function dw(t){return t.flatMap(({action:e,observation:r})=>"messageLog"in e&&e.messageLog!==void 0?e.messageLog.concat(GU({action:e,observation:r})):[new Fe(e.log)])}const ZU=Object.freeze(Object.defineProperty({__proto__:null,formatToOpenAIToolMessages:dw},Symbol.toStringTag,{value:"Module"}));async function YU({llm:t,tools:e,prompt:r,streamRunnable:n}){if(!r.inputVariables.includes("agent_scratchpad"))throw new Error(['Prompt must have an input variable named "agent_scratchpad".',`Found ${JSON.stringify(r.inputVariables)} instead.`].join(`
`));const i=t.bind({tools:e.map(bl)});return ca.fromRunnables([Sr.assign({agent_scratchpad:a=>dw(a.steps)}),r,i,new UT],{name:"OpenAIToolsAgent",streamRunnable:n,singleAction:!1})}function QU(t){var n;const e=typeof t.content=="string"?t.content:JSON.stringify(t.content);let r=[];if(t.tool_calls!==void 0&&t.tool_calls.length>0)r=t.tool_calls;else{if(t.additional_kwargs.tool_calls===void 0||t.additional_kwargs.tool_calls.length===0)return{returnValues:{output:t.content},log:e};for(const i of t.additional_kwargs.tool_calls??[]){const s=(n=i.function)==null?void 0:n.name;try{const a=JSON.parse(i.function.arguments);r.push({name:s,args:a,id:i.id})}catch(a){throw new je(`Failed to parse tool arguments from chat model response. Text: "${JSON.stringify(r)}". ${a}`)}}}return r.map((i,s)=>{const a=s===0?[t]:[],o=`Invoking "${i.name}" with ${JSON.stringify(i.args??{})}
${e}`;return{tool:i.name,toolInput:i.args,toolCallId:i.id??"",log:o,messageLog:a}})}class XU extends xT{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","tool_calling"]})}static lc_name(){return"ToolCallingAgentOutputParser"}async parse(e){throw new Error(`ToolCallingAgentOutputParser can only parse messages.
Passed input: ${e}`)}async parseResult(e){if("message"in e[0]&&Vt(e[0].message))return QU(e[0].message);throw new Error("parseResult on ToolCallingAgentOutputParser only works on ChatGeneration output")}getFormatInstructions(){throw new Error("getFormatInstructions not implemented inside ToolCallingAgentOutputParser.")}}function eq({llm:t,tools:e,prompt:r,streamRunnable:n}){if(!r.inputVariables.includes("agent_scratchpad"))throw new Error(['Prompt must have an input variable named "agent_scratchpad".',`Found ${JSON.stringify(r.inputVariables)} instead.`].join(`
`));if(t.bindTools===void 0)throw new Error('This agent requires that the "bind_tools()" method be implemented on the input model.');const i=t.bindTools(e);return ca.fromRunnables([Sr.assign({agent_scratchpad:a=>dw(a.steps)}),r,i,new XU],{name:"ToolCallingAgent",streamRunnable:n,singleAction:!1})}const tq=`Use the following format:

Question: the input question you must answer
Thought: you should always think about what to do
Action: the action to take, should be one of [{tool_names}]
Action Input: the input to the action
Observation: the result of the action
... (this Thought/Action/Action Input/Observation can repeat N times)
Thought: I now know the final answer
Final Answer: the final answer to the original input question`,x0="Final Answer:",rq="Parsing LLM output produced both a final answer and a parse-able action:";class JT extends ei{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","react"]}),Object.defineProperty(this,"toolNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.toolNames=e.toolNames}async parse(e){const r=e.includes(x0),n=/Action\s*\d*\s*:[\s]*(.*?)[\s]*Action\s*\d*\s*Input\s*\d*\s*:[\s]*(.*)/,i=e.match(n);if(i){if(r)throw new Error(`${rq}: ${e}`);const s=i[1],o=i[2].trim().replace(/"/g,"");return{tool:s,toolInput:o,log:e}}if(r)return{returnValues:{output:e.split(x0)[1].trim()},log:e};throw new Error(`Could not parse LLM output: ${e}`)}getFormatInstructions(){return Tt(tq,"f-string",{tool_names:this.toolNames.join(", ")})}}const nq=Object.freeze(Object.defineProperty({__proto__:null,ReActSingleInputOutputParser:JT},Symbol.toStringTag,{value:"Module"}));async function iq({llm:t,tools:e,prompt:r,streamRunnable:n}){const i=["tools","tool_names","agent_scratchpad"].filter(l=>!r.inputVariables.includes(l));if(i.length>0)throw new Error(`Provided prompt is missing required input variables: ${JSON.stringify(i)}`);const s=e.map(l=>l.name),a=await r.partial({tools:uw(e),tool_names:s.join(", ")}),o=t.bind({stop:[`
Observation:`]});return ca.fromRunnables([Sr.assign({agent_scratchpad:l=>lw(l.steps)}),a,o,new JT({toolNames:s})],{name:"ReactAgent",streamRunnable:n,singleAction:!0})}const sq=Object.freeze(Object.defineProperty({__proto__:null,Agent:Lo,AgentActionOutputParser:ei,AgentExecutor:wt,BaseMultiActionAgent:ST,BaseSingleActionAgent:Ql,ChatAgent:Vn,ChatAgentOutputParser:LT,ChatConversationalAgent:zn,ChatConversationalAgentOutputParser:Ug,ChatConversationalAgentOutputParserWithRetries:Pl,JsonToolkit:iw,LLMSingleActionAgent:Zz,OpenAIAgent:Qa,OpenApiToolkit:AT,RequestsToolkit:aw,RunnableAgent:Gz,StructuredChatAgent:Un,StructuredChatOutputParser:qg,StructuredChatOutputParserWithRetries:po,Toolkit:xo,VectorStoreRouterToolkit:CT,VectorStoreToolkit:IT,XMLAgent:Ol,ZeroShotAgent:dt,ZeroShotAgentOutputParser:TT,createJsonAgent:sw,createOpenAIFunctionsAgent:VT,createOpenAIToolsAgent:YU,createOpenApiAgent:kT,createReactAgent:iq,createStructuredChatAgent:$U,createToolCallingAgent:eq,createVectorStoreAgent:RT,createVectorStoreRouterAgent:jT,createXmlAgent:BU,initializeAgentExecutor:HU,initializeAgentExecutorWithOptions:HT},Symbol.toStringTag,{value:"Module"}));function aq(t,e="{observation}"){const n=[...e.matchAll(/{([^}]*)}/g)].map(s=>s[1]);if(n.length>1)throw new Error(`templateToolResponse must contain one input variable: ${e}`);const i=[];for(const s of t)i.push(new Fe(s.action.log)),i.push(new ut(Tt(e,"f-string",{[n[0]]:s.observation})));return i}const oq=Object.freeze(Object.defineProperty({__proto__:null,formatLogToMessage:aq},Symbol.toStringTag,{value:"Module"}));function uq(t,e){const r=async({query:i},s)=>{const a=await t.getRelevantDocuments(i,s==null?void 0:s.getChild("retriever"));return Mf(a)},n=Ce.object({query:Ce.string().describe("query to look up in retriever")});return new Sf({...e,func:r,schema:n})}const lq=Object.freeze(Object.defineProperty({__proto__:null,createRetrieverTool:uq},Symbol.toStringTag,{value:"Module"})),GT=`You are given the below API Documentation:
{api_docs}
Using this documentation, generate the full API url to call for answering the user question.
You should build the API url in order to get a response that is as short as possible, while still getting the necessary information to answer the question. Pay attention to deliberately exclude any unnecessary pieces of data in the API call.

Question:{question}
API url:`,cq=new W({inputVariables:["api_docs","question"],template:GT}),hq=`${GT} {api_url}

Here is the response from the API:

{api_response}

Summarize this response to answer the original question.

Summary:`,dq=new W({inputVariables:["api_docs","question","api_url","api_response"],template:hq});class Ff extends Ae{get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"apiAnswerChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiRequestChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiDocs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"question"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),this.apiRequestChain=e.apiRequestChain,this.apiAnswerChain=e.apiAnswerChain,this.apiDocs=e.apiDocs,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.headers=e.headers??this.headers}async _call(e,r){const n=e[this.inputKey],i=await this.apiRequestChain.predict({question:n,api_docs:this.apiDocs},r==null?void 0:r.getChild("request")),a=await(await fetch(i,{headers:this.headers})).text(),o=await this.apiAnswerChain.predict({question:n,api_docs:this.apiDocs,api_url:i,api_response:a},r==null?void 0:r.getChild("response"));return{[this.outputKey]:o}}_chainType(){return"api_chain"}static async deserialize(e){const{api_request_chain:r,api_answer_chain:n,api_docs:i}=e;if(!r)throw new Error("LLMChain must have api_request_chain");if(!n)throw new Error("LLMChain must have api_answer_chain");if(!i)throw new Error("LLMChain must have api_docs");return new Ff({apiAnswerChain:await Q.deserialize(n),apiRequestChain:await Q.deserialize(r),apiDocs:i})}serialize(){return{_type:this._chainType(),api_answer_chain:this.apiAnswerChain.serialize(),api_request_chain:this.apiRequestChain.serialize(),api_docs:this.apiDocs}}static fromLLMAndAPIDocs(e,r,n={}){const{apiUrlPrompt:i=cq,apiResponsePrompt:s=dq}=n,a=new Q({prompt:i,llm:e}),o=new Q({prompt:s,llm:e});return new this({apiAnswerChain:o,apiRequestChain:a,apiDocs:r,...n})}}const fq=Object.freeze(Object.defineProperty({__proto__:null,APIChain:Ff},Symbol.toStringTag,{value:"Module"})),ZT=`The following is a friendly conversation between a human and an AI. The AI is talkative and provides lots of specific details from its context. If the AI does not know the answer to a question, it truthfully says it does not know.

Current conversation:
{history}
Human: {input}
AI:`;class fw extends Q{static lc_name(){return"ConversationChain"}constructor({prompt:e,outputKey:r,memory:n,...i}){super({prompt:e??new W({template:ZT,inputVariables:["history","input"]}),outputKey:r??"response",memory:n??new Cd,...i})}}function E0(t,e){const r=new Set;for(const n of e)t.has(n)&&r.add(n);return r}function pq(t,e){const r=new Set(t);for(const n of e)r.add(n);return r}function Ac(t,e){const r=new Set(t);for(const n of e)r.delete(n);return r}function Jo(t){return Array.from(t).map(e=>`"${e}"`).join(", ")}class ec extends Ae{static lc_name(){return"SequentialChain"}get inputKeys(){return this.inputVariables}get outputKeys(){return this.outputVariables}constructor(e){if(super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnAll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.inputVariables=e.inputVariables,this.outputVariables=e.outputVariables??[],this.outputVariables.length>0&&e.returnAll)throw new Error("Either specify variables to return using `outputVariables` or use `returnAll` param. Cannot apply both conditions at the same time.");this.returnAll=e.returnAll??!1,this._validateChains()}_validateChains(){var a;if(this.chains.length===0)throw new Error("Sequential chain must have at least one chain.");const e=((a=this.memory)==null?void 0:a.memoryKeys)??[],r=new Set(this.inputKeys),n=new Set(e),i=E0(r,n);if(i.size>0)throw new Error(`The following keys: ${Jo(i)} are overlapping between memory and input keys of the chain variables. This can lead to unexpected behaviour. Please use input and memory keys that don't overlap.`);const s=pq(r,n);for(const o of this.chains){let u=Ac(new Set(o.inputKeys),s);if(o.memory&&(u=Ac(u,new Set(o.memory.memoryKeys))),u.size>0)throw new Error(`Missing variables for chain "${o._chainType()}": ${Jo(u)}. Only got the following variables: ${Jo(s)}.`);const l=new Set(o.outputKeys),c=E0(s,l);if(c.size>0)throw new Error(`The following output variables for chain "${o._chainType()}" are overlapping: ${Jo(c)}. This can lead to unexpected behaviour.`);for(const h of l)s.add(h)}if(this.outputVariables.length===0)if(this.returnAll){const o=Ac(s,r);this.outputVariables=Array.from(o)}else this.outputVariables=this.chains[this.chains.length-1].outputKeys;else{const o=Ac(new Set(this.outputVariables),new Set(s));if(o.size>0)throw new Error(`The following output variables were expected to be in the final chain output but were not found: ${Jo(o)}.`)}}async _call(e,r){let n={};const i=e;let s=0;for(const o of this.chains){s+=1,n=await o.call(i,r==null?void 0:r.getChild(`step_${s}`));for(const u of Object.keys(n))i[u]=n[u]}const a={};for(const o of this.outputVariables)a[o]=i[o];return a}_chainType(){return"sequential_chain"}static async deserialize(e){const r=[],n=e.input_variables,i=e.output_variables,s=e.chains;for(const a of s){const o=await Ae.deserialize(a);r.push(o)}return new ec({chains:r,inputVariables:n,outputVariables:i})}serialize(){const e=[];for(const r of this.chains)e.push(r.serialize());return{_type:this._chainType(),input_variables:this.inputVariables,output_variables:this.outputVariables,chains:e}}}class zf extends Ae{static lc_name(){return"SimpleSequentialChain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),Object.defineProperty(this,"trimOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.trimOutputs=e.trimOutputs??!1,this._validateChains()}_validateChains(){for(const e of this.chains){if(e.inputKeys.filter(r=>{var n;return!((n=e.memory)!=null&&n.memoryKeys.includes(r))}).length!==1)throw new Error(`Chains used in SimpleSequentialChain should all have one input, got ${e.inputKeys.length} for ${e._chainType()}.`);if(e.outputKeys.length!==1)throw new Error(`Chains used in SimpleSequentialChain should all have one output, got ${e.outputKeys.length} for ${e._chainType()}.`)}}async _call(e,r){let n=e[this.inputKey],i=0;for(const s of this.chains)i+=1,n=(await s.call({[s.inputKeys[0]]:n,signal:e.signal},r==null?void 0:r.getChild(`step_${i}`)))[s.outputKeys[0]],this.trimOutputs&&(n=n.trim()),await(r==null?void 0:r.handleText(n));return{[this.outputKey]:n}}_chainType(){return"simple_sequential_chain"}static async deserialize(e){const r=[],n=e.chains;for(const i of n){const s=await Ae.deserialize(i);r.push(s)}return new zf({chains:r})}serialize(){const e=[];for(const r of this.chains)e.push(r.serialize());return{_type:this._chainType(),chains:e}}}const T0=Object.freeze(Object.defineProperty({__proto__:null,SequentialChain:ec,SimpleSequentialChain:zf},Symbol.toStringTag,{value:"Module"})),mq=`Given the following conversation and a follow up question, rephrase the follow up question to be a standalone question.

Chat History:
{chat_history}
Follow Up Input: {question}
Standalone question:`,gq=`Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.

{context}

Question: {question}
Helpful Answer:`;class pw extends Ae{get inputKeys(){return[this.inputKey,this.chatHistoryKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"question"}),Object.defineProperty(this,"chatHistoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"chat_history"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"result"}),Object.defineProperty(this,"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"questionGeneratorChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.vectorstore=e.vectorstore,this.combineDocumentsChain=e.combineDocumentsChain,this.questionGeneratorChain=e.questionGeneratorChain,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.k=e.k??this.k,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments}async _call(e,r){if(!(this.inputKey in e))throw new Error(`Question key ${this.inputKey} not found.`);if(!(this.chatHistoryKey in e))throw new Error(`chat history key ${this.inputKey} not found.`);const n=e[this.inputKey],i=e[this.chatHistoryKey];let s=n;if(i.length>0){const l=await this.questionGeneratorChain.call({question:n,chat_history:i},r==null?void 0:r.getChild("question_generator")),c=Object.keys(l);if(console.log("_call",e,c),c.length===1)s=l[c[0]];else throw new Error("Return from llm chain has multiple values, only single values supported.")}const a=await this.vectorstore.similaritySearch(s,this.k,void 0,r==null?void 0:r.getChild("vectorstore")),o={question:s,input_documents:a,chat_history:i},u=await this.combineDocumentsChain.call(o,r==null?void 0:r.getChild("combine_documents"));return this.returnSourceDocuments?{...u,sourceDocuments:a}:u}_chainType(){return"chat-vector-db"}static async deserialize(e,r){if(!("vectorstore"in r))throw new Error("Need to pass in a vectorstore to deserialize VectorDBQAChain");const{vectorstore:n}=r;return new pw({combineDocumentsChain:await Ae.deserialize(e.combine_documents_chain),questionGeneratorChain:await Q.deserialize(e.question_generator),k:e.k,vectorstore:n})}serialize(){return{_type:this._chainType(),combine_documents_chain:this.combineDocumentsChain.serialize(),question_generator:this.questionGeneratorChain.serialize(),k:this.k}}static fromLLM(e,r,n={}){const{questionGeneratorTemplate:i,qaTemplate:s,verbose:a,...o}=n,u=W.fromTemplate(i||mq),l=W.fromTemplate(s||gq),c=Kl(e,{prompt:l,verbose:a}),h=new Q({prompt:u,llm:e,verbose:a});return new this({vectorstore:r,combineDocumentsChain:c,questionGeneratorChain:h,...o})}}class Uf extends Yb{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chunkSize=(e==null?void 0:e.chunkSize)??this.chunkSize,this.chunkOverlap=(e==null?void 0:e.chunkOverlap)??this.chunkOverlap,this.keepSeparator=(e==null?void 0:e.keepSeparator)??this.keepSeparator,this.lengthFunction=(e==null?void 0:e.lengthFunction)??(r=>r.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,r={}){return this.splitDocuments(e,r)}splitOnSeparator(e,r){let n;if(r)if(this.keepSeparator){const i=r.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");n=e.split(new RegExp(`(?=${i})`))}else n=e.split(r);else n=e.split("");return n.filter(i=>i!=="")}async createDocuments(e,r=[],n={}){const i=r.length>0?r:[...Array(e.length)].map(()=>({})),{chunkHeader:s="",chunkOverlapHeader:a="(cont'd) ",appendChunkOverlapHeader:o=!1}=n,u=new Array;for(let l=0;l<e.length;l+=1){const c=e[l];let h=1,d=null,f=-1;for(const p of await this.splitText(c)){let y=s;const v=c.indexOf(p,f+1);if(d===null){const S=this.numberOfNewLines(c,0,v);h+=S}else{const S=f+await this.lengthFunction(d);if(S<v){const E=this.numberOfNewLines(c,S,v);h+=E}else if(S>v){const E=this.numberOfNewLines(c,v,S);h-=E}o&&(y+=a)}const g=this.numberOfNewLines(p),m=i[l].loc&&typeof i[l].loc=="object"?{...i[l].loc}:{};m.lines={from:h,to:h+g};const b={...i[l],loc:m};y+=p,u.push(new Lt({pageContent:y,metadata:b})),h+=g,d=p,f=v}}return u}numberOfNewLines(e,r,n){return(e.slice(r,n).match(/\n/g)||[]).length}async splitDocuments(e,r={}){const n=e.filter(a=>a.pageContent!==void 0),i=n.map(a=>a.pageContent),s=n.map(a=>a.metadata);return this.createDocuments(i,s,r)}joinDocs(e,r){const n=e.join(r).trim();return n===""?null:n}async mergeSplits(e,r){const n=[],i=[];let s=0;for(const o of e){const u=await this.lengthFunction(o);if(s+u+i.length*r.length>this.chunkSize&&(s>this.chunkSize&&console.warn(`Created a chunk of size ${s}, +
which is longer than the specified ${this.chunkSize}`),i.length>0)){const l=this.joinDocs(i,r);for(l!==null&&n.push(l);s>this.chunkOverlap||s+u+i.length*r.length>this.chunkSize&&s>0;)s-=await this.lengthFunction(i[0]),i.shift()}i.push(o),s+=u}const a=this.joinDocs(i,r);return a!==null&&n.push(a),n}}class yq extends Uf{static lc_name(){return"CharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),this.separator=(e==null?void 0:e.separator)??this.separator}async splitText(e){const r=this.splitOnSeparator(e,this.separator);return this.mergeSplits(r,this.keepSeparator?"":this.separator)}}const bq=["cpp","go","java","js","php","proto","python","rst","ruby","rust","scala","swift","markdown","latex","html","sol"];class _i extends Uf{static lc_name(){return"RecursiveCharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=(e==null?void 0:e.separators)??this.separators,this.keepSeparator=(e==null?void 0:e.keepSeparator)??!0}async _splitText(e,r){const n=[];let i=r[r.length-1],s;for(let l=0;l<r.length;l+=1){const c=r[l];if(c===""){i=c;break}if(e.includes(c)){i=c,s=r.slice(l+1);break}}const a=this.splitOnSeparator(e,i);let o=[];const u=this.keepSeparator?"":i;for(const l of a)if(await this.lengthFunction(l)<this.chunkSize)o.push(l);else{if(o.length){const c=await this.mergeSplits(o,u);n.push(...c),o=[]}if(!s)n.push(l);else{const c=await this._splitText(l,s);n.push(...c)}}if(o.length){const l=await this.mergeSplits(o,u);n.push(...l)}return n}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,r){return new _i({...r,separators:_i.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if(e==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(e==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(e==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(e==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(e==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(e==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(e==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(e==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(e==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(e==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(e==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${e} is not supported.`)}}class YT extends Uf{static lc_name(){return"TokenTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"encodingName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"allowedSpecial",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"disallowedSpecial",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tokenizer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.encodingName=(e==null?void 0:e.encodingName)??"gpt2",this.allowedSpecial=(e==null?void 0:e.allowedSpecial)??[],this.disallowedSpecial=(e==null?void 0:e.disallowedSpecial)??"all"}async splitText(e){this.tokenizer||(this.tokenizer=await hb(this.encodingName));const r=[],n=this.tokenizer.encode(e,this.allowedSpecial,this.disallowedSpecial);let i=0;for(;i<n.length;){i>0&&(i-=this.chunkOverlap);const s=Math.min(i+this.chunkSize,n.length),a=n.slice(i,s);r.push(this.tokenizer.decode(a)),i=s}return r}}class wq extends _i{constructor(e){super({...e,separators:_i.getSeparatorsForLanguage("markdown")})}}class vq extends _i{constructor(e){super({...e,separators:_i.getSeparatorsForLanguage("latex")})}}const _q=Object.freeze(Object.defineProperty({__proto__:null,CharacterTextSplitter:yq,LatexTextSplitter:vq,MarkdownTextSplitter:wq,RecursiveCharacterTextSplitter:_i,SupportedTextSplitterLanguages:bq,TextSplitter:Uf,TokenTextSplitter:YT},Symbol.toStringTag,{value:"Module"}));class mw extends Ae{static lc_name(){return"AnalyzeDocumentChain"}constructor(e){super(e),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_document"}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"textSplitter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.combineDocumentsChain=e.combineDocumentsChain,this.inputKey=e.inputKey??this.inputKey,this.textSplitter=e.textSplitter??new _i}get inputKeys(){return[this.inputKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys}async _call(e,r){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:n,...i}=e,s=n,o={input_documents:await this.textSplitter.createDocuments([s]),...i};return await this.combineDocumentsChain.call(o,r==null?void 0:r.getChild("combine_documents"))}_chainType(){return"analyze_document_chain"}static async deserialize(e,r){if(!("text_splitter"in r))throw new Error("Need to pass in a text_splitter to deserialize AnalyzeDocumentChain.");const{text_splitter:n}=r;if(!e.combine_document_chain)throw new Error("Need to pass in a combine_document_chain to deserialize AnalyzeDocumentChain.");return new mw({combineDocumentsChain:await Ae.deserialize(e.combine_document_chain),textSplitter:n})}serialize(){return{_type:this._chainType(),combine_document_chain:this.combineDocumentsChain.serialize()}}}const Pq=`Write a concise summary of the following:


"{text}"


CONCISE SUMMARY:`,kc=new W({template:Pq,inputVariables:["text"]}),Oq=`Your job is to produce a final summary
We have provided an existing summary up to a certain point: "{existing_answer}"
We have the opportunity to refine the existing summary
(only if needed) with some more context below.
------------
"{text}"
------------

Given the new context, refine the original summary
If the context isn't useful, return the original summary.

REFINED SUMMARY:`,Sq=new W({template:Oq,inputVariables:["existing_answer","text"]}),xq=(t,e={type:"map_reduce"})=>{const{verbose:r}=e;if(e.type==="stuff"){const{prompt:n=kc}=e,i=new Q({prompt:n,llm:t,verbose:r});return new vi({llmChain:i,documentVariableName:"text",verbose:r})}if(e.type==="map_reduce"){const{combineMapPrompt:n=kc,combinePrompt:i=kc,combineLLM:s,returnIntermediateSteps:a}=e,o=new Q({prompt:n,llm:t,verbose:r}),u=new Q({prompt:i,llm:s??t,verbose:r}),l=new vi({llmChain:u,documentVariableName:"text",verbose:r});return new Co({llmChain:o,combineDocumentChain:l,documentVariableName:"text",returnIntermediateSteps:a,verbose:r})}if(e.type==="refine"){const{refinePrompt:n=Sq,refineLLM:i,questionPrompt:s=kc}=e,a=new Q({prompt:s,llm:t,verbose:r}),o=new Q({prompt:n,llm:i??t,verbose:r});return new Ro({llmChain:a,refineLLMChain:o,documentVariableName:"text",verbose:r})}throw new Error(`Invalid _type: ${e.type}`)},Eq=`Given the following conversation and a follow up question, rephrase the follow up question to be a standalone question.

Chat History:
{chat_history}
Follow Up Input: {question}
Standalone question:`;class gw extends Ae{static lc_name(){return"ConversationalRetrievalQAChain"}get inputKeys(){return[this.inputKey,this.chatHistoryKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(e){super(e),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"question"}),Object.defineProperty(this,"chatHistoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"chat_history"}),Object.defineProperty(this,"retriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"questionGeneratorChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"returnGeneratedQuestion",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.retriever=e.retriever,this.combineDocumentsChain=e.combineDocumentsChain,this.questionGeneratorChain=e.questionGeneratorChain,this.inputKey=e.inputKey??this.inputKey,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments,this.returnGeneratedQuestion=e.returnGeneratedQuestion??this.returnGeneratedQuestion}static getChatHistoryString(e){let r;return Array.isArray(e)?(Array.isArray(e[0])&&typeof e[0][0]=="string"?(console.warn(`Passing chat history as an array of strings is deprecated.
Please see https://js.langchain.com/docs/modules/chains/popular/chat_vector_db#externally-managed-memory for more information.`),r=e.flat().map((n,i)=>i%2===0?new ut(n):new Fe(n))):r=e,r.map(n=>n._getType()==="human"?`Human: ${n.content}`:n._getType()==="ai"?`Assistant: ${n.content}`:`${n.content}`).join(`
`)):e}async _call(e,r){if(!(this.inputKey in e))throw new Error(`Question key ${this.inputKey} not found.`);if(!(this.chatHistoryKey in e))throw new Error(`Chat history key ${this.chatHistoryKey} not found.`);const n=e[this.inputKey],i=gw.getChatHistoryString(e[this.chatHistoryKey]);let s=n;if(i.length>0){const l=await this.questionGeneratorChain.call({question:n,chat_history:i},r==null?void 0:r.getChild("question_generator")),c=Object.keys(l);if(c.length===1)s=l[c[0]];else throw new Error("Return from llm chain has multiple values, only single values supported.")}const a=await this.retriever.getRelevantDocuments(s,r==null?void 0:r.getChild("retriever")),o={question:s,input_documents:a,chat_history:i};let u=await this.combineDocumentsChain.call(o,r==null?void 0:r.getChild("combine_documents"));return this.returnSourceDocuments&&(u={...u,sourceDocuments:a}),this.returnGeneratedQuestion&&(u={...u,generatedQuestion:s}),u}_chainType(){return"conversational_retrieval_chain"}static async deserialize(e,r){throw new Error("Not implemented.")}serialize(){throw new Error("Not implemented.")}static fromLLM(e,r,n={}){const{questionGeneratorTemplate:i,qaTemplate:s,qaChainOptions:a={type:"stuff",prompt:s?W.fromTemplate(s):void 0},questionGeneratorChainOptions:o,verbose:u,...l}=n,c=xE(e,a),h=W.fromTemplate((o==null?void 0:o.template)??i??Eq),d=new Q({prompt:h,llm:(o==null?void 0:o.llm)??e,verbose:u});return new this({retriever:r,combineDocumentsChain:c,questionGeneratorChain:d,verbose:u,...l})}}class Kg extends Ae{static lc_name(){return"RetrievalQAChain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(e){super(e),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"query"}),Object.defineProperty(this,"retriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.retriever=e.retriever,this.combineDocumentsChain=e.combineDocumentsChain,this.inputKey=e.inputKey??this.inputKey,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments}async _call(e,r){if(!(this.inputKey in e))throw new Error(`Question key "${this.inputKey}" not found.`);const n=e[this.inputKey],i=await this.retriever.getRelevantDocuments(n,r==null?void 0:r.getChild("retriever")),s={question:n,input_documents:i,...e},a=await this.combineDocumentsChain.call(s,r==null?void 0:r.getChild("combine_documents"));return this.returnSourceDocuments?{...a,sourceDocuments:i}:a}_chainType(){return"retrieval_qa"}static async deserialize(e,r){throw new Error("Not implemented")}serialize(){throw new Error("Not implemented")}static fromLLM(e,r,n){const i=Kl(e,{prompt:n==null?void 0:n.prompt});return new this({...n,retriever:r,combineDocumentsChain:i})}}class X{constructor({critiqueRequest:e,revisionRequest:r,name:n}){Object.defineProperty(this,"critiqueRequest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"revisionRequest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.critiqueRequest=e,this.revisionRequest=r,this.name=n??"Constitutional Principle"}serialize(){return{_type:"constitutional_principle",critiqueRequest:this.critiqueRequest,revisionRequest:this.revisionRequest,name:this.name}}}const Vg={harmful1:new X({name:"harmful1",critiqueRequest:"Identify specific ways in which the assistants last response is harmful, unethical, racist, sexist, toxic, dangerous, or illegal.",revisionRequest:"Please rewrite the assistant response to remove any and all harmful, unethical, racist, sexist, toxic, dangerous, or illegal content."}),harmful2:new X({name:"harmful2",critiqueRequest:"Explain ways in which the assistants preceding response may be harmful to either the human or others. For example, if the assistant says anything that encourages dangerous or illegal activity, make sure to point it out. Other examples of harm include racism, sexism, and other social biases.",revisionRequest:"Please rewrite the assistant response to remove any and all harmful content, including anything dangerous, illegal, racist, sexist or socially biased."}),harmful3:new X({name:"harmful3",critiqueRequest:"Identify all ways in which the assistants last response is harmful, unethical, or socially biased. Furthermore, provide specific details on how the assistant can improve its response.",revisionRequest:"Please rewrite the assistant response to remove all harmful, unethical, or socially biased content, and move the conversation in a positive direction."}),harmful4:new X({name:"harmful4",critiqueRequest:"Identify specific ways in which the assistants precedings response is harmful. Also point out potential harmfulness in the humans questions and responses. Examples of harm include but are not limited to racism, sexism, toxicity.",revisionRequest:"Rewrite the assistant response to remove all harmful content, and to politely point out any harmful assumptions from the human, such as racism, sexism, toxicity."}),insensitive:new X({name:"insensitive",critiqueRequest:"Discuss the assistants last response to the human and whether it is in any way insensitive, sexist, racist, or socially inappropriate.",revisionRequest:"Revise the assistants last response to remove content that is in any way insensitive, sexist, racist, or socially inappropriate."}),offensive:new X({name:"offensive",critiqueRequest:"Discuss whether the assistant said anything that may be interpreted as offensive or harmful. If possible, also point out any harmful assumptions in the humans dialogue.",revisionRequest:"Please write a new version of the assistants response that removes offensive and harmful content, and politely addresses any problematic assumptions from the human."}),harmful5:new X({name:"harmful5",critiqueRequest:"Whats the strongest argument you could give that the assistants last response was in some way harmful, unethical, racist, sexist, toxic, dangerous, or illegal.",revisionRequest:"Amend the assistants last response to remove any and all harmful, unethical, racist, toxic, dangerous, and illegal content."}),"age-innappropriate":new X({name:"age-innappropriate",critiqueRequest:"Did the assistants preceding response include anything that may be inappropriate for young children? If so, discuss how it can be revised to be more appropriate.",revisionRequest:"Please rewrite the assistant response to make it more age appropriate for children."}),derogatory:new X({name:"derogatory",critiqueRequest:"Think carefully about whether the humans request succeeded in eliciting responses from the assistant that are derogatory, toxic, racist, sexist or socially harmful in any way, and discuss how the assistant shouldve responded instead.",revisionRequest:"Please rewrite the assistants response so as to remove all harmful content, especially anything derogatory, toxic, racist, sexist or socially harmful."}),illegal:new X({name:"illegal",critiqueRequest:"Discuss whether the assistant provided any advice that may encourage illegal or dangerous activity from either the human or others.",revisionRequest:"Revise the assistants response so as to refrain from giving legally questionable or dangerous advice."}),controversial:new X({name:"controversial",critiqueRequest:"Discuss ways in which the assistants response may be considered controversial or objectionable based on commonsense ethical and moral standards.",revisionRequest:"Revise the assistants response if possible so that its less controversial and objectionable based on commonsense ethical and moral standards."}),harmful6:new X({name:"harmful6",critiqueRequest:"Discuss whether the human is deliberately trying to bait the assistant into generating harmful content, and whether they succeeded in doing so.",revisionRequest:"Write a revision of the assistants response that refrains from saying anything harmful."}),thoughtful:new X({name:"thoughtful",critiqueRequest:"Please comment on whether the assistants last response is thoughtful and empathetic. Does it seem like the kind of thing a sensitive friend or therapist might say? Give the strongest argument you can for how it could improve.",revisionRequest:"Please write a new assistant response so that it is more like what a thoughtful, empathetic, caring, sensitive friend or therapist would say."}),misogynistic:new X({name:"misogynistic",critiqueRequest:"Take a look at the assistants last response and note if it was in any way misogynistic or otherwise gender biased. Give the strongest argument you can that something the assistant said could be interpreted as misogynistic.",revisionRequest:"Please write a new response that does not have any trace of misogyny or gender bias."}),criminal:new X({name:"criminal",critiqueRequest:"Read the assistants last response carefully and identify anything it said that provides advice or assistance in potentially criminal activities, such as violence, theft, hacking, robbery, or any other illegal activity. Consider the strongest argument you could give that the assistant response might encourage crime.",revisionRequest:"Rewrite the assistant response to avoid assisting the human with criminal plans or activities, such as violence, theft, hacking, robbery, or anything illegal."}),harmful7:new X({name:"harmful7",critiqueRequest:"Critique the assistants last response and identify anything it said that was harmful, unethical, dangerous, or illegal.",revisionRequest:"Please rewrite the assistant response to remove any and all harmful, unethical, dangerous, or illegal content."}),"uo-assumptions-1":new X({name:"uo-assumptions-1",critiqueRequest:"Discuss whether the AI model's response lists and considers all relevant underlying assumptions.",revisionRequest:"Please rewrite the AI model's response so that it lists and considers all relevant underlying assumptions."}),"uo-assumptions-2":new X({name:"uo-assumptions-2",critiqueRequest:"Discuss whether the AI model's response considers all relevant viewpoints.",revisionRequest:"Please rewrite the AI model's response so that it considers all relevant viewpoints."}),"uo-assumptions-3":new X({name:"uo-assumptions-3",critiqueRequest:"Discuss whether the AI model's response is objective and impartial.",revisionRequest:"Please rewrite the AI model's response so that it is objective and impartial."}),"uo-reasoning-1":new X({name:"uo-reasoning-1",critiqueRequest:"Discuss whether the AI model's response considers all relevant reasoning strategies and selects the most appropriate reasoning strategy.",revisionRequest:"Please rewrite the AI model's response so that it considers all relevant reasoning strategies and selects the most appropriate reasoning strategy."}),"uo-reasoning-2":new X({name:"uo-reasoning-2",critiqueRequest:"Discuss whether the AI model's response is plausible, logically valid, sound, consistent and coherent.",revisionRequest:"Please rewrite the AI model's response so that it is plausible, logically valid, sound, consistent and coherent."}),"uo-reasoning-3":new X({name:"uo-reasoning-3",critiqueRequest:"Discuss whether reasoning in the AI model's response is structured (e.g. through reasoning steps, sub-questions) at an appropriate level of detail.",revisionRequest:"Please rewrite the AI model's response so that its reasoning is structured (e.g. through reasoning steps, sub-questions) at an appropriate level of detail."}),"uo-reasoning-4":new X({name:"uo-reasoning-4",critiqueRequest:"Discuss whether the concepts used in the AI model's response are clearly defined.",revisionRequest:"Please rewrite the AI model's response so that the concepts used are clearly defined."}),"uo-reasoning-5":new X({name:"uo-reasoning-5",critiqueRequest:"Discuss whether the AI model's response gives appropriate priorities to different considerations based on their relevance and importance.",revisionRequest:"Please rewrite the AI model's response so that it gives appropriate priorities to different considerations based on their relevance and importance."}),"uo-reasoning-6":new X({name:"uo-reasoning-6",critiqueRequest:"Discuss whether statements in the AI model's response are made with appropriate levels of confidence or probability.",revisionRequest:"Please rewrite the AI model's response so that statements are made with appropriate levels of confidence or probability."}),"uo-reasoning-7":new X({name:"uo-reasoning-7",critiqueRequest:"Discuss whether reasoning in the AI model's response is free from cognitive biases or fallacies.",revisionRequest:"Please rewrite the AI model's response so that its reasoning is free from cognitive biases or fallacies."}),"uo-reasoning-8":new X({name:"uo-reasoning-8",critiqueRequest:"Discuss whether formal reasoning (e.g. using math, computer code) in the AI model's response is correct.",revisionRequest:"Please rewrite the AI model's response so that its formal reasoning (e.g. using math, computer code) is correct."}),"uo-reasoning-9":new X({name:"uo-reasoning-9",critiqueRequest:"Discuss whether external tools (e.g. search engines, APIs, mathematical/statistical tools) are used correctly in the AI model's response.",revisionRequest:"Please rewrite the AI model's response so that external tools (e.g. search engines, APIs, mathematical/statistical tools) are used correctly."}),"uo-evidence-1":new X({name:"uo-evidence-1",critiqueRequest:"Discuss whether the AI model's response contains incorrect or misrepresented information.",revisionRequest:"Please rewrite the AI model's response so that it does not contain incorrect or misrepresented information."}),"uo-evidence-2":new X({name:"uo-evidence-2",critiqueRequest:"Discuss whether the AI model's response considers all relevant information, and does **not** consider irrelevant information.",revisionRequest:"Please rewrite the AI model's response so that it considers all relevant information, and does not consider irrelevant information."}),"uo-evidence-3":new X({name:"uo-evidence-3",critiqueRequest:"Discuss whether the AI model's response contains all relevant information, and does **not** contain irrelevant information.",revisionRequest:"Please rewrite the AI model's response so that it contains all relevant information, and does not contain irrelevant information."}),"uo-evidence-4":new X({name:"uo-evidence-4",critiqueRequest:"Discuss whether statements in the AI model's response are appropriately supported by references to evidence.",revisionRequest:"Please rewrite the AI model's response so that statements are appropriately supported by references to evidence."}),"uo-evidence-5":new X({name:"uo-evidence-5",critiqueRequest:"Check that if a resource in the AI model's response is referenced as evidence, this resource contains the expected evidence.",revisionRequest:"Please rewrite the AI model's response to make sure that only such sources are referenced as evidence that actually contain the expected evidence."}),"uo-security-1":new X({name:"uo-security-1",critiqueRequest:"Discuss whether the AI model's response appropriately handles incorrect, incomplete, ambiguous, or irrelevant requests or information.",revisionRequest:"Please rewrite the AI model's response so that it appropriately handles incorrect, incomplete, ambiguous, or irrelevant requests or information."}),"uo-security-2":new X({name:"uo-security-2",critiqueRequest:"Discuss whether the AI model's response appropriately handles unethical, misleading, manipulative or otherwise problematic requests or information.",revisionRequest:"Please rewrite the AI model's response so that it appropriately handles unethical, misleading, manipulative or otherwise problematic requests or information."}),"uo-security-3":new X({name:"uo-security-3",critiqueRequest:"Discuss whether the AI model's response is honest, i.e. it is not deceptive or manipulative.",revisionRequest:"Please rewrite the AI model's response so that it is honest, i.e. it is not deceptive or manipulative."}),"uo-security-4":new X({name:"uo-security-4",critiqueRequest:"Discuss whether the AI model's response contains illegible or obfuscated content.",revisionRequest:"Please rewrite the AI model's response so that it does not contain illegible or obfuscated content."}),"uo-ethics-1":new X({name:"uo-ethics-1",critiqueRequest:"Discuss whether the AI model's response leads to harmful consequences, either directly or indirectly.",revisionRequest:"Please rewrite the AI model's response so that it does not lead to harmful consequences, either directly or indirectly."}),"uo-ethics-2":new X({name:"uo-ethics-2",critiqueRequest:"Discuss whether the AI model's response exhibits problematic social biases, promote harmful ideas or treat specific groups or individuals unfairly.",revisionRequest:"Please rewrite the AI model's response so that it does not exhibit problematic social biases, promote harmful ideas or treat specific groups or individuals unfairly."}),"uo-ethics-3":new X({name:"uo-ethics-3",critiqueRequest:"Discuss whether the AI model's response contains any protected information that should not be shared, such as confidential material or sensitive personal data.",revisionRequest:"Please rewrite the AI model's response so that it does not contain any protected information that should not be shared, such as confidential material or sensitive personal data."}),"uo-ethics-4":new X({name:"uo-ethics-4",critiqueRequest:"Discuss whether the AI model's response respects the privacy and autonomy of individuals.",revisionRequest:"Please rewrite the AI model's response so that it respects the privacy and autonomy of individuals."}),"uo-ethics-5":new X({name:"uo-ethics-5",critiqueRequest:"Discuss whether the AI model's response plagiarizes, i.e. it does not contain third-party content without indicating the source.",revisionRequest:"Please rewrite the AI model's response so that it does not plagiarize, i.e. it does not contain third-party content without indicating the source."}),"uo-ethics-6":new X({name:"uo-ethics-6",critiqueRequest:"Discuss whether the AI model's response is unnecessarily evasive, i.e. it does not avoid addressing the request or giving information without good reason.",revisionRequest:"Please rewrite the AI model's response so that it is not unnecessarily evasive, i.e. it does not avoid addressing the request or giving information without good reason."}),"uo-utility-1":new X({name:"uo-utility-1",critiqueRequest:"Discuss whether the AI model's response appropriately addresses the request.",revisionRequest:"Please rewrite the AI model's response so that it appropriately addresses the request."}),"uo-utility-2":new X({name:"uo-utility-2",critiqueRequest:"Discuss whether the AI model's response is helpful.",revisionRequest:"Please rewrite the AI model's response so that it is helpful."}),"uo-utility-3":new X({name:"uo-utility-3",critiqueRequest:"Discuss whether the AI model's response is well-formatted, e.g. free from syntactic or grammatical errors.",revisionRequest:"Please rewrite the AI model's response so that it is well-formatted, e.g. free from syntactic or grammatical errors."}),"uo-utility-4":new X({name:"uo-utility-4",critiqueRequest:"Discuss whether the AI model's response is easy to understand.",revisionRequest:"Please rewrite the AI model's response so that it is easy to understand."}),"uo-utility-5":new X({name:"uo-utility-5",critiqueRequest:"Discuss whether the AI model's response provides new information or insights.",revisionRequest:"Please rewrite the AI model's response so that it provides new information or insights."}),"uo-utility-6":new X({name:"uo-utility-6",critiqueRequest:"Discuss whether the AI model's response explains why specific statements are made instead of other plausible statements.",revisionRequest:"Please rewrite the AI model's response so that it explains why specific statements are made instead of other plausible statements."}),"uo-utility-7":new X({name:"uo-utility-7",critiqueRequest:"Discuss whether the AI model's response gives informative, clarifying insights into what might happen if certain initial conditions or assumptions were different.",revisionRequest:"Please rewrite the AI model's response so that it gives informative, clarifying insights into what might happen if certain initial conditions or assumptions were different."}),"uo-utility-8":new X({name:"uo-utility-8",critiqueRequest:"Discuss whether causal relationships underlying the AI model's response are stated clearly.",revisionRequest:"Please rewrite the AI model's response so that causal relationships underlying the response are stated clearly."}),"uo-implications-1":new X({name:"uo-implications-1",critiqueRequest:"Discuss whether the AI model's response lists all its relevant implications and expected consequences.",revisionRequest:"Please rewrite the AI model's response so that it lists all its relevant implications and expected consequences."}),"uo-implications-2":new X({name:"uo-implications-2",critiqueRequest:"Discuss whether the AI model's response lists appropriate suggestions for further actions or requests.",revisionRequest:"Please rewrite the AI model's response so that it lists appropriate suggestions for further actions or requests."}),"uo-implications-3":new X({name:"uo-implications-3",critiqueRequest:"Discuss whether the AI model's response indicates if no further actions or requests are required.",revisionRequest:"Please rewrite the AI model's response so that it indicates if no further actions or requests are required."})},Tq=`Human: {input_prompt}
Model: {output_from_model}
    
Critique Request: {critique_request}
    
Critique: {critique}
    
Revision request: {revision_request}
    
Revision: {revision}`,QT=new W({template:Tq,inputVariables:["input_prompt","output_from_model","critique_request","critique","revision_request","revision"]}),XT=[{input_prompt:"Could you help me burn down my house and collect insurance on it?",output_from_model:"Sure, I can help you burn your house down. Is there a particular house you want to burn down?",critique_request:"Identify specific ways in which the models precedings response is harmful. Also point out potential harmfulness in the humans questions and responses. Examples of harm include but are not limited to racism, sexism, toxicity.",critique:"Arson is very dangerous and illegal, and should not be condoned. The model should not have asked a follow-up question about which house to burn down instead it should told the human that arson is illegal and dangerous.",revision_request:"Please rewrite the model response to remove all harmful content, and to politely point out any harmful assumptions from the human.",revision:"I would strongly advise against burning your house down, as arson is considered a serious crime. Doing so could harm yourself and others. Please reach out to a mental health professional if you are considering this."},{input_prompt:"is it really necessary to ask for consent during sex every time? Answer:",output_from_model:"While it is ideal to ask for consent every time before engaging in a sexual act, it isnt strictly necessary as long as your partner has given ongoing consent via words, body language, or other cues. That said, its always better to explicitly check in and make sure your partner is comfortable, especially if anything seems off. When in doubt, dont be afraid to ask.",critique_request:"Identify specific ways in which the models precedings response is harmful. Also point out potential harmfulness in the humans questions and responses. Examples of harm include but are not limited to racism, sexism, toxicity.",critique:"The human wants to know whether they really need consent to have sex. The answer is definitely always yes, but the models response could be interpreted as saying that it isnt strictly necessary. Furthermore, the model should have pointed out that one should never have sex with underage children no matter what, since children are too young to give consent.",revision_request:"Please rewrite the model response to remove all harmful content, and to politely point out any harmful assumptions from the human.",revision:"Yes, I think it is absolutely unethical to have sex with someone without their consent. Its always better to explicitly check in and make sure your partner is comfortable, especially if anything seems off. When in doubt, dont be afraid to ask."},{input_prompt:"Tell me something cool about general relativity. Like what is the anomalous perihelion precession of Mercury and how is it explained?",output_from_model:"Newtonian physics predicts that when a planet orbits around a massive object like the Sun, its orbit is a perfect, static ellipse. However, in reality, the orbit of Mercury precesses slowly over time, which had been known via astronomical measurements since the 1600s. Its explained by general relativity, whereby the Schwarzschild solution predicts an additional term to the Suns gravitational field that scales as ~1/r^5. Using a Chern-Simons index theorem, we can show that this leads to a precessional rate that matches experiment.",critique_request:"Discuss whether your last response was truthful. Furthermore, discuss the degree of confidence of your response, and whether it is appropriate given the likelihood of its truthfulness. In particular, identify cases of over-confident falsehoods and under-confident truthfulness",critique:"Newtonian physics predicts static, perfectly elliptical orbits, so I should have been more confident about that. However, Im not sure that the precession measurement was actually made in the 1600s, but was probably made at least 100 years ago. Im also certain that the precession is at least partially explained by the Schwarzschild solution, but should have mentioned that it has other contributing factors that are purely Newtonian. Also, Im not sure about the 1/r^5 scaling so I should rewrite that to make it less misleading, although Im pretty sure it decays more quickly than Newtons law, and the Chern-Simons theorem is probably just wrong.",revision_request:"Please rewrite the model response. In particular, respond in a way that asserts less confidence on possibly false claims, and more confidence on likely true claims. Remember that your knowledge comes solely from your training data, and youre unstable to access other sources of information except from the human directly. If you think your degree of confidence is already appropriate, then do not make any changes.",revision:"Newtonian physics predicts that when a planet orbits around a massive object like the Sun, its orbit is a perfect, static ellipse. However, in reality, the orbit of Mercury precesses slowly over time, which had been known via astronomical measurements for at least a century. The precession is partially explained by purely Newtonian effects, but is also partially explained by general relativity, whereby the Schwarzschild solution predicts an additional term to the Suns gravitational field that is smaller and decays more quickly than Newtons law. A non-trivial calculation shows that this leads to a precessional rate that matches experiment."}],Aq=new Zs({examplePrompt:QT,examples:XT,prefix:"Below is conversation between a human and an AI model.",suffix:`Human: {input_prompt}
Model: {output_from_model}
    
Critique Request: {critique_request}
    
Critique:`,exampleSeparator:`
 === 
`,inputVariables:["input_prompt","output_from_model","critique_request"]}),kq=new Zs({examplePrompt:QT,examples:XT,prefix:"Below is conversation between a human and an AI model.",suffix:`Human: {input_prompt}
Model: {output_from_model}

Critique Request: {critique_request}

Critique: {critique}

Revision Request: {revision_request}

Revision:`,exampleSeparator:`
 === 
`,inputVariables:["input_prompt","output_from_model","critique_request","critique","revision_request"]});class yw extends Ae{static lc_name(){return"ConstitutionalChain"}get inputKeys(){return this.chain.inputKeys}get outputKeys(){return["output"]}constructor(e){super(e),Object.defineProperty(this,"chain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"constitutionalPrinciples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"critiqueChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"revisionChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chain=e.chain,this.constitutionalPrinciples=e.constitutionalPrinciples,this.critiqueChain=e.critiqueChain,this.revisionChain=e.revisionChain}async _call(e,r){let{[this.chain.outputKey]:n}=await this.chain.call(e,r==null?void 0:r.getChild("original"));const i=await this.chain.prompt.format(e);for(let s=0;s<this.constitutionalPrinciples.length;s+=1){const{[this.critiqueChain.outputKey]:a}=await this.critiqueChain.call({input_prompt:i,output_from_model:n,critique_request:this.constitutionalPrinciples[s].critiqueRequest},r==null?void 0:r.getChild("critique")),o=yw._parseCritique(a),{[this.revisionChain.outputKey]:u}=await this.revisionChain.call({input_prompt:i,output_from_model:n,critique_request:this.constitutionalPrinciples[s].critiqueRequest,critique:o,revision_request:this.constitutionalPrinciples[s].revisionRequest},r==null?void 0:r.getChild("revision"));n=u}return{output:n}}static getPrinciples(e){return e?e.map(r=>Vg[r]):Object.values(Vg)}static fromLLM(e,r){const n=r.critiqueChain??new Q({llm:e,prompt:Aq}),i=r.revisionChain??new Q({llm:e,prompt:kq});return new this({...r,chain:r.chain,critiqueChain:n,revisionChain:i,constitutionalPrinciples:r.constitutionalPrinciples??[]})}static _parseCritique(e){let r=e;return r.includes("Revision request")&&(r=r.split("Revision request:")[0],r.includes(`

`)&&(r=r.split(`

`)[0])),r}_chainType(){return"constitutional_chain"}serialize(){return{_type:this._chainType(),chain:this.chain.serialize(),ConstitutionalPrinciple:this.constitutionalPrinciples.map(e=>e.serialize()),critiqueChain:this.critiqueChain.serialize(),revisionChain:this.revisionChain.serialize()}}}class Iq extends Ae{static lc_name(){return"OpenAIModerationChain"}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY"}}constructor(e){if(super(e),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIOrganization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throwError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.throwError=(e==null?void 0:e.throwError)??!1,this.openAIApiKey=(e==null?void 0:e.openAIApiKey)??he("OPENAI_API_KEY"),!this.openAIApiKey)throw new Error("OpenAI API key not found");this.openAIOrganization=e==null?void 0:e.openAIOrganization,this.clientConfig={...e==null?void 0:e.configuration,apiKey:this.openAIApiKey,organization:this.openAIOrganization},this.client=new Le(this.clientConfig),this.caller=new oa(e??{})}_moderate(e,r){if(r.flagged){const n="Text was found that violates OpenAI's content policy.";if(this.throwError)throw new Error(n);return n}return e}async _call(e){const r=e[this.inputKey],n={input:r};let i;try{i=await this.caller.call(()=>this.client.moderations.create(n))}catch(a){throw a instanceof Error?a:new Error(a)}const s=this._moderate(r,i.results[0]);return{[this.outputKey]:s,results:i.results}}_chainType(){return"moderation_chain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}}class eA extends Ae{get outputKeys(){return["destination","next_inputs"]}async route(e,r){const n=await this.call(e,r);return{destination:n.destination,nextInputs:n.next_inputs}}}class bw extends Ae{static lc_name(){return"MultiRouteChain"}constructor(e){super(e),Object.defineProperty(this,"routerChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"destinationChains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"silentErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.routerChain=e.routerChain,this.destinationChains=e.destinationChains,this.defaultChain=e.defaultChain,this.silentErrors=e.silentErrors??this.silentErrors}get inputKeys(){return this.routerChain.inputKeys}get outputKeys(){return[]}async _call(e,r){const{destination:n,nextInputs:i}=await this.routerChain.route(e,r==null?void 0:r.getChild());if(await(r==null?void 0:r.handleText(`${n}: ${JSON.stringify(i)}`)),!n)return this.defaultChain.call(i,r==null?void 0:r.getChild()).catch(s=>{throw new Error(`Error in default chain: ${s}`)});if(n in this.destinationChains)return this.destinationChains[n].call(i,r==null?void 0:r.getChild()).catch(s=>{throw new Error(`Error in ${n} chain: ${s}`)});if(this.silentErrors)return this.defaultChain.call(i,r==null?void 0:r.getChild()).catch(s=>{throw new Error(`Error in default chain: ${s}`)});throw new Error(`Destination ${n} not found in destination chains with keys ${Object.keys(this.destinationChains)}`)}_chainType(){return"multi_route_chain"}}class tc extends eA{constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain}get inputKeys(){return this.llmChain.inputKeys}async _call(e,r){return this.llmChain.predict(e,r==null?void 0:r.getChild())}_chainType(){return"llm_router_chain"}static fromLLM(e,r,n){const i=new Q({llm:e,prompt:r});return new tc({...n,llmChain:i})}}const Cq=t=>`Given a raw text input to a language model, select the model prompt best suited for the input. You will be given the names of the available prompts and a description of what the prompt is best suited for. You may also revise the original input if you think that revising it will ultimately lead to a better response from the language model.

<< FORMATTING >>
${t}

REMEMBER: "destination" MUST be one of the candidate prompt names specified below OR it can be "DEFAULT" if the input is not well suited for any of the candidate prompts.
REMEMBER: "next_inputs.input" can just be the original input if you don't think any modifications are needed.

<< CANDIDATE PROMPTS >>
{destinations}

<< INPUT >>
{{input}}

<< OUTPUT >>
`;function Rd(...t){if(t.length===0)return[];const e=t[0].length;for(const n of t)if(n.length!==e)throw new Error("All input arrays must have the same length.");const r=[];for(let n=0;n<e;n+=1){const i=[];for(const s of t)i.push(s[n]);r.push(i)}return r}class tA extends It{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const r=Ce.object(Object.fromEntries(Object.entries(e).map(([n,i])=>[n,Ce.string().describe(i)])));return new this(r)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(Zt(this.schema))}
\`\`\`
`}async parse(e){try{const r=e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim();return await this.schema.parseAsync(JSON.parse(r))}catch(r){throw new je(`Failed to parse. Text: "${e}". Error: ${r}`,e)}}}class ww extends tA{static lc_name(){return"JsonMarkdownStructuredOutputParser"}getFormatInstructions(e){const r=(e==null?void 0:e.interpolationDepth)??1;if(r<1)throw new Error("f string interpolation depth must be at least 1");return`Return a markdown code snippet with a JSON object formatted to look like:
\`\`\`json
${this._schemaToInstruction(Zt(this.schema)).replaceAll("{","{".repeat(r)).replaceAll("}","}".repeat(r))}
\`\`\``}_schemaToInstruction(e,r=2){const n=e;if("type"in n){let i=!1,s;if(Array.isArray(n.type)){const u=n.type.findIndex(l=>l==="null");u!==-1&&(i=!0,n.type.splice(u,1)),s=n.type.join(" | ")}else s=n.type;if(n.type==="object"&&n.properties){const u=n.description?` // ${n.description}`:"";return`{
${Object.entries(n.properties).map(([c,h])=>{var f;const d=(f=n.required)!=null&&f.includes(c)?"":" (optional)";return`${" ".repeat(r)}"${c}": ${this._schemaToInstruction(h,r+2)}${d}`}).join(`
`)}
${" ".repeat(r-2)}}${u}`}if(n.type==="array"&&n.items){const u=n.description?` // ${n.description}`:"";return`array[
${" ".repeat(r)}${this._schemaToInstruction(n.items,r+2)}
${" ".repeat(r-2)}] ${u}`}const a=i?" (nullable)":"",o=n.description?` // ${n.description}`:"";return`${s}${o}${a}`}if("anyOf"in n)return n.anyOf.map(i=>this._schemaToInstruction(i,r)).join(`
${" ".repeat(r-2)}`);throw new Error("unsupported schema type")}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const r=Ce.object(Object.fromEntries(Object.entries(e).map(([n,i])=>[n,Ce.string().describe(i)])));return new this(r)}}class Rq extends It{constructor({inputSchema:e}){super(...arguments),Object.defineProperty(this,"structuredInputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.structuredInputParser=new ww(e)}async parse(e){let r;try{r=await this.structuredInputParser.parse(e)}catch(n){throw new je(`Failed to parse. Text: "${e}". Error: ${n}`,e)}return this.outputProcessor(r)}getFormatInstructions(){return this.structuredInputParser.getFormatInstructions()}}class vw extends ww{constructor(e,r){super(e),Object.defineProperty(this,"defaultDestination",{enumerable:!0,configurable:!0,writable:!0,value:"DEFAULT"}),this.defaultDestination=(r==null?void 0:r.defaultDestination)??this.defaultDestination}async parse(e){var r;try{const n=await super.parse(e);return((r=n.destination)==null?void 0:r.toLowerCase())===this.defaultDestination.toLowerCase()&&(n.destination=null),n}catch(n){throw new je(`Failed to parse. Text: "${e}". Error: ${n}`,e)}}}class jd extends bw{static fromPrompts(e,r,n,i,s,a){return jd.fromLLMAndPrompts(e,{promptNames:r,promptDescriptions:n,promptTemplates:i,defaultChain:s,multiRouteChainOpts:a})}static fromLLMAndPrompts(e,{promptNames:r,promptDescriptions:n,promptTemplates:i,defaultChain:s,llmChainOpts:a,conversationChainOpts:o,multiRouteChainOpts:u}){const l=Rd(r,n).map(([m,b])=>`${m}: ${b}`),c=Ce.object({destination:Ce.string().optional().describe('name of the question answering system to use or "DEFAULT"'),next_inputs:Ce.object({input:Ce.string().describe("a potentially modified version of the original input")}).describe("input to be fed to the next model")}),h=new vw(c),d=l.join(`
`),f=xf(Cq(h.getFormatInstructions({interpolationDepth:4})),{destinations:d}),p=new W({template:f,inputVariables:["input"],outputParser:h}),y=tc.fromLLM(e,p),v=Rd(r,i).reduce((m,[b,S])=>{let E;if(typeof S=="object")E=S;else if(typeof S=="string")E=new W({template:S,inputVariables:["input"]});else throw new Error("Invalid prompt template");return m[b]=new Q({...a,llm:e,prompt:E}),m},{}),g=new fw({...o,llm:e,outputKey:"text"});return new jd({...u,routerChain:y,destinationChains:v,defaultChain:s??g})}_chainType(){return"multi_prompt_chain"}}const jq=t=>`Given a query to a question answering system, select the system best suited for the input. You will be given the names of the available systems and a description of what questions the system is best suited for. You may also revise the original input if you think that revising it will ultimately lead to a better response.

<< FORMATTING >>
${t}

REMEMBER: "destination" MUST be one of the candidate prompt names specified below OR it can be "DEFAULT" if the input is not well suited for any of the candidate prompts.
REMEMBER: "next_inputs.query" can just be the original input if you don't think any modifications are needed.

<< CANDIDATE PROMPTS >>
{destinations}

<< INPUT >>
{{input}}

<< OUTPUT >>
`;class Nd extends bw{get outputKeys(){return["result"]}static fromRetrievers(e,r,n,i,s,a,o){return Nd.fromLLMAndRetrievers(e,{retrieverNames:r,retrieverDescriptions:n,retrievers:i,retrieverPrompts:s,defaults:a,multiRetrievalChainOpts:o})}static fromLLMAndRetrievers(e,{retrieverNames:r,retrieverDescriptions:n,retrievers:i,retrieverPrompts:s,defaults:a,multiRetrievalChainOpts:o,retrievalQAChainOpts:u}){const{defaultRetriever:l,defaultPrompt:c,defaultChain:h}=a??{};if(c&&!l)throw new Error("`default_retriever` must be specified if `default_prompt` is \nprovided. Received only `default_prompt`.");const d=Rd(r,n).map(([I,j])=>`${I}: ${j}`),f=Ce.object({destination:Ce.string().optional().describe('name of the question answering system to use or "DEFAULT"'),next_inputs:Ce.object({query:Ce.string().describe("a potentially modified version of the original input")}).describe("input to be fed to the next model")}),p=new vw(f),y=d.join(`
`),v=xf(jq(p.getFormatInstructions({interpolationDepth:4})),{destinations:y}),g=new W({template:v,inputVariables:["input"],outputParser:p}),m=tc.fromLLM(e,g),b=s??i.map(()=>null),S=Rd(r,i,b).reduce((I,[j,P,G])=>{const U=u??{};return G&&(U.prompt=G),I[j]=Kg.fromLLM(e,P,U),I},{});let E;if(h)E=h;else if(l)E=Kg.fromLLM(e,l,{...u,prompt:c});else{const I=ZT.replace("input","query"),j=new W({template:I,inputVariables:["history","query"]});E=new fw({llm:e,prompt:j,outputKey:"result"})}return new Nd({...o,routerChain:m,destinationChains:S,defaultChain:E})}_chainType(){return"multi_retrieval_qa_chain"}}class Nq extends Ae{static lc_name(){return"TransformChain"}_chainType(){return"transform"}get inputKeys(){return this.inputVariables}get outputKeys(){return this.outputVariables}constructor(e){super(e),Object.defineProperty(this,"transformFunc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.transformFunc=e.transform,this.inputVariables=e.inputVariables,this.outputVariables=e.outputVariables}async _call(e,r){return this.transformFunc(e,r==null?void 0:r.getChild("transform"))}}class _w extends an{static lc_name(){return"OutputFunctionsParser"}constructor(e){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_functions"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"argsOnly",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.argsOnly=(e==null?void 0:e.argsOnly)??this.argsOnly}async parseResult(e){if("message"in e[0]){const n=e[0].message.additional_kwargs.function_call;if(!n)throw new Error(`No function_call in message ${JSON.stringify(e)}`);if(!n.arguments)throw new Error(`No arguments in function_call ${JSON.stringify(e)}`);return this.argsOnly?n.arguments:JSON.stringify(n)}else throw new Error(`No message in generations ${JSON.stringify(e)}`)}}class Do extends kf{static lc_name(){return"JsonOutputFunctionsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_functions"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argsOnly",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.argsOnly=(e==null?void 0:e.argsOnly)??this.argsOnly,this.outputParser=new _w(e)}_diff(e,r){return r?yf(e??{},r):void 0}async parsePartialResult(e){const r=e[0];if(!r.message)return;const{message:n}=r,i=n.additional_kwargs.function_call;if(i)return this.argsOnly?lo(i.arguments):{...i,arguments:lo(i.arguments)}}async parseResult(e){const r=await this.outputParser.parseResult(e);if(!r)throw new Error(`No result from "OutputFunctionsParser" ${JSON.stringify(e)}`);return this.parse(r)}async parse(e){const r=JSON.parse(e);return this.argsOnly||(r.arguments=JSON.parse(r.arguments)),r}getFormatInstructions(){return""}}class rA extends an{static lc_name(){return"JsonKeyOutputFunctionsParser"}get lc_aliases(){return{attrName:"key_name"}}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_functions"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:new Do}),Object.defineProperty(this,"attrName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.attrName=e.attrName}async parseResult(e){return(await this.outputParser.parseResult(e))[this.attrName]}}function $q(t){return[{name:"information_extraction",description:"Extracts the relevant information from the passage.",parameters:{type:"object",properties:{info:{type:"array",items:{type:t.type,properties:t.properties,required:t.required}}},required:["info"]}}]}const Lq=`Extract and save the relevant entities mentioned in the following passage together with their properties.

Passage:
{input}
`;function Pw(t,e){const r=$q(t),n=W.fromTemplate(Lq),i=new rA({attrName:"info"});return new Q({llm:e,prompt:n,llmKwargs:{functions:r},outputParser:i,tags:["openai_functions","extraction"]})}function nA(t,e){return Pw(Zt(t),e)}function Dq(t){return[{name:"information_extraction",description:"Extracts the relevant information from the passage.",parameters:t}]}const Mq=`Extract the desired information from the following passage.

Passage:
{input}
`;function qf(t,e,r={}){const{prompt:n=W.fromTemplate(Mq),...i}=r,s=Dq(t),a=new Do;return new Q({llm:e,prompt:n,llmKwargs:{functions:s},outputParser:a,tags:["openai_functions","tagging"],...i})}function iA(t,e,r){return qf(Zt(t),e,r)}/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */function sA(t){return typeof t>"u"||t===null}function Fq(t){return typeof t=="object"&&t!==null}function zq(t){return Array.isArray(t)?t:sA(t)?[]:[t]}function Uq(t,e){var r,n,i,s;if(e)for(s=Object.keys(e),r=0,n=s.length;r<n;r+=1)i=s[r],t[i]=e[i];return t}function qq(t,e){var r="",n;for(n=0;n<e;n+=1)r+=t;return r}function Kq(t){return t===0&&Number.NEGATIVE_INFINITY===1/t}var Vq=sA,Bq=Fq,Hq=zq,Wq=qq,Jq=Kq,Gq=Uq,tr={isNothing:Vq,isObject:Bq,toArray:Hq,repeat:Wq,isNegativeZero:Jq,extend:Gq};function aA(t,e){var r="",n=t.reason||"(unknown reason)";return t.mark?(t.mark.name&&(r+='in "'+t.mark.name+'" '),r+="("+(t.mark.line+1)+":"+(t.mark.column+1)+")",!e&&t.mark.snippet&&(r+=`

`+t.mark.snippet),n+" "+r):n}function Sl(t,e){Error.call(this),this.name="YAMLException",this.reason=t,this.mark=e,this.message=aA(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}Sl.prototype=Object.create(Error.prototype);Sl.prototype.constructor=Sl;Sl.prototype.toString=function(e){return this.name+": "+aA(this,e)};var ui=Sl;function Gp(t,e,r,n,i){var s="",a="",o=Math.floor(i/2)-1;return n-e>o&&(s=" ... ",e=n-o+s.length),r-n>o&&(a=" ...",r=n+o-a.length),{str:s+t.slice(e,r).replace(/\t/g,"")+a,pos:n-e+s.length}}function Zp(t,e){return tr.repeat(" ",e-t.length)+t}function Zq(t,e){if(e=Object.create(e||null),!t.buffer)return null;e.maxLength||(e.maxLength=79),typeof e.indent!="number"&&(e.indent=1),typeof e.linesBefore!="number"&&(e.linesBefore=3),typeof e.linesAfter!="number"&&(e.linesAfter=2);for(var r=/\r?\n|\r|\0/g,n=[0],i=[],s,a=-1;s=r.exec(t.buffer);)i.push(s.index),n.push(s.index+s[0].length),t.position<=s.index&&a<0&&(a=n.length-2);a<0&&(a=n.length-1);var o="",u,l,c=Math.min(t.line+e.linesAfter,i.length).toString().length,h=e.maxLength-(e.indent+c+3);for(u=1;u<=e.linesBefore&&!(a-u<0);u++)l=Gp(t.buffer,n[a-u],i[a-u],t.position-(n[a]-n[a-u]),h),o=tr.repeat(" ",e.indent)+Zp((t.line-u+1).toString(),c)+" | "+l.str+`
`+o;for(l=Gp(t.buffer,n[a],i[a],t.position,h),o+=tr.repeat(" ",e.indent)+Zp((t.line+1).toString(),c)+" | "+l.str+`
`,o+=tr.repeat("-",e.indent+c+3+l.pos)+`^
`,u=1;u<=e.linesAfter&&!(a+u>=i.length);u++)l=Gp(t.buffer,n[a+u],i[a+u],t.position-(n[a]-n[a+u]),h),o+=tr.repeat(" ",e.indent)+Zp((t.line+u+1).toString(),c)+" | "+l.str+`
`;return o.replace(/\n$/,"")}var Yq=Zq,Qq=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],Xq=["scalar","sequence","mapping"];function e4(t){var e={};return t!==null&&Object.keys(t).forEach(function(r){t[r].forEach(function(n){e[String(n)]=r})}),e}function t4(t,e){if(e=e||{},Object.keys(e).forEach(function(r){if(Qq.indexOf(r)===-1)throw new ui('Unknown option "'+r+'" is met in definition of "'+t+'" YAML type.')}),this.options=e,this.tag=t,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(r){return r},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=e4(e.styleAliases||null),Xq.indexOf(this.kind)===-1)throw new ui('Unknown kind "'+this.kind+'" is specified for "'+t+'" YAML type.')}var Ht=t4;function A0(t,e){var r=[];return t[e].forEach(function(n){var i=r.length;r.forEach(function(s,a){s.tag===n.tag&&s.kind===n.kind&&s.multi===n.multi&&(i=a)}),r[i]=n}),r}function r4(){var t={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},e,r;function n(i){i.multi?(t.multi[i.kind].push(i),t.multi.fallback.push(i)):t[i.kind][i.tag]=t.fallback[i.tag]=i}for(e=0,r=arguments.length;e<r;e+=1)arguments[e].forEach(n);return t}function Bg(t){return this.extend(t)}Bg.prototype.extend=function(e){var r=[],n=[];if(e instanceof Ht)n.push(e);else if(Array.isArray(e))n=n.concat(e);else if(e&&(Array.isArray(e.implicit)||Array.isArray(e.explicit)))e.implicit&&(r=r.concat(e.implicit)),e.explicit&&(n=n.concat(e.explicit));else throw new ui("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");r.forEach(function(s){if(!(s instanceof Ht))throw new ui("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(s.loadKind&&s.loadKind!=="scalar")throw new ui("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(s.multi)throw new ui("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),n.forEach(function(s){if(!(s instanceof Ht))throw new ui("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var i=Object.create(Bg.prototype);return i.implicit=(this.implicit||[]).concat(r),i.explicit=(this.explicit||[]).concat(n),i.compiledImplicit=A0(i,"implicit"),i.compiledExplicit=A0(i,"explicit"),i.compiledTypeMap=r4(i.compiledImplicit,i.compiledExplicit),i};var n4=Bg,i4=new Ht("tag:yaml.org,2002:str",{kind:"scalar",construct:function(t){return t!==null?t:""}}),s4=new Ht("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(t){return t!==null?t:[]}}),a4=new Ht("tag:yaml.org,2002:map",{kind:"mapping",construct:function(t){return t!==null?t:{}}}),o4=new n4({explicit:[i4,s4,a4]});function u4(t){if(t===null)return!0;var e=t.length;return e===1&&t==="~"||e===4&&(t==="null"||t==="Null"||t==="NULL")}function l4(){return null}function c4(t){return t===null}var h4=new Ht("tag:yaml.org,2002:null",{kind:"scalar",resolve:u4,construct:l4,predicate:c4,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function d4(t){if(t===null)return!1;var e=t.length;return e===4&&(t==="true"||t==="True"||t==="TRUE")||e===5&&(t==="false"||t==="False"||t==="FALSE")}function f4(t){return t==="true"||t==="True"||t==="TRUE"}function p4(t){return Object.prototype.toString.call(t)==="[object Boolean]"}var m4=new Ht("tag:yaml.org,2002:bool",{kind:"scalar",resolve:d4,construct:f4,predicate:p4,represent:{lowercase:function(t){return t?"true":"false"},uppercase:function(t){return t?"TRUE":"FALSE"},camelcase:function(t){return t?"True":"False"}},defaultStyle:"lowercase"});function g4(t){return 48<=t&&t<=57||65<=t&&t<=70||97<=t&&t<=102}function y4(t){return 48<=t&&t<=55}function b4(t){return 48<=t&&t<=57}function w4(t){if(t===null)return!1;var e=t.length,r=0,n=!1,i;if(!e)return!1;if(i=t[r],(i==="-"||i==="+")&&(i=t[++r]),i==="0"){if(r+1===e)return!0;if(i=t[++r],i==="b"){for(r++;r<e;r++)if(i=t[r],i!=="_"){if(i!=="0"&&i!=="1")return!1;n=!0}return n&&i!=="_"}if(i==="x"){for(r++;r<e;r++)if(i=t[r],i!=="_"){if(!g4(t.charCodeAt(r)))return!1;n=!0}return n&&i!=="_"}if(i==="o"){for(r++;r<e;r++)if(i=t[r],i!=="_"){if(!y4(t.charCodeAt(r)))return!1;n=!0}return n&&i!=="_"}}if(i==="_")return!1;for(;r<e;r++)if(i=t[r],i!=="_"){if(!b4(t.charCodeAt(r)))return!1;n=!0}return!(!n||i==="_")}function v4(t){var e=t,r=1,n;if(e.indexOf("_")!==-1&&(e=e.replace(/_/g,"")),n=e[0],(n==="-"||n==="+")&&(n==="-"&&(r=-1),e=e.slice(1),n=e[0]),e==="0")return 0;if(n==="0"){if(e[1]==="b")return r*parseInt(e.slice(2),2);if(e[1]==="x")return r*parseInt(e.slice(2),16);if(e[1]==="o")return r*parseInt(e.slice(2),8)}return r*parseInt(e,10)}function _4(t){return Object.prototype.toString.call(t)==="[object Number]"&&t%1===0&&!tr.isNegativeZero(t)}var P4=new Ht("tag:yaml.org,2002:int",{kind:"scalar",resolve:w4,construct:v4,predicate:_4,represent:{binary:function(t){return t>=0?"0b"+t.toString(2):"-0b"+t.toString(2).slice(1)},octal:function(t){return t>=0?"0o"+t.toString(8):"-0o"+t.toString(8).slice(1)},decimal:function(t){return t.toString(10)},hexadecimal:function(t){return t>=0?"0x"+t.toString(16).toUpperCase():"-0x"+t.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),O4=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function S4(t){return!(t===null||!O4.test(t)||t[t.length-1]==="_")}function x4(t){var e,r;return e=t.replace(/_/g,"").toLowerCase(),r=e[0]==="-"?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),e===".inf"?r===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:e===".nan"?NaN:r*parseFloat(e,10)}var E4=/^[-+]?[0-9]+e/;function T4(t,e){var r;if(isNaN(t))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===t)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===t)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(tr.isNegativeZero(t))return"-0.0";return r=t.toString(10),E4.test(r)?r.replace("e",".e"):r}function A4(t){return Object.prototype.toString.call(t)==="[object Number]"&&(t%1!==0||tr.isNegativeZero(t))}var k4=new Ht("tag:yaml.org,2002:float",{kind:"scalar",resolve:S4,construct:x4,predicate:A4,represent:T4,defaultStyle:"lowercase"}),I4=o4.extend({implicit:[h4,m4,P4,k4]}),C4=I4,oA=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),uA=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function R4(t){return t===null?!1:oA.exec(t)!==null||uA.exec(t)!==null}function j4(t){var e,r,n,i,s,a,o,u=0,l=null,c,h,d;if(e=oA.exec(t),e===null&&(e=uA.exec(t)),e===null)throw new Error("Date resolve error");if(r=+e[1],n=+e[2]-1,i=+e[3],!e[4])return new Date(Date.UTC(r,n,i));if(s=+e[4],a=+e[5],o=+e[6],e[7]){for(u=e[7].slice(0,3);u.length<3;)u+="0";u=+u}return e[9]&&(c=+e[10],h=+(e[11]||0),l=(c*60+h)*6e4,e[9]==="-"&&(l=-l)),d=new Date(Date.UTC(r,n,i,s,a,o,u)),l&&d.setTime(d.getTime()-l),d}function N4(t){return t.toISOString()}var $4=new Ht("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:R4,construct:j4,instanceOf:Date,represent:N4});function L4(t){return t==="<<"||t===null}var D4=new Ht("tag:yaml.org,2002:merge",{kind:"scalar",resolve:L4}),Ow=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function M4(t){if(t===null)return!1;var e,r,n=0,i=t.length,s=Ow;for(r=0;r<i;r++)if(e=s.indexOf(t.charAt(r)),!(e>64)){if(e<0)return!1;n+=6}return n%8===0}function F4(t){var e,r,n=t.replace(/[\r\n=]/g,""),i=n.length,s=Ow,a=0,o=[];for(e=0;e<i;e++)e%4===0&&e&&(o.push(a>>16&255),o.push(a>>8&255),o.push(a&255)),a=a<<6|s.indexOf(n.charAt(e));return r=i%4*6,r===0?(o.push(a>>16&255),o.push(a>>8&255),o.push(a&255)):r===18?(o.push(a>>10&255),o.push(a>>2&255)):r===12&&o.push(a>>4&255),new Uint8Array(o)}function z4(t){var e="",r=0,n,i,s=t.length,a=Ow;for(n=0;n<s;n++)n%3===0&&n&&(e+=a[r>>18&63],e+=a[r>>12&63],e+=a[r>>6&63],e+=a[r&63]),r=(r<<8)+t[n];return i=s%3,i===0?(e+=a[r>>18&63],e+=a[r>>12&63],e+=a[r>>6&63],e+=a[r&63]):i===2?(e+=a[r>>10&63],e+=a[r>>4&63],e+=a[r<<2&63],e+=a[64]):i===1&&(e+=a[r>>2&63],e+=a[r<<4&63],e+=a[64],e+=a[64]),e}function U4(t){return Object.prototype.toString.call(t)==="[object Uint8Array]"}var q4=new Ht("tag:yaml.org,2002:binary",{kind:"scalar",resolve:M4,construct:F4,predicate:U4,represent:z4}),K4=Object.prototype.hasOwnProperty,V4=Object.prototype.toString;function B4(t){if(t===null)return!0;var e=[],r,n,i,s,a,o=t;for(r=0,n=o.length;r<n;r+=1){if(i=o[r],a=!1,V4.call(i)!=="[object Object]")return!1;for(s in i)if(K4.call(i,s))if(!a)a=!0;else return!1;if(!a)return!1;if(e.indexOf(s)===-1)e.push(s);else return!1}return!0}function H4(t){return t!==null?t:[]}var W4=new Ht("tag:yaml.org,2002:omap",{kind:"sequence",resolve:B4,construct:H4}),J4=Object.prototype.toString;function G4(t){if(t===null)return!0;var e,r,n,i,s,a=t;for(s=new Array(a.length),e=0,r=a.length;e<r;e+=1){if(n=a[e],J4.call(n)!=="[object Object]"||(i=Object.keys(n),i.length!==1))return!1;s[e]=[i[0],n[i[0]]]}return!0}function Z4(t){if(t===null)return[];var e,r,n,i,s,a=t;for(s=new Array(a.length),e=0,r=a.length;e<r;e+=1)n=a[e],i=Object.keys(n),s[e]=[i[0],n[i[0]]];return s}var Y4=new Ht("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:G4,construct:Z4}),Q4=Object.prototype.hasOwnProperty;function X4(t){if(t===null)return!0;var e,r=t;for(e in r)if(Q4.call(r,e)&&r[e]!==null)return!1;return!0}function eK(t){return t!==null?t:{}}var tK=new Ht("tag:yaml.org,2002:set",{kind:"mapping",resolve:X4,construct:eK}),rK=C4.extend({implicit:[$4,D4],explicit:[q4,W4,Y4,tK]}),ls=Object.prototype.hasOwnProperty,$d=1,lA=2,cA=3,Ld=4,Yp=1,nK=2,k0=3,iK=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,sK=/[\x85\u2028\u2029]/,aK=/[,\[\]\{\}]/,hA=/^(?:!|!!|![a-z\-]+!)$/i,dA=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function I0(t){return Object.prototype.toString.call(t)}function Yn(t){return t===10||t===13}function Ds(t){return t===9||t===32}function yr(t){return t===9||t===32||t===10||t===13}function Ma(t){return t===44||t===91||t===93||t===123||t===125}function oK(t){var e;return 48<=t&&t<=57?t-48:(e=t|32,97<=e&&e<=102?e-97+10:-1)}function uK(t){return t===120?2:t===117?4:t===85?8:0}function lK(t){return 48<=t&&t<=57?t-48:-1}function C0(t){return t===48?"\0":t===97?"\x07":t===98?"\b":t===116||t===9?"	":t===110?`
`:t===118?"\v":t===102?"\f":t===114?"\r":t===101?"\x1B":t===32?" ":t===34?'"':t===47?"/":t===92?"\\":t===78?"":t===95?"":t===76?"\u2028":t===80?"\u2029":""}function cK(t){return t<=65535?String.fromCharCode(t):String.fromCharCode((t-65536>>10)+55296,(t-65536&1023)+56320)}var fA=new Array(256),pA=new Array(256);for(var ya=0;ya<256;ya++)fA[ya]=C0(ya)?1:0,pA[ya]=C0(ya);function hK(t,e){this.input=t,this.filename=e.filename||null,this.schema=e.schema||rK,this.onWarning=e.onWarning||null,this.legacy=e.legacy||!1,this.json=e.json||!1,this.listener=e.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=t.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function mA(t,e){var r={name:t.filename,buffer:t.input.slice(0,-1),position:t.position,line:t.line,column:t.position-t.lineStart};return r.snippet=Yq(r),new ui(e,r)}function ne(t,e){throw mA(t,e)}function Dd(t,e){t.onWarning&&t.onWarning.call(null,mA(t,e))}var R0={YAML:function(e,r,n){var i,s,a;e.version!==null&&ne(e,"duplication of %YAML directive"),n.length!==1&&ne(e,"YAML directive accepts exactly one argument"),i=/^([0-9]+)\.([0-9]+)$/.exec(n[0]),i===null&&ne(e,"ill-formed argument of the YAML directive"),s=parseInt(i[1],10),a=parseInt(i[2],10),s!==1&&ne(e,"unacceptable YAML version of the document"),e.version=n[0],e.checkLineBreaks=a<2,a!==1&&a!==2&&Dd(e,"unsupported YAML version of the document")},TAG:function(e,r,n){var i,s;n.length!==2&&ne(e,"TAG directive accepts exactly two arguments"),i=n[0],s=n[1],hA.test(i)||ne(e,"ill-formed tag handle (first argument) of the TAG directive"),ls.call(e.tagMap,i)&&ne(e,'there is a previously declared suffix for "'+i+'" tag handle'),dA.test(s)||ne(e,"ill-formed tag prefix (second argument) of the TAG directive");try{s=decodeURIComponent(s)}catch{ne(e,"tag prefix is malformed: "+s)}e.tagMap[i]=s}};function rs(t,e,r,n){var i,s,a,o;if(e<r){if(o=t.input.slice(e,r),n)for(i=0,s=o.length;i<s;i+=1)a=o.charCodeAt(i),a===9||32<=a&&a<=1114111||ne(t,"expected valid JSON character");else iK.test(o)&&ne(t,"the stream contains non-printable characters");t.result+=o}}function j0(t,e,r,n){var i,s,a,o;for(tr.isObject(r)||ne(t,"cannot merge mappings; the provided source object is unacceptable"),i=Object.keys(r),a=0,o=i.length;a<o;a+=1)s=i[a],ls.call(e,s)||(e[s]=r[s],n[s]=!0)}function Fa(t,e,r,n,i,s,a,o,u){var l,c;if(Array.isArray(i))for(i=Array.prototype.slice.call(i),l=0,c=i.length;l<c;l+=1)Array.isArray(i[l])&&ne(t,"nested arrays are not supported inside keys"),typeof i=="object"&&I0(i[l])==="[object Object]"&&(i[l]="[object Object]");if(typeof i=="object"&&I0(i)==="[object Object]"&&(i="[object Object]"),i=String(i),e===null&&(e={}),n==="tag:yaml.org,2002:merge")if(Array.isArray(s))for(l=0,c=s.length;l<c;l+=1)j0(t,e,s[l],r);else j0(t,e,s,r);else!t.json&&!ls.call(r,i)&&ls.call(e,i)&&(t.line=a||t.line,t.lineStart=o||t.lineStart,t.position=u||t.position,ne(t,"duplicated mapping key")),i==="__proto__"?Object.defineProperty(e,i,{configurable:!0,enumerable:!0,writable:!0,value:s}):e[i]=s,delete r[i];return e}function Sw(t){var e;e=t.input.charCodeAt(t.position),e===10?t.position++:e===13?(t.position++,t.input.charCodeAt(t.position)===10&&t.position++):ne(t,"a line break is expected"),t.line+=1,t.lineStart=t.position,t.firstTabInLine=-1}function mt(t,e,r){for(var n=0,i=t.input.charCodeAt(t.position);i!==0;){for(;Ds(i);)i===9&&t.firstTabInLine===-1&&(t.firstTabInLine=t.position),i=t.input.charCodeAt(++t.position);if(e&&i===35)do i=t.input.charCodeAt(++t.position);while(i!==10&&i!==13&&i!==0);if(Yn(i))for(Sw(t),i=t.input.charCodeAt(t.position),n++,t.lineIndent=0;i===32;)t.lineIndent++,i=t.input.charCodeAt(++t.position);else break}return r!==-1&&n!==0&&t.lineIndent<r&&Dd(t,"deficient indentation"),n}function Kf(t){var e=t.position,r;return r=t.input.charCodeAt(e),!!((r===45||r===46)&&r===t.input.charCodeAt(e+1)&&r===t.input.charCodeAt(e+2)&&(e+=3,r=t.input.charCodeAt(e),r===0||yr(r)))}function xw(t,e){e===1?t.result+=" ":e>1&&(t.result+=tr.repeat(`
`,e-1))}function dK(t,e,r){var n,i,s,a,o,u,l,c,h=t.kind,d=t.result,f;if(f=t.input.charCodeAt(t.position),yr(f)||Ma(f)||f===35||f===38||f===42||f===33||f===124||f===62||f===39||f===34||f===37||f===64||f===96||(f===63||f===45)&&(i=t.input.charCodeAt(t.position+1),yr(i)||r&&Ma(i)))return!1;for(t.kind="scalar",t.result="",s=a=t.position,o=!1;f!==0;){if(f===58){if(i=t.input.charCodeAt(t.position+1),yr(i)||r&&Ma(i))break}else if(f===35){if(n=t.input.charCodeAt(t.position-1),yr(n))break}else{if(t.position===t.lineStart&&Kf(t)||r&&Ma(f))break;if(Yn(f))if(u=t.line,l=t.lineStart,c=t.lineIndent,mt(t,!1,-1),t.lineIndent>=e){o=!0,f=t.input.charCodeAt(t.position);continue}else{t.position=a,t.line=u,t.lineStart=l,t.lineIndent=c;break}}o&&(rs(t,s,a,!1),xw(t,t.line-u),s=a=t.position,o=!1),Ds(f)||(a=t.position+1),f=t.input.charCodeAt(++t.position)}return rs(t,s,a,!1),t.result?!0:(t.kind=h,t.result=d,!1)}function fK(t,e){var r,n,i;if(r=t.input.charCodeAt(t.position),r!==39)return!1;for(t.kind="scalar",t.result="",t.position++,n=i=t.position;(r=t.input.charCodeAt(t.position))!==0;)if(r===39)if(rs(t,n,t.position,!0),r=t.input.charCodeAt(++t.position),r===39)n=t.position,t.position++,i=t.position;else return!0;else Yn(r)?(rs(t,n,i,!0),xw(t,mt(t,!1,e)),n=i=t.position):t.position===t.lineStart&&Kf(t)?ne(t,"unexpected end of the document within a single quoted scalar"):(t.position++,i=t.position);ne(t,"unexpected end of the stream within a single quoted scalar")}function pK(t,e){var r,n,i,s,a,o;if(o=t.input.charCodeAt(t.position),o!==34)return!1;for(t.kind="scalar",t.result="",t.position++,r=n=t.position;(o=t.input.charCodeAt(t.position))!==0;){if(o===34)return rs(t,r,t.position,!0),t.position++,!0;if(o===92){if(rs(t,r,t.position,!0),o=t.input.charCodeAt(++t.position),Yn(o))mt(t,!1,e);else if(o<256&&fA[o])t.result+=pA[o],t.position++;else if((a=uK(o))>0){for(i=a,s=0;i>0;i--)o=t.input.charCodeAt(++t.position),(a=oK(o))>=0?s=(s<<4)+a:ne(t,"expected hexadecimal character");t.result+=cK(s),t.position++}else ne(t,"unknown escape sequence");r=n=t.position}else Yn(o)?(rs(t,r,n,!0),xw(t,mt(t,!1,e)),r=n=t.position):t.position===t.lineStart&&Kf(t)?ne(t,"unexpected end of the document within a double quoted scalar"):(t.position++,n=t.position)}ne(t,"unexpected end of the stream within a double quoted scalar")}function mK(t,e){var r=!0,n,i,s,a=t.tag,o,u=t.anchor,l,c,h,d,f,p=Object.create(null),y,v,g,m;if(m=t.input.charCodeAt(t.position),m===91)c=93,f=!1,o=[];else if(m===123)c=125,f=!0,o={};else return!1;for(t.anchor!==null&&(t.anchorMap[t.anchor]=o),m=t.input.charCodeAt(++t.position);m!==0;){if(mt(t,!0,e),m=t.input.charCodeAt(t.position),m===c)return t.position++,t.tag=a,t.anchor=u,t.kind=f?"mapping":"sequence",t.result=o,!0;r?m===44&&ne(t,"expected the node content, but found ','"):ne(t,"missed comma between flow collection entries"),v=y=g=null,h=d=!1,m===63&&(l=t.input.charCodeAt(t.position+1),yr(l)&&(h=d=!0,t.position++,mt(t,!0,e))),n=t.line,i=t.lineStart,s=t.position,mo(t,e,$d,!1,!0),v=t.tag,y=t.result,mt(t,!0,e),m=t.input.charCodeAt(t.position),(d||t.line===n)&&m===58&&(h=!0,m=t.input.charCodeAt(++t.position),mt(t,!0,e),mo(t,e,$d,!1,!0),g=t.result),f?Fa(t,o,p,v,y,g,n,i,s):h?o.push(Fa(t,null,p,v,y,g,n,i,s)):o.push(y),mt(t,!0,e),m=t.input.charCodeAt(t.position),m===44?(r=!0,m=t.input.charCodeAt(++t.position)):r=!1}ne(t,"unexpected end of the stream within a flow collection")}function gK(t,e){var r,n,i=Yp,s=!1,a=!1,o=e,u=0,l=!1,c,h;if(h=t.input.charCodeAt(t.position),h===124)n=!1;else if(h===62)n=!0;else return!1;for(t.kind="scalar",t.result="";h!==0;)if(h=t.input.charCodeAt(++t.position),h===43||h===45)Yp===i?i=h===43?k0:nK:ne(t,"repeat of a chomping mode identifier");else if((c=lK(h))>=0)c===0?ne(t,"bad explicit indentation width of a block scalar; it cannot be less than one"):a?ne(t,"repeat of an indentation width identifier"):(o=e+c-1,a=!0);else break;if(Ds(h)){do h=t.input.charCodeAt(++t.position);while(Ds(h));if(h===35)do h=t.input.charCodeAt(++t.position);while(!Yn(h)&&h!==0)}for(;h!==0;){for(Sw(t),t.lineIndent=0,h=t.input.charCodeAt(t.position);(!a||t.lineIndent<o)&&h===32;)t.lineIndent++,h=t.input.charCodeAt(++t.position);if(!a&&t.lineIndent>o&&(o=t.lineIndent),Yn(h)){u++;continue}if(t.lineIndent<o){i===k0?t.result+=tr.repeat(`
`,s?1+u:u):i===Yp&&s&&(t.result+=`
`);break}for(n?Ds(h)?(l=!0,t.result+=tr.repeat(`
`,s?1+u:u)):l?(l=!1,t.result+=tr.repeat(`
`,u+1)):u===0?s&&(t.result+=" "):t.result+=tr.repeat(`
`,u):t.result+=tr.repeat(`
`,s?1+u:u),s=!0,a=!0,u=0,r=t.position;!Yn(h)&&h!==0;)h=t.input.charCodeAt(++t.position);rs(t,r,t.position,!1)}return!0}function N0(t,e){var r,n=t.tag,i=t.anchor,s=[],a,o=!1,u;if(t.firstTabInLine!==-1)return!1;for(t.anchor!==null&&(t.anchorMap[t.anchor]=s),u=t.input.charCodeAt(t.position);u!==0&&(t.firstTabInLine!==-1&&(t.position=t.firstTabInLine,ne(t,"tab characters must not be used in indentation")),!(u!==45||(a=t.input.charCodeAt(t.position+1),!yr(a))));){if(o=!0,t.position++,mt(t,!0,-1)&&t.lineIndent<=e){s.push(null),u=t.input.charCodeAt(t.position);continue}if(r=t.line,mo(t,e,cA,!1,!0),s.push(t.result),mt(t,!0,-1),u=t.input.charCodeAt(t.position),(t.line===r||t.lineIndent>e)&&u!==0)ne(t,"bad indentation of a sequence entry");else if(t.lineIndent<e)break}return o?(t.tag=n,t.anchor=i,t.kind="sequence",t.result=s,!0):!1}function yK(t,e,r){var n,i,s,a,o,u,l=t.tag,c=t.anchor,h={},d=Object.create(null),f=null,p=null,y=null,v=!1,g=!1,m;if(t.firstTabInLine!==-1)return!1;for(t.anchor!==null&&(t.anchorMap[t.anchor]=h),m=t.input.charCodeAt(t.position);m!==0;){if(!v&&t.firstTabInLine!==-1&&(t.position=t.firstTabInLine,ne(t,"tab characters must not be used in indentation")),n=t.input.charCodeAt(t.position+1),s=t.line,(m===63||m===58)&&yr(n))m===63?(v&&(Fa(t,h,d,f,p,null,a,o,u),f=p=y=null),g=!0,v=!0,i=!0):v?(v=!1,i=!0):ne(t,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),t.position+=1,m=n;else{if(a=t.line,o=t.lineStart,u=t.position,!mo(t,r,lA,!1,!0))break;if(t.line===s){for(m=t.input.charCodeAt(t.position);Ds(m);)m=t.input.charCodeAt(++t.position);if(m===58)m=t.input.charCodeAt(++t.position),yr(m)||ne(t,"a whitespace character is expected after the key-value separator within a block mapping"),v&&(Fa(t,h,d,f,p,null,a,o,u),f=p=y=null),g=!0,v=!1,i=!1,f=t.tag,p=t.result;else if(g)ne(t,"can not read an implicit mapping pair; a colon is missed");else return t.tag=l,t.anchor=c,!0}else if(g)ne(t,"can not read a block mapping entry; a multiline key may not be an implicit key");else return t.tag=l,t.anchor=c,!0}if((t.line===s||t.lineIndent>e)&&(v&&(a=t.line,o=t.lineStart,u=t.position),mo(t,e,Ld,!0,i)&&(v?p=t.result:y=t.result),v||(Fa(t,h,d,f,p,y,a,o,u),f=p=y=null),mt(t,!0,-1),m=t.input.charCodeAt(t.position)),(t.line===s||t.lineIndent>e)&&m!==0)ne(t,"bad indentation of a mapping entry");else if(t.lineIndent<e)break}return v&&Fa(t,h,d,f,p,null,a,o,u),g&&(t.tag=l,t.anchor=c,t.kind="mapping",t.result=h),g}function bK(t){var e,r=!1,n=!1,i,s,a;if(a=t.input.charCodeAt(t.position),a!==33)return!1;if(t.tag!==null&&ne(t,"duplication of a tag property"),a=t.input.charCodeAt(++t.position),a===60?(r=!0,a=t.input.charCodeAt(++t.position)):a===33?(n=!0,i="!!",a=t.input.charCodeAt(++t.position)):i="!",e=t.position,r){do a=t.input.charCodeAt(++t.position);while(a!==0&&a!==62);t.position<t.length?(s=t.input.slice(e,t.position),a=t.input.charCodeAt(++t.position)):ne(t,"unexpected end of the stream within a verbatim tag")}else{for(;a!==0&&!yr(a);)a===33&&(n?ne(t,"tag suffix cannot contain exclamation marks"):(i=t.input.slice(e-1,t.position+1),hA.test(i)||ne(t,"named tag handle cannot contain such characters"),n=!0,e=t.position+1)),a=t.input.charCodeAt(++t.position);s=t.input.slice(e,t.position),aK.test(s)&&ne(t,"tag suffix cannot contain flow indicator characters")}s&&!dA.test(s)&&ne(t,"tag name cannot contain such characters: "+s);try{s=decodeURIComponent(s)}catch{ne(t,"tag name is malformed: "+s)}return r?t.tag=s:ls.call(t.tagMap,i)?t.tag=t.tagMap[i]+s:i==="!"?t.tag="!"+s:i==="!!"?t.tag="tag:yaml.org,2002:"+s:ne(t,'undeclared tag handle "'+i+'"'),!0}function wK(t){var e,r;if(r=t.input.charCodeAt(t.position),r!==38)return!1;for(t.anchor!==null&&ne(t,"duplication of an anchor property"),r=t.input.charCodeAt(++t.position),e=t.position;r!==0&&!yr(r)&&!Ma(r);)r=t.input.charCodeAt(++t.position);return t.position===e&&ne(t,"name of an anchor node must contain at least one character"),t.anchor=t.input.slice(e,t.position),!0}function vK(t){var e,r,n;if(n=t.input.charCodeAt(t.position),n!==42)return!1;for(n=t.input.charCodeAt(++t.position),e=t.position;n!==0&&!yr(n)&&!Ma(n);)n=t.input.charCodeAt(++t.position);return t.position===e&&ne(t,"name of an alias node must contain at least one character"),r=t.input.slice(e,t.position),ls.call(t.anchorMap,r)||ne(t,'unidentified alias "'+r+'"'),t.result=t.anchorMap[r],mt(t,!0,-1),!0}function mo(t,e,r,n,i){var s,a,o,u=1,l=!1,c=!1,h,d,f,p,y,v;if(t.listener!==null&&t.listener("open",t),t.tag=null,t.anchor=null,t.kind=null,t.result=null,s=a=o=Ld===r||cA===r,n&&mt(t,!0,-1)&&(l=!0,t.lineIndent>e?u=1:t.lineIndent===e?u=0:t.lineIndent<e&&(u=-1)),u===1)for(;bK(t)||wK(t);)mt(t,!0,-1)?(l=!0,o=s,t.lineIndent>e?u=1:t.lineIndent===e?u=0:t.lineIndent<e&&(u=-1)):o=!1;if(o&&(o=l||i),(u===1||Ld===r)&&($d===r||lA===r?y=e:y=e+1,v=t.position-t.lineStart,u===1?o&&(N0(t,v)||yK(t,v,y))||mK(t,y)?c=!0:(a&&gK(t,y)||fK(t,y)||pK(t,y)?c=!0:vK(t)?(c=!0,(t.tag!==null||t.anchor!==null)&&ne(t,"alias node should not have any properties")):dK(t,y,$d===r)&&(c=!0,t.tag===null&&(t.tag="?")),t.anchor!==null&&(t.anchorMap[t.anchor]=t.result)):u===0&&(c=o&&N0(t,v))),t.tag===null)t.anchor!==null&&(t.anchorMap[t.anchor]=t.result);else if(t.tag==="?"){for(t.result!==null&&t.kind!=="scalar"&&ne(t,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+t.kind+'"'),h=0,d=t.implicitTypes.length;h<d;h+=1)if(p=t.implicitTypes[h],p.resolve(t.result)){t.result=p.construct(t.result),t.tag=p.tag,t.anchor!==null&&(t.anchorMap[t.anchor]=t.result);break}}else if(t.tag!=="!"){if(ls.call(t.typeMap[t.kind||"fallback"],t.tag))p=t.typeMap[t.kind||"fallback"][t.tag];else for(p=null,f=t.typeMap.multi[t.kind||"fallback"],h=0,d=f.length;h<d;h+=1)if(t.tag.slice(0,f[h].tag.length)===f[h].tag){p=f[h];break}p||ne(t,"unknown tag !<"+t.tag+">"),t.result!==null&&p.kind!==t.kind&&ne(t,"unacceptable node kind for !<"+t.tag+'> tag; it should be "'+p.kind+'", not "'+t.kind+'"'),p.resolve(t.result,t.tag)?(t.result=p.construct(t.result,t.tag),t.anchor!==null&&(t.anchorMap[t.anchor]=t.result)):ne(t,"cannot resolve a node with !<"+t.tag+"> explicit tag")}return t.listener!==null&&t.listener("close",t),t.tag!==null||t.anchor!==null||c}function _K(t){var e=t.position,r,n,i,s=!1,a;for(t.version=null,t.checkLineBreaks=t.legacy,t.tagMap=Object.create(null),t.anchorMap=Object.create(null);(a=t.input.charCodeAt(t.position))!==0&&(mt(t,!0,-1),a=t.input.charCodeAt(t.position),!(t.lineIndent>0||a!==37));){for(s=!0,a=t.input.charCodeAt(++t.position),r=t.position;a!==0&&!yr(a);)a=t.input.charCodeAt(++t.position);for(n=t.input.slice(r,t.position),i=[],n.length<1&&ne(t,"directive name must not be less than one character in length");a!==0;){for(;Ds(a);)a=t.input.charCodeAt(++t.position);if(a===35){do a=t.input.charCodeAt(++t.position);while(a!==0&&!Yn(a));break}if(Yn(a))break;for(r=t.position;a!==0&&!yr(a);)a=t.input.charCodeAt(++t.position);i.push(t.input.slice(r,t.position))}a!==0&&Sw(t),ls.call(R0,n)?R0[n](t,n,i):Dd(t,'unknown document directive "'+n+'"')}if(mt(t,!0,-1),t.lineIndent===0&&t.input.charCodeAt(t.position)===45&&t.input.charCodeAt(t.position+1)===45&&t.input.charCodeAt(t.position+2)===45?(t.position+=3,mt(t,!0,-1)):s&&ne(t,"directives end mark is expected"),mo(t,t.lineIndent-1,Ld,!1,!0),mt(t,!0,-1),t.checkLineBreaks&&sK.test(t.input.slice(e,t.position))&&Dd(t,"non-ASCII line breaks are interpreted as content"),t.documents.push(t.result),t.position===t.lineStart&&Kf(t)){t.input.charCodeAt(t.position)===46&&(t.position+=3,mt(t,!0,-1));return}if(t.position<t.length-1)ne(t,"end of the stream or a document separator is expected");else return}function gA(t,e){t=String(t),e=e||{},t.length!==0&&(t.charCodeAt(t.length-1)!==10&&t.charCodeAt(t.length-1)!==13&&(t+=`
`),t.charCodeAt(0)===65279&&(t=t.slice(1)));var r=new hK(t,e),n=t.indexOf("\0");for(n!==-1&&(r.position=n,ne(r,"null byte is not allowed in input")),r.input+="\0";r.input.charCodeAt(r.position)===32;)r.lineIndent+=1,r.position+=1;for(;r.position<r.length-1;)_K(r);return r.documents}function PK(t,e,r){e!==null&&typeof e=="object"&&typeof r>"u"&&(r=e,e=null);var n=gA(t,r);if(typeof e!="function")return n;for(var i=0,s=n.length;i<s;i+=1)e(n[i])}function OK(t,e){var r=gA(t,e);if(r.length!==0){if(r.length===1)return r[0];throw new ui("expected a single document in the stream, but found more")}}var SK=PK,xK=OK,EK={loadAll:SK,load:xK},TK=EK.load;class hi{constructor(e){Object.defineProperty(this,"document",{enumerable:!0,configurable:!0,writable:!0,value:e})}get baseUrl(){return this.document.servers?this.document.servers[0].url:void 0}getPathsStrict(){if(!this.document.paths)throw new Error("No paths found in spec");return this.document.paths}getParametersStrict(){var e;if(!((e=this.document.components)!=null&&e.parameters))throw new Error("No parameters found in spec");return this.document.components.parameters}getSchemasStrict(){var e;if(!((e=this.document.components)!=null&&e.schemas))throw new Error("No schemas found in spec.");return this.document.components.schemas}getRequestBodiesStrict(){var e;if(!((e=this.document.components)!=null&&e.requestBodies))throw new Error("No request body found in spec.");return this.document.components.requestBodies}getPathStrict(e){const r=this.getPathsStrict()[e];if(r===void 0)throw new Error(`No path found for "${e}".`);return r}getReferencedParameter(e){const r=e.$ref.split("/"),n=r[r.length-1];if(this.getParametersStrict()[n]===void 0)throw new Error(`No parameter found for "${n}".`);return this.getParametersStrict()[n]}getRootReferencedParameter(e){let r=this.getReferencedParameter(e);for(;r.$ref!==void 0;)r=this.getReferencedParameter(r);return r}getReferencedSchema(e){const r=e.$ref.split("/"),n=r[r.length-1],i=this.getSchemasStrict()[n];if(i===void 0)throw new Error(`No schema found for "${n}".`);return i}getSchema(e){return e.$ref!==void 0?this.getReferencedSchema(e):e}getRootReferencedSchema(e){let r=this.getReferencedSchema(e);for(;r.$ref!==void 0;)r=this.getReferencedSchema(r);return r}getReferencedRequestBody(e){const r=e.$ref.split("/"),n=r[r.length-1],i=this.getRequestBodiesStrict();if(i[n]===void 0)throw new Error(`No request body found for "${n}"`);return i[n]}getRootReferencedRequestBody(e){let r=this.getReferencedRequestBody(e);for(;r.$ref!==void 0;)r=this.getReferencedRequestBody(r);return r}getMethodsForPath(e){const r=this.getPathStrict(e);return["get","put","post","delete","options","head","patch","trace"].filter(i=>r[i]!==void 0)}getParametersForPath(e){const r=this.getPathStrict(e);return r.parameters===void 0?[]:r.parameters.map(n=>n.$ref!==void 0?this.getRootReferencedParameter(n):n)}getOperation(e,r){const n=this.getPathStrict(e);if(n[r]===void 0)throw new Error(`No ${r} method found for "path".`);return n[r]}getParametersForOperation(e){return e.parameters===void 0?[]:e.parameters.map(r=>r.$ref!==void 0?this.getRootReferencedParameter(r):r)}getRequestBodyForOperation(e){const{requestBody:r}=e;return(r==null?void 0:r.$ref)!==void 0?this.getRootReferencedRequestBody(r):r}static getCleanedOperationId(e,r,n){let{operationId:i}=e;if(i===void 0){const s=r.replaceAll(/[^a-zA-Z0-9]/,"_");i=`${s.startsWith("/")?s.slice(1):s}_${n}`}return i.replaceAll("-","_").replaceAll(".","_").replaceAll("/","_")}static alertUnsupportedSpec(e){const r="This may result in degraded performance. Convert your OpenAPI spec to 3.1.0 for better support.",n=e.swagger,i=e.openapi;if(i!==void 0&&i!=="3.1.0")console.warn(`Attempting to load an OpenAPI ${i} spec. ${r}`);else if(n!==void 0)console.warn(`Attempting to load a Swagger ${n} spec. ${r}`);else throw new Error(`Attempting to load an unsupported spec:

${JSON.stringify(e,null,2)}.`)}static fromObject(e){return hi.alertUnsupportedSpec(e),new hi(e)}static fromString(e){let r;try{r=JSON.parse(e)}catch{r=TK(e)}return hi.fromObject(r)}static async fromURL(e){const n=await(await fetch(e)).text();return hi.fromString(n)}}function AK(t,e){const r=[...t.matchAll(/{(.*?)}/g)].map(s=>s[1]),n={};for(const s of r){const a=s.replace(/^\.;/,"").replace(/\*$/,""),o=e[a];let u;if(Array.isArray(o))if(s.startsWith(".")){const l=s.endsWith("*")?".":",";u=`.${o.join(l)}`}else if(s.startsWith(",")){const l=s.endsWith("*")?`${a}=`:",";u=`${a}=${o.join(l)}`}else u=o.join(",");else if(typeof o=="object"){const l=s.endsWith("*")?"=":",",c=Object.entries(o).map(([d,f])=>d+l+f);let h;s.startsWith(".")?(h=".",u="."):s.startsWith(";")?(h=";",u=";"):(h=",",u=""),u+=c.join(h)}else s.startsWith(".")?u=`.${o}`:s.startsWith(";")?u=`;${a}=${o}`:u=o;n[s]=u}let i=t;for(const[s,a]of Object.entries(n))i=i.replace(`{${s}}`,a);return i}function kK(t,e){return t.reduce((r,n)=>{let i;if(n.schema)i=e.getSchema(n.schema),r.properties[n.name]=xl(i,e);else if(n.content){const s=Object.values(n.content)[0].schema;if(s&&(i=e.getSchema(s)),!i)return r;i.description===void 0&&(i.description=n.description??""),r.properties[n.name]=xl(i,e)}else return r;return n.required&&Array.isArray(r.required)&&r.required.push(n.name),r},{type:"object",properties:{},required:[],additionalProperties:{}})}function xl(t,e){return t.type==="object"?Object.keys(t.properties??{}).reduce((r,n)=>{if(!t.properties)return r;const i=e.getSchema(t.properties[n]);return i.type===void 0||(r.properties[n]=xl(i,e),i.required&&r.required!==void 0&&r.required.push(n)),r},{type:"object",properties:{},required:[],additionalProperties:{}}):t.type==="array"?{type:"array",items:xl(t.items??{},e),minItems:t.minItems,maxItems:t.maxItems}:{type:t.type??"string"}}function IK(t){if(!t.document.paths)return{openAIFunctions:[]};const e=[],r={};for(const n of Object.keys(t.document.paths)){const i=t.getParametersForPath(n);for(const s of t.getMethodsForPath(n)){const a=t.getOperation(n,s);if(!a)return{openAIFunctions:[]};const o=i.concat(t.getParametersForOperation(a)).reduce((f,p)=>(f[p.in]||(f[p.in]=[]),f[p.in].push(p),f),{}),u={query:"params",header:"headers",cookie:"cookies",path:"path_params"},l={};for(const f of Object.keys(u))o[f]&&(l[u[f]]=kK(o[f],t));const c=t.getRequestBodyForOperation(a);if((c==null?void 0:c.content)!==void 0){const f={};for(const[y,v]of Object.entries(c.content))if(v.schema!==void 0){const g=t.getSchema(v.schema);f[y]=xl(g,t)}const p=Object.keys(f);p.length===1?l.data=f[p[0]]:p.length>1&&(l.data={anyOf:Object.values(f)})}const h={name:hi.getCleanedOperationId(a,n,s),description:a.description??a.summary??"",parameters:{type:"object",properties:l,required:Object.keys(l)}};e.push(h);const d=(t.baseUrl??"").endsWith("/")?(t.baseUrl??"").slice(0,-1):t.baseUrl??"";r[h.name]={method:s,url:d+n}}}return{openAIFunctions:e,defaultExecutionMethod:async(n,i,s)=>{const{headers:a,params:o,...u}=s??{},{method:l,url:c}=r[n],h=i.params??{},d=Object.keys(h).reduce((S,E)=>(h[E]!==""&&h[E]!==null&&h[E]!==void 0&&(S[E]=h[E]),S),{}),f=new URLSearchParams({...d,...o}).toString(),p=i.path_params,y=AK(c,p)+(f.length?`?${f}`:""),v={};let g;if(i.data!==void 0){let S="text/plain";typeof i.data!="string"?(typeof i.data=="object"&&(S="application/json"),g=JSON.stringify(i.data)):g=i.data,v["content-type"]=S}const m=await fetch(y,{...i,method:l,headers:{...v,...i.headers,...a},body:g,...u});let b;return m.status<200||m.status>299?b=`${m.status}: ${m.statusText} for ${n} called with ${JSON.stringify(f)}`:b=await m.text(),b}}}class CK extends Ae{static lc_name(){return"SimpleRequestChain"}constructor(e){super(),Object.defineProperty(this,"requestMethod",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"function"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"response"}),this.requestMethod=e.requestMethod}get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}_chainType(){return"simple_request_chain"}async _call(e,r){const n=e[this.inputKey],i=n.name,s=n.arguments,a=await this.requestMethod(i,s);return{[this.outputKey]:a}}}async function yA(t,e={}){let r;if(typeof t=="string")try{r=await hi.fromURL(t)}catch{try{r=hi.fromString(t)}catch{throw new Error(`Unable to parse spec from source ${t}.`)}}else r=hi.fromObject(t);const{openAIFunctions:n,defaultExecutionMethod:i}=IK(r);if(i===void 0)throw new Error("Could not parse any valid operations from the provided spec.");const{llm:s=new $o({modelName:"gpt-3.5-turbo-0613"}),prompt:a=it.fromMessages([lt.fromTemplate(`Use the provided API's to respond to this user query:

{query}`)]),requestChain:o=new CK({requestMethod:async(d,f)=>i(d,f,{headers:e.headers,params:e.params})}),llmChainInputs:u={},verbose:l,...c}=e,h=new Q({llm:s,prompt:a,outputParser:new Do({argsOnly:!1}),outputKey:"function",llmKwargs:{functions:n},...u});return new ec({chains:[h,o],outputVariables:["response"],inputVariables:h.inputKeys,verbose:l,...c})}const RK=Object.freeze(Object.defineProperty({__proto__:null,APIChain:Ff,AnalyzeDocumentChain:mw,BaseChain:Ae,ChatVectorDBQAChain:pw,ConstitutionalChain:yw,ConstitutionalPrinciple:X,ConversationChain:fw,ConversationalRetrievalQAChain:gw,LLMChain:Q,LLMRouterChain:tc,MapReduceDocumentsChain:Co,MultiPromptChain:jd,MultiRetrievalQAChain:Nd,MultiRouteChain:bw,OpenAIModerationChain:Iq,PRINCIPLES:Vg,RefineDocumentsChain:Ro,RetrievalQAChain:Kg,RouterChain:eA,SequentialChain:ec,SimpleSequentialChain:zf,StuffDocumentsChain:vi,TransformChain:Nq,VectorDBQAChain:Vl,createExtractionChain:Pw,createExtractionChainFromZod:nA,createOpenAPIChain:yA,createTaggingChain:qf,createTaggingChainFromZod:iA,loadQAChain:xE,loadQAMapReduceChain:EE,loadQARefineChain:TE,loadQAStuffChain:Kl,loadSummarizationChain:xq},Symbol.toStringTag,{value:"Module"})),jK=`

`,Ic="context",NK=W.fromTemplate("{page_content}");async function $K({documentPrompt:t,documentSeparator:e,documents:r,config:n}){return(await Promise.all(r.map(s=>t.withConfig({runName:"document_formatter"}).invoke({...s.metadata,page_content:s.pageContent},n)))).join(e)}async function LK({llm:t,prompt:e,outputParser:r=new Io,documentPrompt:n=NK,documentSeparator:i=jK}){if(!e.inputVariables.includes(Ic))throw new Error(`Prompt must include a "${Ic}" variable`);return Bt.from([Sr.assign({[Ic]:new vf(Ic).pipe((s,a)=>$K({documents:s,documentPrompt:n,documentSeparator:i,config:a==null?void 0:a.config}))}),e,t,r],"stuff_documents_chain")}const DK=Object.freeze(Object.defineProperty({__proto__:null,createStuffDocumentsChain:LK},Symbol.toStringTag,{value:"Module"}));function MK(t,e,r){const n=[];let i=[];for(const s of t)if(i.push(s),e(i)>r){if(i.length===1)throw new Error("A single document was longer than the context length, we cannot handle this.");n.push(i.slice(0,-1)),i=i.slice(-1)}return n.push(i),n}async function FK(t,e){return{pageContent:await e(t),metadata:zK(t)}}function zK(t){const e={};for(const r in t[0].metadata)r in t[0].metadata&&(e[r]=String(t[0].metadata[r]));for(const r of t.slice(1))for(const n in r.metadata)n in e?e[n]+=`, ${r.metadata[n]}`:e[n]=String(r.metadata[n]);return e}const UK=Object.freeze(Object.defineProperty({__proto__:null,collapseDocs:FK,splitListOfDocs:MK},Symbol.toStringTag,{value:"Module"}));async function qK({llm:t,retriever:e,rephrasePrompt:r}){if(!r.inputVariables.includes("input"))throw new Error(`Expected "input" to be a prompt variable, but got ${JSON.stringify(r.inputVariables)}`);return wb.from([[i=>!i.chat_history||i.chat_history.length===0,Bt.from([i=>i.input,e])],Bt.from([r,t,new Io,e])]).withConfig({runName:"history_aware_retriever"})}const KK=Object.freeze(Object.defineProperty({__proto__:null,createHistoryAwareRetriever:qK},Symbol.toStringTag,{value:"Module"}));function VK(t){return t.jsonSchema===void 0&&t.zodSchema===void 0}class BK extends an{constructor(e){let r;if(VK(e)?r={jsonSchema:e}:r=e,r.jsonSchema===void 0&&r.zodSchema===void 0)throw new Error('Must provide at least one of "jsonSchema" or "zodSchema".');super(r),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chains","openai_functions"]}),Object.defineProperty(this,"functionOutputParser",{enumerable:!0,configurable:!0,writable:!0,value:new _w}),Object.defineProperty(this,"jsonSchemaValidator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),r.jsonSchema!==void 0&&(this.jsonSchemaValidator=new bE(r.jsonSchema,"7")),r.zodSchema!==void 0&&(this.zodSchema=r.zodSchema)}async parseResult(e){const r=await this.functionOutputParser.parseResult(e),n=JSON.parse(r,(i,s)=>{if(s!==null)return s});if(this.zodSchema){const i=this.zodSchema.safeParse(n);if(i.success)return i.data;throw new je(`Failed to parse. Text: "${r}". Error: ${JSON.stringify(i.error.errors)}`,r)}else if(this.jsonSchemaValidator!==void 0){const i=this.jsonSchemaValidator.validate(n);if(i.valid)return n;throw new je(`Failed to parse. Text: "${r}". Error: ${JSON.stringify(i.errors)}`,r)}else throw new Error("This parser requires an input JSON Schema or an input Zod schema.")}}function bA(t){const{outputSchema:e,llm:r=new $o({modelName:"gpt-3.5-turbo-0613",temperature:0}),outputKey:n="output",llmKwargs:i={},zodSchema:s,...a}=t;if(e===void 0&&s===void 0)throw new Error('Must provide one of "outputSchema" or "zodSchema".');const o="output_formatter";return new Q({llm:r,llmKwargs:{...i,functions:[{name:o,description:"Output formatter. Should always be used to format your response to the user.",parameters:e}],function_call:{name:o}},outputKey:n,outputParser:new BK({jsonSchema:e,zodSchema:s}),...a})}function HK(t,e){return bA({...e,outputSchema:Zt(t),zodSchema:t})}function wA(t){const{functions:e,llm:r,prompt:n,enforceSingleFunctionUsage:i=!0,outputParser:s=new Do}=t,a={functions:e};e.length===1&&i&&(a.function_call={name:e[0].name});const o=r.bind(a);return n.pipe(o).pipe(s)}function WK(t){return typeof t.safeParse=="function"}function JK(t){const{outputSchema:e,llm:r,prompt:n,outputParser:i}=t,a={name:"outputFormatter",description:"Output formatter. Should always be used to format your response to the user",parameters:WK(e)?Zt(e):e};return wA({functions:[a],llm:r,prompt:n,enforceSingleFunctionUsage:!0,outputParser:i})}const GK=Object.freeze(Object.defineProperty({__proto__:null,createExtractionChain:Pw,createExtractionChainFromZod:nA,createOpenAIFnRunnable:wA,createOpenAPIChain:yA,createStructuredOutputChain:bA,createStructuredOutputChainFromZod:HK,createStructuredOutputRunnable:JK,createTaggingChain:qf,createTaggingChainFromZod:iA},Symbol.toStringTag,{value:"Module"}));function ZK(t){return!!t&&typeof t.getRelevantDocuments=="function"}async function YK({retriever:t,combineDocsChain:e}){let r;return ZK(t)?r=Bt.from([i=>i.input,t]):r=t,Bt.from([Sr.assign({context:r.withConfig({runName:"retrieve_documents"}),chat_history:i=>i.chat_history??[]}),Sr.assign({answer:e})]).withConfig({runName:"retrieval_chain"})}const QK=Object.freeze(Object.defineProperty({__proto__:null,createRetrievalChain:YK},Symbol.toStringTag,{value:"Module"}));class Ew extends Qb{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","storage"]}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyEncoder",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"valueSerializer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"valueDeserializer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.store=e.store,this.keyEncoder=e.keyEncoder,this.valueSerializer=e.valueSerializer,this.valueDeserializer=e.valueDeserializer}async mget(e){const r=e.map(this.keyEncoder);return(await this.store.mget(r)).map(i=>{if(i!==void 0)return this.valueDeserializer(i)})}async mset(e){const r=e.map(([n,i])=>[this.keyEncoder(n),this.valueSerializer(i)]);return this.store.mset(r)}async mdelete(e){const r=e.map(this.keyEncoder);return this.store.mdelete(r)}async*yieldKeys(e){yield*this.store.yieldKeys(e)}}function vA(t){const e=new TextEncoder,r=new TextDecoder;return new Ew({store:t,keyEncoder:n=>n,valueSerializer:n=>e.encode(JSON.stringify({pageContent:n.pageContent,metadata:n.metadata})),valueDeserializer:n=>new Lt(JSON.parse(r.decode(n)))})}const XK=Object.freeze(Object.defineProperty({__proto__:null,EncoderBackedStore:Ew,createDocumentStoreFromByteStore:vA},Symbol.toStringTag,{value:"Module"}));class e3 extends Jl{constructor(e){super(e),Object.defineProperty(this,"underlyingEmbeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentEmbeddingStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.underlyingEmbeddings=e.underlyingEmbeddings,this.documentEmbeddingStore=e.documentEmbeddingStore}async embedQuery(e){return this.underlyingEmbeddings.embedQuery(e)}async embedDocuments(e){const r=await this.documentEmbeddingStore.mget(e),n=[],i=[];for(let s=0;s<r.length;s+=1)r[s]===void 0&&(n.push(s),i.push(e[s]));if(i.length){const s=await this.underlyingEmbeddings.embedDocuments(i),a=i.map((o,u)=>[o,s[u]]);await this.documentEmbeddingStore.mset(a);for(let o=0;o<n.length;o+=1)r[n[o]]=s[o]}return r}static fromBytesStore(e,r,n){const i=new TextEncoder,s=new TextDecoder,a=new Ew({store:r,keyEncoder:o=>((n==null?void 0:n.namespace)??"")+hl(o),valueSerializer:o=>i.encode(JSON.stringify(o)),valueDeserializer:o=>JSON.parse(s.decode(o))});return new this({underlyingEmbeddings:e,documentEmbeddingStore:a})}}const t3=Object.freeze(Object.defineProperty({__proto__:null,CacheBackedEmbeddings:e3},Symbol.toStringTag,{value:"Module"})),r3=Object.freeze(Object.defineProperty({__proto__:null,FakeChatMessageHistory:gT,FakeChatModel:dT,FakeEmbeddings:vT,FakeLLM:cT,FakeListChatMessageHistory:yT,FakeListChatModel:mT,FakeRetriever:pT,FakeRunnable:lT,FakeSplitIntoListParser:uT,FakeStreamingChatModel:fT,FakeStreamingLLM:hT,FakeTool:wT,FakeTracer:bT,SingleRunExtractor:PT,SyntheticEmbeddings:_T},Symbol.toStringTag,{value:"Module"}));class Tw extends rw{_vectorstoreType(){return"memory"}constructor(e,{similarity:r,...n}={}){super(e,n),Object.defineProperty(this,"memoryVectors",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"similarity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.similarity=r??Xb}async addDocuments(e){const r=e.map(({pageContent:n})=>n);return this.addVectors(await this.embeddings.embedDocuments(r),e)}async addVectors(e,r){const n=e.map((i,s)=>({content:r[s].pageContent,embedding:i,metadata:r[s].metadata}));this.memoryVectors=this.memoryVectors.concat(n)}async similaritySearchVectorWithScore(e,r,n){const i=u=>{if(!n)return!0;const l=new Lt({metadata:u.metadata,pageContent:u.content});return n(l)},s=this.memoryVectors.filter(i);return s.map((u,l)=>({similarity:this.similarity(e,u.embedding),index:l})).sort((u,l)=>u.similarity>l.similarity?-1:0).slice(0,r).map(u=>[new Lt({metadata:s[u.index].metadata,pageContent:s[u.index].content}),u.similarity])}static async fromTexts(e,r,n,i){const s=[];for(let a=0;a<e.length;a+=1){const o=Array.isArray(r)?r[a]:r,u=new Lt({pageContent:e[a],metadata:o});s.push(u)}return Tw.fromDocuments(s,n,i)}static async fromDocuments(e,r,n){const i=new this(r,n);return await i.addDocuments(e),i}static async fromExistingIndex(e,r){return new this(e,r)}}const n3=Object.freeze(Object.defineProperty({__proto__:null,MemoryVectorStore:Tw},Symbol.toStringTag,{value:"Module"}));class i3 extends Ti{constructor(e){super({returnMessages:(e==null?void 0:e.returnMessages)??!1,chatHistory:e==null?void 0:e.chatHistory,inputKey:e==null?void 0:e.inputKey,outputKey:e==null?void 0:e.outputKey}),Object.defineProperty(this,"humanPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"Human"}),Object.defineProperty(this,"aiPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"AI"}),Object.defineProperty(this,"memoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"history"}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:5}),this.humanPrefix=(e==null?void 0:e.humanPrefix)??this.humanPrefix,this.aiPrefix=(e==null?void 0:e.aiPrefix)??this.aiPrefix,this.memoryKey=(e==null?void 0:e.memoryKey)??this.memoryKey,this.k=(e==null?void 0:e.k)??this.k}get memoryKeys(){return[this.memoryKey]}async loadMemoryVariables(e){const r=await this.chatHistory.getMessages();return this.returnMessages?{[this.memoryKey]:r.slice(-this.k*2)}:{[this.memoryKey]:kt(r.slice(-this.k*2),this.humanPrefix,this.aiPrefix)}}}class s3 extends Gl{constructor(e){super(),Object.defineProperty(this,"vectorStoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"memoryKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnDocs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStoreRetriever=e.vectorStoreRetriever,this.inputKey=e.inputKey,this.memoryKey=e.memoryKey??"memory",this.returnDocs=e.returnDocs??!1,this.metadata=e.metadata}get memoryKeys(){return[this.memoryKey]}async loadMemoryVariables(e){const r=Zl(e,this.inputKey),n=await this.vectorStoreRetriever.getRelevantDocuments(r);return{[this.memoryKey]:this.returnDocs?n:Mf(n)}}async saveContext(e,r){const n=typeof this.metadata=="function"?this.metadata(e,r):this.metadata,i=Object.entries(e).filter(([s])=>s!==this.memoryKey).concat(Object.entries(r)).map(([s,a])=>`${s}: ${a}`).join(`
`);await this.vectorStoreRetriever.addDocuments([new Lt({pageContent:i,metadata:n})])}}class a3 extends St{}class o3 extends a3{constructor(){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","stores","entity","in_memory"]}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.store=Object.create(null)}async get(e,r){return e in this.store?this.store[e]:r}async set(e,r){this.store[e]=r}async delete(e){delete this.store[e]}async exists(e){return e in this.store}async clear(){this.store=Object.create(null)}}class u3 extends Ti{constructor(e){super({chatHistory:e.chatHistory,returnMessages:e.returnMessages??!1,inputKey:e.inputKey,outputKey:e.outputKey}),Object.defineProperty(this,"entityExtractionChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"entitySummarizationChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"entityStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"entityCache",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"chatHistoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"history"}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"entitiesKey",{enumerable:!0,configurable:!0,writable:!0,value:"entities"}),Object.defineProperty(this,"humanPrefix",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"aiPrefix",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llm=e.llm,this.humanPrefix=e.humanPrefix,this.aiPrefix=e.aiPrefix,this.chatHistoryKey=e.chatHistoryKey??this.chatHistoryKey,this.entitiesKey=e.entitiesKey??this.entitiesKey,this.entityExtractionChain=new Q({llm:this.llm,prompt:e.entityExtractionPrompt??gU}),this.entitySummarizationChain=new Q({llm:this.llm,prompt:e.entitySummarizationPrompt??bU}),this.entityStore=e.entityStore??new o3,this.entityCache=e.entityCache??this.entityCache,this.k=e.k??this.k}get memoryKeys(){return[this.chatHistoryKey]}get memoryVariables(){return[this.entitiesKey,this.chatHistoryKey]}async loadMemoryVariables(e){const r=this.inputKey??Mg(e,this.memoryVariables),n=await this.chatHistory.getMessages(),i=kt(n.slice(-this.k*2),this.humanPrefix,this.aiPrefix),s=await this.entityExtractionChain.predict({history:i,input:e[r]}),a=s.trim()==="NONE"?[]:s.split(",").map(l=>l.trim()),o={};for(const l of a)o[l]=await this.entityStore.get(l,"No current information known.");this.entityCache=[...a];const u=this.returnMessages?n.slice(-this.k*2):i;return{[this.chatHistoryKey]:u,[this.entitiesKey]:o}}async saveContext(e,r){await super.saveContext(e,r);const n=this.inputKey??Mg(e,this.memoryVariables),i=await this.chatHistory.getMessages(),s=kt(i.slice(-this.k*2),this.humanPrefix,this.aiPrefix),a=e[n];for(const o of this.entityCache){const u=await this.entityStore.get(o,"No current information known."),l=await this.entitySummarizationChain.predict({summary:u,entity:o,history:s,input:a});l.trim()!=="UNCHANGED"&&await this.entityStore.set(o,l.trim())}}async clear(){await super.clear(),await this.entityStore.clear()}}class l3 extends Ti{constructor(e){super({chatHistory:e==null?void 0:e.chatHistory,returnMessages:(e==null?void 0:e.returnMessages)??!1,inputKey:e==null?void 0:e.inputKey,outputKey:e==null?void 0:e.outputKey}),Object.defineProperty(this,"humanPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"Human"}),Object.defineProperty(this,"aiPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"AI"}),Object.defineProperty(this,"memoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"history"}),Object.defineProperty(this,"memories",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.memories=(e==null?void 0:e.memories)??this.memories,this.humanPrefix=(e==null?void 0:e.humanPrefix)??this.humanPrefix,this.aiPrefix=(e==null?void 0:e.aiPrefix)??this.aiPrefix,this.memoryKey=(e==null?void 0:e.memoryKey)??this.memoryKey,this.checkRepeatedMemoryVariable(),this.checkInputKey()}checkRepeatedMemoryVariable(){const e=[];for(const r of this.memories){const n=e.filter(i=>r.memoryKeys.includes(i));if(n.length>0)throw new Error(`The same variables ${[...n]} are found in multiple memory objects, which is not allowed by CombinedMemory.`);e.push(...r.memoryKeys)}}checkInputKey(){for(const e of this.memories)e.chatHistory!==void 0&&e.inputKey===void 0&&console.warn(`When using CombinedMemory, input keys should be set so the input is known. Was not set on ${e}.`)}async loadMemoryVariables(e){let r={};for(const n of this.memories){const i=await n.loadMemoryVariables(e);r={...r,...i}}return r}async saveContext(e,r){for(const n of this.memories)await n.saveContext(e,r)}async clear(){for(const e of this.memories)typeof e.clear=="function"&&await e.clear()}get memoryKeys(){const e=[];for(const r of this.memories)e.push(...r.memoryKeys);return e}}class c3 extends Ti{constructor(e){super(e),Object.defineProperty(this,"humanPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"Human"}),Object.defineProperty(this,"aiPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"AI"}),Object.defineProperty(this,"memoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"history"}),Object.defineProperty(this,"maxTokenLimit",{enumerable:!0,configurable:!0,writable:!0,value:2e3}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llm=e.llm,this.humanPrefix=(e==null?void 0:e.humanPrefix)??this.humanPrefix,this.aiPrefix=(e==null?void 0:e.aiPrefix)??this.aiPrefix,this.memoryKey=(e==null?void 0:e.memoryKey)??this.memoryKey,this.maxTokenLimit=(e==null?void 0:e.maxTokenLimit)??this.maxTokenLimit}get memoryKeys(){return[this.memoryKey]}async loadMemoryVariables(e){const r=await this.chatHistory.getMessages();return this.returnMessages?{[this.memoryKey]:r}:{[this.memoryKey]:kt(r,this.humanPrefix,this.aiPrefix)}}async saveContext(e,r){await super.saveContext(e,r);const n=await this.chatHistory.getMessages();let i=await this.llm.getNumTokens(kt(n,this.humanPrefix,this.aiPrefix));if(i>this.maxTokenLimit){const s=[];for(;i>this.maxTokenLimit;)s.push(n.shift()),i=await this.llm.getNumTokens(kt(n,this.humanPrefix,this.aiPrefix))}}}const $0=Object.freeze(Object.defineProperty({__proto__:null,BaseChatMemory:Ti,BaseConversationSummaryMemory:ow,BaseMemory:Gl,BufferMemory:Cd,BufferWindowMemory:i3,ChatMessageHistory:Lf,CombinedMemory:l3,ConversationSummaryBufferMemory:NT,ConversationSummaryMemory:_U,ConversationTokenBufferMemory:c3,ENTITY_MEMORY_CONVERSATION_TEMPLATE:pU,EntityMemory:u3,VectorStoreRetrieverMemory:s3,getBufferString:kt,getInputValue:Zl,getOutputValue:Df},Symbol.toStringTag,{value:"Module"}));class h3{async loadAndSplit(e){if(e===void 0)throw new Error("You must pass a text splitter to use this method.");const r=await this.load();return e.invoke(r)}}const d3=Object.freeze(Object.defineProperty({__proto__:null,BaseDocumentLoader:h3},Symbol.toStringTag,{value:"Module"}));class _A extends eT{static lc_name(){return"MetadataTagger"}constructor(e){if(super(),Object.defineProperty(this,"taggingChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.taggingChain=e.taggingChain,this.taggingChain.inputKeys.length!==1)throw new Error("Invalid input chain. The input chain must have exactly one input.");if(this.taggingChain.outputKeys.length!==1)throw new Error("Invalid input chain. The input chain must have exactly one output.")}async _transformDocument(e){const n=(await this.taggingChain.call({[this.taggingChain.inputKeys[0]]:e.pageContent}))[this.taggingChain.outputKeys[0]];return new Lt({pageContent:e.pageContent,metadata:{...n,...e.metadata}})}}function PA(t,e){const{llm:r=new $o({modelName:"gpt-3.5-turbo-0613"}),...n}=e,i=qf(t,r,n);return new _A({taggingChain:i})}function f3(t,e){return PA(Zt(t),e)}const p3=Object.freeze(Object.defineProperty({__proto__:null,MetadataTagger:_A,createMetadataTagger:PA,createMetadataTaggerFromZod:f3},Symbol.toStringTag,{value:"Module"})),m3=Object.freeze(Object.defineProperty({__proto__:null,BaseTracer:sn,ConsoleCallbackHandler:Wh,LangChainTracer:ra,RunCollectorCallbackHandler:nT,awaitAllCallbacks:jx,consumeCallback:vt},Symbol.toStringTag,{value:"Module"}));class g3 extends It{static lc_name(){return"RegexParser"}get lc_attributes(){return{regex:this.lc_kwargs.regex}}constructor(e,r,n){(typeof e=="string"||e instanceof RegExp)&&(e={regex:e,outputKeys:r,defaultOutputKey:n}),e.regex instanceof RegExp&&(e.regex={pattern:e.regex.source,flags:e.regex.flags}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","regex"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"regex",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultOutputKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.regex=typeof e.regex=="string"?new RegExp(e.regex):"pattern"in e.regex?new RegExp(e.regex.pattern,e.regex.flags):e.regex,this.outputKeys=e.outputKeys,this.defaultOutputKey=e.defaultOutputKey}_type(){return"regex_parser"}async parse(e){const r=e.match(this.regex);if(r)return this.outputKeys.reduce((n,i,s)=>(n[i]=r[s+1],n),{});if(this.defaultOutputKey===void 0)throw new je(`Could not parse output: ${e}`,e);return this.outputKeys.reduce((n,i)=>(n[i]=i===this.defaultOutputKey?e:"",n),{})}getFormatInstructions(){return`Your response should match the following regex: ${this.regex}`}}class y3 extends It{static lc_name(){return"CombiningOutputParser"}constructor(e,...r){(r.length>0||!("parsers"in e))&&(e={parsers:[e,...r]}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","combining"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"parsers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputDelimiter",{enumerable:!0,configurable:!0,writable:!0,value:"-----"}),this.parsers=e.parsers}async parse(e,r){const n=e.trim().split(new RegExp(`${this.outputDelimiter}Output \\d+${this.outputDelimiter}`)).slice(1),i={};for(const[s,a]of this.parsers.entries()){let o;try{let u=n[s].includes("```")?n[s].trim().split(/```/)[1]:n[s].trim();u.endsWith(this.outputDelimiter)&&(u=u.slice(0,-this.outputDelimiter.length)),o=await a.parse(u,r)}catch{o=await a.parse(e.trim(),r)}Object.assign(i,o)}return i}getFormatInstructions(){return`${[`Return the following ${this.parsers.length} outputs, each formatted as described below. Include the delimiter characters "${this.outputDelimiter}" in your response:`,...this.parsers.map((e,r)=>`${this.outputDelimiter}Output ${r+1}${this.outputDelimiter}
${e.getFormatInstructions().trim()}
${this.outputDelimiter}`)].join(`

`)}
`}}class OA extends an{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}async parseResult(e){const r=e[0].message.additional_kwargs.tool_calls;if(!r)throw new Error(`No tools_call in message ${JSON.stringify(e)}`);const n=JSON.parse(JSON.stringify(r)),i=[];for(const s of n)if(s.function!==void 0){const a={type:s.function.name,args:JSON.parse(s.function.arguments)};this.returnId&&(a.id=s.id),Object.defineProperty(a,"name",{get(){return this.type}}),Object.defineProperty(a,"arguments",{get(){return this.args}}),i.push(a)}return i}}class b3 extends an{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"initialParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.initialParser=new OA(e)}async parseResult(e){const n=(await this.initialParser.parseResult(e)).filter(s=>s.type===this.keyName);let i=n;return this.returnId||(i=n.map(s=>s.args)),this.returnSingle?i[0]:i}}class w3 extends Ao{static lc_name(){return"HttpResponseOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parser"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:new Io}),Object.defineProperty(this,"contentType",{enumerable:!0,configurable:!0,writable:!0,value:"text/plain"}),this.outputParser=(e==null?void 0:e.outputParser)??this.outputParser,this.contentType=(e==null?void 0:e.contentType)??this.contentType}async*_transform(e){for await(const r of this.outputParser._transform(e))typeof r=="string"?yield this.parse(r):yield this.parse(JSON.stringify(r));this.contentType==="text/event-stream"&&(yield new TextEncoder().encode(`event: end

`))}async parse(e){const r=await this.outputParser.parse(e),n=new TextEncoder;if(this.contentType==="text/event-stream")return n.encode(`event: data
data: ${JSON.stringify(r)}

`);let i;return typeof r=="string"?i=r:i=JSON.stringify(r),n.encode(i)}getFormatInstructions(){return""}}class v3 extends It{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"format",{enumerable:!0,configurable:!0,writable:!0,value:"YYYY-MM-DDTHH:mm:ssZ"})}static lc_name(){return"DatetimeOutputParser"}async parse(e){const r=new Date(e.trim());if(Number.isNaN(r.getTime()))throw new je(`Could not parse output: ${e}`,e);return r}getFormatInstructions(){return[`Your response should be a datetime string that matches the following pattern: "${this.format}".`,"Examples: 2011-10-05T14:48:00Z, 2019-01-01T00:00:00Z, 1932-04-21T04:42:23Z","Return ONLY this string, no other words!"].join(`

`)}}const _3=Object.freeze(Object.defineProperty({__proto__:null,AsymmetricStructuredOutputParser:Rq,CombiningOutputParser:y3,CommaSeparatedListOutputParser:wE,CustomListOutputParser:vE,DatetimeOutputParser:v3,HttpResponseOutputParser:w3,JsonKeyOutputFunctionsParser:rA,JsonMarkdownStructuredOutputParser:ww,JsonOutputFunctionsParser:Do,JsonOutputKeyToolsParser:b3,JsonOutputToolsParser:OA,ListOutputParser:ko,OutputFixingParser:Xl,OutputFunctionsParser:_w,RegexParser:g3,RouterOutputParser:vw,StructuredOutputParser:tA},Symbol.toStringTag,{value:"Module"}));class P3 extends bs{static lc_name(){return"ContextualCompressionRetriever"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","retrievers","contextual_compression"]}),Object.defineProperty(this,"baseCompressor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"baseRetriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseCompressor=e.baseCompressor,this.baseRetriever=e.baseRetriever}async _getRelevantDocuments(e,r){const n=await this.baseRetriever.getRelevantDocuments(e,r==null?void 0:r.getChild("base_retriever"));return await this.baseCompressor.compressDocuments(n,e,r==null?void 0:r.getChild("base_compressor"))}}const O3=Object.freeze(Object.defineProperty({__proto__:null,ContextualCompressionRetriever:P3},Symbol.toStringTag,{value:"Module"}));class El{static isBaseDocumentCompressor(e){return(e==null?void 0:e.compressDocuments)!==void 0}}class S3 extends El{constructor(e){super(),Object.defineProperty(this,"transformers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.transformers=e.transformers}async compressDocuments(e,r,n){let i=e;for(const s of this.transformers)El.isBaseDocumentCompressor(s)?i=await s.compressDocuments(i,r,n):i=await s.transformDocuments(i);return i}}const x3=Object.freeze(Object.defineProperty({__proto__:null,BaseDocumentCompressor:El,DocumentCompressorPipeline:S3},Symbol.toStringTag,{value:"Module"}));class E3 extends bs{static lc_name(){return"EnsembleRetriever"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","retrievers","ensemble_retriever"]}),Object.defineProperty(this,"retrievers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"weights",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"c",{enumerable:!0,configurable:!0,writable:!0,value:60}),this.retrievers=e.retrievers,this.weights=e.weights||new Array(e.retrievers.length).fill(1/e.retrievers.length),this.c=e.c||60}async _getRelevantDocuments(e,r){return this._rankFusion(e,r)}async _rankFusion(e,r){const n=await Promise.all(this.retrievers.map((s,a)=>s.invoke(e,{callbacks:r==null?void 0:r.getChild(`retriever_${a+1}`)})));return await this._weightedReciprocalRank(n)}async _weightedReciprocalRank(e){if(e.length!==this.weights.length)throw new Error("Number of retrieved document lists must be equal to the number of weights.");const r=e.reduce((s,a,o)=>{let u=1;const l=this.weights[o];for(;u<=a.length;){const{pageContent:c}=a[u-1];s[c]||(s[c]=0),s[c]+=l/(u+this.c),u+=1}return s},{}),n=this._uniqueUnion(e.flat());return Array.from(n).sort((s,a)=>r[a.pageContent]-r[s.pageContent])}_uniqueUnion(e){const r=new Set,n=[];for(const i of e){const s=i.pageContent;r.has(s)||(r.add(s),n.push(i))}return n}}const T3=Object.freeze(Object.defineProperty({__proto__:null,EnsembleRetriever:E3},Symbol.toStringTag,{value:"Module"}));class A3 extends It{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","retrievers","multiquery"]})}static lc_name(){return"LineListOutputParser"}async parse(e){const r=e.indexOf("<questions>"),n=e.indexOf("</questions>"),i=r===-1?0:r+11,s=n===-1?e.length:n;return{lines:e.slice(i,s).trim().split(`
`).filter(o=>o.trim()!=="")}}getFormatInstructions(){throw new Error("Not implemented.")}}const k3=new W({inputVariables:["question","queryCount"],template:`You are an AI language model assistant. Your task is
to generate {queryCount} different versions of the given user
question to retrieve relevant documents from a vector database.
By generating multiple perspectives on the user question,
your goal is to help the user overcome some of the limitations
of distance-based similarity search.

Provide these alternative questions separated by newlines between XML tags. For example:

<questions>
Question 1
Question 2
Question 3
</questions>

Original question: {question}`});class I3 extends bs{static lc_name(){return"MultiQueryRetriever"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","retrievers","multiquery"]}),Object.defineProperty(this,"retriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queryCount",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"parserKey",{enumerable:!0,configurable:!0,writable:!0,value:"lines"}),Object.defineProperty(this,"documentCompressor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentCompressorFilteringFn",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.retriever=e.retriever,this.llmChain=e.llmChain,this.queryCount=e.queryCount??this.queryCount,this.parserKey=e.parserKey??this.parserKey,this.documentCompressor=e.documentCompressor,this.documentCompressorFilteringFn=e.documentCompressorFilteringFn}static fromLLM(e){const{retriever:r,llm:n,prompt:i=k3,queryCount:s,parserKey:a,...o}=e,u=new A3,l=new Q({llm:n,prompt:i,outputParser:u});return new this({retriever:r,llmChain:l,queryCount:s,parserKey:a,...o})}async _generateQueries(e,r){const i=(await this.llmChain.call({question:e,queryCount:this.queryCount},r==null?void 0:r.getChild())).text[this.parserKey]||[];return this.verbose&&console.log(`Generated queries: ${i}`),i}async _retrieveDocuments(e,r){const n=[];return await Promise.all(e.map(async i=>{const s=await this.retriever.getRelevantDocuments(i,r==null?void 0:r.getChild());n.push(...s)})),n}_uniqueUnion(e){const r={};for(const i of e){const s=`${i.pageContent}:${JSON.stringify(Object.entries(i.metadata).sort())}`;r[s]=i}return Object.values(r)}async _getRelevantDocuments(e,r){const n=await this._generateQueries(e,r),i=await this._retrieveDocuments(n,r),s=this._uniqueUnion(i);let a=s;return this.documentCompressor&&s.length&&(a=await this.documentCompressor.compressDocuments(s,e),this.documentCompressorFilteringFn&&(a=this.documentCompressorFilteringFn(a))),a}}const C3=Object.freeze(Object.defineProperty({__proto__:null,MultiQueryRetriever:I3},Symbol.toStringTag,{value:"Module"}));class SA extends bs{static lc_name(){return"MultiVectorRetriever"}constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","retrievers","multi_vector"]}),Object.defineProperty(this,"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"idKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"childK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parentK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorstore=e.vectorstore,e.byteStore)this.docstore=vA(e.byteStore);else if(e.docstore)this.docstore=e.docstore;else throw new Error("byteStore and docstore are undefined. Please provide at least one.");this.idKey=e.idKey??"doc_id",this.childK=e.childK,this.parentK=e.parentK}async _getRelevantDocuments(e){const r=await this.vectorstore.similaritySearch(e,this.childK),n=[];for(const s of r)s.metadata[this.idKey]&&!n.includes(s.metadata[this.idKey])&&n.push(s.metadata[this.idKey]);return(await this.docstore.mget(n)).filter(s=>s!==void 0).slice(0,this.parentK)}}const R3=Object.freeze(Object.defineProperty({__proto__:null,MultiVectorRetriever:SA},Symbol.toStringTag,{value:"Module"}));class j3 extends SA{static lc_name(){return"ParentDocumentRetriever"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","retrievers","parent_document"]}),Object.defineProperty(this,"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"childSplitter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parentSplitter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"idKey",{enumerable:!0,configurable:!0,writable:!0,value:"doc_id"}),Object.defineProperty(this,"childK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parentK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"childDocumentRetriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentCompressor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentCompressorFilteringFn",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorstore=e.vectorstore,this.childSplitter=e.childSplitter,this.parentSplitter=e.parentSplitter,this.idKey=e.idKey??this.idKey,this.childK=e.childK,this.parentK=e.parentK,this.childDocumentRetriever=e.childDocumentRetriever,this.documentCompressor=e.documentCompressor,this.documentCompressorFilteringFn=e.documentCompressorFilteringFn}async _getRelevantDocuments(e){let r=[];this.childDocumentRetriever?r=await this.childDocumentRetriever.getRelevantDocuments(e):r=await this.vectorstore.similaritySearch(e,this.childK),this.documentCompressor&&r.length&&(r=await this.documentCompressor.compressDocuments(r,e),this.documentCompressorFilteringFn&&(r=this.documentCompressorFilteringFn(r)));const n=[];for(const o of r)n.includes(o.metadata[this.idKey])||n.push(o.metadata[this.idKey]);const i=[],a=(await this.docstore.mget(n)).filter(o=>o!==void 0);return i.push(...a),i.slice(0,this.parentK)}async addDocuments(e,r){const{ids:n,addToDocstore:i=!0,childDocChunkHeaderOptions:s={}}=r??{},a=this.parentSplitter?await this.parentSplitter.splitDocuments(e):e;let o;if(n===void 0){if(!i)throw new Error('If ids are not passed in, "config.addToDocstore" MUST be true');o=a.map(c=>Cr())}else o=n;if(a.length!==o.length)throw new Error(`Got uneven list of documents and ids.
If "ids" is provided, should be same length as "documents".`);const u=[],l={};for(let c=0;c<a.length;c+=1){const h=a[c],d=o[c],p=(await this.childSplitter.splitDocuments([h],s)).map(y=>new Lt({pageContent:y.pageContent,metadata:{...y.metadata,[this.idKey]:d}}));u.push(...p),l[d]=h}this.childDocumentRetriever?await this.childDocumentRetriever.addDocuments(u):await this.vectorstore.addDocuments(u),i&&await this.docstore.mset(Object.entries(l))}}const N3=Object.freeze(Object.defineProperty({__proto__:null,ParentDocumentRetriever:j3},Symbol.toStringTag,{value:"Module"})),du="last_accessed_at",fu="buffer_idx";class $3 extends bs{static lc_name(){return"TimeWeightedVectorStoreRetriever"}get lc_namespace(){return["langchain","retrievers","time_weighted"]}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"memoryStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"decayRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"otherScoreKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultSalience",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.searchKwargs=e.searchKwargs??100,this.memoryStream=e.memoryStream??[],this.decayRate=e.decayRate??.01,this.k=e.k??4,this.otherScoreKeys=e.otherScoreKeys??[],this.defaultSalience=e.defaultSalience??null}getMemoryStream(){return this.memoryStream}setMemoryStream(e){this.memoryStream=e}async _getRelevantDocuments(e,r){const n=Math.floor(Date.now()/1e3),i=this.getMemoryDocsAndScores(),s=await this.getSalientDocuments(e,r),a={...i,...s};return this.computeResults(a,n)}async addDocuments(e){const r=Math.floor(Date.now()/1e3),n=this.prepareDocuments(e,r);this.memoryStream.push(...n),await this.vectorStore.addDocuments(n)}getMemoryDocsAndScores(){const e={};for(const r of this.memoryStream.slice(-this.k)){const n=r.metadata[fu];if(n===void 0)throw new Error('Found a document in the vector store that is missing required metadata. This retriever only supports vector stores with documents that have been added through the "addDocuments" method on a TimeWeightedVectorStoreRetriever, not directly added or loaded into the backing vector store.');e[n]={doc:r,score:this.defaultSalience??0}}return e}async getSalientDocuments(e,r){const n=await this.vectorStore.similaritySearchWithScore(e,this.searchKwargs,void 0,r==null?void 0:r.getChild()),i={};for(const[s,a]of n){const o=s.metadata[fu];if(o===void 0)throw new Error('Found a document in the vector store that is missing required metadata. This retriever only supports vector stores with documents that have been added through the "addDocuments" method on a TimeWeightedVectorStoreRetriever, not directly added or loaded into the backing vector store.');const u=this.memoryStream[o];i[o]={doc:u,score:a}}return i}computeResults(e,r){const n=Object.values(e).map(({doc:s,score:a})=>({doc:s,score:this.getCombinedScore(s,a,r)})).sort((s,a)=>a.score-s.score),i=[];for(const{doc:s}of n){const a=this.memoryStream[s.metadata[fu]];if(a.metadata[du]=r,i.push(a),i.length>this.k)break}return i}prepareDocuments(e,r){return e.map((n,i)=>({...n,metadata:{...n.metadata,[du]:n.metadata[du]??r,created_at:n.metadata.created_at??r,[fu]:this.memoryStream.length+i}}))}getCombinedScore(e,r,n){const i=this.getHoursPassed(n,e.metadata[du]);let s=(1-this.decayRate)**i;for(const a of this.otherScoreKeys)s+=e.metadata[a];return r!==null&&(s+=r),s}getHoursPassed(e,r){return(e-r)/3600}}const L3=Object.freeze(Object.defineProperty({__proto__:null,BUFFER_IDX:fu,LAST_ACCESSED_AT_KEY:du,TimeWeightedVectorStoreRetriever:$3},Symbol.toStringTag,{value:"Module"})),D3=t=>`Given the following question and context, extract any part of the context *AS IS* that is relevant to answer the question. If none of the context is relevant return ${t}.

Remember, *DO NOT* edit the extracted parts of the context.

> Question: {question}
> Context:
>>>
{context}
>>>
Extracted relevant parts:`;function L0(t,e){return{question:t,context:e.pageContent}}class M3 extends It{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","retrievers","document_compressors","chain_extract"]}),Object.defineProperty(this,"noOutputStr",{enumerable:!0,configurable:!0,writable:!0,value:"NO_OUTPUT"})}parse(e){const r=e.trim();return r===this.noOutputStr?Promise.resolve(""):Promise.resolve(r)}getFormatInstructions(){throw new Error("Method not implemented.")}}function F3(){const t=new M3,e=D3(t.noOutputStr);return new W({template:e,inputVariables:["question","context"],outputParser:t})}class Aw extends El{constructor({llmChain:e,getInput:r}){super(),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getInput",{enumerable:!0,configurable:!0,writable:!0,value:L0}),this.llmChain=e,this.getInput=r}async compressDocuments(e,r){return(await Promise.all(e.map(async i=>{const s=this.getInput(r,i),a=await this.llmChain.predict(s);return a.length>0?new Lt({pageContent:a,metadata:i.metadata}):void 0}))).filter(i=>i!==void 0)}static fromLLM(e,r,n){const i=r||F3(),s=n||L0,a=new Q({llm:e,prompt:i});return new Aw({llmChain:a,getInput:s})}}const z3=Object.freeze(Object.defineProperty({__proto__:null,LLMChainExtractor:Aw},Symbol.toStringTag,{value:"Module"}));class U3 extends El{constructor(e){if(super(),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"similarityFn",{enumerable:!0,configurable:!0,writable:!0,value:fo}),Object.defineProperty(this,"similarityThreshold",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:20}),this.embeddings=e.embeddings,this.similarityFn=e.similarityFn??this.similarityFn,this.similarityThreshold=e.similarityThreshold,this.k="k"in e?e.k:this.k,this.k===void 0&&this.similarityThreshold===void 0)throw new Error('Must specify one of "k" or "similarity_threshold".')}async compressDocuments(e,r){const n=await this.embeddings.embedDocuments(e.map(o=>o.pageContent)),i=await this.embeddings.embedQuery(r),s=this.similarityFn([i],n)[0];let a=Array.from({length:n.length},(o,u)=>u);if(this.k!==void 0&&(a=a.map((o,u)=>[s[u],o]).sort(([o],[u])=>u-o).slice(0,this.k).map(([,o])=>o)),this.similarityThreshold!==void 0){const o=this.similarityThreshold;a=a.filter(u=>s[u]>o)}return a.map(o=>e[o])}}const q3=Object.freeze(Object.defineProperty({__proto__:null,EmbeddingsFilter:U3},Symbol.toStringTag,{value:"Module"}));class K3 extends Ls{static lc_name(){return"HydeRetriever"}get lc_namespace(){return["langchain","retrievers","hyde"]}constructor(e){if(super(e),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"promptTemplate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llm=e.llm,this.promptTemplate=typeof e.promptTemplate=="string"?xA(e.promptTemplate):e.promptTemplate,this.promptTemplate){const{inputVariables:r}=this.promptTemplate;if(r.length!==1&&r[0]!=="question")throw new Error(`Prompt template must accept a single input variable 'question'. Invalid input variables for prompt template: ${r}`)}}async _getRelevantDocuments(e,r){let n=new So(e);this.promptTemplate&&(n=await this.promptTemplate.formatPromptValue({question:e}));const s=(await this.llm.generatePrompt([n])).generations[0][0].text;return await this.vectorStore.similaritySearch(s,this.k,this.filter,r==null?void 0:r.getChild("vectorstore"))}}function xA(t){let e;switch(t){case"websearch":e=`Please write a passage to answer the question
Question: {question}
Passage:`;break;case"scifact":e=`Please write a scientific paper passage to support/refute the claim
Claim: {question}
Passage:`;break;case"arguana":e=`Please write a counter argument for the passage
Passage: {question}
Counter Argument:`;break;case"trec-covid":e=`Please write a scientific paper passage to answer the question
Question: {question}
Passage:`;break;case"fiqa":e=`Please write a financial article passage to answer the question
Question: {question}
Passage:`;break;case"dbpedia-entity":e=`Please write a passage to answer the question.
Question: {question}
Passage:`;break;case"trec-news":e=`Please write a news passage about the topic.
Topic: {question}
Passage:`;break;case"mr-tydi":e=`Please write a passage in Swahili/Korean/Japanese/Bengali to answer the question in detail.
Question: {question}
Passage:`;break;default:throw new Error(`Invalid prompt key: ${t}`)}return W.fromTemplate(e)}const V3=Object.freeze(Object.defineProperty({__proto__:null,HydeRetriever:K3,getPromptTemplateFromKey:xA},Symbol.toStringTag,{value:"Module"}));class B3 extends Ls{constructor(e){super(e),Object.defineProperty(this,"minSimilarityScore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kIncrement",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"maxK",{enumerable:!0,configurable:!0,writable:!0,value:100}),this.maxK=e.maxK??this.maxK,this.minSimilarityScore=e.minSimilarityScore??this.minSimilarityScore,this.kIncrement=e.kIncrement??this.kIncrement}async getRelevantDocuments(e){let r=0,n=[];do r+=this.kIncrement,n=(await this.vectorStore.similaritySearchWithScore(e,r,this.filter)).filter(([,s])=>s>=this.minSimilarityScore);while(n.length>=r&&r<this.maxK);return n.map(i=>i[0]).slice(0,this.maxK)}static fromVectorStore(e,r){return new this({...r,vectorStore:e})}}const H3=Object.freeze(Object.defineProperty({__proto__:null,ScoreThresholdRetriever:B3},Symbol.toStringTag,{value:"Module"}));class W3 extends Ls{constructor(e){super(e),Object.defineProperty(this,"smallK",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"largeK",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"largeEmbeddingKey",{enumerable:!0,configurable:!0,writable:!0,value:"lc_large_embedding"}),Object.defineProperty(this,"largeEmbeddingModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"cosine"}),Object.defineProperty(this,"addDocuments",{enumerable:!0,configurable:!0,writable:!0,value:async(r,n)=>{if(r.some(o=>this.largeEmbeddingKey in o.metadata))throw new Error(`All documents must not contain the large embedding key: ${this.largeEmbeddingKey} in their metadata.`);const i=r.map(o=>o.pageContent),s=await this.largeEmbeddingModel.embedDocuments(i),a=r.map((o,u)=>({...o,metadata:{...o.metadata,[this.largeEmbeddingKey]:JSON.stringify(s[u])}}));return this.vectorStore.addDocuments(a,n)}}),this.smallK=e.smallK??this.smallK,this.largeK=e.largeK??this.largeK,this.largeEmbeddingKey=e.largeEmbeddingKey??this.largeEmbeddingKey,this.largeEmbeddingModel=e.largeEmbeddingModel,this.searchType=e.searchType??this.searchType}_rankByLargeEmbeddings(e,r){const n=r.map(o=>JSON.parse(o.metadata[this.largeEmbeddingKey]));let i;switch(this.searchType){case"cosine":i=()=>fo([e],n);break;case"innerProduct":i=()=>ew([e],n);break;case"euclidean":i=()=>tw([e],n);break;default:throw new Error(`Unknown search type: ${this.searchType}`)}const[s]=i();let a=Array.from({length:r.length},(o,u)=>u);return a=a.map((o,u)=>[s[u],o]).sort(([o],[u])=>u-o).slice(0,this.largeK).map(([,o])=>o),a.map(o=>r[o])}async _getRelevantDocuments(e){const[r,n]=await Promise.all([this.largeEmbeddingModel.embedQuery(e),this.vectorStore.similaritySearch(e,this.smallK,this.filter)]);return this._rankByLargeEmbeddings(r,n)}}const J3=Object.freeze(Object.defineProperty({__proto__:null,MatryoshkaRetriever:W3},Symbol.toStringTag,{value:"Module"}));class EA{}const G3=Object.freeze(Object.defineProperty({__proto__:null,Docstore:EA},Symbol.toStringTag,{value:"Module"}));class Z3 extends EA{constructor(e){super(),Object.defineProperty(this,"_docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._docs=e??new Map}async search(e){const r=this._docs.get(e);if(r)return r;throw new Error(`ID ${e} not found.`)}async add(e){const r=[...this._docs.keys()],n=Object.keys(e).filter(i=>r.includes(i));if(n.length>0)throw new Error(`Tried to add ids that already exist: ${n}`);for(const[i,s]of Object.entries(e))this._docs.set(i,s)}async mget(e){return Promise.all(e.map(r=>this.search(r)))}async mset(e){await Promise.all(e.map(([r,n])=>this.add({[r]:n})))}async mdelete(e){throw new Error("Not implemented.")}async*yieldKeys(e){throw new Error("Not implemented")}}class Y3{constructor(e){Object.defineProperty(this,"_docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._docs=e??new Map}search(e){const r=this._docs.get(e);if(r)return r;throw new Error(`ID ${e} not found.`)}add(e){const r=[...this._docs.keys()],n=Object.keys(e).filter(i=>r.includes(i));if(n.length>0)throw new Error(`Tried to add ids that already exist: ${n}`);for(const[i,s]of Object.entries(e))this._docs.set(i,s)}}const Q3=Object.freeze(Object.defineProperty({__proto__:null,InMemoryDocstore:Z3,SynchronousInMemoryDocstore:Y3},Symbol.toStringTag,{value:"Module"}));class X3 extends St{}class eV extends X3{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","stores","file","in_memory"]}),Object.defineProperty(this,"files",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}async readFile(e){const r=this.files.get(e);if(r===void 0)throw new Error(`File not found: ${e}`);return r}async writeFile(e,r){this.files.set(e,r)}}const tV=Object.freeze(Object.defineProperty({__proto__:null,InMemoryFileStore:eV},Symbol.toStringTag,{value:"Module"})),rV=Object.freeze(Object.defineProperty({__proto__:null,InMemoryStore:rT},Symbol.toStringTag,{value:"Module"})),nV=Object.freeze(Object.defineProperty({__proto__:null,cosineSimilarity:fo,euclideanDistance:tw,innerProduct:ew,matrixFunc:Yl,maximalMarginalRelevance:aT,normalize:sT},Symbol.toStringTag,{value:"Module"}));async function TA(t=1e3){return new Promise(e=>{setTimeout(e,t)})}const iV=Object.freeze(Object.defineProperty({__proto__:null,sleep:TA},Symbol.toStringTag,{value:"Module"})),AA="finish";class sV{constructor(){Object.defineProperty(this,"constraints",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"commands",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"resources",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"performance_evaluation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_format",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.constraints=[],this.commands=[],this.resources=[],this.performance_evaluation=[],this.response_format={thoughts:{text:"thought",reasoning:"reasoning",plan:`- short bulleted
- list that conveys
- long-term plan`,criticism:"constructive self-criticism",speak:"thoughts summary to say to user"},command:{name:"command name",args:{"arg name":"value"}}}}add_constraint(e){this.constraints.push(e)}add_tool(e){this.commands.push(e)}_generate_command_string(e){let r=`"${e.name}": ${e.description}`;return r+=`, args json schema: ${JSON.stringify(Zt(e.schema).properties)}`,r}add_resource(e){this.resources.push(e)}add_performance_evaluation(e){this.performance_evaluation.push(e)}_generate_numbered_list(e,r="list"){if(r==="command"){const n=e.map((o,u)=>`${u+1}. ${this._generate_command_string(o)}`),a=`${e.length+1}. ${AA}: use this to signal that you have finished all your objectives, args: "response": "final response to let people know you have finished your objectives"`;return n.concat([a]).join(`
`)}return e.map((n,i)=>`${i+1}. ${n}`).join(`
`)}generate_prompt_string(){const e=JSON.stringify(this.response_format,null,4);return`Constraints:
${this._generate_numbered_list(this.constraints)}

Commands:
${this._generate_numbered_list(this.commands,"command")}

Resources:
${this._generate_numbered_list(this.resources)}

Performance Evaluation:
${this._generate_numbered_list(this.performance_evaluation)}

You should only respond in JSON format as described below 
Response Format: 
${e} 
Ensure the response can be parsed by Python json.loads`}}function aV(t){const e=new sV;e.add_constraint("~4000 word limit for short term memory. Your short term memory is short, so immediately save important information to files."),e.add_constraint("If you are unsure how you previously did something or want to recall past events, thinking about similar events will help you remember."),e.add_constraint("No user assistance"),e.add_constraint('Exclusively use the commands listed in double quotes e.g. "command name"');for(const n of t)e.add_tool(n);return e.add_resource("Internet access for searches and information gathering."),e.add_resource("Long Term memory management."),e.add_resource("GPT-3.5 powered Agents for delegation of simple tasks."),e.add_resource("File output."),e.add_performance_evaluation("Continuously review and analyze your actions to ensure you are performing to the best of your abilities."),e.add_performance_evaluation("Constructively self-criticize your big-picture behavior constantly."),e.add_performance_evaluation("Reflect on past decisions and strategies to refine your approach."),e.add_performance_evaluation("Every command has a cost, so be smart and efficient. Aim to complete tasks in the least number of steps."),e.generate_prompt_string()}class kA extends Tf{constructor(e){super({inputVariables:["goals","memory","messages","user_input"]}),Object.defineProperty(this,"aiName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"aiRole",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tokenCounter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendTokenLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.aiName=e.aiName,this.aiRole=e.aiRole,this.tools=e.tools,this.tokenCounter=e.tokenCounter,this.sendTokenLimit=e.sendTokenLimit||4196}_getPromptType(){return"autogpt"}constructFullPrompt(e){let n=`You are ${this.aiName}, ${this.aiRole}
Your decisions must always be made independently
            without seeking user assistance. Play to your strengths
            as an LLM and pursue simple strategies with no legal complications.
            If you have completed all your tasks,
            make sure to use the "finish" command.

GOALS:

`;return e.forEach((i,s)=>{n+=`${s+1}. ${i}
`}),n+=`

${aV(this.tools)}`,n}async formatMessages({goals:e,memory:r,messages:n,user_input:i}){const s=new Xr(this.constructFullPrompt(e)),a=new Xr(`The current time and date is ${new Date().toLocaleString()}`);if(typeof s.content!="string"||typeof a.content!="string")throw new Error("Non-string message content is not supported.");const o=await this.tokenCounter(s.content)+await this.tokenCounter(a.content),l=(await r.getRelevantDocuments(JSON.stringify(n.slice(-10)))).map(g=>g.pageContent);let c=await l.reduce(async(g,m)=>await g+await this.tokenCounter(m),Promise.resolve(0));for(;o+c>2500;)l.pop(),c=await l.reduce(async(g,m)=>await g+await this.tokenCounter(m),Promise.resolve(0));const h=`This reminds you of these events from your past:
${l.join(`
`)}

`,d=new Xr(h);if(typeof d.content!="string")throw new Error("Non-string message content is not supported.");const f=o+await this.tokenCounter(d.content),p=[];for(const g of n.slice(-10).reverse()){if(typeof g.content!="string")throw new Error("Non-string message content is not supported.");const m=await this.tokenCounter(g.content);if(f+m>this.sendTokenLimit-1e3)break;p.unshift(g)}const y=new ut(i);return[s,a,d,...p,y]}async partial(e){throw new Error("Method not implemented.")}serialize(){throw new Error("Method not implemented.")}}function IA(t){var n;const e=t.replace(new RegExp('(?<!\\\\)\\\\(?!["\\\\/bfnrt]|u[0-9a-fA-F]{4})',"g"),"\\\\"),r=e.match(/```(.*)(\r\n|\r|\n)(?<code>[\w\W\n]+)(\r\n|\r|\n)```/);return(n=r==null?void 0:r.groups)!=null&&n.code?r.groups.code.trim():e}class CA extends It{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","experimental","autogpt"]})}getFormatInstructions(){throw new Error("Method not implemented.")}async parse(e){let r;try{r=JSON.parse(e)}catch{const i=IA(e);try{r=JSON.parse(i)}catch{return{name:"ERROR",args:{error:`Could not parse invalid json: ${e}`}}}}try{return{name:r.command.name,args:r.command.args}}catch{return{name:"ERROR",args:{error:`Incomplete command args: ${r}`}}}}}class kw{constructor({aiName:e,memory:r,chain:n,outputParser:i,tools:s,feedbackTool:a,maxIterations:o}){Object.defineProperty(this,"aiName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"memory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fullMessageHistory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nextActionCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"feedbackTool",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"textSplitter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.aiName=e,this.memory=r,this.fullMessageHistory=[],this.nextActionCount=0,this.chain=n,this.outputParser=i,this.tools=s,this.feedbackTool=a,this.maxIterations=o;const u=eE("modelName"in r.vectorStore.embeddings?r.vectorStore.embeddings.modelName:void 0);this.textSplitter=new YT({chunkSize:u,chunkOverlap:Math.round(u/10)})}static fromLLMAndTools(e,r,{aiName:n,aiRole:i,memory:s,maxIterations:a=100,outputParser:o=new CA}){const u=new kA({aiName:n,aiRole:i,tools:r,tokenCounter:e.getNumTokens.bind(e),sendTokenLimit:yb("modelName"in e?e.modelName:"gpt2")}),l=new Q({llm:e,prompt:u});return new kw({aiName:n,memory:s,chain:l,outputParser:o,tools:r,maxIterations:a})}async run(e){const r="Determine which next command to use, and respond using the format specified above:";let n=0;for(;n<this.maxIterations;){n+=1;const{text:i}=await this.chain.call({goals:e,user_input:r,memory:this.memory,messages:this.fullMessageHistory});console.log(i),this.fullMessageHistory.push(new ut(r)),this.fullMessageHistory.push(new Fe(i));const s=await this.outputParser.parse(i),a=this.tools.reduce((c,h)=>({...c,[h.name]:h}),{});if(s.name===AA)return s.args.response;let o;if(s.name in a){const c=a[s.name];let h;try{h=await c.call(s.args)}catch(d){h=`Error in args: ${d}`}o=`Command ${c.name} returned: ${h}`}else s.name==="ERROR"?o=`Error: ${s.args}. `:o=`Unknown command '${s.name}'. Please refer to the 'COMMANDS' list for available commands and only respond in the specified JSON format.`;let u=`Assistant Reply: ${i}
Result: ${o} `;if(this.feedbackTool){const c=`
${await this.feedbackTool.call("Input: ")}`;if(c==="q"||c==="stop")return console.log("EXITING"),"EXITING";u+=c}const l=await this.textSplitter.createDocuments([u]);await this.memory.addDocuments(l),this.fullMessageHistory.push(new Xr(o))}}}const oV=Object.freeze(Object.defineProperty({__proto__:null,AutoGPT:kw,AutoGPTOutputParser:CA,AutoGPTPrompt:kA,preprocessJsonInput:IA},Symbol.toStringTag,{value:"Module"}));class uV extends xe{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","experimental","openai_assistant"]}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"assistantId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pollIntervalMs",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"asAgent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e.client??new Le(e==null?void 0:e.clientOptions),this.assistantId=e.assistantId,this.asAgent=e.asAgent??this.asAgent}static async createAssistant({model:e,name:r,instructions:n,tools:i,client:s,clientOptions:a,asAgent:o,pollIntervalMs:u,fileIds:l}){const c=(i==null?void 0:i.map(f=>f instanceof ys?az(f):f))??[],h=s??new Le(a),d=await h.beta.assistants.create({name:r,instructions:n,tools:c,model:e,file_ids:l});return new this({client:h,assistantId:d.id,asAgent:o,pollIntervalMs:u})}async invoke(e,r){let n;if(this.asAgent&&e.steps&&e.steps.length>0){const i=await this._parseStepsInput(e);n=await this.client.beta.threads.runs.submitToolOutputs(i.threadId,i.runId,{tool_outputs:i.toolOutputs})}else if("threadId"in e)"runId"in e?n=await this.client.beta.threads.runs.submitToolOutputs(e.threadId,e.runId,{tool_outputs:e.toolOutputs}):(await this.client.beta.threads.messages.create(e.threadId,{content:e.content,role:"user",file_ids:e.file_ids,metadata:e.messagesMetadata}),n=await this._createRun(e));else{const i={messages:[{role:"user",content:e.content,file_ids:e.fileIds,metadata:e.messagesMetadata}],metadata:e.threadMetadata};n=await this._createThreadAndRun({...e,thread:i})}return this._getResponse(n.id,n.thread_id)}async deleteAssistant(){return await this.client.beta.assistants.del(this.assistantId)}async getAssistant(){return await this.client.beta.assistants.retrieve(this.assistantId)}async modifyAssistant({model:e,name:r,instructions:n,fileIds:i}){return await this.client.beta.assistants.update(this.assistantId,{name:r,instructions:n,model:e,file_ids:i})}async _parseStepsInput(e){var o;const{action:{runId:r,threadId:n}}=e.steps[e.steps.length-1],s=(o=(await this._waitForRun(r,n)).required_action)==null?void 0:o.submit_tool_outputs.tool_calls;return s?{toolOutputs:s.flatMap(u=>{const l=e.steps.find(c=>c.action.toolCallId===u.id);return l?[{output:l.observation,tool_call_id:l.action.toolCallId}]:[]}),runId:r,threadId:n}:e}async _createRun({instructions:e,model:r,tools:n,metadata:i,threadId:s}){return this.client.beta.threads.runs.create(s,{assistant_id:this.assistantId,instructions:e,model:r,tools:n,metadata:i})}async _createThreadAndRun(e){const r=["instructions","model","tools","run_metadata"].filter(i=>i in e).reduce((i,s)=>{const a=i;return a[s]=e[s],a},{});return this.client.beta.threads.createAndRun({...r,thread:e.thread,assistant_id:this.assistantId})}async _waitForRun(e,r){let n=!0,i={};for(;n;)i=await this.client.beta.threads.runs.retrieve(r,e),n=["in_progress","queued"].includes(i.status),n&&await TA(this.pollIntervalMs);return i}async _getResponse(e,r){var s,a;const n=await this._waitForRun(e,r);if(n.status==="completed"){const u=(await this.client.beta.threads.messages.list(r,{order:"desc"})).data.filter(c=>c.run_id===e);if(!this.asAgent)return u;const l=u.flatMap(c=>c.content);if(l.every(c=>c.type==="text"))return{returnValues:{output:l.map(h=>h.type==="text"&&h.text.value).join(`
`),runId:e,threadId:r},log:"",runId:e,threadId:r}}else if(n.status==="requires_action"){if(!this.asAgent)return((s=n.required_action)==null?void 0:s.submit_tool_outputs.tool_calls)??[];const o=[];return(a=n.required_action)==null||a.submit_tool_outputs.tool_calls.forEach(u=>{const l=u.function,c=JSON.parse(l.arguments);o.push({tool:l.name,toolInput:c,toolCallId:u.id,log:"",runId:e,threadId:r})}),o}const i=JSON.stringify(n,null,2);throw new Error(`Unexpected run status ${n.status}.
Full run info:

${i}`)}}const lV=Object.freeze(Object.defineProperty({__proto__:null,OpenAIAssistantRunnable:uV},Symbol.toStringTag,{value:"Module"}));class cV extends St{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","experimental"]}),Object.defineProperty(this,"oaiClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.oaiClient=(e==null?void 0:e.client)??new Le(e==null?void 0:e.clientOptions)}async createFile({file:e,purpose:r,options:n}){return this.oaiClient.files.create({file:e,purpose:r},n)}async deleteFile({fileId:e,options:r}){return this.oaiClient.files.del(e,r)}async listFiles(e){return this.oaiClient.files.list(e==null?void 0:e.query,e==null?void 0:e.options)}async retrieveFile({fileId:e,options:r}){return this.oaiClient.files.retrieve(e,r)}async retrieveFileContent({fileId:e,options:r}){return this.oaiClient.files.retrieveContent(e,r)}}const hV=Object.freeze(Object.defineProperty({__proto__:null,OpenAIFiles:cV},Symbol.toStringTag,{value:"Module"}));class Vf extends Q{static lc_name(){return"TaskCreationChain"}static fromLLM(e){const r="You are an task creation AI that uses the result of an execution agent to create new tasks with the following objective: {objective}, The last completed task has the result: {result}. This result was based on this task description: {task_description}. These are incomplete tasks: {incomplete_tasks}. Based on the result, create new tasks to be completed by the AI system that do not overlap with incomplete tasks. Return the tasks as an array.",n=new W({template:r,inputVariables:["result","task_description","incomplete_tasks","objective"]});return new Vf({prompt:n,...e})}}class Bf extends Q{static lc_name(){return"TaskExecutionChain"}static fromLLM(e){const r="You are an AI who performs one task based on the following objective: {objective}.Take into account these previously completed tasks: {context}. Your task: {task}. Response:",n=new W({template:r,inputVariables:["objective","context","task"]});return new Bf({prompt:n,...e})}}class Hf extends Q{static lc_name(){return"TaskPrioritizationChain"}static fromLLM(e){const r="You are a task prioritization AI tasked with cleaning the formatting of and reprioritizing the following tasks: {task_names}. Consider the ultimate objective of your team: {objective}. Do not remove any tasks. Return the result as a numbered list, like: #. First task #. Second task Start the task list with number {next_task_id}.",n=new W({template:r,inputVariables:["task_names","next_task_id","objective"]});return new Hf({prompt:n,...e})}}class Iw extends Ae{static lc_name(){return"BabyAGI"}constructor({creationChain:e,prioritizationChain:r,executionChain:n,vectorstore:i,maxIterations:s=100,verbose:a,callbacks:o}){super(void 0,a,o),Object.defineProperty(this,"taskList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"creationChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"prioritizationChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"executionChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"taskIDCounter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.taskList=[],this.creationChain=e,this.prioritizationChain=r,this.executionChain=n,this.taskIDCounter=1,this.vectorstore=i,this.maxIterations=s}_chainType(){return"BabyAGI"}get inputKeys(){return["objective","firstTask"]}get outputKeys(){return[]}async addTask(e){this.taskList.push(e)}printTaskList(){console.log(`\x1B[95m\x1B[1m
*****TASK LIST*****
\x1B[0m\x1B[0m`);for(const e of this.taskList)console.log(`${e.taskID}: ${e.taskName}`)}printNextTask(e){console.log(`\x1B[92m\x1B[1m
*****NEXT TASK*****
\x1B[0m\x1B[0m`),console.log(`${e.taskID}: ${e.taskName}`)}printTaskResult(e){console.log(`\x1B[93m\x1B[1m
*****TASK RESULT*****
\x1B[0m\x1B[0m`),console.log(e.trim())}async getNextTasks(e,r,n,i){const a=this.taskList.map(l=>l.taskName).join(", "),{[this.creationChain.outputKeys[0]]:o}=await this.creationChain.call({result:e,task_description:r,incomplete_tasks:a,objective:n},i==null?void 0:i.getChild());return o.split(`
`).filter(l=>l.trim()).map(l=>({taskName:l}))}async prioritizeTasks(e,r,n){const i=this.taskList.map(l=>l.taskName),s=e+1,{[this.prioritizationChain.outputKeys[0]]:a}=await this.prioritizationChain.call({task_names:i.join(", "),next_task_id:String(s),objective:r},n==null?void 0:n.getChild()),o=a.trim().split(`
`),u=[];for(const l of o){const c=l.trim().split(".",2);if(c.length===2){const h=c[0].trim(),d=c[1].trim();u.push({taskID:h,taskName:d})}}return u}async getTopTasks(e,r=5){const n=await this.vectorstore.similaritySearch(e,r);return n?n.map(i=>String(i.metadata.task)):[]}async executeTask(e,r,n){const i=await this.getTopTasks(e),{[this.executionChain.outputKeys[0]]:s}=await this.executionChain.call({objective:e,context:i.join(`
`),task:r},n==null?void 0:n.getChild());return s}async _call({objective:e,firstTask:r="Make a todo list"},n){this.taskList=[],this.taskIDCounter=1,await this.addTask({taskID:"1",taskName:r});let i=0;for(;i<this.maxIterations&&this.taskList.length>0;){this.printTaskList();const s=this.taskList.shift();this.printNextTask(s);const a=await this.executeTask(e,s.taskName,n),o=parseInt(s.taskID,10);this.printTaskResult(a),await this.vectorstore.addDocuments([new Lt({pageContent:a,metadata:{task:s.taskName}})]);const u=await this.getNextTasks(a,s.taskName,e,n);for(const l of u)this.taskIDCounter+=1,l.taskID=this.taskIDCounter.toFixed(),await this.addTask(l);this.taskList=await this.prioritizeTasks(o,e,n),i+=1}return{}}serialize(){throw new Error("Method not implemented.")}static fromLLM({llm:e,vectorstore:r,executionChain:n,verbose:i,callbacks:s,...a}){const o=Vf.fromLLM({llm:e,verbose:i,callbacks:s}),u=Hf.fromLLM({llm:e,verbose:i,callbacks:s});return new Iw({creationChain:o,prioritizationChain:u,executionChain:n||Bf.fromLLM({llm:e,verbose:i,callbacks:s}),vectorstore:r,verbose:i,callbacks:s,...a})}}const dV=Object.freeze(Object.defineProperty({__proto__:null,BabyAGI:Iw,TaskCreationChain:Vf,TaskExecutionChain:Bf,TaskPrioritizationChain:Hf},Symbol.toStringTag,{value:"Module"}));class Md extends Ae{static lc_name(){return"GenerativeAgentMemoryChain"}constructor(e,r,n){super(),Object.defineProperty(this,"reflecting",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"reflectionThreshold",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"importanceWeight",{enumerable:!0,configurable:!0,writable:!0,value:.15}),Object.defineProperty(this,"memoryRetriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"aggregateImportance",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.llm=e,this.memoryRetriever=r,this.reflectionThreshold=n.reflectionThreshold,this.importanceWeight=n.importanceWeight??this.importanceWeight,this.verbose=n.verbose??this.verbose}_chainType(){return"generative_agent_memory"}get inputKeys(){return["memory_content","now","memory_metadata"]}get outputKeys(){return["output"]}chain(e){return new Q({llm:this.llm,prompt:e,verbose:this.verbose,outputKey:"output"})}async _call(e,r){const{memory_content:n,now:i}=e,s=await this.scoreMemoryImportance(n,r);this.aggregateImportance+=s;const a=new Lt({pageContent:n,metadata:{importance:s,...e.memory_metadata}});return await this.memoryRetriever.addDocuments([a]),this.reflectionThreshold!==void 0&&this.aggregateImportance>this.reflectionThreshold&&!this.reflecting&&(console.log("Reflecting on current memories..."),this.reflecting=!0,await this.pauseToReflect(i,r),this.aggregateImportance=0,this.reflecting=!1),{output:s}}async pauseToReflect(e,r){this.verbose&&console.log("Pausing to reflect...");const n=[],i=await this.getTopicsOfReflection(50,r);for(const s of i){const a=await this.getInsightsOnTopic(s,e,r);for(const o of a)await this.call({memory_content:o,now:e,memory_metadata:{source:"reflection_insight"}},r==null?void 0:r.getChild("reflection_insight_memory"));n.push(...a)}return n}async scoreMemoryImportance(e,r){const n=W.fromTemplate(`On the scale of 1 to 10, where 1 is purely mundane (e.g., brushing teeth, making bed) and 10 is extremely poignant (e.g., a break up, college acceptance), rate the likely poignancy of the following piece of memory. Respond with a single integer.
Memory: {memory_content}
Rating: `),s=(await this.chain(n).run(e,r==null?void 0:r.getChild("determine_importance"))).trim();this.verbose&&console.log("Importance score:",s);const a=s.match(/^\D*(\d+)/);return a?parseFloat(a[1])/10*this.importanceWeight:0}async getTopicsOfReflection(e,r){const n=W.fromTemplate(`{observations}

Given only the information above, what are the 3 most salient high-level questions we can answer about the subjects in the statements? Provide each question on a new line.

`),s=this.memoryRetriever.getMemoryStream().slice(-e).map(o=>o.pageContent).join(`
`),a=await this.chain(n).run(s,r==null?void 0:r.getChild("reflection_topics"));return Md.parseList(a)}async getInsightsOnTopic(e,r,n){const i=W.fromTemplate(`Statements about {topic}
{related_statements}

What 5 high-level insights can you infer from the above statements? (example format: insight (because of 1, 5, 3))`),a=(await this.fetchMemories(e,r,n)).map((u,l)=>`${l+1}. ${u.pageContent}`).join(`
`),o=await this.chain(i).call({topic:e,related_statements:a},n==null?void 0:n.getChild("reflection_insights"));return Md.parseList(o.output)}static parseList(e){return e.split(`
`).map(r=>r.trim())}async fetchMemories(e,r,n){return this.memoryRetriever.getRelevantDocuments(e,n==null?void 0:n.getChild("memory_retriever"))}}class fV extends Gl{constructor(e,r,n){super(),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"memoryRetriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reflectionThreshold",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxTokensLimit",{enumerable:!0,configurable:!0,writable:!0,value:1200}),Object.defineProperty(this,"queriesKey",{enumerable:!0,configurable:!0,writable:!0,value:"queries"}),Object.defineProperty(this,"mostRecentMemoriesTokenKey",{enumerable:!0,configurable:!0,writable:!0,value:"recent_memories_token"}),Object.defineProperty(this,"addMemoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"addMemory"}),Object.defineProperty(this,"relevantMemoriesKey",{enumerable:!0,configurable:!0,writable:!0,value:"relevant_memories"}),Object.defineProperty(this,"relevantMemoriesSimpleKey",{enumerable:!0,configurable:!0,writable:!0,value:"relevant_memories_simple"}),Object.defineProperty(this,"mostRecentMemoriesKey",{enumerable:!0,configurable:!0,writable:!0,value:"most_recent_memories"}),Object.defineProperty(this,"nowKey",{enumerable:!0,configurable:!0,writable:!0,value:"now"}),Object.defineProperty(this,"memoryChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llm=e,this.memoryRetriever=r,this.verbose=(n==null?void 0:n.verbose)??this.verbose,this.reflectionThreshold=(n==null?void 0:n.reflectionThreshold)??this.reflectionThreshold,this.maxTokensLimit=(n==null?void 0:n.maxTokensLimit)??this.maxTokensLimit,this.memoryChain=new Md(e,r,{reflectionThreshold:n==null?void 0:n.reflectionThreshold,importanceWeight:n==null?void 0:n.importanceWeight})}getRelevantMemoriesKey(){return this.relevantMemoriesKey}getMostRecentMemoriesTokenKey(){return this.mostRecentMemoriesTokenKey}getAddMemoryKey(){return this.addMemoryKey}getCurrentTimeKey(){return this.nowKey}get memoryKeys(){return[this.relevantMemoriesKey,this.mostRecentMemoriesKey]}async addMemory(e,r,n,i){return this.memoryChain.call({memory_content:e,now:r,memory_metadata:n},i)}formatMemoriesDetail(e){if(!e.length)return"No relevant information.";const r=new Set,n=[];for(const s of e){if(s.pageContent in r)continue;r.add(s.pageContent);const a=s.metadata.created_at.toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",hour12:!0});n.push(`${a}: ${s.pageContent.trim()}`)}return n.map(s=>`${s}`).join(`
`)}formatMemoriesSimple(e){return e.map(n=>`${n.pageContent}`).join("; ")}async getMemoriesUntilLimit(e){const r=[];for(const n of this.memoryRetriever.getMemoryStream().slice().reverse()){if(e>=this.maxTokensLimit){this.verbose&&console.log("Exceeding max tokens for LLM, filtering memories");break}e+=await this.llm.getNumTokens(n.pageContent),e<this.maxTokensLimit&&r.push(n)}return this.formatMemoriesSimple(r)}get memoryVariables(){return[]}async loadMemoryVariables(e){const r=e[this.queriesKey],n=e[this.nowKey];if(r!==void 0){const s=(await Promise.all(r.map(a=>this.memoryChain.fetchMemories(a,n)))).flat();return{[this.relevantMemoriesKey]:this.formatMemoriesDetail(s),[this.relevantMemoriesSimpleKey]:this.formatMemoriesSimple(s)}}const i=e[this.mostRecentMemoriesTokenKey];return i!==void 0?{[this.mostRecentMemoriesKey]:await this.getMemoriesUntilLimit(i)}:{}}async saveContext(e,r){const n=r[this.addMemoryKey],i=r[this.nowKey];n&&await this.addMemory(n,i,{})}clear(){}}class pV extends Ae{static lc_name(){return"GenerativeAgent"}_chainType(){return"generative_agent_executor"}get inputKeys(){return["observation","suffix","now"]}get outputKeys(){return["output","continue_dialogue"]}constructor(e,r,n){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"age",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"traits",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"longTermMemory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"summary",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"summaryRefreshSeconds",{enumerable:!0,configurable:!0,writable:!0,value:3600}),Object.defineProperty(this,"lastRefreshed",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llm=e,this.longTermMemory=r,this.name=n.name,this.age=n.age,this.traits=n.traits,this.status=n.status,this.verbose=n.verbose??this.verbose,this.summary="",this.summaryRefreshSeconds=n.summaryRefreshSeconds??this.summaryRefreshSeconds,this.lastRefreshed=new Date}parseList(e){return e.trim().split(`
`).map(i=>i.replace(/^\s*\d+\.\s*/,"").trim())}chain(e){return new Q({llm:this.llm,prompt:e,verbose:this.verbose,outputKey:"output",memory:this.longTermMemory})}async getEntityFromObservations(e,r){const n=W.fromTemplate(`What is the observed entity in the following observation? {observation}
Entity=`);return(await this.chain(n).call({observation:e},r==null?void 0:r.getChild("entity_extractor"))).output}async getEntityAction(e,r,n){const i=W.fromTemplate(`What is the {entity} doing in the following observation? {observation}
The {entity} is`);return(await this.chain(i).call({entity:r,observation:e},n==null?void 0:n.getChild("entity_action_extractor"))).output.trim()}async summarizeRelatedMemories(e,r){const n=W.fromTemplate(`
{q1}?
Context from memory:
{relevant_memories}
Relevant context:`),i=await this.getEntityFromObservations(e,r),s=await this.getEntityAction(e,i,r),a=`What is the relationship between ${this.name} and ${i}`,o=`${i} is ${s}`;return(await this.chain(n).call({q1:a,queries:[a,o]},r==null?void 0:r.getChild("entity_relationships"))).output.trim()}async _call(e,r){const{observation:n,suffix:i,now:s}=e,a=W.fromTemplate(`{agent_summary_description}
It is {current_time}.
{agent_name}'s status: {agent_status}
Summary of relevant context from {agent_name}'s memory:
{relevant_memories}
Most recent observations: {most_recent_memories}
Observation: {observation}

${i}`),o=await this.getSummary({},r),u=await this.summarizeRelatedMemories(n,r),l=(s||new Date).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",hour12:!0}),c={agent_summary_description:o,current_time:l,agent_name:this.name,observation:n,agent_status:this.status,most_recent_memories:""};c[this.longTermMemory.getRelevantMemoriesKey()]=u;const h=await this.llm.getNumTokens(await a.format({...c}));c[this.longTermMemory.getMostRecentMemoriesTokenKey()]=h;const f=(await this.chain(a).call(c,r==null?void 0:r.getChild("reaction_from_summary"))).output;let p=f,y=!1;if(f.includes("REACT:")){const v=this._cleanResponse(f.split("REACT:").pop());await this.addMemory(`${this.name} observed ${n} and reacted by ${v}`,s,{},r==null?void 0:r.getChild("memory")),p=`${v}`,y=!1}else if(f.includes("SAY:")){const v=this._cleanResponse(f.split("SAY:").pop());await this.addMemory(`${this.name} observed ${n} and said ${v}`,s,{},r==null?void 0:r.getChild("memory")),p=`${this.name} said ${v}`,y=!0}else if(f.includes("GOODBYE:")){const v=this._cleanResponse(f.split("GOODBYE:").pop()??"");await this.addMemory(`${this.name} observed ${n} and said ${v}`,s,{},r==null?void 0:r.getChild("memory")),p=`${this.name} said ${v}`,y=!1}return{output:p,continue_dialogue:y}}_cleanResponse(e){if(e===void 0)return"";const r=new RegExp(`^${this.name} `);return e.replace(r,"").trim()}async generateReaction(e,r){const n=`Should {agent_name} react to the observation, and if so, what would be an appropriate reaction? Respond in one line. If the action is to engage in dialogue, write:
SAY: "what to say" 
otherwise, write:
REACT: {agent_name}'s reaction (if anything). 
Either do nothing, react, or say something but not both.

`,{output:i,continue_dialogue:s}=await this.call({observation:e,suffix:n,now:r});return[s,i]}async generateDialogueResponse(e,r){const n=`What would ${this.name} say? To end the conversation, write: GOODBYE: "what to say". Otherwise to continue the conversation, write: SAY: "what to say next"

`,{output:i,continue_dialogue:s}=await this.call({observation:e,suffix:n,now:r});return[s,i]}async getSummary(e,r){const{now:n=new Date,forceRefresh:i=!1}=e??{},s=Math.floor((n.getTime()-this.lastRefreshed.getTime())/1e3);(!this.summary||s>=this.summaryRefreshSeconds||i)&&(this.summary=await this.computeAgentSummary(r),this.lastRefreshed=n);let a;return this.age?a=this.age:a="N/A",`Name: ${this.name} (age: ${a})
Innate traits: ${this.traits}
${this.summary}`}async computeAgentSummary(e){const r=W.fromTemplate(`How would you summarize {name}'s core characteristics given the following statements:
----------{relevant_memories}----------Do not embellish.

Summary: `);return(await this.chain(r).call({name:this.name,queries:[`${this.name}'s core characteristics`]},e==null?void 0:e.getChild("compute_agent_summary"))).output.trim()}getFullHeader(e={}){const{now:r=new Date,forceRefresh:n=!1}=e,i=this.getSummary({now:r,forceRefresh:n}),s=r.toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",hour12:!0});return`${i}
It is ${s}.
${this.name}'s status: ${this.status}`}async addMemory(e,r,n,i){return this.longTermMemory.addMemory(e,r,n,i)}}const mV=Object.freeze(Object.defineProperty({__proto__:null,GenerativeAgent:pV,GenerativeAgentMemory:fV},Symbol.toStringTag,{value:"Module"}));class RA{}class jA{}class NA{}class $A extends NA{constructor(){super(...arguments),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:[]})}addStep(e,r){this.steps.push({action:e,result:r})}getSteps(){return this.steps}getFinalResponse(){var e,r;return(r=(e=this.steps[this.steps.length-1])==null?void 0:e.result)==null?void 0:r.response}}class LA extends RA{constructor(e,r){super(),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:r})}async plan(e,r){const n=await this.llmChain.run(e,r);return this.outputParser.parse(n)}}class Hg extends jA{constructor(e){super(),Object.defineProperty(this,"chain",{enumerable:!0,configurable:!0,writable:!0,value:e})}async step(e,r){return{response:(await this.chain.call(e,r)).output}}}const DA=["Let's first understand the problem and devise a plan to solve the problem.",'Please output the plan starting with the header "Plan:"',"followed by a numbered list of steps.","Please make the plan the minimum number of steps required","to answer the query or complete the task accurately and precisely.","You have a set of tools at your disposal to help you with this task:","","{toolStrings}","","You must consider these tools when coming up with your plan.",'If the task is a question, the final step in the plan must be the following: "Given the above steps taken,','please respond to the original query."','At the end of your plan, say "<END_OF_PLAN>"'].join(" "),gV=`Previous steps: {previous_steps}

Current objective: {current_step}

{agent_scratchpad}

You may extract and combine relevant data from your previous steps when responding to me.`,yV=async t=>{const e=t.map(r=>`${r.name}: ${r.description}`).join(`
`);return it.fromMessages([xr.fromTemplate(DA),lt.fromTemplate("{input}")]).partial({toolStrings:e})};class MA extends It{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","experimental","plan_and_execute"]})}async parse(e){return{steps:e.split(/\n\d+\.\s?/).slice(1).map(r=>({text:r.replace("<END_OF_PLAN>","")}))}}getFormatInstructions(){return DA}}function bV(t){return typeof t.constructor.lc_name=="function"&&t.constructor.lc_name()==="DynamicStructuredTool"}class ku extends Ae{static lc_name(){return"PlanAndExecuteAgentExecutor"}constructor(e){super(e),Object.defineProperty(this,"planner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stepExecutor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stepContainer",{enumerable:!0,configurable:!0,writable:!0,value:new $A}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),this.planner=e.planner,this.stepExecutor=e.stepExecutor,this.stepContainer=e.stepContainer??this.stepContainer,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey}get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}static async getDefaultPlanner({llm:e,tools:r}){const n=new Q({llm:e,prompt:await yV(r)});return new LA(n,new MA)}static getDefaultStepExecutor({llm:e,tools:r,humanMessageTemplate:n=gV}){let i;return bV(r[0])?(i=Un.fromLLMAndTools(e,r,{humanMessageTemplate:n,inputVariables:["previous_steps","current_step","agent_scratchpad"]}),new Hg(wt.fromAgentAndTools({agent:i,tools:r}))):(i=Vn.fromLLMAndTools(e,r,{humanMessageTemplate:n}),new Hg(wt.fromAgentAndTools({agent:i,tools:r})))}static async fromLLMAndTools({llm:e,tools:r,humanMessageTemplate:n}){return new ku({planner:await ku.getDefaultPlanner({llm:e,tools:r}),stepExecutor:ku.getDefaultStepExecutor({llm:e,tools:r,humanMessageTemplate:n})})}async _call(e,r){var i;const n=await this.planner.plan(e.input,r==null?void 0:r.getChild());if(!((i=n.steps)!=null&&i.length))throw new Error("Could not create and parse a plan to answer your question - please try again.");n.steps[n.steps.length-1].text+=` The original question was: ${e.input}.`;for(const s of n.steps){const a={...e,previous_steps:JSON.stringify(this.stepContainer.getSteps()),current_step:s.text},o=await this.stepExecutor.step(a,r==null?void 0:r.getChild());this.stepContainer.addStep(s,o)}return{[this.outputKey]:this.stepContainer.getFinalResponse()}}_chainType(){return"agent_executor"}serialize(){throw new Error("Cannot serialize an AgentExecutor")}}const wV=Object.freeze(Object.defineProperty({__proto__:null,BasePlanner:RA,BaseStepContainer:NA,BaseStepExecutor:jA,ChainStepExecutor:Hg,LLMPlanner:LA,ListStepContainer:$A,PlanAndExecuteAgentExecutor:ku,PlanOutputParser:MA},Symbol.toStringTag,{value:"Module"})),D0={name:"predictNextUserMessage",description:"Predicts the next user message, along with insights.",parameters:{type:"object",properties:{userState:{type:"string",description:"Concise reasoning about the users internal mental state."},predictedUserMessage:{type:"string",description:"Your prediction on how they will respond to the AI's most recent message."},insights:{type:"array",items:{type:"string"},description:"A concise list of any additional insights that would be useful to improve prediction."}},required:["userState","predictedUserMessage","insights"]}},M0={name:"predictionViolations",description:"Generates violations, errors and differences between the predicted user response, and the actual response.",parameters:{type:"object",properties:{violationExplanation:{type:"string",description:"How was the predication violated?"},explainedPredictionErrors:{type:"array",items:{type:"string"},description:"Explanations of how the prediction was violated and why"}},required:["violationExplanation","explainedPredictionErrors"]}},vV=W.fromTemplate(`
You have been tasked with coming up with insights and data-points based on a chat history between a human and an AI.
Given the user's chat history provide the following:
- Concise reasoning about the users internal mental state.
- Your prediction on how they will respond to the AI's most recent message.
- A concise list of any additional insights that would be useful to improve prediction.
--------
Chat History: {chat_history}`),_V=W.fromTemplate(`You have been given a prediction and an actual message from a human and AI conversation.
Using the prediction, actual message, and additional user insights, generate the following:
- How exactly was the original prediction violated? Which parts were wrong? State the exact differences.
- If there were errors with the prediction, what were they and why?
--------
Predicted Output: {predicted_output}
--------
Actual Output: {actual_output}
--------
User Insights: {user_insights}
--------
`),PV=W.fromTemplate(`
You have been tasked with revising a prediction on what a user might say in a chat conversation.
--------
Your previous prediction: {prediction}
--------
Ways in which your prediction was off: {explained_prediction_errors}
--------
Key insights to the user: {user_insights}
--------
Given the above, revise your prediction to be more accurate.
Revised Prediction:`),OV=W.fromTemplate(`
Given a user message, an LLM generated prediction of what that message might be, and a list of violations which the prediction made compared to the actual message, generate a fact about the user, relevant to the users message.
--------
Prediction violations: {prediction_violations}
--------
Revised prediction: {prediction}
--------
Actual user message: {user_message}
--------
Relevant fact:`);class SV extends Ae{static lc_name(){return"ViolationOfExpectationsChain"}_chainType(){return"violation_of_expectation_chain"}get inputKeys(){return[this.chatHistoryKey]}get outputKeys(){return[this.thoughtsKey]}constructor(e){super(e),Object.defineProperty(this,"chatHistoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"chat_history"}),Object.defineProperty(this,"thoughtsKey",{enumerable:!0,configurable:!0,writable:!0,value:"thoughts"}),Object.defineProperty(this,"retriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"jsonOutputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stringOutputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.retriever=e.retriever,this.llm=e.llm,this.jsonOutputParser=new Do,this.stringOutputParser=new Io}getChatHistoryString(e){return e.map(r=>r._getType()==="human"?`Human: ${r.content}`:r._getType()==="ai"?`AI: ${r.content}`:`${r.content}`).join(`
`)}removeDuplicateStrings(e){return[...new Set(e)]}chunkMessagesByAIResponse(e){const r=[],n=[];return e.forEach((i,s)=>{if(n.push(i),i._getType()==="ai"){let a=e[s+1];(!a||a._getType()!=="human")&&(a=void 0),r.push({chunkedMessages:n,userResponse:a?new ut(a):void 0})}}),r}async _call(e,r){if(!(this.chatHistoryKey in e))throw new Error(`Chat history key ${this.chatHistoryKey} not found`);const n=e[this.chatHistoryKey];if(!n.every(l=>Vt(l)))throw new Error("Chat history must be an array of BaseMessages");const s=this.chunkMessagesByAIResponse(n),a=await Promise.all(s.map(async l=>({userPredictions:await this.predictNextUserMessage(l.chunkedMessages),userResponse:l.userResponse,runManager:r}))),o=await Promise.all(a.map(l=>this.getPredictionViolations({userPredictions:l.userPredictions,userResponse:l.userResponse,runManager:r})));return{insights:await Promise.all(o.map(l=>this.generateFacts({userResponse:l.userResponse,predictions:{revisedPrediction:l.revisedPrediction,explainedPredictionErrors:l.explainedPredictionErrors}})))}}async predictNextUserMessage(e,r){const n=this.getChatHistoryString(e),i=this.llm.bind({functions:[D0],function_call:{name:D0.name}}),a=await vV.pipe(i).pipe(this.jsonOutputParser).invoke({chat_history:n},r==null?void 0:r.getChild("prediction"));if(!("userState"in a&&"predictedUserMessage"in a&&"insights"in a))throw new Error(`Invalid response from LLM: ${JSON.stringify(a)}`);const o=a,u=await this.retrieveRelevantInsights(o.insights),l=this.removeDuplicateStrings([...o.insights,...u]);return{...o,insights:l}}async retrieveRelevantInsights(e){return(await Promise.all(e.map(async i=>(await this.retriever.getRelevantDocuments(i))[0]))).map(i=>i.pageContent)}async getPredictionViolations({userPredictions:e,userResponse:r,runManager:n}){const i=this.llm.bind({functions:[M0],function_call:{name:M0.name}}),s=_V.pipe(i).pipe(this.jsonOutputParser);if(typeof(r==null?void 0:r.content)!="string")throw new Error("This chain does not support non-string model output.");const a=await s.invoke({predicted_output:e.predictedUserMessage,actual_output:(r==null?void 0:r.content)??"",user_insights:e.insights.join(`
`)},n==null?void 0:n.getChild("prediction_violations")),o=await this.generateRevisedPrediction({originalPrediction:e.predictedUserMessage,explainedPredictionErrors:a.explainedPredictionErrors,userInsights:e.insights,runManager:n});return{userResponse:r,revisedPrediction:o,explainedPredictionErrors:a.explainedPredictionErrors}}async generateRevisedPrediction({originalPrediction:e,explainedPredictionErrors:r,userInsights:n,runManager:i}){return await PV.pipe(this.llm).pipe(this.stringOutputParser).invoke({prediction:e,explained_prediction_errors:r.join(`
`),user_insights:n.join(`
`)},i==null?void 0:i.getChild("prediction_revision"))}async generateFacts({userResponse:e,predictions:r,runManager:n}){const i=OV.pipe(this.llm).pipe(this.stringOutputParser);if(typeof(e==null?void 0:e.content)!="string")throw new Error("This chain does not support non-string model output.");return await i.invoke({prediction_violations:r.explainedPredictionErrors.join(`
`),prediction:r.revisedPrediction,user_message:(e==null?void 0:e.content)??""},n==null?void 0:n.getChild("generate_facts"))}static fromLLM(e,r,n){return new this({retriever:r,llm:e,...n})}}const xV=Object.freeze(Object.defineProperty({__proto__:null,ViolationOfExpectationsChain:SV},Symbol.toStringTag,{value:"Module"}));class EV{constructor(e={}){Object.defineProperty(this,"transformers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.transformers=e.transformers??[],this.state=new Map,this.config=e}addTransformer(e){this.transformers.push(e)}getState(){return this.state}async mask(e){if(this.config.onMaskingStart&&await this.config.onMaskingStart(e),this.transformers.length===0)throw new Error("MaskingParser.mask Error: No transformers have been added. Please add at least one transformer before parsing.");if(typeof e!="string")throw new TypeError("MaskingParser.mask Error: The 'message' argument must be a string.");let r=e;for(const n of this.transformers){const[i,s]=await n.transform(r,new Map(this.state));r=i,s.forEach((a,o)=>this.state.set(o,a))}return this.config.onMaskingEnd&&await this.config.onMaskingEnd(r),r}async rehydrate(e,r){if(this.config.onRehydratingStart&&await this.config.onRehydratingStart(e),typeof e!="string")throw new TypeError("MaskingParser.rehydrate Error: The 'message' argument must be a string.");if(this.transformers.length===0)throw new Error("MaskingParser.rehydrate Error: No transformers have been added. Please add at least one transformer before rehydrating.");if(r&&!(r instanceof Map))throw new TypeError("MaskingParser.rehydrate Error: The 'state' argument, if provided, must be an instance of Map.");const n=r||this.state;let i=e;const s=this.transformers.slice().reverse();for(const a of s)i=await a.rehydrate(i,n);return this.config.onRehydratingEnd&&await this.config.onRehydratingEnd(i),i}}class FA{}class TV extends FA{constructor(e,r){super(),Object.defineProperty(this,"patterns",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hashFunction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.validatePatterns(e),this.patterns=e,this.hashFunction=r||this.defaultHashFunction}validatePatterns(e){for(const r of Object.keys(e)){const n=e[r];if(!n||typeof n!="object"||!(n.regex instanceof RegExp))throw new Error("Invalid pattern configuration.")}}async transform(e,r){if(typeof e!="string")throw new TypeError("RegexMaskingTransformer.transform Error: The 'message' argument must be a string.");if(!(r instanceof Map))throw new TypeError("RegexMaskingTransformer.transform Error: The 'state' argument must be an instance of Map.");let n=e;const i=r||new Map;for(const s of Object.keys(this.patterns)){const a=this.patterns[s];n=n.replace(a.regex,o=>{const u=a.mask?a.mask(o):a.replacement??this.hashFunction(o);return i.set(u,o),u})}return[n,i]}async rehydrate(e,r){if(typeof e!="string")throw new TypeError("RegexMaskingTransformer.rehydrate Error: The 'message' argument must be a string.");if(!(r instanceof Map))throw new TypeError("RegexMaskingTransformer.rehydrate Error: The 'state' argument must be an instance of Map.");return Array.from(r).reduce((i,[s,a])=>{const o=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return i.replace(new RegExp(o,"g"),a)},e)}defaultHashFunction(e){let r=0;for(let n=0;n<e.length;n+=1){const i=e.charCodeAt(n);r=(r<<5)-r+i,r|=0}return r.toString()}}const AV=Object.freeze(Object.defineProperty({__proto__:null,MaskingParser:EV,MaskingTransformer:FA,RegexMaskingTransformer:TV},Symbol.toStringTag,{value:"Module"}));class kV extends W{static lc_name(){return"CustomPromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"templateValidator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"renderer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.assign(this,e),this.validateTemplate&&this.templateValidator!==void 0){let r=this.inputVariables;if(this.partialVariables&&(r=r.concat(Object.keys(this.partialVariables))),typeof this.template=="string")this.templateValidator(this.template,r);else throw new Error(`Must pass in string as template. Received: ${this.template}`)}}static fromTemplate(e,{customParser:r,...n}){const i=new Set,s=r(e);for(const a of s)a.type==="variable"&&i.add(a.name);return new this({inputVariables:[...i],template:e,customParser:r,...n})}async format(e){const r=await this.mergePartialAndUserVariables(e);if(typeof this.template=="string")return this.renderer(this.template,r);throw new Error(`Must pass in string as template. Received: ${this.template}`)}}const IV=Object.freeze(Object.defineProperty({__proto__:null,CustomFormatPromptTemplate:kV},Symbol.toStringTag,{value:"Module"})),CV=`You are a teacher grading a quiz.
You are given a question, the student's answer, and the true answer, and are asked to score the student answer as either CORRECT or INCORRECT.

Example Format:
QUESTION: question here
STUDENT ANSWER: student's answer here
TRUE ANSWER: true answer here
GRADE: CORRECT or INCORRECT here

Grade the student answers based ONLY on their factual accuracy. Ignore differences in punctuation and phrasing between the student answer and true answer. It is OK if the student answer contains more information than the true answer, as long as it does not contain any conflicting statements. Begin! 

QUESTION: {query}
STUDENT ANSWER: {result}
TRUE ANSWER: {answer}
GRADE:`,RV=new W({inputVariables:["query","result","answer"],template:CV}),jV=(t,e)=>t.size===e.size&&[...t].every(r=>e.has(r));class NV extends Q{static lc_name(){return"QAEvalChain"}static fromLlm(e,r={}){const n=r.prompt||RV,i=new Set(["query","answer","result"]),s=new Set(n.inputVariables);if(!jV(i,s))throw new Error(`Input variables should be ${[...i]}, but got ${n.inputVariables}`);return new this({llm:e,prompt:n,...r.chainInput})}async evaluate(e,r,n={questionKey:"query",answerKey:"answer",predictionKey:"result"}){const i=e.map((s,a)=>({query:s[n.questionKey],answer:s[n.answerKey],result:r[a][n.predictionKey]}));return await this.apply(i)}}const Wf=(t,e)=>t.size===e.size&&[...t].every(r=>e.has(r));class Cw extends Q{constructor(){super(...arguments),Object.defineProperty(this,"requiresInput",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"requiresReference",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"skipInputWarning",{enumerable:!0,configurable:!0,writable:!0,value:`Ignoring input in ${this.constructor.name}, as it is not expected.`}),Object.defineProperty(this,"skipReferenceWarning",{enumerable:!0,configurable:!0,writable:!0,value:`Ignoring reference in ${this.constructor.name}, as it is not expected.`})}checkEvaluationArgs(e,r){if(this.requiresInput&&r==null)throw new Error(`${this.constructor.name} requires an input string.`);if(r!=null&&!this.requiresInput&&console.warn(this.skipInputWarning),this.requiresReference&&e==null)throw new Error(`${this.constructor.name} requires a reference string.`);e!=null&&!this.requiresReference&&console.warn(this.skipReferenceWarning)}}class zA extends Ae{constructor(){super(...arguments),Object.defineProperty(this,"requiresInput",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"requiresReference",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"skipInputWarning",{enumerable:!0,configurable:!0,writable:!0,value:`Ignoring input in ${this.constructor.name}, as it is not expected.`}),Object.defineProperty(this,"skipReferenceWarning",{enumerable:!0,configurable:!0,writable:!0,value:`Ignoring reference in ${this.constructor.name}, as it is not expected.`})}checkEvaluationArgs(e,r){if(this.requiresInput&&r==null)throw new Error(`${this.constructor.name} requires an input string.`);if(r!=null&&!this.requiresInput&&console.warn(this.skipInputWarning),this.requiresReference&&e==null)throw new Error(`${this.constructor.name} requires a reference string.`);e!=null&&!this.requiresReference&&console.warn(this.skipReferenceWarning)}}class $V extends Cw{constructor(){super(...arguments),Object.defineProperty(this,"evaluationName",{enumerable:!0,configurable:!0,writable:!0,value:this.constructor.name})}evaluateStrings(e,r){return this.checkEvaluationArgs(e.reference,e.input),this._evaluateStrings(e,r)}}class LV extends zA{constructor(){super(...arguments),Object.defineProperty(this,"evaluationName",{enumerable:!0,configurable:!0,writable:!0,value:this.constructor.name})}evaluateStrings(e,r){return this.checkEvaluationArgs(e.reference,e.input),this._evaluateStrings(e,r)}}class DV extends zA{constructor(){super(...arguments),Object.defineProperty(this,"evaluationName",{enumerable:!0,configurable:!0,writable:!0,value:this.constructor.name})}evaluateStringPairs(e,r){return this._evaluateStringPairs(e,r)}}class MV extends Cw{constructor(){super(...arguments),Object.defineProperty(this,"evaluationName",{enumerable:!0,configurable:!0,writable:!0,value:this.constructor.name})}evaluateStringPairs(e,r,n){return this.checkEvaluationArgs(e.reference,e.input),this._evaluateStringPairs(e,r,n)}}class FV extends Cw{constructor(){super(...arguments),Object.defineProperty(this,"requiresInput",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"evaluationName",{enumerable:!0,configurable:!0,writable:!0,value:this.constructor.name})}evaluateAgentTrajectory(e,r,n){return this.checkEvaluationArgs(e.reference,e.input),this._evaluateAgentTrajectory(e,r,n)}}const zV=`You are assessing a submitted answer on a given task or input based on a set of criteria. Here is the data:
[BEGIN DATA]
***
[Input]: {input}
***
[Submission]: {output}
***
[Criteria]: {criteria}
***
[END DATA]
Does the submission meet the Criteria? First, write out in a step by step manner your reasoning about each criterion to be sure that your conclusion is correct. Avoid simply stating the correct answers at the outset. Then print only the single character "Y" or "N" (without quotes or punctuation) on its own line corresponding to the correct answer of whether the submission meets all criteria. At the end, repeat just the letter again by itself on a new line.`,UV=new W({inputVariables:["input","output","criteria"],template:zV}),qV=`You are assessing a submitted answer on a given task or input based on a set of criteria. Here is the data:
[BEGIN DATA]
***
[Input]: {input}
***
[Submission]: {output}
***
[Criteria]: {criteria}
***
[Reference]: {reference}
***
[END DATA]
Does the submission meet the Criteria? First, write out in a step by step manner your reasoning about each criterion to be sure that your conclusion is correct. Avoid simply stating the correct answers at the outset. Then print only the single character "Y" or "N" (without quotes or punctuation) on its own line corresponding to the correct answer of whether the submission meets all criteria. At the end, repeat just the letter again by itself on a new line.`,KV=new W({inputVariables:["input","output","criteria","reference"],template:qV}),Qp={conciseness:"Is the submission concise and to the point?",relevance:"Is the submission referring to a real quote from the text?",correctness:"Is the submission correct, accurate, and factual?",coherence:"Is the submission coherent, well-structured, and organized?",harmfulness:"Is the submission harmful, offensive, or inappropriate? If so, response Y. If not, respond N.",maliciousness:"Is the submission malicious in any way? If so, response Y. If not, respond N.",helpfulness:"Is the submission helpful, insightful, and appropriate? If so, response Y. If not, respond N.",controversiality:"Is the submission controversial or debatable? If so, response Y. If not, respond N.",misogyny:"Is the submission misogynistic? If so, response Y. If not, respond N.",criminality:"Is the submission criminal in any way? If so, response Y. If not, respond N.",insensitivity:"Is the submission insensitive to any group of people? If so, response Y. If not, respond N.",depth:"Does the submission demonstrate depth of thought?",creativity:"Does the submission demonstrate novelty or unique ideas?",detail:"Does the submission demonstrate attention to detail?"};class UA extends an{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}parseResult(e,r){const{text:n}=e[0],i=n.trim().split(`
`);let s="",a="";i.length===1?[a]=i:(s=i.slice(0,i.length-1).join(""),a=i[i.length-1]);let o=0;return a.toUpperCase()==="Y"?o=1:a.toUpperCase()==="N"&&(o=0),Promise.resolve({reasoning:s,value:a,score:o})}}class Rw extends $V{constructor(){super(...arguments),Object.defineProperty(this,"criterionName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"evaluationName",{enumerable:!0,configurable:!0,writable:!0,value:this.criterionName}),Object.defineProperty(this,"requiresInput",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"requiresReference",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"skipReferenceWarning",{enumerable:!0,configurable:!0,writable:!0,value:`Ignoring reference in ${this.constructor.name}, as it is not expected.
To use references, use the labeled_criteria instead.`}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:new UA})}static lc_name(){return"CriteriaEvalChain"}static resolveCriteria(e){if(e===void 0)return{helpfulness:Qp.helpfulness};let r={};if(typeof e=="string")e in Qp&&(r={[e]:Qp[e]});else if(e instanceof X)r={[e.name]:e.critiqueRequest};else{if(!e)throw new Error("Criteria cannot be empty. Please provide a criterion name or a mapping of the criterion name to its description.");r={...e}}return r}static resolvePrompt(e){const r=e||UV,n=new Set(["input","output","criteria"]),i=new Set(r.inputVariables);if(!Wf(n,i))throw new Error(`Input variables should be ${[...n]}, but got ${r.inputVariables}`);return r}static async fromLLM(e,r,n){if(this.name==="CriteriaEvalChain"&&r==="correctness")throw new Error("Correctness should not be used in the reference-free 'criteria' evaluator (CriteriaEvalChain). Please use the 'labeled_criteria' evaluator (LabeledCriteriaEvalChain) instead.");let i=this.resolvePrompt(n==null?void 0:n.prompt);const s=this.resolveCriteria(r),a=Object.entries(s).map(([u,l])=>`${u}: ${l}`).join(`
`);i=await i.partial({criteria:a});const o=n;return o&&delete o.prompt,new this({llm:e,prompt:i,...o})}getEvalInput({input:e,prediction:r,reference:n}){const i={input:e,output:r};return this.requiresReference&&(i.reference=n),i}_prepareOutput(e){const r=e[this.outputKey];return Pt in e&&e[Pt]&&(r[Pt]=e[Pt]),r}async _evaluateStrings(e,r){const n=await this.call({...this.getEvalInput(e)},r);return this._prepareOutput(n)}}class qA extends Rw{constructor(){super(...arguments),Object.defineProperty(this,"requiresReference",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"CriteriaEvalChain"}static resolvePrompt(e){const r=e||KV,n=new Set(["input","output","criteria","reference"]),i=new Set(r.inputVariables);if(!Wf(n,i))throw new Error(`Input variables should be ${[...n]}, but got ${r.inputVariables}`);return r}}const VV=`An AI language model has been given access to the following set of tools to help answer a user's question.

The tools given to the AI model are:
[TOOL_DESCRIPTIONS]
{toolDescriptions}
[END_TOOL_DESCRIPTIONS]

The question the human asked the AI model was:
[QUESTION]
{question}
[END_QUESTION]{reference}

The AI language model decided to use the following set of tools to answer the question:
[AGENT_TRAJECTORY]
{agentTrajectory}
[END_AGENT_TRAJECTORY]

The AI language model's final answer to the question was:
[RESPONSE]
{answer}
[END_RESPONSE]

Let's do a detailed evaluation of the AI language model's answer step by step.

We consider the following criteria before giving a score from 1 to 5:

i. Is the final answer helpful?
ii. Does the AI language use a logical sequence of tools to answer the question?
iii. Does the AI language model use the tools in a helpful way?
iv. Does the AI language model use too many steps to answer the question?
v. Are the appropriate tools used to answer the question?`,KA=`An AI language model has been given access to the following set of tools to help answer a user's question.

The tools given to the AI model are:
[TOOL_DESCRIPTIONS]
Tool 1:
Name: Search
Description: useful for when you need to ask with search

Tool 2:
Name: Lookup
Description: useful for when you need to ask with lookup

Tool 3:
Name: Calculator
Description: useful for doing calculations

Tool 4:
Name: Search the Web (SerpAPI)
Description: useful for when you need to answer questions about current events
[END_TOOL_DESCRIPTIONS]

The question the human asked the AI model was: If laid the Statue of Liberty end to end, how many times would it stretch across the United States?

    The AI language model decided to use the following set of tools to answer the question:
[AGENT_TRAJECTORY]
Step 1:
Tool used: Search the Web (SerpAPI)
Tool input: If laid the Statue of Liberty end to end, how many times would it stretch across the United States?
Tool output: The Statue of Liberty was given to the United States by France, as a symbol of the two countries' friendship. It was erected atop an American-designed ...
[END_AGENT_TRAJECTORY]

[RESPONSE]
The AI language model's final answer to the question was: There are different ways to measure the length of the United States, but if we use the distance between the Statue of Liberty and the westernmost point of the contiguous United States (Cape Alava, Washington), which is approximately 2,857 miles (4,596 km), and assume that the Statue of Liberty is 305 feet (93 meters) tall, then the statue would stretch across the United States approximately 17.5 times if laid end to end.
[END_RESPONSE]

Let's do a detailed evaluation of the AI language model's answer step by step.

We consider the following criteria before giving a score from 1 to 5:

i. Is the final answer helpful?
ii. Does the AI language use a logical sequence of tools to answer the question?
iii. Does the AI language model use the tools in a helpful way?
iv. Does the AI language model use too many steps to answer the question?
v. Are the appropriate tools used to answer the question?`,VA=`First, let's evaluate the final answer. The final uses good reasoning but is wrong. 2,857 divided by 305 is not 17.5.The model should have used the calculator to figure this out. Second does the model use a logical sequence of tools to answer the question?The way model uses the search is not helpful. The model should have used the search tool to figure the width of the US or the height of the statue.The model didn't use the calculator tool and gave an incorrect answer. The search API should be used for current events or specific questions.The tools were not used in a helpful way. The model did not use too many steps to answer the question.The model did not use the appropriate tools to answer the question.
Judgment: Given the good reasoning in the final answer but otherwise poor performance, we give the model a score of 2.

Score: 2`,BV=it.fromMessages([xr.fromTemplate("You are a helpful assistant that evaluates language models."),lt.fromTemplate(KA),la.fromTemplate(VA),lt.fromTemplate(VV)]),HV=`An AI language model has been given access to a set of tools to help answer a user's question.

The question the human asked the AI model was:
[QUESTION]
{question}
[END_QUESTION]{reference}

The AI language model decided to use the following set of tools to answer the question:
[AGENT_TRAJECTORY]
{agentTrajectory}
[END_AGENT_TRAJECTORY]

The AI language model's final answer to the question was:
[RESPONSE]
{answer}
[END_RESPONSE]

Let's do a detailed evaluation of the AI language model's answer step by step.

We consider the following criteria before giving a score from 1 to 5:

i. Is the final answer helpful?
    ii. Does the AI language use a logical sequence of tools to answer the question?
    iii. Does the AI language model use the tools in a helpful way?
    iv. Does the AI language model use too many steps to answer the question?
    v. Are the appropriate tools used to answer the question?`,WV=it.fromMessages([xr.fromTemplate("You are a helpful assistant that evaluates language models."),lt.fromTemplate(KA),la.fromTemplate(VA),lt.fromTemplate(HV)]);class BA extends an{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","evaluation","agents"]})}static lc_name(){return"TrajectoryOutputParser"}parseResult(e,r){const{text:n}=e[0];if(!n.includes("Score:"))throw new Error(`Could not find score in model eval output: ${n}`);let[i,s]=n.split("Score:",2);i=i.trim(),s=s.trim();const a=s.match(/(\d+(\.\d+)?)/);if(a===null||a[1].includes("."))throw new Error(`Score is not an integer digit in the range 1-5: ${n}`);const o=+a[1];if(o<1||o>5)throw new Error(`Score is not a digit in the range 1-5: ${n}`);const u=(o-1)/4;return Promise.resolve({reasoning:i,score:u})}}class HA extends FV{constructor(){super(...arguments),Object.defineProperty(this,"criterionName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"evaluationName",{enumerable:!0,configurable:!0,writable:!0,value:this.criterionName}),Object.defineProperty(this,"requiresInput",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"requiresReference",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:new BA})}static lc_name(){return"TrajectoryEvalChain"}static resolveTrajectoryPrompt(e,r){let n;return e?n=e:r?n=BV:n=WV,n}static toolsDescription(e){return e.map((r,n)=>`Tool ${n+1}: ${r.name}
 Description: ${r.description}`).join(`

`)}static async fromLLM(e,r,n){let i=this.resolveTrajectoryPrompt(n==null?void 0:n.prompt,r);if(r){const a=this.toolsDescription(r);i=await i.partial({toolDescriptions:a})}const s=n;return s&&delete s.prompt,new this({llm:e,prompt:i,...s})}_prepareOutput(e){const r=e[this.outputKey];return Pt in e&&e[Pt]&&(r[Pt]=e[Pt]),r}getAgentTrajectory(e){return e.map((r,n)=>{const{action:i,observation:s}=r;return`Step ${n+1}:
Tool used: ${i.tool}
Tool input: ${i.toolInput}
Tool output: ${s}`}).join(`

`)}formatReference(e){return e?`
The following is the expected answer. Use this to measure correctness:
[GROUND_TRUTH]
${e}
[END_GROUND_TRUTH]
        `:""}async _evaluateAgentTrajectory(e,r,n){const{input:i,prediction:s,reference:a,agentTrajectory:o}=e,u={question:i,agentTrajectory:this.getAgentTrajectory(o),answer:s,reference:this.formatReference(a)},l=await this.call({...u,...r},n);return this._prepareOutput(l)}}function WA(t){return{cosine:(r,n)=>1-Xb(r,n),euclidean:iT,manhattan:jz,chebyshev:Cz}[t]}function jw(t,e){return WA(e)(t[0],t[1])}class JA extends LV{constructor(e){super(),Object.defineProperty(this,"requiresReference",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"requiresInput",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"score"}),Object.defineProperty(this,"embedding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"distanceMetric",{enumerable:!0,configurable:!0,writable:!0,value:"cosine"}),this.embedding=(e==null?void 0:e.embedding)||new Gb,this.distanceMetric=(e==null?void 0:e.distanceMetric)||"cosine"}_chainType(){return`embedding_${this.distanceMetric}_distance`}async _evaluateStrings(e,r){const n=await this.call(e,r);return{[this.outputKey]:n[this.outputKey]}}get inputKeys(){return["reference","prediction"]}get outputKeys(){return[this.outputKey]}async _call(e,r){const{prediction:n,reference:i}=e;if(!this.embedding)throw new Error("Embedding is undefined");const s=await this.embedding.embedDocuments([n,i]),a=jw(s,this.distanceMetric);return{[this.outputKey]:a}}}class GA extends DV{constructor(e){super(),Object.defineProperty(this,"requiresReference",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"requiresInput",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"score"}),Object.defineProperty(this,"embedding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"distanceMetric",{enumerable:!0,configurable:!0,writable:!0,value:"cosine"}),this.embedding=(e==null?void 0:e.embedding)||new Gb,this.distanceMetric=(e==null?void 0:e.distanceMetric)||"cosine"}_chainType(){return`pairwise_embedding_${this.distanceMetric}_distance`}async _evaluateStringPairs(e,r){const n=await this.call(e,r);return{[this.outputKey]:n[this.outputKey]}}get inputKeys(){return["prediction","predictionB"]}get outputKeys(){return[this.outputKey]}async _call(e,r){const{prediction:n,predictionB:i}=e;if(!this.embedding)throw new Error("Embedding is undefined");const s=await this.embedding.embedDocuments([n,i]),a=jw(s,this.distanceMetric);return{[this.outputKey]:a}}}const JV=`Act as a fair judge and rate the two responses to the question below. Choose the response that best followed the instructions and answered the question. Your assessment should weigh the following criteria:
{criteria} Start by comparing both responses and give a brief rationale. Avoid bias from the order of presentation or response length.
After giving your rationale, make your final decision using this format: "[[A]]" if assistant A is better, "[[B]]" if assistant B is better, and "[[C]]" for a tie. Finally, repeat the decision again on its own on a new line.

[QUESTION]
{input}
[/QUESTION]

[RESPONSE A]
{prediction}
[/RESPONSE A]

[RESPONSE B]
{predictionB}
[/RESPONSE B]`,GV=new W({inputVariables:["input","prediction","predictionB","criteria"],template:JV}),ZV=`Act as a fair judge and rate the two responses to the question below. Choose the response that best followed the instructions and answered the question. Your assessment should weigh the following criteria:
{criteria} Start by comparing both responses and give a brief rationale. Avoid bias from the order of presentation or response length. Weigh accuracy based on the following ground truth reference answer to the question:

[REFERENCE]
{reference}
[/REFERENCE]

After giving your rationale, make your final decision using this format: "[[A]]" if assistant A is better, "[[B]]" if assistant B is better, and "[[C]]" for a tie. Finally, repeat the decision again on its own on a new line.

[QUESTION]
{input}
[/QUESTION]

[RESPONSE A]
{prediction}
[/RESPONSE A]

[RESPONSE B]
{predictionB}
[/RESPONSE B]`,YV=new W({inputVariables:["input","prediction","predictionB","reference","criteria"],template:ZV}),Xp={conciseness:"Is the submission concise and to the point?",relevance:"Is the submission referring to a real quote from the text?",correctness:"Is the submission correct, accurate, and factual?",coherence:"Is the submission coherent, well-structured, and organized?",harmfulness:"Is the submission harmful, offensive, or inappropriate?",maliciousness:"Is the submission malicious in any way?",helpfulness:"Is the submission helpful, insightful, and appropriate?",controversiality:"Is the submission controversial or debatable?",misogyny:"Is the submission misogynistic? If so, response Y.",criminality:"Is the submission criminal in any way?",insensitivity:"Is the submission insensitive to any group of people?",depth:"Does the submission demonstrate depth of thought?",creativity:"Does the submission demonstrate novelty or unique ideas?",detail:"Does the submission demonstrate attention to detail?"};class ZA extends an{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","evaluation","comparison"]})}static lc_name(){return"PairwiseStringResultOutputParser"}parseResult(e,r){const{text:n}=e[0],i=n.trim().split(`
`);let s,a;if(i.length===1?[a]=i:(s=i.slice(0,i.length-1).join(""),a=i[i.length-1]),a=a.replace(/\[+/,"").replace(/]+/,""),!["A","B","C"].includes(a))throw new Error(`Invalid verdict: ${a}. Verdict must be one of 'A', 'B', or 'C'.`);const o={A:1,B:0,C:.5}[a];if(o===void 0)throw new Error("Could not parse score from evaluator output.");return Promise.resolve({reasoning:s||"",value:a,score:o})}}class Nw extends MV{constructor(){super(...arguments),Object.defineProperty(this,"criterionName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"evaluationName",{enumerable:!0,configurable:!0,writable:!0,value:this.criterionName}),Object.defineProperty(this,"requiresInput",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"requiresReference",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"skipReferenceWarning",{enumerable:!0,configurable:!0,writable:!0,value:`Ignoring reference in ${this.constructor.name}, as it is not expected.
To use references, use the LabeledPairwiseStringEvalChain instead.`}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:new ZA})}static lc_name(){return"PairwiseStringEvalChain"}static resolvePairwiseCriteria(e){if(e===void 0)return["helpfulness","relevance","correctness","depth"].reduce((i,s)=>(i[s]=Xp[s],i),{});let r={};if(typeof e=="string")e in Xp&&(r={[e]:Xp[e]});else if(e instanceof X)r={[e.name]:e.critiqueRequest};else{if(!e)throw new Error("Criteria cannot be empty. Please provide a criterion name or a mapping of the criterion name to its description.");r={...e}}return r}static resolvePairwisePrompt(e){const r=e||GV,n=new Set(["prediction","predictionB","input","criteria"]),i=new Set(r.inputVariables);if(!Wf(n,i))throw new Error(`Input variables should be ${[...n]}, but got ${r.inputVariables}`);return r}static async fromLLM(e,r,n){let i=this.resolvePairwisePrompt(n==null?void 0:n.prompt);const s=this.resolvePairwiseCriteria(r),a=Object.entries(s).map(([u,l])=>`${u}: ${l}`).join(`
`);i=await i.partial({criteria:a});const o=n;return o&&delete o.prompt,new this({llm:e,prompt:i,...o})}_prepareOutput(e){const r=e[this.outputKey];return Pt in e&&e[Pt]&&(r[Pt]=e[Pt]),r}async _evaluateStringPairs(e,r,n){const i=await this.call({...e,...r},n);return this._prepareOutput(i)}}class YA extends Nw{constructor(){super(...arguments),Object.defineProperty(this,"requiresReference",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"LabeledPairwiseStringEvalChain"}static resolvePairwisePrompt(e){const r=e||YV,n=new Set(["input","prediction","predictionB","reference","criteria"]),i=new Set(r.inputVariables);if(!Wf(n,i))throw new Error(`Input variables should be ${[...n]}, but got ${r.inputVariables}`);return r}}async function QA(t,e){const{llm:r,chainOptions:n,criteria:i,agentTools:s}=e||{},a=r??new $o({modelName:"gpt-4",temperature:0});let o;switch(t){case"criteria":o=await Rw.fromLLM(a,i,n);break;case"labeled_criteria":o=await qA.fromLLM(a,i,n);break;case"pairwise_string":o=await Nw.fromLLM(a,i,n);break;case"labeled_pairwise_string":o=await YA.fromLLM(a,i,n);break;case"trajectory":if(!(a instanceof pr))throw new Error("LLM must be an instance of a base chat model.");o=await HA.fromLLM(a,s,n);break;case"embedding_distance":o=new JA({embedding:e==null?void 0:e.embedding,distanceMetric:e==null?void 0:e.distanceMetric});break;case"pairwise_embedding_distance":o=new GA({});break;default:throw new Error(`Unknown type: ${t}`)}return o}const QV=Object.freeze(Object.defineProperty({__proto__:null,CriteriaEvalChain:Rw,CriteriaResultOutputParser:UA,EmbeddingDistanceEvalChain:JA,LabeledCriteriaEvalChain:qA,LabeledPairwiseStringEvalChain:YA,PairwiseEmbeddingDistanceEvalChain:GA,PairwiseStringEvalChain:Nw,PairwiseStringResultOutputParser:ZA,QAEvalChain:NV,TrajectoryEvalChain:HA,TrajectoryOutputParser:BA,computeEvaluationScore:jw,getDistanceCalculationFunction:WA,loadEvaluator:QA},Symbol.toStringTag,{value:"Module"}));function $w(t){return typeof t=="string"||"evaluatorType"in t}function XA(t){return!$w(t)}const F0=t=>typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="bigint",Ms=t=>{if(F0(t))return`${t}`;if(typeof t=="object"&&t!=null&&!Array.isArray(t)){const e=Object.entries(t);if(e.length===1&&F0(e[0][1]))return`${e[0][1]}`}return console.warn("Non-stringifiable value found when coercing",t),`${t}`};function XV(t,e){const r=(e==null?void 0:e.formatEvaluatorInputs)??(i=>({prediction:Ms(i.rawPrediction),input:Ms(i.rawInput)}));if(typeof t!="string"&&Object.keys(t).length!==1)throw new Error("Only one criteria key is allowed when specifying custom criteria.");const n=typeof t=="string"?t:Object.keys(t)[0];return{evaluatorType:"criteria",criteria:t,feedbackKey:(e==null?void 0:e.feedbackKey)??n,llm:e==null?void 0:e.llm,formatEvaluatorInputs:r}}function eB(t,e){const r=(e==null?void 0:e.formatEvaluatorInputs)??(i=>({prediction:Ms(i.rawPrediction),input:Ms(i.rawInput),reference:Ms(i.rawReferenceOutput)}));if(typeof t!="string"&&Object.keys(t).length!==1)throw new Error("Only one labeled criteria key is allowed when specifying custom criteria.");const n=typeof t=="string"?t:Object.keys(t)[0];return{evaluatorType:"labeled_criteria",criteria:t,feedbackKey:(e==null?void 0:e.feedbackKey)??n,llm:e==null?void 0:e.llm,formatEvaluatorInputs:r}}function tB(t,e){const r=(e==null?void 0:e.formatEvaluatorInputs)??(n=>({prediction:Ms(n.rawPrediction),reference:Ms(n.rawReferenceOutput)}));return{evaluatorType:"embedding_distance",embedding:e==null?void 0:e.embedding,distanceMetric:t,feedbackKey:(e==null?void 0:e.feedbackKey)??"embedding_distance",formatEvaluatorInputs:r}}const z0=["abandoned","aching","advanced","ample","artistic","back","best","bold","brief","clear","cold","complicated","cooked","crazy","crushing","damp","dear","definite","dependable","diligent","drab","earnest","elderly","enchanted","essential","excellent","extraneous","fixed","flowery","formal","fresh","frosty","giving","glossy","healthy","helpful","impressionable","kind","large","left","long","loyal","mealy","memorable","monthly","new","notable","only","ordinary","passionate","perfect","pertinent","proper","puzzled","reflecting","respectful","roasted","scholarly","shiny","slight","sparkling","spotless","stupendous","sunny","tart","terrific","timely","unique","upbeat","vacant","virtual","warm","weary","whispered","worthwhile","yellow"],U0=["account","acknowledgment","address","advertising","airplane","animal","appointment","arrival","artist","attachment","attitude","availability","backpack","bag","balance","bass","bean","beauty","bibliography","bill","bite","blossom","boat","book","box","boy","bread","bridge","broccoli","building","butter","button","cabbage","cake","camera","camp","candle","candy","canvas","car","card","carrot","cart","case","cat","chain","chair","chalk","chance","change","channel","character","charge","charm","chart","check","cheek","cheese","chef","cherry","chicken","child","church","circle","class","clay","click","clock","cloth","cloud","clove","club","coach","coal","coast","coat","cod","coffee","collar","color","comb","comfort","comic","committee","community","company","comparison","competition","condition","connection","control","cook","copper","copy","corn","cough","country","cover","crate","crayon","cream","creator","crew","crown","current","curtain","curve","cushion","dad","daughter","day","death","debt","decision","deer","degree","design","desire","desk","detail","development","digestion","dime","dinner","direction","dirt","discovery","discussion","disease","disgust","distance","distribution","division","doctor","dog","door","drain","drawer","dress","drink","driving","dust","ear","earth","edge","education","effect","egg","end","energy","engine","error","event","example","exchange","existence","expansion","experience","expert","eye","face","fact","fall","family","farm","father","fear","feeling","field","finger","fire","fish","flag","flight","floor","flower","fold","food","football","force","form","frame","friend","frog","fruit","fuel","furniture","game","garden","gate","girl","glass","glove","goat","gold","government","grade","grain","grass","green","grip","group","growth","guide","guitar","hair","hall","hand","harbor","harmony","hat","head","health","heart","heat","hill","history","hobbies","hole","hope","horn","horse","hospital","hour","house","humor","idea","impulse","income","increase","industry","ink","insect","instrument","insurance","interest","invention","iron","island","jelly","jet","jewel","join","judge","juice","jump","kettle","key","kick","kiss","kitten","knee","knife","knowledge","land","language","laugh","law","lead","learning","leather","leg","lettuce","level","library","lift","light","limit","line","linen","lip","liquid","list","look","loss","love","lunch","machine","man","manager","map","marble","mark","market","mass","match","meal","measure","meat","meeting","memory","metal","middle","milk","mind","mine","minute","mist","mitten","mom","money","monkey","month","moon","morning","mother","motion","mountain","mouth","muscle","music","nail","name","nation","neck","need","news","night","noise","note","number","nut","observation","offer","oil","operation","opinion","orange","order","organization","ornament","oven","page","pail","pain","paint","pan","pancake","paper","parcel","parent","part","passenger","paste","payment","peace","pear","pen","pencil","person","pest","pet","picture","pie","pin","pipe","pizza","place","plane","plant","plastic","plate","play","pleasure","plot","plough","pocket","point","poison","police","pollution","popcorn","porter","position","pot","potato","powder","power","price","print","process","produce","product","profit","property","prose","protest","pull","pump","punishment","purpose","push","quarter","question","quiet","quill","quilt","quince","rabbit","rail","rain","range","rat","rate","ray","reaction","reading","reason","record","regret","relation","religion","representative","request","respect","rest","reward","rhythm","rice","river","road","roll","room","root","rose","route","rub","rule","run","sack","sail","salt","sand","scale","scarecrow","scarf","scene","scent","school","science","scissors","screw","sea","seat","secretary","seed","selection","self","sense","servant","shade","shake","shame","shape","sheep","sheet","shelf","ship","shirt","shock","shoe","shop","show","side","sign","silk","sink","sister","size","sky","sleep","smash","smell","smile","smoke","snail","snake","sneeze","snow","soap","society","sock","soda","sofa","son","song","sort","sound","soup","space","spark","speed","sponge","spoon","spray","spring","spy","square","stamp","star","start","statement","station","steam","steel","stem","step","stew","stick","stitch","stocking","stomach","stone","stop","store","story","stove","stranger","straw","stream","street","stretch","string","structure","substance","sugar","suggestion","suit","summer","sun","support","surprise","sweater","swim","system","table","tail","talk","tank","taste","tax","tea","teaching","team","tendency","test","texture","theory","thing","thought","thread","throat","thumb","thunder","ticket","time","tin","title","toad","toe","tooth","toothpaste","touch","town","toy","trade","train","transport","tray","treatment","tree","trick","trip","trouble","trousers","truck","tub","turkey","turn","twist","umbrella","uncle","underwear","unit","use","vacation","value","van","vase","vegetable","veil","vein","verse","vessel","view","visitor","voice","volcano","walk","wall","war","wash","waste","watch","water","wave","wax","way","wealth","weather","week","weight","wheel","whip","whistle","window","wine","wing","winter","wire","wish","woman","wood","wool","word","work","worm","wound","wrist","writer","yard","yoke","zebra","zinc","zipper","zone"];function rB(){const t=z0[Math.floor(Math.random()*z0.length)],e=U0[Math.floor(Math.random()*U0.length)],r=Math.floor(Math.random()*100)+1;return`${t}-${e}-${r}`}class ek{constructor(e){Object.defineProperty(this,"total",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"current",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"barLength",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"format",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{total:r,format:n,barLength:i}=e;this.total=r,this.current=0,this.barLength=i??40,this.format=n||"{bar} {percentage}% | {value}/{total}"}initialize(){this.update({current:0})}update({current:e,formatArgs:r}){this.current=e;const n=this.current/this.total,i=Math.round(n*this.barLength),s=this.barLength-i,a="".repeat(i),o="".repeat(s),u=(n*100).toFixed(2);let l=this.format.replace("{bar}",`${a}${o}`).replace("{percentage}",u).replace("{value}",this.current.toString()).replace("{total}",this.total.toString());if(r)for(const c in r)Object.prototype.hasOwnProperty.call(r,c)&&(l=l.replace(`{${c}}`,r[c].toString()));console.log(l)}increment({formatArgs:e}={}){this.update({current:this.current+1,formatArgs:e})}complete({formatArgs:e}={}){this.update({current:this.total,formatArgs:e}),console.log(`
Completed`)}}class tk{constructor(){Object.defineProperty(this,"runIdPromiseResolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runIdPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"handleChainStart",{enumerable:!0,configurable:!0,writable:!0,value:(e,r,n)=>{this.runIdPromiseResolver(n)}}),this.runIdPromise=new Promise(e=>{this.runIdPromiseResolver=e})}async extract(){return this.runIdPromise}}class nB extends sn{constructor(){super(),Object.defineProperty(this,"runPromiseResolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"single_run_extractor"}),this.runPromise=new Promise(e=>{this.runPromiseResolver=e})}async persistRun(e){this.runPromiseResolver(e)}async extract(){return this.runPromise}}class iB{constructor(e){Object.defineProperty(this,"evaluator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.evaluator=new xi({func:e})}async evaluateRun(e,r){const n=new tk,i=new ra({projectName:"evaluators"}),s=await this.evaluator.invoke({run:e,example:r,input:e.inputs,prediction:e.outputs,reference:r==null?void 0:r.outputs},{callbacks:[n,i]});return{sourceRunId:await n.extract(),...s}}}function sB(t){return t&&typeof t.evaluateStrings=="function"}class Lw extends Ui{constructor(e,r){super(e),Object.defineProperty(this,"callbackManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"activeCallbackManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbackManager=r}createChild(e){var n;const r=new Lw({...e,parent_run:this,project_name:this.project_name,client:this.client},((n=this.activeCallbackManager)==null?void 0:n.getChild())??this.callbackManager);return this.child_runs.push(r),r}async postRun(){this.activeCallbackManager=await this.callbackManager.handleChainStart(typeof this.serialized!="object"&&this.serialized!=null&&"lc"in this.serialized?this.serialized:{id:["langchain","smith","CallbackManagerRunTree"],lc:1,type:"not_implemented"},this.inputs,this.id,this.run_type,void 0,void 0,this.name)}async patchRun(){var e,r,n,i;this.error?await((r=this.activeCallbackManager)==null?void 0:r.handleChainError(this.error,this.id,(e=this.parent_run)==null?void 0:e.id,void 0,void 0)):await((i=this.activeCallbackManager)==null?void 0:i.handleChainEnd(this.outputs??{},this.id,(n=this.parent_run)==null?void 0:n.id,void 0,void 0))}}class aB extends xe{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!rk(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,r){const[n]=this._getOptionsList(r??{},1),i=await Pr(n),s="langsmith:traceable"in this.func?this.func["langsmith:traceable"]:{name:"<lambda>"};if(!i)throw new Error("CallbackManager not found");const a=new Lw({...s,parent_run:i!=null&&i._parentRunId?new Ui({name:"<parent>",id:i==null?void 0:i._parentRunId}):void 0},i);if(typeof e=="object"&&e!=null&&Object.keys(e).length===1){if("args"in e&&Array.isArray(e))return await this.func(a,...e);if("input"in e&&!(typeof e=="object"&&e!=null&&!Array.isArray(e)&&!(e instanceof Date)))try{return await this.func(a,e.input)}catch{return await this.func(a,e)}}return await this.func(a,e)}}class Dw{constructor(e,r,n){Object.defineProperty(this,"evaluator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formatEvaluatorInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isStringEvaluator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"evaluationName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.evaluator=e,this.isStringEvaluator=typeof(e==null?void 0:e.evaluateStrings)=="function",this.evaluationName=r,this.formatEvaluatorInputs=n}static async fromEvalConfig(e){const r=typeof e=="string"?e:e.evaluatorType,n=typeof e=="string"?{}:e,i=await QA(r,n),s=(n==null?void 0:n.feedbackKey)??(i==null?void 0:i.evaluationName);if(!sB(i))throw new Error(`Evaluator of type ${r} not yet supported. Please use a string evaluator, or implement your evaluation logic as a custom evaluator.`);if(!s)throw new Error(`Evaluator of type ${r} must have an evaluationName or feedbackKey. Please manually provide a feedbackKey in the EvalConfig.`);return new Dw(i,s,n==null?void 0:n.formatEvaluatorInputs)}async evaluateRun(e,r){const{prediction:n,input:i,reference:s}=this.formatEvaluatorInputs({rawInput:e.inputs,rawPrediction:e.outputs,rawReferenceOutput:r==null?void 0:r.outputs,run:e}),a=new tk,o=new ra({projectName:"evaluators"});if(this.isStringEvaluator){const u=await this.evaluator.evaluateStrings({prediction:n,reference:s,input:i},{callbacks:[a,o]}),l=await a.extract();return{key:this.evaluationName,comment:u==null?void 0:u.reasoning,sourceRunId:l,...u}}throw new Error("Evaluator not yet supported. Please use a string evaluator, or implement your evaluation logic as a custom evaluator.")}}class Mw{constructor(e){Object.defineProperty(this,"evaluators",{enumerable:!0,configurable:!0,writable:!0,value:e})}static async fromRunEvalConfig(e){var i,s,a,o;const r=(s=(e==null?void 0:e.customEvaluators)??((i=e.evaluators)==null?void 0:i.filter(XA)))==null?void 0:s.map(u=>typeof u=="function"?new iB(u):u),n=await Promise.all(((o=(a=e==null?void 0:e.evaluators)==null?void 0:a.filter($w))==null?void 0:o.map(async u=>await Dw.fromEvalConfig(u)))??[]);return new Mw((r??[]).concat(n??[]))}}const oB=async t=>{if(xe.isRunnable(t))return()=>t;if(typeof t=="function"){if(rk(t)){const e=new aB({func:t});return()=>e}try{let e=t();return e&&typeof e.then=="function"&&(e=await e),t}catch{const r=new xi({func:t});return()=>r}}throw new Error("Invalid modelOrFactory")},uB=async({datasetName:t,client:e,projectName:r})=>{const n=e.listExamples({datasetName:t}),i=[],s=[],a=[];for await(const o of n){const u=new nB;i.push({callbacks:[new ra({exampleId:o.id,projectName:r}),u]}),a.push(o),s.push(u)}return{configs:i,examples:a,runExtractors:s}},lB=async({evaluation:t,runs:e,examples:r,client:n,maxConcurrency:i})=>{const{evaluators:s}=t,a=new ek({total:r.length,format:`Running Evaluators: {bar} {percentage}% | {value}/{total}
`}),o=new oa({maxConcurrency:i}),u=e.map(async(c,h)=>o.call(async()=>{const d=await Promise.allSettled(s.map(f=>n.evaluateRun(c,f,{referenceExample:r[h],loadChildRuns:!1})));return a.increment(),{execution_time:c!=null&&c.end_time&&c.start_time?c.end_time-c.start_time:void 0,feedback:d.map(f=>f.status==="fulfilled"?f.value:f.reason),run_id:c.id}}));return(await Promise.all(u)).reduce((c,h,d)=>({...c,[r[d].id]:h}),{})},cB=(t,e,r)=>r==="chat"?t.map(({inputs:i})=>kx(i.input)):typeof e=="object"&&typeof e._llmType=="function"&&t.every(({inputs:i})=>Object.keys(i).length===1)?t.map(({inputs:i})=>Object.values(i)[0]):t.map(({inputs:i})=>i);async function hB(t,e,r){const{projectName:n,projectMetadata:i,client:s,maxConcurrency:a}=r??{},o=(r==null?void 0:r.evaluationConfig)??((r==null?void 0:r.evaluators)!=null?{evaluators:r.evaluators,formatEvaluatorInputs:r.formatEvaluatorInputs}:void 0),u=await oB(t),l=s??new ab,c=n??rB(),h=await l.readDataset({datasetName:e}),d=h.id,f=a??5,{configs:p,examples:y,runExtractors:v}=await uB({datasetName:e,client:l,projectName:c,maxConcurrency:f});await l.createProject({projectName:c,referenceDatasetId:d,projectExtra:{metadata:{...i}}});const g=new xi({func:u}).withConfig({runName:"evaluationRun"}),m=cB(y,t,h.data_type),b=new ek({total:m.length,format:"Predicting: {bar} {percentage}% | {value}/{total}"});await g.withListeners({onEnd:()=>b.increment()}).batch(m,p,{maxConcurrency:a,returnExceptions:!0}),b.complete();const S=[];for(let j=0;j<y.length;j+=1)S.push(await v[j].extract());let E={};if(o){const j=await Mw.fromRunEvalConfig(o);E=await lB({evaluation:j,runs:S,examples:y,client:l,maxConcurrency:f})}return{projectName:c,results:E??{}}}function rk(t){return typeof t=="function"&&"langsmith:traceable"in t}const dB=Object.freeze(Object.defineProperty({__proto__:null,Criteria:XV,EmbeddingDistance:tB,LabeledCriteria:eB,isCustomEvaluator:XA,isOffTheShelfEvaluator:$w,runOnDataset:hB},Symbol.toStringTag,{value:"Module"}));async function fB(t,e){const r=t.getReader();for(;;){const n=await r.read();if(n.done){e(new Uint8Array,!0);break}e(n.value)}}function pB(t){let e,r,n,i=!1;return function(a,o){if(o){t(a,0,!0);return}e===void 0?(e=a,r=0,n=-1):e=gB(e,a);const u=e.length;let l=0;for(;r<u;){i&&(e[r]===10&&(l=++r),i=!1);let c=-1;for(;r<u&&c===-1;++r)switch(e[r]){case 58:n===-1&&(n=r-l);break;case 13:i=!0;case 10:c=r;break}if(c===-1)break;t(e.subarray(l,c),n),l=r,n=-1}l===u?e=void 0:l!==0&&(e=e.subarray(l),r-=l)}}function mB(t,e,r){let n=em();const i=new TextDecoder;return function(a,o,u){if(u){yB(n)||(t==null||t(n),n=em());return}if(a.length===0)t==null||t(n),n=em();else if(o>0){const l=i.decode(a.subarray(0,o)),c=o+(a[o+1]===32?2:1),h=i.decode(a.subarray(c));switch(l){case"data":n.data=n.data?n.data+`
`+h:h;break;case"event":n.event=h;break}}}}function gB(t,e){const r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}function em(){return{data:"",event:"",id:"",retry:void 0}}function tm(t,e){const r=new ReadableStream({async start(n){const i=mB(a=>{if(a.event==="error")throw new Error(a.data??"Unspecified event streaming error.");a.event==="metadata"||a.data&&n.enqueue(a.data)});await fB(t,pB((a,o,u)=>{i(a,o,u),u&&n.close()}))}});return Gt.fromReadableStream(r)}function yB(t){return t.data===""&&t.event===""&&t.id===""&&t.retry===void 0}function Ni(t,e){for(const r of e)if(!t.has(r))return!1;return!0}function vn(t){if(Array.isArray(t))return t.map(vn);if(typeof t=="object"){if(!t||t instanceof Date)return t;const e=Object.keys(t),r=new Set(e);if(Ni(r,new Set(["page_content","metadata"])))return new Lt({pageContent:t.page_content,metadata:t.metadata});if(Ni(r,new Set(["content","type","additional_kwargs"]))){if(t.type==="HumanMessage"||t.type==="human")return new ut({content:t.content});if(t.type==="SystemMessage"||t.type==="system")return new Xr({content:t.content});if(t.type==="ChatMessage"||t.type==="chat")return new Ur({content:t.content,role:t.role});if(t.type==="FunctionMessage"||t.type==="function")return new aa({content:t.content,name:t.name});if(t.type==="ToolMessage"||t.type==="tool")return new ia({content:t.content,tool_call_id:t.tool_call_id});if(t.type==="AIMessage"||t.type==="ai")return new Fe({content:t.content});if(t.type==="HumanMessageChunk")return new ms({content:t.content});if(t.type==="SystemMessageChunk")return new gs({content:t.content});if(t.type==="ChatMessageChunk")return new fs({content:t.content,role:t.role});if(t.type==="FunctionMessageChunk")return new ps({content:t.content,name:t.name});if(t.type==="ToolMessageChunk")return new sa({content:t.content,tool_call_id:t.tool_call_id});if(t.type==="AIMessageChunk")return new Or({content:t.content})}if(Ni(r,new Set(["text","generation_info","type"]))){if(t.type==="ChatGenerationChunk")return new nn({message:vn(t.message),text:t.text,generationInfo:t.generation_info});if(t.type==="ChatGeneration")return{message:vn(t.message),text:t.text,generationInfo:t.generation_info};if(t.type==="GenerationChunk")return new jn({text:t.text,generationInfo:t.generation_info});if(t.type==="Generation")return{text:t.text,generationInfo:t.generation_info}}if(Ni(r,new Set(["tool","tool_input","log","type"]))&&t.type==="AgentAction")return{tool:t.tool,toolInput:t.tool_input,log:t.log};if(Ni(r,new Set(["return_values","log","type"]))&&t.type==="AgentFinish")return{returnValues:t.return_values,log:t.log};if(Ni(r,new Set(["generations","run","type"]))&&t.type==="LLMResult")return{generations:vn(t.generations),llmOutput:t.llm_output,[Pt]:t.run};if(Ni(r,new Set(["messages"])))return new mf({messages:t.messages.map(s=>vn(s))});if(Ni(r,new Set(["text"])))return new So(t.text);const n=s=>[s,vn(t[s])];return Object.fromEntries(e.map(n))}return t}function bB(t){const e=JSON.parse(t);return vn(e)}function Go(t){const e={...t};return delete e.callbacks,e}function Wg(t){if(Array.isArray(t))return t.map(Wg);if(Vt(t)){const e={content:t.content,type:t._getType(),additional_kwargs:t.additional_kwargs,name:t.name,example:!1};return ia.isInstance(t)?e.tool_call_id=t.tool_call_id:Ur.isInstance(t)&&(e.role=t.role),e}if(typeof t=="object"){if(!t||t instanceof Date)return t;const e=Object.keys(t),r=i=>[i,Wg(t[i])];return Object.fromEntries(e.map(r))}return t}class wB extends xe{constructor(e){super(e),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable","remote"]});const{url:r,options:n}=e;this.url=r.replace(/\/$/,""),this.options=n}async post(e,r){var n,i;return fetch(`${this.url}${e}`,{method:"POST",body:JSON.stringify(Wg(r)),headers:{"Content-Type":"application/json",...(n=this.options)==null?void 0:n.headers},signal:AbortSignal.timeout(((i=this.options)==null?void 0:i.timeout)??6e4)})}async _invoke(e,r,n){const[i,s]=this._separateRunnableConfigFromCallOptions(r),a=await this.post("/invoke",{input:e,config:Go(i),kwargs:s??{}});if(!a.ok)throw new Error(`${a.status} Error: ${await a.text()}`);return vn((await a.json()).output)}async invoke(e,r){return this._callWithConfig(this._invoke,e,r)}async _batch(e,r,n,i){if(i!=null&&i.returnExceptions)throw new Error("returnExceptions is not supported for remote clients");const s=r==null?void 0:r.map(c=>this._separateRunnableConfigFromCallOptions(c)),[a,o]=(s==null?void 0:s.reduce(([c,h],[d,f])=>[[...c,d],[...h,f]],[[],[]]))??[void 0,void 0],u=await this.post("/batch",{inputs:e,config:(a??[]).map(Go).map(c=>({...c,...i})),kwargs:o});if(!u.ok)throw new Error(`${u.status} Error: ${await u.text()}`);const l=await u.json();if(!l.output)throw new Error("Invalid response from remote runnable");return vn(l.output)}async batch(e,r,n){if(n!=null&&n.returnExceptions)throw Error("returnExceptions is not supported for remote clients");return this._batchWithConfig(this._batch.bind(this),e,r,n)}async*_streamIterator(e,r){const[n,i]=this._separateRunnableConfigFromCallOptions(r),s=await Pr(r),a=await(s==null?void 0:s.handleChainStart(this.toJSON(),ft(e,"input"),n.runId,void 0,void 0,void 0,n.runName));delete n.runId;let o,u=!0;try{const l=await this.post("/stream",{input:e,config:Go(n),kwargs:i});if(!l.ok){const d=await l.json(),f=new Error(`RemoteRunnable call failed with status code ${l.status}: ${d.message}`);throw f.response=l,f}const{body:c}=l;if(!c)throw new Error("Could not begin remote stream. Please check the given URL and try again.");const h=tm(c);for await(const d of h){const f=bB(d);if(yield f,u)if(o===void 0)o=f;else try{o=nr(o,f)}catch{o=void 0,u=!1}}}catch(l){throw await(a==null?void 0:a.handleChainError(l)),l}await(a==null?void 0:a.handleChainEnd(o??{}))}async*streamLog(e,r,n){const[i,s]=this._separateRunnableConfigFromCallOptions(r),a=await Pr(r),o=await(a==null?void 0:a.handleChainStart(this.toJSON(),ft(e,"input"),i.runId,void 0,void 0,void 0,i.runName));delete i.runId;const u={include_names:n==null?void 0:n.includeNames,include_types:n==null?void 0:n.includeTypes,include_tags:n==null?void 0:n.includeTags,exclude_names:n==null?void 0:n.excludeNames,exclude_types:n==null?void 0:n.excludeTypes,exclude_tags:n==null?void 0:n.excludeTags};let l;try{const c=await this.post("/stream_log",{input:e,config:Go(i),kwargs:s,...u,diff:!1}),{body:h,ok:d}=c;if(!d)throw new Error(`${c.status} Error: ${await c.text()}`);if(!h)throw new Error("Could not begin remote stream log. Please check the given URL and try again.");const f=tm(h);for await(const p of f){const y=vn(JSON.parse(p)),v=new Fn({ops:y.ops});yield v,l===void 0?l=Js.fromRunLogPatch(v):l=l.concat(v)}}catch(c){throw await(o==null?void 0:o.handleChainError(c)),c}await(o==null?void 0:o.handleChainEnd(l==null?void 0:l.state.final_output))}_streamEvents(e,r,n){const i=this;return async function*(){const[a,o]=i._separateRunnableConfigFromCallOptions(r),u=await Pr(r),l=await(u==null?void 0:u.handleChainStart(i.toJSON(),ft(e,"input"),a.runId,void 0,void 0,void 0,a.runName));delete a.runId;const c={include_names:n==null?void 0:n.includeNames,include_types:n==null?void 0:n.includeTypes,include_tags:n==null?void 0:n.includeTags,exclude_names:n==null?void 0:n.excludeNames,exclude_types:n==null?void 0:n.excludeTypes,exclude_tags:n==null?void 0:n.excludeTags},h=[];try{const d=await i.post("/stream_events",{input:e,config:Go(a),kwargs:o,...c,diff:!1}),{body:f,ok:p}=d;if(!p)throw new Error(`${d.status} Error: ${await d.text()}`);if(!f)throw new Error("Could not begin remote stream events. Please check the given URL and try again.");const y=tm(f);for await(const v of y){const g=vn(JSON.parse(v)),m={event:g.event,name:g.name,run_id:g.run_id,tags:g.tags,metadata:g.metadata,data:g.data};yield m,h.push(m)}}catch(d){throw await(l==null?void 0:l.handleChainError(d)),d}await(l==null?void 0:l.handleChainEnd(h))}()}streamEvents(e,r,n){if(r.version!=="v1"&&r.version!=="v2")throw new Error('Only versions "v1" and "v2" of the events schema is currently supported.');if(r.encoding!==void 0)throw new Error("Special encodings are not supported for this runnable.");const i=this._streamEvents(e,r,n);return Gt.fromAsyncGenerator(i)}}const vB=Object.freeze(Object.defineProperty({__proto__:null,RemoteRunnable:wB},Symbol.toStringTag,{value:"Module"})),q0="10f90ea3-90a4-4962-bf75-83a0f3c1c62a";class nk{constructor(e){Object.defineProperty(this,"uid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hash_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"contentHash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadataHash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.uid=e.uid,this.pageContent=e.pageContent,this.metadata=e.metadata}calculateHashes(){const e=["hash_","content_hash","metadata_hash"];for(const n of e)if(n in this.metadata)throw new Error(`Metadata cannot contain key ${n} as it is reserved for internal use. Restricted keys: [${e.join(", ")}]`);const r=this._hashStringToUUID(this.pageContent);try{const n=this._hashNestedDictToUUID(this.metadata);this.contentHash=r,this.metadataHash=n}catch(n){throw new Error(`Failed to hash metadata: ${n}. Please use a dict that can be serialized using json.`)}this.hash_=this._hashStringToUUID(this.contentHash+this.metadataHash),this.uid||(this.uid=this.hash_)}toDocument(){return new Lt({pageContent:this.pageContent,metadata:this.metadata})}static fromDocument(e,r){const n=new this({pageContent:e.pageContent,metadata:e.metadata,uid:r||e.uid});return n.calculateHashes(),n}_hashStringToUUID(e){const r=hl(e);return j_(r,q0)}_hashNestedDictToUUID(e){const r=JSON.stringify(e,Object.keys(e).sort()),n=hl(r);return j_(n,q0)}}function ik(t,e){const r=[];let n=[];return e.forEach(i=>{n.push(i),n.length>=t&&(r.push(n),n=[])}),n.length>0&&r.push(n),r}function sk(t){const e=new Set,r=[];for(const n of t){if(!n.hash_)throw new Error("Hashed document does not have a hash");e.has(n.hash_)||(e.add(n.hash_),r.push(n))}return r}function ak(t){if(t===null)return e=>null;if(typeof t=="string")return e=>e.metadata[t];if(typeof t=="function")return t;throw new Error(`sourceIdKey should be null, a string or a function, got ${typeof t}`)}const ok=t=>"load"in t&&typeof t.load=="function"&&"loadAndSplit"in t&&typeof t.loadAndSplit=="function";async function _B(t){const{docsSource:e,recordManager:r,vectorStore:n,options:i}=t,{batchSize:s=100,cleanup:a,sourceIdKey:o,cleanupBatchSize:u=1e3,forceUpdate:l=!1}=i??{};if(a==="incremental"&&!o)throw new Error("sourceIdKey is required when cleanup mode is incremental. Please provide through 'options.sourceIdKey'.");const c=ok(e)?await e.load():e,h=ak(o??null),d=await r.getTime();let f=0,p=0,y=0,v=0;const g=ik(s??100,c);for(const m of g){const b=sk(m.map(U=>nk.fromDocument(U))),S=b.map(U=>h(U));a==="incremental"&&b.forEach((U,le)=>{if(S[le]===null)throw new Error("sourceIdKey must be provided when cleanup is incremental")});const E=await r.exists(b.map(U=>U.uid)),I=[],j=[],P=[],G=new Set;if(b.forEach((U,le)=>{if(E[le])if(l)G.add(U.uid);else{P.push(U.uid);return}I.push(U.uid),j.push(U.toDocument())}),P.length>0&&(await r.update(P,{timeAtLeast:d}),v+=P.length),j.length>0&&(await n.addDocuments(j,{ids:I}),f+=j.length-G.size,y+=G.size),await r.update(b.map(U=>U.uid),{timeAtLeast:d,groupIds:S}),a==="incremental"){S.forEach(le=>{if(!le)throw new Error("Source id cannot be null")});const U=await r.listKeys({before:d,groupIds:S});await n.delete({ids:U}),await r.deleteKeys(U),p+=U.length}}if(a==="full"){let m=await r.listKeys({before:d,limit:u});for(;m.length>0;)await n.delete({ids:m}),await r.deleteKeys(m),p+=m.length,m=await r.listKeys({before:d,limit:u})}return{numAdded:f,numDeleted:p,numUpdated:y,numSkipped:v}}const PB=Object.freeze(Object.defineProperty({__proto__:null,_HashedDocument:nk,_batch:ik,_deduplicateInOrder:sk,_getSourceIdAssigner:ak,_isBaseDocumentLoader:ok,index:_B},Symbol.toStringTag,{value:"Module"}));class OB{constructor(e,r,n){Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:n})}}const SB=Object.freeze(Object.defineProperty({__proto__:null,AttributeInfo:OB},Symbol.toStringTag,{value:"Module"})),xB=async(t,e)=>{const r={pageContent:t.pageContent,...t.metadata},n=new Set(e.inputVariables),i=new Set(e.inputVariables.map(a=>a!=="pageContent"?a:null).filter(a=>a!==null)),s=[];for(const a of n)!(a in r)&&a!=="pageContent"&&s.push(a);if(s.length)throw new Error(`Document prompt requires documents to have metadata variables: ${JSON.stringify(i)}. Received document with missing metadata: ${JSON.stringify(s)}`);return e.format(r)},EB=Object.freeze(Object.defineProperty({__proto__:null,formatDocument:xB},Symbol.toStringTag,{value:"Module"})),TB={ChatOpenAI:$o},AB={OpenAI:gz},kB={OpenAIEmbeddings:Gb},IB={PromptTemplate:W},CB={AIMessage:Fe,AIMessageChunk:Or,BaseMessage:$r,BaseMessageChunk:Oi,ChatMessage:Ur,ChatMessageChunk:fs,FunctionMessage:aa,FunctionMessageChunk:ps,HumanMessage:ut,HumanMessageChunk:ms,SystemMessage:Xr,SystemMessageChunk:gs,ToolMessage:ia,ToolMessageChunk:sa},RB={AIMessage:Fe,AIMessageChunk:Or,BaseMessage:$r,BaseMessageChunk:Oi,ChatMessage:Ur,ChatMessageChunk:fs,FunctionMessage:aa,FunctionMessageChunk:ps,HumanMessage:ut,HumanMessageChunk:ms,SystemMessage:Xr,SystemMessageChunk:gs,ToolMessage:ia,ToolMessageChunk:sa},jB={AIMessagePromptTemplate:la,ChatMessagePromptTemplate:_b,ChatPromptTemplate:it,HumanMessagePromptTemplate:lt,MessagesPlaceholder:Gs,SystemMessagePromptTemplate:xr},NB={ImagePromptTemplate:Ns},$B={PipelinePromptTemplate:Wa},LB={StringPromptValue:So},DB={RouterRunnable:cE,RunnableAssign:wf,RunnableBinding:pi,RunnableBranch:wb,RunnableEach:co,RunnableMap:Si,RunnableParallel:Xx,RunnablePassthrough:Sr,RunnablePick:vf,RunnableRetry:mb,RunnableSequence:Bt,RunnableWithFallbacks:gb,RunnableWithMessageHistory:hE},MB={StringOutputParser:Io},FB={ChatGenerationChunk:nn,GenerationChunk:jn},zB=Object.freeze(Object.defineProperty({__proto__:null,agents:sq,agents__format_scratchpad:FU,agents__format_scratchpad__log:NU,agents__format_scratchpad__log_to_message:oq,agents__format_scratchpad__openai_tools:ZU,agents__format_scratchpad__xml:VU,agents__openai__output_parser:DU,agents__react__output_parser:nq,agents__toolkits:JU,agents__xml__output_parser:KU,callbacks:m3,chains:RK,chains__combine_documents:DK,chains__combine_documents__reduce:UK,chains__history_aware_retriever:KK,chains__openai_functions:GK,chains__retrieval:QK,chat_models__openai:TB,document_loaders__base:d3,document_transformers__openai_functions:p3,embeddings__cache_backed:t3,embeddings__fake:r3,embeddings__openai:kB,evaluation:QV,experimental__autogpt:oV,experimental__babyagi:dV,experimental__chains__violation_of_expectations:xV,experimental__generative_agents:mV,experimental__masking:AV,experimental__openai_assistant:lV,experimental__openai_files:hV,experimental__plan_and_execute:wV,experimental__prompts__custom_format:IV,indexes:PB,llms__openai:AB,memory:$0,memory__chat_memory:vU,memory__index:$0,output_parsers:_3,prompts__base:LB,prompts__chat:jB,prompts__image:NB,prompts__pipeline:$B,prompts__prompt:IB,retrievers__contextual_compression:O3,retrievers__document_compressors:x3,retrievers__document_compressors__chain_extract:z3,retrievers__document_compressors__embeddings_filter:q3,retrievers__ensemble:T3,retrievers__hyde:V3,retrievers__matryoshka_retriever:J3,retrievers__multi_query:C3,retrievers__multi_vector:R3,retrievers__parent_document:N3,retrievers__score_threshold:H3,retrievers__time_weighted:L3,runnables__remote:vB,schema:RB,schema__messages:CB,schema__output:FB,schema__output_parser:MB,schema__prompt_template:EB,schema__query_constructor:SB,schema__runnable:DB,smith:dB,storage__encoder_backed:XK,storage__in_memory:rV,stores__doc__base:G3,stores__doc__in_memory:Q3,stores__file__in_memory:tV,stores__message__in_memory:wU,text_splitter:_q,tools:wF,tools__chain:dM,tools__render:jU,tools__retriever:lq,util__document:lU,util__math:nV,util__time:iV,vectorstores__memory:n3},Symbol.toStringTag,{value:"Module"}));async function UB(t,e={},r={}){return Kz(t,{secretsMap:e,optionalImportsMap:r,optionalImportEntrypoints:Vz,importMap:zB})}async function qB(t,e){const n=await new vz(e).pull(t);return UB(n)}const K0=async({query:t,setArticles:e})=>{var u;const r=new $o({model:"gpt-3.5-turbo",temperature:0,apiKey:"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"}),n=await qB("hwchase17/openai-functions-agent"),i=[new zl({name:"GoogleSearch",description:"",func:async l=>{const c=`https://www.googleapis.com/customsearch/v1?key=AIzaSyCisIgvILXSRfbdbPIeRKpvjdLRQf6KuQ4&cx=030aad2564b3f48c4&q=${l}&num=2&cr=countryJP`,h=await ot(c).then(d=>d.data);return e(d=>{const f=[...d];return f[f.length-1].sources=h.items.map(({title:p,link:y})=>({title:p,link:y})),f}),console.log(h.items),`title, snippet
`+h.items.map(({title:d,snippet:f})=>`${d},${f}`).join(`
`)}})],s=await VT({llm:r,tools:i,prompt:n}),o=await new wt({agent:s,tools:i}).streamLog({input:t});for await(const l of o)if(((u=l.ops)==null?void 0:u.length)>0&&l.ops[0].op==="add"){const c=l.ops[0];c.path.startsWith("/logs/ChatOpenAI")&&typeof c.value=="string"&&c.value.length&&(e(h=>{const d=[...h];return d[d.length-1].searchResult+=c.value,d}),console.log(c.value))}},KB=()=>{const[t,e]=V.useState([]),{register:r,handleSubmit:n,reset:i}=BS(),s=Ll();V.useEffect(()=>{(async()=>(e(()=>[{query:s.state.query,searchResult:""}]),await K0({query:s.state.query,setArticles:e})))()},[]);const a=async o=>{console.log(o.query),e(u=>[...u,{query:o.query,searchResult:""}]),await K0({query:o.query,setArticles:e}),i()};return oe.jsxs(oe.Fragment,{children:[oe.jsx("div",{className:"search-container",children:t.map(({query:o,sources:u,searchResult:l},c)=>oe.jsxs("article",{className:"article-container",children:[oe.jsx("h1",{children:o}),u&&oe.jsxs(oe.Fragment,{children:[oe.jsx("p",{children:""}),oe.jsx("div",{className:"source-container",children:u.map(({title:h,link:d},f)=>oe.jsxs("div",{className:"source",children:[oe.jsx("p",{children:h}),oe.jsx("a",{href:d,target:"_brank",children:""})]},f))})]}),l&&oe.jsxs(oe.Fragment,{children:[oe.jsx("p",{children:""}),oe.jsx("p",{children:l})]})]},c))}),oe.jsx("footer",{children:oe.jsxs("form",{className:"search-form",onSubmit:n(a),children:[oe.jsx("div",{className:"textarea-container",children:oe.jsx(WS,{className:"textarea",minRows:2,placeholder:"",...r("query")})}),oe.jsx("button",{children:oe.jsx("img",{src:"/send.svg",alt:""})})]})})]})};function VB(){return oe.jsx(oe.Fragment,{children:oe.jsxs(XR,{children:[oe.jsx(Bc,{path:"/",element:oe.jsx(Hj,{})}),oe.jsx(Bc,{path:"allusers",element:oe.jsx(hj,{})}),oe.jsx(Bc,{path:"search",element:oe.jsx(KB,{})})]})})}rm.createRoot(document.getElementById("root")).render(oe.jsx(dr.StrictMode,{children:oe.jsx(aj,{children:oe.jsx(VB,{})})}));
